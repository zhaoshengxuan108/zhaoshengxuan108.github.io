<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.122.0">
    <meta name="generator" content="Relearn 5.23.2+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="ÂïäÂïäÂïäÂïä">
    <meta name="author" content="S√∂ren Weber">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://example.com/images/hero.png">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="OIT Introduction In the Blending chapter, the subject of color blending was introduced. Blending is the way of implementing transparent surfaces in a 3D scene. In short, transparency delves into the subject of drawing semi-solid or fully see-through objects like glasses in computer graphics. The idea is explained up to a suitable point in that chapter, so if you&rsquo;re unfamiliar with the topic, better read Blending first.
In this article, we are scratching the surface of this topic a bit further, since there are so many techniques involved in implementing such an effect in a 3D environment.">
    <meta property="og:title" content="">
    <meta property="og:description" content="OIT Introduction In the Blending chapter, the subject of color blending was introduced. Blending is the way of implementing transparent surfaces in a 3D scene. In short, transparency delves into the subject of drawing semi-solid or fully see-through objects like glasses in computer graphics. The idea is explained up to a suitable point in that chapter, so if you&rsquo;re unfamiliar with the topic, better read Blending first.
In this article, we are scratching the surface of this topic a bit further, since there are so many techniques involved in implementing such an effect in a 3D environment.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://example.com/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2020/index.html">
    <meta property="og:image" content="https://example.com/images/hero.png">
    <meta property="article:section" content="Learn OpenGL :: Hugo Relearn Theme">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <title></title><link rel="icon" href="../../../../../images/favicon.ico">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../../../../css/fontawesome-all.min.css?1708235000" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/fontawesome-all.min.css?1708235000" rel="stylesheet"></noscript>
    <link href="../../../../../css/nucleus.css?1708235000" rel="stylesheet">
    <link href="../../../../../css/auto-complete.css?1708235000" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/auto-complete.css?1708235000" rel="stylesheet"></noscript>
    <link href="../../../../../css/perfect-scrollbar.min.css?1708235000" rel="stylesheet">
    <link href="../../../../../css/fonts.css?1708235000" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/fonts.css?1708235000" rel="stylesheet"></noscript>
    <link href="../../../../../css/theme.css?1708235000" rel="stylesheet">
    <link href="../../../../../css/theme-auto.css?1708235000" rel="stylesheet" id="R-variant-style">
    <link href="../../../../../css/variant.css?1708235000" rel="stylesheet">
    <link href="../../../../../css/print.css?1708235000" rel="stylesheet" media="print">
    <link href="../../../../../css/ie.css?1708235000" rel="stylesheet">
    <script src="../../../../../js/url.js?1708235000"></script>
    <script src="../../../../../js/variant.js?1708235000"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../../../../index.search.js";
      var root_url="../../../../../";
      var baseUri=root_url.replace(/\/$/, '');
      window.relearn = window.relearn || {};
      window.relearn.baseUriFull='https:\/\/example.com/';
      // variant stuff
      window.variants && variants.init( [ 'auto', 'relearn-light', 'relearn-dark', 'zen-light', 'zen-dark', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    <style>
      #R-body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support html" data-url="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2020/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
              <button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)">
                <i class="fa-fw fas fa-bars"></i>
              </button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)">
                <i class="fa-fw fas fa-list-alt"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../index.html"><span itemprop="name">‰∏ªÈ°µ</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/index.html"><span itemprop="name">ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/index.html"><span itemprop="name">ÁªèÂÖ∏ÊïôÁ®ã</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/index.html"><span itemprop="name">OpenGLÊïôÁ®ã</span></a><meta itemprop="position" content="4">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html"><span itemprop="name">Learn OpenGL</span></a><meta itemprop="position" content="5">&nbsp;>&nbsp;</li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2020/index.print.html" title="Print whole chapter (CTRL&#43;ALT&#43;p)">
                <i class="fa-fw fas fa-print"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html" title="Learn OpenGL (ü°ê)">
                <i class="fa-fw fas fa-chevron-left"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html" title="OGL dev ÊïôÁ®ã (ü°í)">
                <i class="fa-fw fas fa-chevron-right"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More">
                <i class="fa-fw fas fa-ellipsis-v"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<h4 id="oit">OIT</h4>
<h5 id="introduction">Introduction</h5>
<p>In the <a href="https://learnopengl.com/Advanced-OpenGL/Blending" target="_blank">Blending</a> chapter, the subject of color blending was introduced. Blending is the way of implementing transparent surfaces in a 3D scene. In short, transparency delves into the subject of drawing semi-solid or fully see-through objects like glasses in computer graphics. The idea is explained up to a suitable point in that chapter, so if you&rsquo;re unfamiliar with the topic, better read Blending first.</p>
<p>In this article, we are scratching the surface of this topic a bit further, since there are so many techniques involved in implementing such an effect in a 3D environment.</p>
<p>To begin with, we are going to discuss about the limitations of the graphics library/hardware and the hardships they entail, and the reason that why transparency is such a tricky subject. Later on, we will introduce and briefly review some of the more well-known transparency techniques that have been invented and used for the past twenty years associated with the current hardware. Ultimately, we are going to focus on explaining and implementing one of them, which will be the subject of the following part of this article.</p>
<p>Note that the goal of this article is to introduce techniques which have significantly better performance than the technique that was used in the Blending chapter. Otherwise, there isn&rsquo;t a genuinely compelling reason to expand on that matter.</p>
<h5 id="graphics-libraryhardware-limitations">Graphics library/hardware limitations</h5>
<p>The reason that this article exists, and you&rsquo;re reading it, is that there is no direct way to draw transparent surfaces with the current technology. Many people wish, that it was as simple as turning on a flag in their graphics API, but that&rsquo;s a fairy tale. Whether, this is a limitation of the graphics libraries or video cards, that&rsquo;s debatable.</p>
<p>As explained in the Blending chapter, the source of this problem arises from combining depth testing and color blending. At the fragment stage, there is no buffer like the depth buffer for transparent pixels that would tell the graphics library, which pixels are fully visible or semi-visible. One of the reasons could be, that there is no efficient way of storing the information of transparent pixels in such a buffer that can hold an infinite number of pixels for each coordinate on the screen. Since each transparent pixel could expose its underlying pixels, therefore there needs to be a way to store different layers of all pixels for all screen coordinates.</p>
<p>This limitation leaves us to think for a way to overcome such an issue and since neither the graphics library nor the hardware gives us a hand, this all has to be done by the developer with the tools at hand. We will examine two methods which are prominent in this subject. One being, ordered transparency and the other order-independent transparency.</p>
<h5 id="ordered-transparency">Ordered transparency</h5>
<p>The most convenient solution to overcome this issue, is to sort your transparent objects, so they&rsquo;re either drawn from the furthest to the nearest, or from the nearest to the furthest in relation to the camera&rsquo;s position. This way, the depth testing wouldn&rsquo;t affect the outcome of those pixels that have been drawn after/before but over/under a further/closer object. However major the expenditure this method entails for the CPU, it was used in many early games that probably most of us have played.</p>
<p>For example, the sample image below shows the importance of blending order. The top part of the image produces an incorrect result with unordered alpha blending, while the bottom correctly sorts the geometry. Note lower visibility of the skeletal structure without correct depth ordering. This image is from <a href="http://gpuopen.com/archive/gpu-demos/radeon-hd-5000-series-graphics-real-time-demos/" target="_blank">ATI Mecha Demo</a>:</p>
<p><a href="#R-image-2604a3384fea3b870ffd3aaec5aa4917" class="lightbox-link"><img src="./assets/ATI_Mecha_Demo_Screenshot.jpg" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2604a3384fea3b870ffd3aaec5aa4917"><img src="./assets/ATI_Mecha_Demo_Screenshot.jpg" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>So far, we have understood that in order to overcome the limitation of current technology to draw transparent objects, we need order for our transparent objects to be displayed properly on the screen. Ordering takes away performance from your application, and since most of 3D applications are running in real-time, this will be so much more evident as you perform sorting at every frame.</p>
<p>Therefore, we will be looking into the world of order-independent transparency techniques and to find one which better suits our purpose and furthermore our pipeline, so we don&rsquo;t have to sort the objects before drawing.</p>
<h5 id="order-independent-transparency">Order-independent transparency</h5>
<p>Order-independent transparency or for short OIT, is a technique which doesn&rsquo;t require us to draw our transparent objects in an orderly fashion. At first glance, this will give us back the CPU cycles that we were taking for sorting the objects, but at the same time OIT techniques have their pros and cons.</p>
<p>The goal of OIT techniques is to eliminate the need of sorting transparent objects at draw time. Depending on the technique, some of them must sort fragments for an accurate result, but only at a later stage when all the draw calls have been made, and some of them don&rsquo;t require sorting, but results are approximated.</p>
<h5 id="history">History</h5>
<p>Some of the more advanced techniques that have been invented to overcome the limitation of rendering transparent surfaces, explicitly use a buffer (e.g. a linked list or a 3D array such as [x][y][z]) that can hold multiple layers of pixels&rsquo; information and can sort pixels on the GPU, normally because of its parallel processing power, as opposed to CPU.</p>
<p><note>The <a href="https://en.wikipedia.org/wiki/A-buffer" target="_blank">A-buffer</a> is a computer graphics technique introduced in 1984 which stores per-pixel lists of fragment data (including <a href="https://en.wikipedia.org/wiki/Micropolygon" target="_blank">micro-polygon</a> information) in a software rasterizer, <a href="https://en.wikipedia.org/wiki/Reyes_rendering" target="_blank">REYES</a>, originally designed for anti-aliasing but also supporting transparency.</note></p>
<p>At the same time, there has been hardware capable of facilitating this task by performing on-hardware calculations which is the most convenient way for a developer to have access to transparency out of the box.</p>
<p><note><a href="https://en.wikipedia.org/wiki/Dreamcast#Hardware" target="_blank">SEGA Dreamcast</a> was one of the few consoles that had automatic per-pixel translucency sorting, implemented in its hardware.</note></p>
<p>Commonly, OIT techniques are separated into two categories which are exact and approximate. Respectively, exact will result in better images with an accurate transparency which suits every scenario, while approximate although resulting in good-looking images, lacks accuracy in complex scenes.</p>
<h5 id="exact-oit">Exact OIT</h5>
<p>These techniques accurately compute the final color, for which all fragments must be sorted. For high depth complexity scenes, sorting becomes the bottleneck.</p>
<p>One issue with the sorting stage is local memory limited occupancy, in this case a <a href="https://en.wikipedia.org/wiki/Single_Instruction_Multiple_Threads" target="_blank">single instruction, multiple threads</a> attribute relating to the throughput and operation latency hiding of GPUs. Although, <a href="http://diglib.eg.org/handle/10.2312/PE.PG.PG2013short.059-064" target="_blank">BMA</a> (backwards memory allocation) can group pixels by their depth complexity and sort them in batches to improve the occupancy and hence performance of low depth complexity pixels in the context of a potentially high depth complexity scene. Up to a 3√ó overall OIT performance increase is reported.</p>
<p><note>The sorting stage requires relatively large amounts of temporary memory in shaders that is usually conservatively allocated at a maximum, which impacts memory occupancy and performance.</note></p>
<p>Sorting is typically performed in a local array, however performance can be improved further by making use of the GPU&rsquo;s memory hierarchy and sorting in registers, similarly to an <a href="https://en.wikipedia.org/wiki/External_sorting#External_merge_sort" target="_blank">external merge sort</a>, especially in conjunction with BMA.</p>
<h5 id="approximate-oit">Approximate OIT</h5>
<p>Approximate OIT techniques relax the constraint of exact rendering to provide faster results. Higher performance can be gained from not having to store all fragments or only partially sorting the geometry. A number of techniques also compress, or reduce, the fragment data. These include:</p>
<ul>
<li>Stochastic Transparency: draw in a higher resolution in full opacity but discard some fragments. Down-sampling will then yield transparency.</li>
<li>Adaptive Transparency: a two-pass technique where the first constructs a visibility function which compresses on the fly (this compression avoids having to fully sort the fragments) and the second uses this data to composite unordered fragments. Intel&rsquo;s pixel synchronization avoids the need to store all fragments, removing the unbounded memory requirement of many other OIT techniques.</li>
</ul>
<h5 id="techniques">Techniques</h5>
<p>Some of the OIT techniques that have been commonly used in the industry are as follows:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Depth_peeling" target="_blank">Depth peeling</a>: Introduced in 2001, described a hardware accelerated OIT technique which utilizes the depth buffer to peel a layer of pixels at each pass. With limitations in graphics hardware the scene&rsquo;s geometry had to be rendered many times.</li>
<li><a href="http://developer.download.nvidia.com/SDK/10/opengl/src/dual_depth_peeling/doc/DualDepthPeeling.pdf" target="_blank">Dual depth peeling</a>: Introduced in 2008, improves on the performance of depth peeling, still with many-pass rendering limitation.</li>
<li><a href="http://jcgt.org/published/0002/02/09/" target="_blank">Weighted, blended</a>: Published in 2013, utilizes a weighting function and two buffers for pixel color and pixel reveal threshold for the final composition pass. Results in an approximated image with a decent quality in complex scenes.</li>
</ul>
<h5 id="implementation">Implementation</h5>
<p>The usual way of performing OIT in 3D applications is to do it in multiple passes. There are at least three passes required for an OIT technique to be performed, so in order to do this, you&rsquo;ll have to have a perfect understanding of how <a href="https://learnopengl.com/Advanced-OpenGL/Framebuffers" target="_blank">Framebuffers</a> work in OpenGL. Once you&rsquo;re comfortable with Framebuffers, it all boils down to the implementation complexity of the technique you are trying to implement.</p>
<p>Briefly explained, the three passes involved are as follows:</p>
<ol>
<li>First pass, is where you draw all of your solid objects, this means any object that does not let the light travel through its geometry.</li>
<li>Second pass, is where you draw all of your translucent objects. Objects that need alpha discarding, can be rendered in the first pass.</li>
<li>Third pass, is where you composite the images that resulted from two previous passes and draw that image onto your backbuffer.</li>
</ol>
<p>This routine is almost identical in implementing OIT techniques across all different pipelines.</p>
<p>In the next part of this article, we are going to implement weighted, blended OIT which is one of the easiest and high performance OIT techniques that has been used in the video game industry for the past ten years.</p>
<h5 id="further-reading">Further reading</h5>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Dreamcast#Hardware" target="_blank">SEGA Dreamcast Hardware</a>: Dreamcast was one of the few consoles that had hardware implemented order-independent transparency.</li>
<li><a href="https://en.wikipedia.org/wiki/Order-independent_transparency" target="_blank">Order-independent transparency</a>: A series of techniques that have a great performance and produce nice results even with the approximated methods.</li>
<li><a href="http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html" target="_blank">Weighted, blended order-independent transparency</a>: One of the easiest OIT techniques in terms of implementation while producing highly acceptable images for complex scenes.</li>
</ul>
<h5 id="weighted-blended">Weighted Blended</h5>
<p>Weighted, Blended is an approximate order-independent transparency technique which was published in the <a href="http://jcgt.org/published/0002/02/09/" target="_blank">journal of computer graphics techniques</a> in 2013 by Morgan McGuire and Louis Bavoil at NVIDIA to address the transparency problem on a broad class of then gaming platforms.</p>
<p>Their approach to avoid the cost of storing and sorting primitives or fragments is to alter the compositing operator so that it is order independent, thus allowing a pure streaming approach.</p>
<p>Most games have ad-hoc and scene-dependent ways of working around transparent surface rendering limitations. These include limited sorting, additive-only blending, and hard-coded render and composite ordering. Most of these methods also break at some point during gameplay and create visual artifacts. One not-viable alternative is <a href="http://developer.download.nvidia.com/SDK/10/opengl/screenshots/samples/dual_depth_peeling.html" target="_blank">depth peeling</a>, which produces good images, but is too slow for scenes with many layers both in theory and practice.</p>
<p>There are many <a href="https://en.wikipedia.org/wiki/Asymptotic_analysis" target="_blank">asymptotically</a> fast solutions for transparency rendering, such as bounded A-buffer approximations using programmable blending (e.g., <a href="http://software.intel.com/en-us/articles/multi-layer-alpha-blending" target="_blank">Marco Salvi&rsquo;s work</a>), stochastic transparency (as <a href="https://www.computer.org/csdl/journal/tg/2011/08/ttg2011081036/13rRUxBa55X" target="_blank">explained by Eric Enderton and others</a>), and ray tracing. One or more of these will probably dominate at some point, but all were impractical on the game platforms of five or six years ago, including PC DX11/GL4 GPUs, mobile devices with OpenGL ES 3.0 GPUs, and last-generation consoles like PlayStation 4.</p>
<p><note>In mathematical analysis, asymptotic analysis, also known as asymptotics, is a method of describing limiting behavior.</note></p>
<p>The below image is a transparent CAD view of a car engine rendered by this technique.</p>
<p><a href="#R-image-23a203317170b7f58b42037def126b71" class="lightbox-link"><img src="./assets/cad_view_of_an_engine.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-23a203317170b7f58b42037def126b71"><img src="./assets/cad_view_of_an_engine.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h5 id="theory">Theory</h5>
<p>This technique renders non-refractive, monochrome transmission through surfaces that themselves have color, without requiring sorting or new hardware features. In fact, it can be implemented with a simple shader for any GPU that supports blending to render targets with more than 8 bits per channel.</p>
<p>It works best on GPUs with multiple render targets and floating-point texture, where it is faster than sorted transparency and avoids sorting artifacts and popping for particle systems. It also consumes less bandwidth than even a 4-deep RGBA8 K-buffer and allows mixing low-resolution particles with full-resolution surfaces such as glass.</p>
<p>For the mixed resolution case, the peak memory cost remains that of the higher resolution render target but bandwidth cost falls based on the proportional of low-resolution surfaces.</p>
<p>The basic idea of Weighted, Blended method is to compute the coverage of the background by transparent surfaces exactly, but to only approximate the light scattered towards the camera by the transparent surfaces themselves. The algorithm imposes a heuristic on inter-occlusion factor among transparent surfaces that increases with distance from the camera.</p>
<p><note>A heuristic technique, or a heuristic, is any approach to problem solving or self-discovery that employs a practical method that is not guaranteed to be optimal, perfect, or rational, but is nevertheless sufficient for reaching an immediate, short-term goal or approximation. In our case, the heuristic is the weighting function.</note></p>
<p>After all transparent surfaces have been rendered, it then performs a full-screen normalization and compositing pass to reduce errors where the heuristic was a poor approximation of the true inter-occlusion.</p>
<p>The below image is a glass chess set rendered with this technique. Note that the glass pieces are not refracting any light.</p>
<p><a href="#R-image-2dc348d36768ad160caeb881bd0ed00b" class="lightbox-link"><img src="./assets/a_glass_chess_set.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2dc348d36768ad160caeb881bd0ed00b"><img src="./assets/a_glass_chess_set.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>For a better understanding and a more detailed explanation of the weight function, please refer to page 5, 6 and 7 of the original paper as the Blended OIT has been implemented and improved by different methods along the years. Link to the paper is provided at the end of this article.</p>
<h5 id="limitation">Limitation</h5>
<p>The primary limitation of the technique is that the weighting heuristic must be tuned for the anticipated depth range and opacity of transparent surfaces.</p>
<p>The technique was implemented in OpenGL for the <a href="http://g3d.sf.net/" target="_blank">G3D Innovation Engine</a> and DirectX for the <a href="http://www.unrealengine.com/" target="_blank">Unreal Engine</a> to produce the results live and in the paper. Dan Bagnell and Patrick Cozzi <a href="http://bagnell.github.io/cesium/Apps/Sandcastle/gallery/OIT.html" target="_blank">implemented it in WebGL</a> for their open-source Cesium engine (see also their <a href="http://cesiumjs.org/2014/03/14/Weighted-Blended-Order-Independent-Transparency/" target="_blank">blog post</a> discussing it).</p>
<p>From those implementations, a good set of weighting functions were found, which are reported in the journal paper. In the paper, they also discuss how to spot artifacts from a poorly-tuned weighting function and fix them.</p>
<p>Also, I haven&rsquo;t been able to find a proper way to implement this technique in a deferred renderer. Since pixels override each other in a deferred renderer, we lose information about the previous layers so we cannot correctly accumulate the color values for the lighting stage.</p>
<p>One feasible solution is to apply this technique as you would ordinarily do in a forward renderer. This is basically borrowing the transparency pass of a forward renderer and incorporate it in a deferred one.</p>
<h5 id="implementation-1">Implementation</h5>
<p>This technique is fairly straight forward to implement and the shader modifications are very simple. If you&rsquo;re familiar with how Framebuffers work in OpenGL, you&rsquo;re almost halfway there.</p>
<p>The only caveat is we need to write our code in OpenGL ^4.0 to be able to use blending to multiple render targets (e.g. utilizing glBlendFunci). In the paper, different ways of implementation have been discussed for libraries that do not support rendering or blending to multiple targets.</p>
<p><warning>Don&rsquo;t forget to change your OpenGL version when initializng GLFW and also your GLSL version in your shaders.</warning></p>
<h5 id="overview">Overview</h5>
<p>During the transparent surface rendering, shade surfaces as usual, but output to two render targets. The first render target (accum) must have at least RGBA16F precision and the second (revealage) must have at least R8 precision. Clear the first render target to vec4(0) and the second render target to 1 (using a pixel shader or glClearBuffer + glClear).</p>
<p>Then, render the surfaces in any order to these render targets, adding the following to the bottom of the pixel shader and using the specified blending modes:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// your first render target which is used to accumulate pre-multiplied color values
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">out</span> <span class="n">vec4</span> <span class="n">accum</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// your second render target which is used to store pixel revealage
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">out</span> <span class="kt">float</span> <span class="n">reveal</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">// output linear (not gamma encoded!), unmultiplied color from the rest of the shader
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="n">vec4</span> <span class="n">color</span> <span class="o">=</span> <span class="p">...</span> <span class="c1">// regular shading code
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">// insert your favorite weighting function here. the color-based factor
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// avoids color pollution from the edges of wispy clouds. the z-based
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// factor gives precedence to nearer surfaces
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="kt">float</span> <span class="n">weight</span> <span class="o">=</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">max</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">g</span><span class="p">),</span> <span class="n">color</span><span class="p">.</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">),</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">clamp</span><span class="p">(</span><span class="mf">0.03</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e-5</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)),</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">3e3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1">// blend func: GL_ONE, GL_ONE
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">// switch to pre-multiplied alpha and weight
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span><span class="n">accum</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">rgb</span> <span class="o">*</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1">// blend func: GL_ZERO, GL_ONE_MINUS_SRC_ALPHA
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="c1"></span><span class="n">reveal</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">;</span></span></span></code></pre></div><p>Finally, after all surfaces have been rendered, composite the result onto the screen using a full-screen pass:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// bind your accum render target to this texture unit
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">binding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">rt0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// bind your reveal render target to this texture unit
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">binding</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">rt1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// shader output
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="n">out</span> <span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// fetch pixel information
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="n">vec4</span> <span class="n">accum</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">rt0</span><span class="p">,</span> <span class="n">int2</span><span class="p">(</span><span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="kt">float</span> <span class="n">reveal</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">rt1</span><span class="p">,</span> <span class="n">int2</span><span class="p">(</span><span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="p">),</span> <span class="mi">0</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// blend func: GL_ONE_MINUS_SRC_ALPHA, GL_SRC_ALPHA
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="n">color</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">accum</span><span class="p">.</span><span class="n">rgb</span> <span class="o">/</span> <span class="n">max</span><span class="p">(</span><span class="n">accum</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="n">reveal</span><span class="p">);</span></span></span></code></pre></div><p>Use this table as a reference for your render targets:</p>
<p><a href="#R-image-41dc115799b76172b7b374aabcdde2b6" class="lightbox-link"><img src="./assets/20240215115113.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-41dc115799b76172b7b374aabcdde2b6"><img src="./assets/20240215115113.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>A total of three rendering passes are needed to accomplish the finished result which is down below:</p>
<p><a href="#R-image-0bf1e055d49ebdf2c409ad77067d6d8c" class="lightbox-link"><img src="./assets/weighted_blended_result.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0bf1e055d49ebdf2c409ad77067d6d8c"><img src="./assets/weighted_blended_result.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h5 id="details">Details</h5>
<p>To get started, we would have to setup a quad for our solid and transparent surfaces. The red quad will be the solid one, and the green and blue will be the transparent one. Since we&rsquo;re using the same quad for our screen quad as well, here we define UV values for texture mapping purposes at the screen pass.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">float</span> <span class="n">quadVertices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="c1">// positions        // uv
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>	<span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">     <span class="mf">1.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">     <span class="mf">1.0f</span><span class="p">,</span>  <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">     <span class="mf">1.0f</span><span class="p">,</span>  <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>  <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">// quad VAO
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">quadVAO</span><span class="p">,</span> <span class="n">quadVBO</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">glGenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quadVBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">quadVBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">quadVertices</span><span class="p">),</span> <span class="n">quadVertices</span><span class="p">,</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="mi">3</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></span></span></code></pre></div><p>Next, we will create two framebuffers for our solid and transparent passes. Our solid pass needs a color buffer and a depth buffer to store color and depth information. Our transparent pass needs two color buffers to store color accumulation and pixel revealage threshold. We will also attach the opaque framebuffer&rsquo;s depth texture to our transparent framebuffer, to utilize it for depth testing when rendering our transparent surfaces.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// set up framebuffers
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">opaqueFBO</span><span class="p">,</span> <span class="n">transparentFBO</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opaqueFBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">transparentFBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">// set up attachments for opaque framebuffer
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">opaqueTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opaqueTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">opaqueTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA16F</span><span class="p">,</span> <span class="n">SCR_WIDTH</span><span class="p">,</span> <span class="n">SCR_HEIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_HALF_FLOAT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depthTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">depthTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">depthTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span> <span class="n">SCR_WIDTH</span><span class="p">,</span> <span class="n">SCR_HEIGHT</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">             <span class="mi">0</span><span class="p">,</span> <span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="c1">// set up attachments for transparent framebuffer
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">accumTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">accumTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">accumTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA16F</span><span class="p">,</span> <span class="n">SCR_WIDTH</span><span class="p">,</span> <span class="n">SCR_HEIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_HALF_FLOAT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">revealTexture</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">revealTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">revealTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_R8</span><span class="p">,</span> <span class="n">SCR_WIDTH</span><span class="p">,</span> <span class="n">SCR_HEIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RED</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="c1">// don&#39;t forget to explicitly tell OpenGL that your transparent framebuffer has two draw buffers
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="n">GLenum</span> <span class="n">transparentDrawBuffers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">,</span> <span class="n">GL_COLOR_ATTACHMENT1</span> <span class="p">};</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="n">glDrawBuffers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">transparentDrawBuffers</span><span class="p">);</span></span></span></code></pre></div><p><note>For the sake of this article, we are creating two separate framebuffers, so it would be easier to understand how the technique unfolds. We could omit the opaque framebuffer and use backbuffer for our solid pass or just create a single framebuffer with four attachments all together (opaque, accumulation, revealage, depth) and render to different render targets at each pass.</note></p>
<p>Before rendering, setup some model matrices for your quads. You can set the Z axis however you want since this is an order-independent technique and objects closer or further to the camera would not impose any problem.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">redModelMat</span> <span class="o">=</span> <span class="n">calculate_model_matrix</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">greenModelMat</span> <span class="o">=</span> <span class="n">calculate_model_matrix</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">blueModelMat</span> <span class="o">=</span> <span class="n">calculate_model_matrix</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">2.0f</span><span class="p">));</span></span></span></code></pre></div><p>At this point, we have to perform our solid pass, so configure the render states and bind the opaque framebuffer.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// configure render states
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">glDepthFunc</span><span class="p">(</span><span class="n">GL_LESS</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">glDepthMask</span><span class="p">(</span><span class="n">GL_TRUE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">glDisable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">// bind opaque framebuffer to render solid objects
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">opaqueFBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span></span></span></code></pre></div><p>We have to reset our depth function and depth mask for the solid pass at every frame since pipeline changes these states further down the line.</p>
<p>Now, draw the solid objects using the solid shader. You can draw alpha cutout objects both at this stage and the next stage as well. The solid shader is just a simple shader that transforms the vertices and draws the mesh with the supplied color.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// use solid shader
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="n">solidShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">// draw red quad
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="n">solidShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;mvp&#34;</span><span class="p">,</span> <span class="n">vp</span> <span class="o">*</span> <span class="n">redModelMat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">solidShader</span><span class="p">.</span><span class="n">setVec3</span><span class="p">(</span><span class="s">&#34;color&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span></span></span></code></pre></div><p>So far so good. For our transparent pass, like in the solid pass, configure the render states to blend to these render targets as below, then bind the transparent framebuffer and clear its two color buffers to vec4(0.0f) and vec4(1.0).</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// configure render states
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">// disable depth writes so transparent objects wouldn&#39;t interfere with solid pass depth values
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="n">glDepthMask</span><span class="p">(</span><span class="n">GL_FALSE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">glBlendFunci</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">);</span> <span class="c1">// accumulation blend target
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="n">glBlendFunci</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">GL_ZERO</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_COLOR</span><span class="p">);</span> <span class="c1">// revealge blend target
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="n">glBlendEquation</span><span class="p">(</span><span class="n">GL_FUNC_ADD</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">// bind transparent framebuffer to render transparent objects
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">transparentFBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">// use a four component float array or a glm::vec4(0.0)
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="n">glClearBufferfv</span><span class="p">(</span><span class="n">GL_COLOR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zeroFillerVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl"> <span class="c1">// use a four component float array or a glm::vec4(1.0)
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="n">glClearBufferfv</span><span class="p">(</span><span class="n">GL_COLOR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oneFillerVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></span></span></code></pre></div><p>Then, draw the transparent surfaces with your preferred alpha values.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// use transparent shader
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">transparentShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// draw green quad
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="n">transparentShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;mvp&#34;</span><span class="p">,</span> <span class="n">vp</span> <span class="o">*</span> <span class="n">greenModelMat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">transparentShader</span><span class="p">.</span><span class="n">setVec4</span><span class="p">(</span><span class="s">&#34;color&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// draw blue quad
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="n">transparentShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;mvp&#34;</span><span class="p">,</span> <span class="n">vp</span> <span class="o">*</span> <span class="n">blueModelMat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">transparentShader</span><span class="p">.</span><span class="n">setVec4</span><span class="p">(</span><span class="s">&#34;color&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span></span></span></code></pre></div><p>The transparent shader is where half the work is done. It&rsquo;s primarily a shader that collects pixel information for our composite pass:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// shader outputs
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">out</span> <span class="n">vec4</span> <span class="n">accum</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">out</span> <span class="kt">float</span> <span class="n">reveal</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">// material color
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="n">uniform</span> <span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">// weight function
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e8</span> <span class="o">*</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">                         <span class="n">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">z</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">3e3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="c1">// store pixel color accumulation
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>    <span class="n">accum</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">rgb</span> <span class="o">*</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">// store pixel revealage threshold
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>    <span class="n">reveal</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Note that, we are directly using the color passed to the shader as our final fragment color. Normally, if you are in a lighting shader, you want to use the final result of the lighting to store in accumulation and revealage render targets.</p>
<p>Now that everything has been rendered, we have to composite these two images so we can have the finished result.</p>
<p><note>Compositing is a common method in many techniques that use a post-processing quad drawn all over the screen. Think of it as merging two layers in a photo editing software like Photoshop or Gimp.</note></p>
<p>In OpenGL, we can achieve this by color blending feature:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// set render states
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">glDepthFunc</span><span class="p">(</span><span class="n">GL_ALWAYS</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">glBlendFunc</span><span class="p">(</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">// bind opaque framebuffer
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">opaqueFBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1">// use composite shader
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="n">compositeShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">// draw screen quad
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">accumTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">revealTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span></span></span></code></pre></div><p>Composite shader is where the other half of the work is done. We&rsquo;re basically merging two layers, one being the solid objects image and the other being the transparent objects image. Accumulation buffer tells us about the color and revealage buffer determines the visibility of the the underlying pixel:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// shader outputs
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">out</span> <span class="n">vec4</span> <span class="n">frag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// color accumulation buffer
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">binding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">accum</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// revealage threshold buffer
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="n">layout</span> <span class="p">(</span><span class="n">binding</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">reveal</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// epsilon number
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.00001f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// calculate floating point numbers equality accurately
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">isApproximatelyEqual</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">:</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1">// get the max value between three values
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span><span class="kt">float</span> <span class="nf">max3</span><span class="p">(</span><span class="n">vec3</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="c1">// fragment coordination
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="c1"></span>    <span class="n">ivec2</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">ivec2</span><span class="p">(</span><span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="c1">// fragment revealage
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">revealage</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">reveal</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="c1">// save the blending and color texture fetch cost if there is not a transparent fragment
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">isApproximatelyEqual</span><span class="p">(</span><span class="n">revealage</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="n">discard</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="c1">// fragment color
</span></span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="c1"></span>    <span class="n">vec4</span> <span class="n">accumulation</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">accum</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="c1">// suppress overflow
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">isinf</span><span class="p">(</span><span class="n">max3</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">accumulation</span><span class="p">.</span><span class="n">rgb</span><span class="p">))))</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">accumulation</span><span class="p">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">accumulation</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="c1">// prevent floating point precision bug
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="c1"></span>    <span class="n">vec3</span> <span class="n">average_color</span> <span class="o">=</span> <span class="n">accumulation</span><span class="p">.</span><span class="n">rgb</span> <span class="o">/</span> <span class="n">max</span><span class="p">(</span><span class="n">accumulation</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="c1">// blend pixels
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="c1"></span>    <span class="n">frag</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">average_color</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="o">-</span> <span class="n">revealage</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Note that, we are using some helper functions like isApproximatelyEqual or max3 to help us with the accurate calculation of floating-point numbers. Due to inaccuracy of floating-point numbers calculation in current generation processors, we need to compare our values with an extremely small amount called an epsilon to avoid underflows or overflows.</p>
<p>Also, we don&rsquo;t need an intermediate framebuffer to do compositing. We can use our opaque framebuffer as the base framebuffer and paint over it since it already has the opaque pass information. Plus, we&rsquo;re stating that all depth tests should pass since we want to paint over the opaque image.</p>
<p>Finally, draw your composited image (which is the opaque texture attachment since you rendered your transparent image over it in the last pass) onto the backbuffer and observe the result.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// set render states
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL_DEPTH</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">glDepthMask</span><span class="p">(</span><span class="n">GL_TRUE</span><span class="p">);</span> <span class="c1">// enable depth writes so glClear won&#39;t ignore clearing the depth buffer
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">// bind backbuffer
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_STENCIL_BUFFER_BIT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">// use screen shader
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="n">screenShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// draw final screen quad
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">opaqueTexture</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span></span></span></code></pre></div><p>Screen shader is just a simple post-processing shader which draws a full-screen quad.</p>
<p>In a regular pipeline, you would also apply gamma-correction, tone-mapping, etc. in an intermediate post-processing framebuffer before you render to backbuffer, but ensure you are not applying them while rendering your solid and transparent surfaces and also not before composition since this transparency technique needs raw color values for calculating transparent pixels.</p>
<p>Now, the interesting part is to play with the Z axis of your objects to see order-independence in action. Try to place your transparent objects behind the solid object or mess up the orders entirely.</p>
<p><a href="#R-image-7264790e3ef51a62b24faadef8984582" class="lightbox-link"><img src="./assets/weighted_blended_reordered.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7264790e3ef51a62b24faadef8984582"><img src="./assets/weighted_blended_reordered.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In the image above, the green quad is rendered after the red quad, but behind it, and if you move the camera around to see the green quad from behind, you won&rsquo;t see any artifacts.</p>
<p>As stated earlier, one limitation that this technique imposes is that for scenes with higher depth/alpha complexity we need to tune the weighting function to achieve the correct result. Luckily, a number of tested weighting functions are provided in the paper which you can refer and investigate them for your environment.</p>
<p>Be sure to also check the colored transmission transparency which is the improved version of this technique in the links below.</p>
<p>You can find the source code for this demo <a href="https://learnopengl.com/code_viewer_gh.php?code=src/8.guest/2020/oit/weighted_blended.cpp" target="_blank">here</a>.</p>
<h5 id="further-reading-1">Further reading</h5>
<ul>
<li><a href="http://jcgt.org/published/0002/02/09" target="_blank">Weighted, Blended paper</a>: The original paper published in the journal of computer graphics. A brief history of the transparency and the emergence of the technique itself is provided. This is a must for the dedicated readers.</li>
<li><a href="http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html" target="_blank">Weighted, Blended introduction</a>: Casual Effects is Morgan McGuire&rsquo;s personal blog. This post is the introduction of their technique which goes into further details and is definitely worth to read. Plus, there are videos of their implementation live in action that you would not want to miss.</li>
<li><a href="http://casual-effects.blogspot.com/2015/03/implemented-weighted-blended-order.html" target="_blank">Weighted, Blended for implementors</a>: And also another blog post by him on implementing the technique for implementors.</li>
<li><a href="http://casual-effects.blogspot.com/2015/03/colored-blended-order-independent.html" target="_blank">Weighted, Blended and colored transmission</a>: And another blog post on colored transmission for transparent surfaces.</li>
<li><a href="http://bagnell.github.io/cesium/Apps/Sandcastle/gallery/OIT.html" target="_blank">A live implementation of the technique</a>: This is a live WebGL visualization from Cesium engine which accepts weighting functions for you to test in your browser!</li>
</ul>
<h4 id="skeletal-animation">Skeletal Animation</h4>
<p>3D Animations can bring our games to life. Objects in 3D world like humans and animals feel more organic when they move their limbs to do certain things like walking, running &amp; attacking. This tutorial is about Skeletal animation which you all have been waiting for. We will first understand the concept thoroughly and then understand the data we need to animate a 3D model using Assimp. I&rsquo;d recommend you to finish the <a href="https://learnopengl.com/Model-Loading/Assimp" target="_blank">Model Loading</a> section of this saga as this tutorial code continues from there. You can still understand the concept and implement it in your way. So let&rsquo;s get started.</p>
<h5 id="interpolation">Interpolation</h5>
<p>To understand how animation works at basic level we need to understand the concept of Interpolation. Interpolation can be defined as something happening over time. Like an enemy moving from point A to point B in time T i.e Translation happening over time . A gun turret smoothly rotates to face the target i.e Rotation happening over time and a tree is scaling up from size A to size B in time T i.e Scaling happening over time.</p>
<p>A simple interpolation equation used for Translation and Scale looks like this..</p>
<p><strong>a = a * (1 - t) + b * t</strong></p>
<p>It is known as as Linear Interpolation equation or Lerp. For Rotation we cannot use Vector. The reason for that is if we went ahead and tried to use the linear interpolation equation on a vector of X(Pitch),Y(Yaw) &amp; Z(Roll), the interpolation won&rsquo;t be linear. You will encounter weird issues like The Gimbal Lock(See references section below to learn about it). To avoid this issue we use Quaternion for rotations. Quaternion provides something called The Spherical Interpolation or Slerp equation which gives the same result as Lerp but for two rotations A &amp; B. I won&rsquo;t be able to explain how the equation works because its out of the scope for now. You can surely checkout references section below to understand The Quaternion.</p>
<h5 id="components-of-an-animated-model--skin-bones-and-keyframes">Components of An Animated Model : Skin, Bones and Keyframes</h5>
<p>The whole process of an animation starts with the addition of the first component which is The Skin in a software like blender or Maya. Skin is nothing but meshes which add visual aspect to the model to tell the viewer how it looks like. But If you want to move any mesh then just like the real world, you need to add Bones. You can see the images below to understand how it looks in software like blender&hellip;.</p>
<p><a href="#R-image-dc1af688698b92e740102961537a196f" class="lightbox-link"><img src="./assets/skin.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dc1af688698b92e740102961537a196f"><img src="./assets/skin.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-ea2255990d1c6261cb1799ced56c9d37" class="lightbox-link"><img src="./assets/bones.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ea2255990d1c6261cb1799ced56c9d37"><img src="./assets/bones.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-f46e48d30cb34d7b88f5e7d548825949" class="lightbox-link"><img src="./assets/merged.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f46e48d30cb34d7b88f5e7d548825949"><img src="./assets/merged.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>These bones are usually added in hierarchical fashion for characters like humans &amp; animals and the reason is pretty obvious. We want parent-child relationship among limbs. For example, If we move our right shoulder then our right bicep, forearm, hand and fingers should move as well. This is how the hierarchy looks like&hellip;.</p>
<p><a href="#R-image-1dedf9f883fde330e565a7b1abea91b0" class="lightbox-link"><img src="./assets/parent_child.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1dedf9f883fde330e565a7b1abea91b0"><img src="./assets/parent_child.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In the above diagram if you grab the hip bone and move it, all limbs will be affected by its movement.</p>
<p>At this point, we are ready to create KeyFrames for an animation. Keyframes are poses at different point of time in an animation. We will interpolate between these Keyframes to go from one pose to another pose smoothly in our code. Below you can see how poses are created for a simple 4 frame jump animation&hellip;</p>
<p><a href="#R-image-8d6514d4c9a9310ec6c0b05074f77823" class="lightbox-link"><img src="./assets/poses.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8d6514d4c9a9310ec6c0b05074f77823"><img src="./assets/poses.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-0445f51f07ac973f0930ca8014c1c3ec" class="lightbox-link"><img src="./assets/interpolating.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0445f51f07ac973f0930ca8014c1c3ec"><img src="./assets/interpolating.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h5 id="how-assimp-holds-animation-data">How Assimp holds animation data</h5>
<p>We are almost there to the code part but first we need to understand how assimp holds imported animation data. Look at the diagram below..</p>
<p><a href="#R-image-e0f6783886b42f8e0b6477c5b0cd7363" class="lightbox-link"><img src="./assets/assimp1.jpeg" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e0f6783886b42f8e0b6477c5b0cd7363"><img src="./assets/assimp1.jpeg" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Just like the <a href="https://learnopengl.com/Model-Loading/Assimp" target="_blank">Model Loading</a> section, we will start with the <code>aiScene</code> pointer which holds a pointer to the root node and look what do we have here, an array of Animations. This array of <code>aiAnimation</code> contains the general information like duration of an animation represented here as <code>mDuration</code> and then we have a <code>mTicksPerSecond</code> variable, which controls how fast we should interpolate between frames. If you remember from the last section that an animation has keyframes. Similary, an <code>aiAnimation</code> contains an <code>aiNodeAnim</code> array called Channels. This array of contains all bones and their keyframes which are going to be engaged in an animation. An <code>aiNodeAnim</code> contains name of the bone and you will find 3 types of keys to interpolate between here, Translation,Rotation &amp; Scale.</p>
<p>Alright, there&rsquo;s one last thing we need to understand and we are good to go for writing some code.</p>
<h5 id="influence-of-multiple-bones-on-vertices">Influence of multiple bones on vertices</h5>
<p>When we curl our forearm and we see our biceps muscle pop up. We can also say that forearm bone transformation is affecting vertices on our biceps. Similary, there could be multiple bones affecting a single vertex in a mesh. For characters like solid metal robots all forearm vertices will only be affected by forearm bone but for characters like humans, animals etc, there could be upto 4 bones which can affect a vertex. Let&rsquo;s see how assimp stores that information&hellip;</p>
<p><a href="#R-image-a8a8f2680d06a875da0720a35bfee19d" class="lightbox-link"><img src="./assets/assimp2.jpeg" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a8a8f2680d06a875da0720a35bfee19d"><img src="./assets/assimp2.jpeg" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We start with the <code>aiScene</code> pointer again which contains an array of all aiMeshes. Each <code>aiMesh</code> object has an array of <code>aiBone</code> which contains the information like how much influence this <code>aiBone</code> will have on set of vertices on the mesh. aiBone contains the name of the bone, an array of <code>aiVertexWeight</code> which basically tells us how much influence this <code>aiBone</code> will have on what vertices on the mesh. Now we have one more member of <code>aiBone</code> which is offsetMatrix. It&rsquo;s a 4x4 matrix used to transform vertices from model space to their bone space. You can see this in action in images below&hellip;.</p>
<p><a href="#R-image-e38364a6ebf021295c706551cb1d2ab0" class="lightbox-link"><img src="./assets/mesh_space.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e38364a6ebf021295c706551cb1d2ab0"><img src="./assets/mesh_space.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-4e598c64c7138de4d1a4ab681f4b9a88" class="lightbox-link"><img src="./assets/bone_space.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4e598c64c7138de4d1a4ab681f4b9a88"><img src="./assets/bone_space.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When vertices are in bone space they will be transformed relative to their bone as they are supposed to. You will soon see this in action in code.</p>
<h5 id="finally-lets-code">Finally! Let&rsquo;s code.</h5>
<p>Thank you for making it this far. We will start with directly looking at the end result which is our final vertex shader code. This will give us good sense what we need at the end..</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 430 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec3</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec3</span> <span class="n">norm</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec2</span> <span class="n">tex</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="n">in</span> <span class="n">ivec4</span> <span class="n">boneIds</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">layout</span><span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec4</span> <span class="n">weights</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">projection</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">view</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">model</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">	
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_BONES</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_BONE_INFLUENCE</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">finalBonesMatrices</span><span class="p">[</span><span class="n">MAX_BONES</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">	
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">out</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">	
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="n">vec4</span> <span class="n">totalPosition</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_BONE_INFLUENCE</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">boneIds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">boneIds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span><span class="n">MAX_BONES</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">totalPosition</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">vec4</span> <span class="n">localPosition</span> <span class="o">=</span> <span class="n">finalBonesMatrices</span><span class="p">[</span><span class="n">boneIds</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="n">totalPosition</span> <span class="o">+=</span> <span class="n">localPosition</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">vec3</span> <span class="n">localNormal</span> <span class="o">=</span> <span class="n">mat3</span><span class="p">(</span><span class="n">finalBonesMatrices</span><span class="p">[</span><span class="n">boneIds</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">*</span> <span class="n">norm</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">		
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="n">mat4</span> <span class="n">viewModel</span> <span class="o">=</span> <span class="n">view</span> <span class="o">*</span> <span class="n">model</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">gl_Position</span> <span class="o">=</span>  <span class="n">projection</span> <span class="o">*</span> <span class="n">viewModel</span> <span class="o">*</span> <span class="n">totalPosition</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">tex</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Fragment shader remains the same from the <a href="https://learnopengl.com/Model-Loading/Model" target="_blank">this tutorial.</a> Starting from the top you see two new attributes layout declaration. First <code>boneIds</code> and second is <code>weights</code>. we also have a uniform array <code>finalBonesMatrices</code> which stores transformations of all bones.  <code>boneIds</code> contains indices which are used to read the <code>finalBonesMatrices</code> array and apply those transformation to <code>pos</code> vertex with their respective weights stored in <code>weights </code>array. This happens inside <code>for </code>loop above. Now let&rsquo;s add support in our <code>Mesh</code> class for bone weights first..</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#define MAX_BONE_INFLUENCE 4
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">struct</span> <span class="nc">Vertex</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// position
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">Position</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">// normal
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">Normal</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">// texCoords
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">// tangent
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">Tangent</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">// bitangent
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">Bitangent</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1">//bone indexes which will influence this vertex
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">m_BoneIDs</span><span class="p">[</span><span class="n">MAX_BONE_INFLUENCE</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1">//weights from each bone
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">m_Weights</span><span class="p">[</span><span class="n">MAX_BONE_INFLUENCE</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>We have added two new attributes for the <code>Vertex</code>, just like we saw in our vertex shader. Now&rsquo;s let&rsquo;s load them in GPU buffers just like other attributes in our <code>Mesh::setupMesh </code>function&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">Mesh</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kt">void</span> <span class="n">setupMesh</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="p">....</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="c1">// ids
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>        <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">glVertexAttribIPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">GL_INT</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">offsetof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">m_BoneIDs</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1">// weights
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>        <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">offsetof</span><span class="p">(</span><span class="n">Vertex</span><span class="p">,</span> <span class="n">m_Weights</span><span class="p">));</span>   
</span></span><span class="line"><span class="ln">17</span><span class="cl">  
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>    
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Just like before, except now we have added 3 and 4 layout location ids for <code>boneIds</code> and <code>weights</code>. One imporant thing to notice here is how we are passing data for <code>boneIds</code>. We are using <code>glVertexAttribIPointer</code> and we passed GL_INT as third parameter.</p>
<p>Now we can extract the bone-weight information from the assimp data structure. Let&rsquo;s make some changes in Model class&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="nc">BoneInfo</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="cm">/*id is index in finalBoneMatrices*/</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="cm">/*offset matrix transforms vertex from model space to bone space*/</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>This <code>BoneInfo </code>will store our offset matrix and also a unique id which will be used as an index to store it in <code>finalBoneMatrices</code> array we saw earlier in our shader. Now we will add bone weight extraction support in <code>Model</code>&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">class</span> <span class="nc">Model</span> 
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">BoneInfo</span><span class="o">&gt;</span> <span class="n">m_BoneInfoMap</span><span class="p">;</span> <span class="c1">//
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">m_BoneCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">
</span></span><span class="line"><span class="ln">  8</span><span class="cl">    <span class="k">auto</span><span class="o">&amp;</span> <span class="n">GetBoneInfoMap</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_BoneInfoMap</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="kt">int</span><span class="o">&amp;</span> <span class="n">GetBoneCount</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_BoneCounter</span><span class="p">;</span> <span class="p">}</span>    
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">    <span class="kt">void</span> <span class="n">SetVertexBoneDataToDefault</span><span class="p">(</span><span class="n">Vertex</span><span class="o">&amp;</span> <span class="n">vertex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_BONE_WEIGHTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">            <span class="n">vertex</span><span class="p">.</span><span class="n">m_BoneIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">            <span class="n">vertex</span><span class="p">.</span><span class="n">m_Weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="n">Mesh</span> <span class="nf">processMesh</span><span class="p">(</span><span class="n">aiMesh</span><span class="o">*</span> <span class="n">mesh</span><span class="p">,</span> <span class="k">const</span> <span class="n">aiScene</span><span class="o">*</span> <span class="n">scene</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">        <span class="n">vector</span> <span class="n">vertices</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">        <span class="n">vector</span> <span class="n">indices</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">        <span class="n">vector</span> <span class="n">textures</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mNumVertices</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">            <span class="n">Vertex</span> <span class="n">vertex</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">            <span class="n">SetVertexBoneDataToDefault</span><span class="p">(</span><span class="n">vertex</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">            <span class="n">vertex</span><span class="p">.</span><span class="n">Position</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">GetGLMVec</span><span class="p">(</span><span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mVertices</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">            <span class="n">vertex</span><span class="p">.</span><span class="n">Normal</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">GetGLMVec</span><span class="p">(</span><span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mNormals</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">			
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mTextureCoords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">vec</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">                <span class="n">vec</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mTextureCoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">                <span class="n">vec</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mTextureCoords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">                <span class="n">vertex</span><span class="p">.</span><span class="n">TexCoords</span> <span class="o">=</span> <span class="n">vec</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">                <span class="n">vertex</span><span class="p">.</span><span class="n">TexCoords</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">            <span class="n">vertices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">vertex</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">        <span class="n">ExtractBoneWeightForVertices</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span><span class="n">mesh</span><span class="p">,</span><span class="n">scene</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">        <span class="k">return</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">textures</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">    <span class="kt">void</span> <span class="nf">SetVertexBoneData</span><span class="p">(</span><span class="n">Vertex</span><span class="o">&amp;</span> <span class="n">vertex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">boneID</span><span class="p">,</span> <span class="kt">float</span> <span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_BONE_WEIGHTS</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">m_BoneIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">                <span class="n">vertex</span><span class="p">.</span><span class="n">m_Weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">                <span class="n">vertex</span><span class="p">.</span><span class="n">m_BoneIDs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">boneID</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">    <span class="kt">void</span> <span class="nf">ExtractBoneWeightForVertices</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&amp;</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">aiMesh</span><span class="o">*</span> <span class="n">mesh</span><span class="p">,</span> <span class="k">const</span> <span class="n">aiScene</span><span class="o">*</span> <span class="n">scene</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">boneIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">boneIndex</span> <span class="o">&lt;</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mNumBones</span><span class="p">;</span> <span class="o">++</span><span class="n">boneIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">            <span class="kt">int</span> <span class="n">boneID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">boneName</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mBones</span><span class="p">[</span><span class="n">boneIndex</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">mName</span><span class="p">.</span><span class="n">C_Str</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">m_BoneInfoMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">boneName</span><span class="p">)</span> <span class="o">==</span> <span class="n">m_BoneInfoMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">                <span class="n">BoneInfo</span> <span class="n">newBoneInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">                <span class="n">newBoneInfo</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">m_BoneCounter</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">                <span class="n">newBoneInfo</span><span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">ConvertMatrixToGLMFormat</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">                    <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mBones</span><span class="p">[</span><span class="n">boneIndex</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">mOffsetMatrix</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">                <span class="n">m_BoneInfoMap</span><span class="p">[</span><span class="n">boneName</span><span class="p">]</span> <span class="o">=</span> <span class="n">newBoneInfo</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">                <span class="n">boneID</span> <span class="o">=</span> <span class="n">m_BoneCounter</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">                <span class="n">m_BoneCounter</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                <span class="n">boneID</span> <span class="o">=</span> <span class="n">m_BoneInfoMap</span><span class="p">[</span><span class="n">boneName</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">            <span class="n">assert</span><span class="p">(</span><span class="n">boneID</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">            <span class="k">auto</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mBones</span><span class="p">[</span><span class="n">boneIndex</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">mWeights</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">            <span class="kt">int</span> <span class="n">numWeights</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">-&gt;</span><span class="n">mBones</span><span class="p">[</span><span class="n">boneIndex</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">mNumWeights</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">weightIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">weightIndex</span> <span class="o">&lt;</span> <span class="n">numWeights</span><span class="p">;</span> <span class="o">++</span><span class="n">weightIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">                <span class="kt">int</span> <span class="n">vertexId</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">weightIndex</span><span class="p">].</span><span class="n">mVertexId</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">                <span class="kt">float</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">weightIndex</span><span class="p">].</span><span class="n">mWeight</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">                <span class="n">assert</span><span class="p">(</span><span class="n">vertexId</span> <span class="o">&lt;=</span> <span class="n">vertices</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">                <span class="n">SetVertexBoneData</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">vertexId</span><span class="p">],</span> <span class="n">boneID</span><span class="p">,</span> <span class="n">weight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>We start by declaring a map <code>m_BoneInfoMap</code> and a counter <code>m_BoneCounter</code> which will be incremented as soon as we read a new bone. we saw in the diagram earlier that each <code>aiMesh</code> contains all aiBones which are associated with the <code>aiMesh</code>. The whole process of the bone-weight extraction starts from the <code>processMesh </code>function. For each loop iteration we are setting <code>m_BoneIDs</code> and <code>m_Weights</code> to their default values by calling function <code>SetVertexBoneDataToDefault</code>. Just before the <code>processMesh</code> function ends, we call the <code>ExtractBoneWeightData</code>. In the <code>ExtractBoneWeightData</code> we run a for loop for each <code>aiBone</code> and check if this bone already exists in the <code>m_BoneInfoMap</code>. If we couldn&rsquo;t find it then it&rsquo;s considered a new bone and we create new <code>BoneInfo</code> with an id and store its associated <code>mOffsetMatrix</code> to it. Then we store this new <code>BoneInfo</code> in <code>m_BoneInfoMap</code> and then we increment the <code>m_BoneCounter</code> counter to create an id for next bone. In case we find the bone name in <code>m_BoneInfoMap</code> then that means this bone affects vertices of mesh out of its scope. So we take it&rsquo;s Id and proceed further to know which vertices it affects.</p>
<p>One thing to notice that we are calling <code>AssimpGLMHelpers::ConvertMatrixToGLMFormat</code>. Assimp store its matrix data in different format than GLM so this function just gives us our matrix in GLM format.</p>
<p>We have extracted the offsetMatrix for the bone and now we will simply iterate its <code>aiVertexWeight</code>array and extract all vertices indices which will be influenced by this bone along with their respective weights and call <code>SetVertexBoneData</code> to fill up <code>Vertex.boneIds</code> and <code>Vertex.weights</code> with extracted information.</p>
<p>Phew! You deserve a coffee break at this point.</p>
<h5 id="boneanimation--animator-classes">Bone,Animation &amp; Animator classes</h5>
<p>Here&rsquo;s high level view of classes..</p>
<p><a href="#R-image-fe48d21db893ae7516a3b754d4588c74" class="lightbox-link"><img src="./assets/bird_eye_view.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fe48d21db893ae7516a3b754d4588c74"><img src="./assets/bird_eye_view.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let us remind ourselves what we are trying to achieve. For each rendering frame we want to interpolate all bones in heirarchy smoothly and get their final transformations matrices which will be supplied to shader uniform <code>finalBonesMatrices</code>. Here&rsquo;s what each class does&hellip;</p>
<p><strong>Bone</strong> : A single bone which reads all keyframes data from <code>aiNodeAnim</code>. It will also interpolate between its keys i.e Translation,Scale &amp; Rotation based on the current animation time.</p>
<p><strong>AssimpNodeData</strong> : This struct will help us to isolate our <code>**Animation** from Assimp.</code></p>
<p><strong>Animation</strong> : An asset which reads data from aiAnimation and create a heirarchical record of <code>**Bone**</code>s</p>
<p><strong>Animator</strong> : This will read the heirarchy of <code>AssimpNodeData</code>, Interpolate all bones in a recursive manner and then prepare final bone transformation matrices for us that we need.</p>
<p>Here&rsquo;s the code for <code>Bone</code>&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">struct</span> <span class="nc">KeyPosition</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="kt">float</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">struct</span> <span class="nc">KeyRotation</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">quat</span> <span class="n">orientation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">    <span class="kt">float</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="k">struct</span> <span class="nc">KeyScale</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="kt">float</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">
</span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="k">class</span> <span class="nc">Bone</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPosition</span><span class="o">&gt;</span> <span class="n">m_Positions</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyRotation</span><span class="o">&gt;</span> <span class="n">m_Rotations</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyScale</span><span class="o">&gt;</span> <span class="n">m_Scales</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="kt">int</span> <span class="n">m_NumPositions</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="kt">int</span> <span class="n">m_NumRotations</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="kt">int</span> <span class="n">m_NumScalings</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">m_LocalTransform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_Name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="kt">int</span> <span class="n">m_ID</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">
</span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="cm">/*reads keyframes from aiNodeAnim*/</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="n">Bone</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ID</span><span class="p">,</span> <span class="k">const</span> <span class="n">aiNodeAnim</span><span class="o">*</span> <span class="n">channel</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="o">:</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="n">m_Name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="n">m_ID</span><span class="p">(</span><span class="n">ID</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">        <span class="n">m_LocalTransform</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="n">m_NumPositions</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNumPositionKeys</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">positionIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">positionIndex</span> <span class="o">&lt;</span> <span class="n">m_NumPositions</span><span class="p">;</span> <span class="o">++</span><span class="n">positionIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">            <span class="n">aiVector3D</span> <span class="n">aiPosition</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mPositionKeys</span><span class="p">[</span><span class="n">positionIndex</span><span class="p">].</span><span class="n">mValue</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">            <span class="kt">float</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mPositionKeys</span><span class="p">[</span><span class="n">positionIndex</span><span class="p">].</span><span class="n">mTime</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">            <span class="n">KeyPosition</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">GetGLMVec</span><span class="p">(</span><span class="n">aiPosition</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">timeStamp</span> <span class="o">=</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">            <span class="n">m_Positions</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">        <span class="n">m_NumRotations</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNumRotationKeys</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">rotationIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">rotationIndex</span> <span class="o">&lt;</span> <span class="n">m_NumRotations</span><span class="p">;</span> <span class="o">++</span><span class="n">rotationIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">            <span class="n">aiQuaternion</span> <span class="n">aiOrientation</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mRotationKeys</span><span class="p">[</span><span class="n">rotationIndex</span><span class="p">].</span><span class="n">mValue</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">            <span class="kt">float</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mRotationKeys</span><span class="p">[</span><span class="n">rotationIndex</span><span class="p">].</span><span class="n">mTime</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">            <span class="n">KeyRotation</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">GetGLMQuat</span><span class="p">(</span><span class="n">aiOrientation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">timeStamp</span> <span class="o">=</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">            <span class="n">m_Rotations</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">        <span class="n">m_NumScalings</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNumScalingKeys</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">keyIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">keyIndex</span> <span class="o">&lt;</span> <span class="n">m_NumScalings</span><span class="p">;</span> <span class="o">++</span><span class="n">keyIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">            <span class="n">aiVector3D</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mScalingKeys</span><span class="p">[</span><span class="n">keyIndex</span><span class="p">].</span><span class="n">mValue</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">            <span class="kt">float</span> <span class="n">timeStamp</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mScalingKeys</span><span class="p">[</span><span class="n">keyIndex</span><span class="p">].</span><span class="n">mTime</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">            <span class="n">KeyScale</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">GetGLMVec</span><span class="p">(</span><span class="n">scale</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="n">timeStamp</span> <span class="o">=</span> <span class="n">timeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">            <span class="n">m_Scales</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">    <span class="cm">/*interpolates  b/w positions,rotations &amp; scaling keys based on the curren time of 
</span></span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="cm">    the animation and prepares the local transformation matrix by combining all keys 
</span></span></span><span class="line"><span class="ln"> 79</span><span class="cl"><span class="cm">    tranformations*/</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">    <span class="kt">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">translation</span> <span class="o">=</span> <span class="n">InterpolatePosition</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">InterpolateRotation</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">InterpolateScaling</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">        <span class="n">m_LocalTransform</span> <span class="o">=</span> <span class="n">translation</span> <span class="o">*</span> <span class="n">rotation</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">GetLocalTransform</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_LocalTransform</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">GetBoneName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Name</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="kt">int</span> <span class="nf">GetBoneID</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_ID</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="cm">/* Gets the current index on mKeyPositions to interpolate to based on 
</span></span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="cm">    the current animation time*/</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="kt">int</span> <span class="nf">GetPositionIndex</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">m_NumPositions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">animationTime</span> <span class="o">&lt;</span> <span class="n">m_Positions</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">                <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">
</span></span><span class="line"><span class="ln">105</span><span class="cl">    <span class="cm">/* Gets the current index on mKeyRotations to interpolate to based on the 
</span></span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="cm">    current animation time*/</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">    <span class="kt">int</span> <span class="nf">GetRotationIndex</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">m_NumRotations</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">animationTime</span> <span class="o">&lt;</span> <span class="n">m_Rotations</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">                <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">
</span></span><span class="line"><span class="ln">117</span><span class="cl">    <span class="cm">/* Gets the current index on mKeyScalings to interpolate to based on the 
</span></span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="cm">    current animation time */</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="kt">int</span> <span class="nf">GetScaleIndex</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">m_NumScalings</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">index</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">animationTime</span> <span class="o">&lt;</span> <span class="n">m_Scales</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">                <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">
</span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="cm">/* Gets normalized value for Lerp &amp; Slerp*/</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="kt">float</span> <span class="n">GetScaleFactor</span><span class="p">(</span><span class="kt">float</span> <span class="n">lastTimeStamp</span><span class="p">,</span> <span class="kt">float</span> <span class="n">nextTimeStamp</span><span class="p">,</span> <span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">        <span class="kt">float</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">        <span class="kt">float</span> <span class="n">midWayLength</span> <span class="o">=</span> <span class="n">animationTime</span> <span class="o">-</span> <span class="n">lastTimeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">        <span class="kt">float</span> <span class="n">framesDiff</span> <span class="o">=</span> <span class="n">nextTimeStamp</span> <span class="o">-</span> <span class="n">lastTimeStamp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">        <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">midWayLength</span> <span class="o">/</span> <span class="n">framesDiff</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">        <span class="k">return</span> <span class="n">scaleFactor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="cm">/*figures out which position keys to interpolate b/w and performs the interpolation 
</span></span></span><span class="line"><span class="ln">142</span><span class="cl"><span class="cm">    and returns the translation matrix*/</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">InterpolatePosition</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="n">m_NumPositions</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">            <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span> <span class="n">m_Positions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">position</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">
</span></span><span class="line"><span class="ln">148</span><span class="cl">        <span class="kt">int</span> <span class="n">p0Index</span> <span class="o">=</span> <span class="n">GetPositionIndex</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">        <span class="kt">int</span> <span class="n">p1Index</span> <span class="o">=</span> <span class="n">p0Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">        <span class="kt">float</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">GetScaleFactor</span><span class="p">(</span><span class="n">m_Positions</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">            <span class="n">m_Positions</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span> <span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">finalPosition</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">mix</span><span class="p">(</span><span class="n">m_Positions</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">position</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">            <span class="n">m_Positions</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">position</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">        <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span> <span class="n">finalPosition</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">
</span></span><span class="line"><span class="ln">157</span><span class="cl">    <span class="cm">/*figures out which rotations keys to interpolate b/w and performs the interpolation 
</span></span></span><span class="line"><span class="ln">158</span><span class="cl"><span class="cm">    and returns the rotation matrix*/</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">InterpolateRotation</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="n">m_NumRotations</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">            <span class="k">auto</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">m_Rotations</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">orientation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">            <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">toMat4</span><span class="p">(</span><span class="n">rotation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">
</span></span><span class="line"><span class="ln">167</span><span class="cl">        <span class="kt">int</span> <span class="n">p0Index</span> <span class="o">=</span> <span class="n">GetRotationIndex</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">        <span class="kt">int</span> <span class="n">p1Index</span> <span class="o">=</span> <span class="n">p0Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">        <span class="kt">float</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">GetScaleFactor</span><span class="p">(</span><span class="n">m_Rotations</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">            <span class="n">m_Rotations</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span> <span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">quat</span> <span class="n">finalRotation</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">slerp</span><span class="p">(</span><span class="n">m_Rotations</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">orientation</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">            <span class="n">m_Rotations</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">orientation</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">        <span class="n">finalRotation</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">finalRotation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">        <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">toMat4</span><span class="p">(</span><span class="n">finalRotation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">
</span></span><span class="line"><span class="ln">177</span><span class="cl">    <span class="cm">/*figures out which scaling keys to interpolate b/w and performs the interpolation 
</span></span></span><span class="line"><span class="ln">178</span><span class="cl"><span class="cm">    and returns the scale matrix*/</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">Bone</span><span class="o">::</span><span class="n">InterpolateScaling</span><span class="p">(</span><span class="kt">float</span> <span class="n">animationTime</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="n">m_NumScalings</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">182</span><span class="cl">            <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span> <span class="n">m_Scales</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">scale</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">
</span></span><span class="line"><span class="ln">184</span><span class="cl">        <span class="kt">int</span> <span class="n">p0Index</span> <span class="o">=</span> <span class="n">GetScaleIndex</span><span class="p">(</span><span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">        <span class="kt">int</span> <span class="n">p1Index</span> <span class="o">=</span> <span class="n">p0Index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">        <span class="kt">float</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="n">GetScaleFactor</span><span class="p">(</span><span class="n">m_Scales</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">            <span class="n">m_Scales</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">timeStamp</span><span class="p">,</span> <span class="n">animationTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">finalScale</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">mix</span><span class="p">(</span><span class="n">m_Scales</span><span class="p">[</span><span class="n">p0Index</span><span class="p">].</span><span class="n">scale</span><span class="p">,</span> <span class="n">m_Scales</span><span class="p">[</span><span class="n">p1Index</span><span class="p">].</span><span class="n">scale</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">            <span class="p">,</span> <span class="n">scaleFactor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">        <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span> <span class="n">finalScale</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">191</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">192</span><span class="cl">	
</span></span><span class="line"><span class="ln">193</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>We start by creating 3 structs for our key types. Each struct holds a value and a time stamp. Timestamp tells us at what point of an animation we need to interpolate to its value. <code>Bone</code> has a constructor which reads from <code>aiNodeAnim</code> and stores keys and their timestamps to <code>mPositionKeys, mRotationKeys &amp; mScalingKeys </code>. The main interpolation process starts from <code>Update(float animationTime)</code> which gets called every frame. This function calls respective interpolation functions for all key types and combines all final interpolation results and store it to a 4x4 Matrix <code>m_LocalTransform</code>. The interpolations functions for translation &amp; scale keys are similar but for rotation we are using <code>Slerp</code> to interpolate between quaternions. Both <code>Lerp</code> &amp; <code>Slerp</code> takes 3 arguments. First argument takes last key, second argument takes next key and third argument takes value of range 0-1,we call it scale factor here. Let&rsquo;s see how we calculate this scale factor in function <code>GetScaleFactor</code>&hellip;</p>
<p><a href="#R-image-7927632e07def51c8ecf23eea97dd7bd" class="lightbox-link"><img src="./assets/scale_factor.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7927632e07def51c8ecf23eea97dd7bd"><img src="./assets/scale_factor.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In code&hellip;</p>
<p><strong>float midWayLength = animationTime - lastTimeStamp;</strong></p>
<p><strong>float framesDiff = nextTimeStamp - lastTimeStamp;</strong></p>
<p><strong>scaleFactor = midWayLength / framesDiff;</strong></p>
<p>Let&rsquo;s move on to <code>**Animation**</code> class now&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">struct</span> <span class="nc">AssimpNodeData</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">transformation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="kt">int</span> <span class="n">childrenCount</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">AssimpNodeData</span><span class="o">&gt;</span> <span class="n">children</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="k">class</span> <span class="nc">Animation</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">    <span class="n">Animation</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="n">Animation</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">animationPath</span><span class="p">,</span> <span class="n">Model</span><span class="o">*</span> <span class="n">model</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="n">Assimp</span><span class="o">::</span><span class="n">Importer</span> <span class="n">importer</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">const</span> <span class="n">aiScene</span><span class="o">*</span> <span class="n">scene</span> <span class="o">=</span> <span class="n">importer</span><span class="p">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">animationPath</span><span class="p">,</span> <span class="n">aiProcess_Triangulate</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">scene</span> <span class="o">&amp;&amp;</span> <span class="n">scene</span><span class="o">-&gt;</span><span class="n">mRootNode</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">auto</span> <span class="n">animation</span> <span class="o">=</span> <span class="n">scene</span><span class="o">-&gt;</span><span class="n">mAnimations</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">        <span class="n">m_Duration</span> <span class="o">=</span> <span class="n">animation</span><span class="o">-&gt;</span><span class="n">mDuration</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">        <span class="n">m_TicksPerSecond</span> <span class="o">=</span> <span class="n">animation</span><span class="o">-&gt;</span><span class="n">mTicksPerSecond</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">        <span class="n">ReadHeirarchyData</span><span class="p">(</span><span class="n">m_RootNode</span><span class="p">,</span> <span class="n">scene</span><span class="o">-&gt;</span><span class="n">mRootNode</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">        <span class="n">ReadMissingBones</span><span class="p">(</span><span class="n">animation</span><span class="p">,</span> <span class="o">*</span><span class="n">model</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="o">~</span><span class="n">Animation</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="n">Bone</span><span class="o">*</span> <span class="nf">FindBone</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">        <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">m_Bones</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">m_Bones</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">            <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">Bone</span><span class="o">&amp;</span> <span class="n">Bone</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">                <span class="k">return</span> <span class="n">Bone</span><span class="p">.</span><span class="n">GetBoneName</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">iter</span> <span class="o">==</span> <span class="n">m_Bones</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">else</span> <span class="k">return</span> <span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">    <span class="kr">inline</span> <span class="kt">float</span> <span class="nf">GetTicksPerSecond</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_TicksPerSecond</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">    <span class="kr">inline</span> <span class="kt">float</span> <span class="nf">GetDuration</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_Duration</span><span class="p">;}</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">    <span class="kr">inline</span> <span class="k">const</span> <span class="n">AssimpNodeData</span><span class="o">&amp;</span> <span class="n">GetRootNode</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_RootNode</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="kr">inline</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="n">BoneInfo</span><span class="o">&gt;&amp;</span> <span class="n">GetBoneIDMap</span><span class="p">()</span> 
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">        <span class="k">return</span> <span class="n">m_BoneInfoMap</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">    <span class="kt">void</span> <span class="n">ReadMissingBones</span><span class="p">(</span><span class="k">const</span> <span class="n">aiAnimation</span><span class="o">*</span> <span class="n">animation</span><span class="p">,</span> <span class="n">Model</span><span class="o">&amp;</span> <span class="n">model</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">        <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">animation</span><span class="o">-&gt;</span><span class="n">mNumChannels</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">        <span class="k">auto</span><span class="o">&amp;</span> <span class="n">boneInfoMap</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">GetBoneInfoMap</span><span class="p">();</span><span class="c1">//getting m_BoneInfoMap from Model class
</span></span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="c1"></span>        <span class="kt">int</span><span class="o">&amp;</span> <span class="n">boneCount</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">GetBoneCount</span><span class="p">();</span> <span class="c1">//getting the m_BoneCounter from Model class
</span></span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">        <span class="c1">//reading channels(bones engaged in an animation and their keyframes)
</span></span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">            <span class="k">auto</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">animation</span><span class="o">-&gt;</span><span class="n">mChannels</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">boneName</span> <span class="o">=</span> <span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNodeName</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">boneInfoMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">boneName</span><span class="p">)</span> <span class="o">==</span> <span class="n">boneInfoMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">                <span class="n">boneInfoMap</span><span class="p">[</span><span class="n">boneName</span><span class="p">].</span><span class="n">id</span> <span class="o">=</span> <span class="n">boneCount</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">                <span class="n">boneCount</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">            <span class="n">m_Bones</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bone</span><span class="p">(</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNodeName</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">                <span class="n">boneInfoMap</span><span class="p">[</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">mNodeName</span><span class="p">.</span><span class="n">data</span><span class="p">].</span><span class="n">id</span><span class="p">,</span> <span class="n">channel</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">        <span class="n">m_BoneInfoMap</span> <span class="o">=</span> <span class="n">boneInfoMap</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">    <span class="kt">void</span> <span class="nf">ReadHeirarchyData</span><span class="p">(</span><span class="n">AssimpNodeData</span><span class="o">&amp;</span> <span class="n">dest</span><span class="p">,</span> <span class="k">const</span> <span class="n">aiNode</span><span class="o">*</span> <span class="n">src</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">        <span class="n">assert</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">        <span class="n">dest</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">mName</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">        <span class="n">dest</span><span class="p">.</span><span class="n">transformation</span> <span class="o">=</span> <span class="n">AssimpGLMHelpers</span><span class="o">::</span><span class="n">ConvertMatrixToGLMFormat</span><span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">mTransformation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">        <span class="n">dest</span><span class="p">.</span><span class="n">childrenCount</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">mNumChildren</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">mNumChildren</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">            <span class="n">AssimpNodeData</span> <span class="n">newData</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">            <span class="n">ReadHeirarchyData</span><span class="p">(</span><span class="n">newData</span><span class="p">,</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">mChildren</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">            <span class="n">dest</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newData</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="kt">float</span> <span class="n">m_Duration</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="kt">int</span> <span class="n">m_TicksPerSecond</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Bone</span><span class="o">&gt;</span> <span class="n">m_Bones</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    <span class="n">AssimpNodeData</span> <span class="n">m_RootNode</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">BoneInfo</span><span class="o">&gt;</span> <span class="n">m_BoneInfoMap</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>Here, creation of an <code>Animation</code> object starts with a constructor. It takes two arguments. First, path to the animation file &amp; second parameter is the <code>Model</code> for this animation. You will see later ahead why we need this <code>Model</code> reference here. We then create an <code>Assimp::Importer</code> to read the animation file, followed by an <code>assert</code> check which will throw an error if animation could not be found. Then we read general animation data like how long is this animation which is <code>mDuration</code> and the animation speed represented by <code>mTicksPerSecond</code>. We then call <code>ReadHeirarchyData</code> which replicates <code>aiNode</code> heirarchy of Assimp and creates heirarchy of <code>AssimpNodeData</code>.</p>
<p>Then we call a function called <code>ReadMissingBones</code>. I had to write this function because sometimes when I loaded FBX model separately, it had some bones missing and I found those missing bones in the animation file. This function reads the missing bones information and stores their information in <code>m_BoneInfoMap</code> of <code>Model</code> and saves a reference of <code>m_BoneInfoMap</code> locally in the m_BoneInfoMap.</p>
<p>And we have our animation ready. Now let&rsquo;s look at our final stage, The Animator class&hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">Animator</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>	
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">Animator</span><span class="o">::</span><span class="n">Animator</span><span class="p">(</span><span class="n">Animation</span><span class="o">*</span> <span class="n">Animation</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="n">m_CurrentTime</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">m_CurrentAnimation</span> <span class="o">=</span> <span class="n">currentAnimation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">m_FinalBoneMatrices</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="n">m_FinalBoneMatrices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">	
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="kt">void</span> <span class="n">Animator</span><span class="o">::</span><span class="n">UpdateAnimation</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">m_DeltaTime</span> <span class="o">=</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">m_CurrentAnimation</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="n">m_CurrentTime</span> <span class="o">+=</span> <span class="n">m_CurrentAnimation</span><span class="o">-&gt;</span><span class="n">GetTicksPerSecond</span><span class="p">()</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">m_CurrentTime</span> <span class="o">=</span> <span class="n">fmod</span><span class="p">(</span><span class="n">m_CurrentTime</span><span class="p">,</span> <span class="n">m_CurrentAnimation</span><span class="o">-&gt;</span><span class="n">GetDuration</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">CalculateBoneTransform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_CurrentAnimation</span><span class="o">-&gt;</span><span class="n">GetRootNode</span><span class="p">(),</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">	
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="kt">void</span> <span class="n">Animator</span><span class="o">::</span><span class="n">PlayAnimation</span><span class="p">(</span><span class="n">Animation</span><span class="o">*</span> <span class="n">pAnimation</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">m_CurrentAnimation</span> <span class="o">=</span> <span class="n">pAnimation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="n">m_CurrentTime</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">	
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="kt">void</span> <span class="n">Animator</span><span class="o">::</span><span class="n">CalculateBoneTransform</span><span class="p">(</span><span class="k">const</span> <span class="n">AssimpNodeData</span><span class="o">*</span> <span class="n">node</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">parentTransform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">nodeName</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">nodeTransform</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">transformation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">	
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="n">Bone</span><span class="o">*</span> <span class="n">Bone</span> <span class="o">=</span> <span class="n">m_CurrentAnimation</span><span class="o">-&gt;</span><span class="n">FindBone</span><span class="p">(</span><span class="n">nodeName</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">	
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">Bone</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">            <span class="n">Bone</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(</span><span class="n">m_CurrentTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">            <span class="n">nodeTransform</span> <span class="o">=</span> <span class="n">Bone</span><span class="o">-&gt;</span><span class="n">GetLocalTransform</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">	
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">globalTransformation</span> <span class="o">=</span> <span class="n">parentTransform</span> <span class="o">*</span> <span class="n">nodeTransform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">	
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="k">auto</span> <span class="n">boneInfoMap</span> <span class="o">=</span> <span class="n">m_CurrentAnimation</span><span class="o">-&gt;</span><span class="n">GetBoneIDMap</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">boneInfoMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span> <span class="o">!=</span> <span class="n">boneInfoMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">            <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">boneInfoMap</span><span class="p">[</span><span class="n">nodeName</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">            <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">boneInfoMap</span><span class="p">[</span><span class="n">nodeName</span><span class="p">].</span><span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">            <span class="n">m_FinalBoneMatrices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">globalTransformation</span> <span class="o">*</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">	
</span></span><span class="line"><span class="ln">55</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">childrenCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">            <span class="n">CalculateBoneTransform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">globalTransformation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">	
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&gt;</span> <span class="n">GetFinalBoneMatrices</span><span class="p">()</span> 
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln">61</span><span class="cl">        <span class="k">return</span> <span class="n">m_FinalBoneMatrices</span><span class="p">;</span>  
</span></span><span class="line"><span class="ln">62</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">		
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&gt;</span> <span class="n">m_FinalBoneMatrices</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="n">Animation</span><span class="o">*</span> <span class="n">m_CurrentAnimation</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    <span class="kt">float</span> <span class="n">m_CurrentTime</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">    <span class="kt">float</span> <span class="n">m_DeltaTime</span><span class="p">;</span>	
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p><code>Animator</code> constructor takes an animation to play and then it proceeds to reset the animation time <code>m_CurrentTime</code> to 0. It also initializes <code>m_FinalBoneMatrices</code> which is a <code>std::vector&lt;glm::mat4&gt;</code>. The main point of attention here is <code>UpdateAnimation(float deltaTime)</code> function. It advances the <code>m_CurrentTime</code> with rate of <code>m_TicksPerSecond</code> and then calls the <code>CalculateBoneTransform</code> function. We will pass two arguments in the start, first is the <code>m_RootNode</code> of <code>m_CurrentAnimation</code> and second is an identity matrix passed as <code>parentTransform</code> This function then check if <code>m_RootNode</code>s bone is engaged in this animation by finding it in <code>m_Bones</code> array of <code>Animation</code>. If bone is found then it calls <code>Bone.Update()</code> function which interpolates all bones and return local bone transform matrix to <code>nodeTransform</code>. But this is local space matrix and will move bone around origin if passed in shaders. So we multiply this <code>nodeTransform</code> with <code>parentTransform</code> and we store the result in <code>globalTransformation</code>. This would be enough but vertices are still in default model space. we find offset matrix in <code>m_BoneInfoMap</code> and then multiply it with <code>globalTransfromMatrix</code>. We will also get the id index which will be used to write final transformation of this bone to m_FinalBoneMatrices.</p>
<p>Finally! we call <code>CalculateBoneTransform</code> for each child nodes of this node and pass <code>globalTransformation</code> as <code>parentTransform</code>. We break this recursive loop when there will no children left to process further.</p>
<h5 id="lets-animate">Let&rsquo;s Animate</h5>
<p>Fruit of our hardwork is finally here! Here&rsquo;s how we will play the animation in <code>main.cpp</code> &hellip;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">Model</span> <span class="n">ourModel</span><span class="p">(</span><span class="n">FileSystem</span><span class="o">::</span><span class="n">getPath</span><span class="p">(</span><span class="s">&#34;resources/objects/vampire/dancing_vampire.dae&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">Animation</span> <span class="n">danceAnimation</span><span class="p">(</span><span class="n">FileSystem</span><span class="o">::</span><span class="n">getPath</span><span class="p">(</span><span class="s">&#34;resources/objects/vampire/dancing_vampire.dae&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="o">&amp;</span><span class="n">ourModel</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">Animator</span> <span class="n">animator</span><span class="p">(</span><span class="o">&amp;</span><span class="n">danceAnimation</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">// draw in wireframe
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>    <span class="c1">//glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">// render loop
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>    <span class="c1">// -----------
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1">// per-frame time logic
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>        <span class="c1">// --------------------
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>        <span class="kt">float</span> <span class="n">currentFrame</span> <span class="o">=</span> <span class="n">glfwGetTime</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">deltaTime</span> <span class="o">=</span> <span class="n">currentFrame</span> <span class="o">-</span> <span class="n">lastFrame</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">lastFrame</span> <span class="o">=</span> <span class="n">currentFrame</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="c1">// input
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="c1"></span>        <span class="c1">// -----
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span>        <span class="n">processInput</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="n">animator</span><span class="p">.</span><span class="n">UpdateAnimation</span><span class="p">(</span><span class="n">deltaTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">		
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="c1">// render
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>        <span class="c1">// ------
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="c1"></span>        <span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.05f</span><span class="p">,</span> <span class="mf">0.05f</span><span class="p">,</span> <span class="mf">0.05f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="c1">// don&#39;t forget to enable shader before setting uniforms
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c1"></span>        <span class="n">ourShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="c1">// view/projection transformations
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="c1"></span>        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">camera</span><span class="p">.</span><span class="n">Zoom</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">SCR_WIDTH</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">SCR_HEIGHT</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">100.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">view</span> <span class="o">=</span> <span class="n">camera</span><span class="p">.</span><span class="n">GetViewMatrix</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">ourShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;projection&#34;</span><span class="p">,</span> <span class="n">projection</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="n">ourShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;view&#34;</span><span class="p">,</span> <span class="n">view</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">auto</span> <span class="n">transforms</span> <span class="o">=</span> <span class="n">animator</span><span class="p">.</span><span class="n">GetFinalBoneMatrices</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">transforms</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">            <span class="n">ourShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;finalBonesMatrices[&#34;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="p">,</span> <span class="n">transforms</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="c1">// render the loaded model
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="c1"></span>        <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="c1">// translate it down so it&#39;s at the center of the scene
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="c1"></span>        <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">51</span><span class="cl">        <span class="c1">// it&#39;s a bit too big for our scene, so scale it down
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="c1"></span>        <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">.5f</span><span class="p">,</span> <span class="mf">.5f</span><span class="p">,</span> <span class="mf">.5f</span><span class="p">));</span>	
</span></span><span class="line"><span class="ln">53</span><span class="cl">        <span class="n">ourShader</span><span class="p">.</span><span class="n">setMat4</span><span class="p">(</span><span class="s">&#34;model&#34;</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">        <span class="n">ourModel</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">ourShader</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl">        <span class="c1">// glfw: swap buffers and poll IO events (keys pressed/released, mouse moved etc.)
</span></span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="c1"></span>        <span class="c1">// -------------------------------------------------------------------------------
</span></span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="c1"></span>        <span class="n">glfwSwapBuffers</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">        <span class="n">glfwPollEvents</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl">    <span class="c1">// glfw: terminate, clearing all previously allocated GLFW resources.
</span></span></span><span class="line"><span class="ln">63</span><span class="cl"><span class="c1"></span>    <span class="c1">// ------------------------------------------------------------------
</span></span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="c1"></span>    <span class="n">glfwTerminate</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span></span></span></code></pre></div><p>We start with loading our <code>Model</code> which will setup bone weight data for the shader and then create an <code>Animation</code> by giving it the path. Then we create our <code>Animator</code> object by passing it the created <code>Animation</code>. In render loop we then update our <code>Animator</code>, take the final bone transformations and give it to shaders. Here&rsquo;s the output we all have been waiting for&hellip;</p>
<p><a href="#R-image-a76d0d0067c821402d8b36a3ce7f1732" class="lightbox-link"><img src="./assets/output.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a76d0d0067c821402d8b36a3ce7f1732"><img src="./assets/output.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Download the model used from <a href="https://learnopengl.com/Model-Loading/Assimp" target="_blank">Here.</a> Note that animations and meshes are baked in single DAE(collada) file. You can find the full source code for this demo <a href="https://learnopengl.com/code_viewer_gh.php?code=src/8.guest/2020/skeletal_animation/skeletal_animation.cpp" target="_blank">here</a>.</p>
<h5 id="further-reading-2">Further reading</h5>
<ul>
<li><a href="http://www.songho.ca/math/quaternion/quaternion.html" target="_blank">Quaternions</a>: An article by songho to understand quaternions in depth.</li>
<li><a href="http://ogldev.atspace.co.uk/www/tutorial38/tutorial38.html" target="_blank">Skeletal Animation with Assimp</a>: An article by OGL Dev.</li>
<li><a href="https://youtu.be/f3Cr8Yx3GGA" target="_blank">Skeletal Animation with Java</a>: A fantastic youtube playlist by Thin Matrix.</li>
<li><a href="https://www.gamasutra.com/view/feature/131686/rotating_objects_using_quaternions.php" target="_blank">Why Quaternions should be used for Rotation</a>: An awesome gamasutra article.</li>
</ul>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          
<span style="font-size:26px">Êôü‰∏ñÊ∏ÖÈ£é</span>
        </div>
        <form action="../../../../../search.html" method="get"><div class="searchbox default-animation">
          <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
          <label class="a11y-only" for="R-search-by">Search</label>
          <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
          <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
        </div></form>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="../../../../../js/auto-complete.js?1708235000" defer></script>
        <script src="../../../../../js/lunr/lunr.min.js?1708235000" defer></script>
        <script src="../../../../../js/lunr/lunr.stemmer.support.min.js?1708235000" defer></script>
        <script src="../../../../../js/lunr/lunr.multi.min.js?1708235000" defer></script>
        <script src="../../../../../js/lunr/lunr.en.min.js?1708235000" defer></script>
        <script src="../../../../../js/search.js?1708235000" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="../../../../../index.html"><i class='fas fa-home'></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
          <li data-nav-id="/programming/index.html" class=""><input type="checkbox" id="R-section-d205f2b94e06f539e77f2bc392064cb6" aria-controls="R-subsections-d205f2b94e06f539e77f2bc392064cb6"><label for="R-section-d205f2b94e06f539e77f2bc392064cb6"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Á®ãÂ∫èËÆæËÆ°‰∏éÂºÄÂèë</span></label><a class="padding" href="../../../../../programming/index.html">Á®ãÂ∫èËÆæËÆ°‰∏éÂºÄÂèë</a><ul id="R-subsections-d205f2b94e06f539e77f2bc392064cb6" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/index.html" class="alwaysopen"><input type="checkbox" id="R-section-1a585580994f9dab2d4547c8eaf11987" aria-controls="R-subsections-1a585580994f9dab2d4547c8eaf11987" checked><label for="R-section-1a585580994f9dab2d4547c8eaf11987"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Java ËØ≠Ë®Ä</span></label><a class="padding" href="../../../../../programming/java/index.html">Java ËØ≠Ë®Ä</a><ul id="R-subsections-1a585580994f9dab2d4547c8eaf11987" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/java_basics/index.html" class=""><a class="padding" href="../../../../../programming/java/java_basics/index.html">Java Âü∫Á°ÄÁü•ËØÜ</a></li>
          <li data-nav-id="/programming/java/java_collection_framework/index.html" class=""><a class="padding" href="../../../../../programming/java/java_collection_framework/index.html">Java ÈõÜÂêàÊ°ÜÊû∂</a></li>
          <li data-nav-id="/programming/java/java_concurrency/index.html" class=""><a class="padding" href="../../../../../programming/java/java_concurrency/index.html">Java Âπ∂ÂèëÁºñÁ®ã</a></li>
          <li data-nav-id="/programming/java/java_memory_model/index.html" class=""><a class="padding" href="../../../../../programming/java/java_memory_model/index.html">Java ÂÜÖÂ≠òÊ®°Âûã</a></li>
          <li data-nav-id="/programming/java/java_annotation/index.html" class=""><a class="padding" href="../../../../../programming/java/java_annotation/index.html">Java Ê≥®Ëß£Áõ∏ÂÖ≥</a></li></ul></li></ul></li>
          <li data-nav-id="/test/index.html" class=""><input type="checkbox" id="R-section-40aaf63da4d8c6f43df4cc726b56321f" aria-controls="R-subsections-40aaf63da4d8c6f43df4cc726b56321f"><label for="R-section-40aaf63da4d8c6f43df4cc726b56321f"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Test</span></label><a class="padding" href="../../../../../test/index.html">Test</a><ul id="R-subsections-40aaf63da4d8c6f43df4cc726b56321f" class="morespace collapsible-menu">
          <li data-nav-id="/test/demo/index.html" class=""><a class="padding" href="../../../../../test/demo/index.html">Test</a></li></ul></li>
          <li data-nav-id="/algorithms_and_data_structures/index.html" class=""><a class="padding" href="../../../../../algorithms_and_data_structures/index.html">Êï∞ÊçÆÁªìÊûÑ‰∏éÁÆóÊ≥ï</a></li>
          <li data-nav-id="/computer_graphics/index.html" class="parent "><input type="checkbox" id="R-section-17dabdd0438dc68716ce11b90ee5aa30" aria-controls="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" checked><label for="R-section-17dabdd0438dc68716ce11b90ee5aa30"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</span></label><a class="padding" href="../../../../../computer_graphics/index.html">ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</a><ul id="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/index.html" class="parent "><input type="checkbox" id="R-section-0e0951862a264269c87df7fac4f297fb" aria-controls="R-subsections-0e0951862a264269c87df7fac4f297fb" checked><label for="R-section-0e0951862a264269c87df7fac4f297fb"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ÁªèÂÖ∏ÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/index.html">ÁªèÂÖ∏ÊïôÁ®ã</a><ul id="R-subsections-0e0951862a264269c87df7fac4f297fb" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/basics_tutorial/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/basics_tutorial/index.html">Âü∫Á°ÄÊïôÁ®ã</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/shader_tutorial/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/shader_tutorial/index.html">ÁùÄËâ≤ÊïôÁ®ã</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/index.html" class=""><input type="checkbox" id="R-section-06ac295778bd74c824886a3ab22c212c" aria-controls="R-subsections-06ac295778bd74c824886a3ab22c212c"><label for="R-section-06ac295778bd74c824886a3ab22c212c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ÂÖâÁ∫øËøΩË∏™</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/index.html">ÂÖâÁ∫øËøΩË∏™</a><ul id="R-subsections-06ac295778bd74c824886a3ab22c212c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html">Ray Tracing in One Weekend</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html">Ray Tracing The Next Week</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html">Ray Tracing The Rest of Your Life</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html" class=""><input type="checkbox" id="R-section-c33da7e0886830ccf91b260ac3fff456" aria-controls="R-subsections-c33da7e0886830ccf91b260ac3fff456"><label for="R-section-c33da7e0886830ccf91b260ac3fff456"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Scratchapixe Á≥ªÂàóÁü≠Êñá</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html">Scratchapixe Á≥ªÂàóÁü≠Êñá</a><ul id="R-subsections-c33da7e0886830ccf91b260ac3fff456" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html">Chapter - 6</a></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/index.html" class="parent "><input type="checkbox" id="R-section-23d956a7f1e516a9e3d46517dfb799dd" aria-controls="R-subsections-23d956a7f1e516a9e3d46517dfb799dd" checked><label for="R-section-23d956a7f1e516a9e3d46517dfb799dd"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OpenGLÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/index.html">OpenGLÊïôÁ®ã</a><ul id="R-subsections-23d956a7f1e516a9e3d46517dfb799dd" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html" class="parent "><input type="checkbox" id="R-section-57f86dac108257fe13450c17c0c3086c" aria-controls="R-subsections-57f86dac108257fe13450c17c0c3086c" checked><label for="R-section-57f86dac108257fe13450c17c0c3086c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Learn OpenGL</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html">Learn OpenGL</a><ul id="R-subsections-57f86dac108257fe13450c17c0c3086c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2020/index.html" class="active"><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2020/index.html"></a></li></ul></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html" class=""><input type="checkbox" id="R-section-ae6b71edd18a266dbd92162060f7614e" aria-controls="R-subsections-ae6b71edd18a266dbd92162060f7614e"><label for="R-section-ae6b71edd18a266dbd92162060f7614e"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OGL dev ÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html">OGL dev ÊïôÁ®ã</a><ul id="R-subsections-ae6b71edd18a266dbd92162060f7614e" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html">Chapter - 6</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html">Chapter - 7</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html">Chapter - 8</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html">Chapter - 9</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html">Chapter - 10</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html">Chapter - 11</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html">Chapter - 12</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html">Chapter - 13</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html">Chapter - 14</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html">Chapter - 15</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html">Chapter - 16</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html">Chapter - 17</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html">Chapter - 18</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html">Chapter - 19</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html">Chapter - 20</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html">Chapter - 21</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html">Chapter - 22</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html">Chapter - 23</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html">Chapter - 24</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html">Chapter - 25</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html">Chapter - 26</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html">Chapter - 27</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html">Chapter - 28</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html">Chapter - 29</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html">Chapter - 30</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html">Chapter - 31</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html">Chapter - 32</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html">Chapter - 33</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html">Chapter - 34</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html">Chapter - 35</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html">Chapter - 36</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html">Chapter - 37</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html">Chapter - 38</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html">Chapter - 39</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html">Chapter - 40</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html">Chapter - 41</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html">Chapter - 42</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html">Chapter - 43</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html">Chapter - 44</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html">Chapter - 45</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html">Chapter - 46</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html">Chapter - 47</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html">Chapter - 48</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html">Chapter - 49</a></li></ul></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/book_recommend/index.html" class=""><a class="padding" href="../../../../../computer_graphics/book_recommend/index.html">‰π¶Á±çÊé®Ëçê</a></li>
          <li data-nav-id="/computer_graphics/blog_article/index.html" class=""><a class="padding" href="../../../../../computer_graphics/blog_article/index.html">ÂçöÂÆ¢ÊñáÁ´†</a></li>
          <li data-nav-id="/computer_graphics/reference/index.html" class=""><a class="padding" href="../../../../../computer_graphics/reference/index.html">ÂèÇËÄÉËµÑÊñô</a></li></ul></li>
          <li data-nav-id="/computer_science/index.html" class=""><input type="checkbox" id="R-section-7d71eaebfb32275fa70e6b3397a5fe7c" aria-controls="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c"><label for="R-section-7d71eaebfb32275fa70e6b3397a5fe7c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ËÆ°ÁÆóÊú∫ÁßëÂ≠¶</span></label><a class="padding" href="../../../../../computer_science/index.html">ËÆ°ÁÆóÊú∫ÁßëÂ≠¶</a><ul id="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_science/blog_article/index.html" class=""><a class="padding" href="../../../../../computer_science/blog_article/index.html">ÂçöÂÆ¢ÊñáÁ´†</a></li>
          <li data-nav-id="/computer_science/operating_system/index.html" class=""><a class="padding" href="../../../../../computer_science/operating_system/index.html">Êìç‰ΩúÁ≥ªÁªü</a></li></ul></li>
          <li data-nav-id="/computer_networks/index.html" class=""><a class="padding" href="../../../../../computer_networks/index.html">ËÆ°ÁÆóÊú∫ÁΩëÁªú</a></li>
          <li data-nav-id="/game_programming/index.html" class=""><a class="padding" href="../../../../../game_programming/index.html">Ê∏∏ÊàèÁºñÁ®ã</a></li>
          <li data-nav-id="/database/index.html" class=""><a class="padding" href="../../../../../database/index.html">Êï∞ÊçÆÂ∫ì</a></li>
          </ul>
        </div>
        <div id="R-shortcuts">
          <div class="nav-title padding">More</div>
          <ul class="space">
            <li><a class="padding" href="https://github.com/McShelby/hugo-theme-relearn"><i class='fab fa-fw fa-github'></i> GitHub repo</a></li>
            <li><a class="padding" href="../../../../../tags/index.html"><i class='fas fa-fw fa-tags'></i> Tags</a></li>
            <li><a class="padding" href="../../../../../categories/index.html"><i class='fas fa-fw fa-layer-group'></i> Categories</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVariantSwitch">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-language fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = baseUri + this.value;">
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch showVariantSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-paint-brush fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-auto" value="auto" selected>Auto</option>
                      <option id="R-relearn-light" value="relearn-light">Relearn Light</option>
                      <option id="R-relearn-dark" value="relearn-dark">Relearn Dark</option>
                      <option id="R-zen-light" value="zen-light">Zen Light</option>
                      <option id="R-zen-dark" value="zen-dark">Zen Dark</option>
                      <option id="R-neon" value="neon">Neon</option>
                      <option id="R-learn" value="learn">Learn</option>
                      <option id="R-blue" value="blue">Blue</option>
                      <option id="R-green" value="green">Green</option>
                      <option id="R-red" value="red">Red</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fas fa-history fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
          <span class="github-buttons"></span>
          <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
          <script>
            function githubButtonsScheme(){
              var scheme = 'light';
              var colorPropertyValue = window.getComputedStyle( document.querySelector( '#R-sidebar' ) ).getPropertyValue( 'background-color' );
              var colorValues = colorPropertyValue.match( /\d+/g ).map( function( e ){ return parseInt(e,10); });
              if( colorValues.length === 3 && ((0.2126 * colorValues[0]) + (0.7152 * colorValues[1]) + (0.0722 * colorValues[2]) < 165) ){
                
                scheme = 'dark';
              }
              return scheme;
            }
            function githubButtonsInit(){
              if( !window.githubButtons ){
                
                setTimeout( githubButtonsInit, 50 );
                return;
              }
              var scheme = githubButtonsScheme();
              var githubButtonsHTML = `
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/archive/main.zip" data-color-scheme="${scheme}" data-icon="octicon-cloud-download" aria-label="Download McShelby/hugo-theme-relearn on GitHub">Download</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn" data-color-scheme="${scheme}" data-icon="octicon-star" data-show-count="true" aria-label="Star McShelby/hugo-theme-relearn on GitHub">Star</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/fork" data-color-scheme="${scheme}" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork McShelby/hugo-theme-relearn on GitHub">Fork</a>
               `;
              document.querySelector( '.github-buttons' ).innerHTML = githubButtonsHTML;
              document.querySelectorAll( '.github-button' ).forEach( function( anchor ){
                anchor.dataset.colorScheme = scheme;
                window.githubButtons.render( anchor, function( el ){
                  anchor.parentNode.replaceChild( el, anchor );
                });
              });
            }
            document.addEventListener( 'themeVariantLoaded', function( e ){
              
              setTimeout( githubButtonsInit, 400 );
            });
          </script>
          <script async src="../../../../../js/github-buttons.js?1708235000"></script>
          </div>
        </div>
      </div>
    </aside>
    <script src="../../../../../js/clipboard.min.js?1708235000" defer></script>
    <script src="../../../../../js/perfect-scrollbar.min.js?1708235000" defer></script>
    <script src="../../../../../js/theme.js?1708235000" defer></script>
  </body>
</html>
