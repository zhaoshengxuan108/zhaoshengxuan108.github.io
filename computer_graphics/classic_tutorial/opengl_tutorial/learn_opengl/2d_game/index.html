<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.122.0">
    <meta name="generator" content="Relearn 5.23.2+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="ÂïäÂïäÂïäÂïä">
    <meta name="author" content="S√∂ren Weber">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://example.com/images/hero.png">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="Breakout Over these chapters we learned a fair share about OpenGL&rsquo;s inner workings and how we can use them to create fancy graphics. However, aside from a lot of tech demos, we haven&rsquo;t really created a practical application with OpenGL. This is the introduction of a larger series about creating a relatively simple 2D game using OpenGL. The next chapters will demonstrate how we can use OpenGL in a larger, more complicated, setting.">
    <meta property="og:title" content="">
    <meta property="og:description" content="Breakout Over these chapters we learned a fair share about OpenGL&rsquo;s inner workings and how we can use them to create fancy graphics. However, aside from a lot of tech demos, we haven&rsquo;t really created a practical application with OpenGL. This is the introduction of a larger series about creating a relatively simple 2D game using OpenGL. The next chapters will demonstrate how we can use OpenGL in a larger, more complicated, setting.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://example.com/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2d_game/index.html">
    <meta property="og:image" content="https://example.com/images/hero.png">
    <meta property="article:section" content="Learn OpenGL :: Hugo Relearn Theme">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <title></title><link rel="icon" href="../../../../../images/favicon.ico">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../../../../css/fontawesome-all.min.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/fontawesome-all.min.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../../../css/nucleus.css?1708235101" rel="stylesheet">
    <link href="../../../../../css/auto-complete.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/auto-complete.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../../../css/perfect-scrollbar.min.css?1708235101" rel="stylesheet">
    <link href="../../../../../css/fonts.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../../../css/fonts.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../../../css/theme.css?1708235101" rel="stylesheet">
    <link href="../../../../../css/theme-auto.css?1708235101" rel="stylesheet" id="R-variant-style">
    <link href="../../../../../css/variant.css?1708235101" rel="stylesheet">
    <link href="../../../../../css/print.css?1708235101" rel="stylesheet" media="print">
    <link href="../../../../../css/ie.css?1708235101" rel="stylesheet">
    <script src="../../../../../js/url.js?1708235101"></script>
    <script src="../../../../../js/variant.js?1708235101"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../../../../index.search.js";
      var root_url="../../../../../";
      var baseUri=root_url.replace(/\/$/, '');
      window.relearn = window.relearn || {};
      window.relearn.baseUriFull='https:\/\/example.com/';
      // variant stuff
      window.variants && variants.init( [ 'auto', 'relearn-light', 'relearn-dark', 'zen-light', 'zen-dark', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    <style>
      #R-body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support html" data-url="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2d_game/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
              <button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)">
                <i class="fa-fw fas fa-bars"></i>
              </button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)">
                <i class="fa-fw fas fa-list-alt"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../index.html"><span itemprop="name">‰∏ªÈ°µ</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/index.html"><span itemprop="name">ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/index.html"><span itemprop="name">ÁªèÂÖ∏ÊïôÁ®ã</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/index.html"><span itemprop="name">OpenGLÊïôÁ®ã</span></a><meta itemprop="position" content="4">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html"><span itemprop="name">Learn OpenGL</span></a><meta itemprop="position" content="5">&nbsp;>&nbsp;</li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2d_game/index.print.html" title="Print whole chapter (CTRL&#43;ALT&#43;p)">
                <i class="fa-fw fas fa-print"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html" title="Learn OpenGL (ü°ê)">
                <i class="fa-fw fas fa-chevron-left"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html" title="OGL dev ÊïôÁ®ã (ü°í)">
                <i class="fa-fw fas fa-chevron-right"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More">
                <i class="fa-fw fas fa-ellipsis-v"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id=""></h1>

<h4 id="breakout">Breakout</h4>
<p>Over these chapters we learned a fair share about OpenGL&rsquo;s inner workings and how we can use them to create fancy graphics. However, aside from a lot of tech demos, we haven&rsquo;t really created a practical application with OpenGL. This is the introduction of a larger series about creating a relatively simple 2D game using OpenGL. The next chapters will demonstrate how we can use OpenGL in a larger, more complicated, setting. Note that the series does not necessarily introduce new OpenGL concepts but more or less show how we can apply these concepts to a larger whole.</p>
<p>Because we rather keep things simple, we&rsquo;re going to base our 2D game on an already existing 2D arcade game. Introducing Breakout, a classic 2D game released in 1976 on the Atari 2600 console. Breakout requires the player, who controls a small horizontal paddle, to destroy all the bricks by bouncing a small ball against each brick without allowing the ball to reach the bottom edge. Once the player destroys all bricks, he completes the game.</p>
<p>Below we can see how Breakout originally looked on the Atari 2600:</p>
<p><a href="#R-image-a96e4817f8949743d273b6be42567d2b" class="lightbox-link"><img src="./assets/breakout2600.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a96e4817f8949743d273b6be42567d2b"><img src="./assets/breakout2600.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The game has the following mechanics:</p>
<ul>
<li>A small paddle is controlled by the player and can only move horizontally within the bounds of the screen.</li>
<li>The ball travels across the screen and each collision results in the ball changing its direction based on where it hit; this applies to the screen bounds, the bricks, and the paddle.</li>
<li>If the ball reaches the bottom edge of the screen, the player is either game over or loses a life.</li>
<li>As soon as a brick touches the ball, the brick is destroyed.</li>
<li>The player wins as soon as all bricks are destroyed.</li>
<li>The direction of the ball can be manipulated by how far the ball bounces from the paddle&rsquo;s center.</li>
</ul>
<p>Because from time to time the ball may find a small gap reaching the area above the brick wall, it will continue to bounce up and forth between the top edge of the level and the top edge of the brick layer. The ball keeps this up, until it eventually finds a gap again. This is logically where the game obtained its name from, since the ball has to <em>break out</em>.</p>
<h5 id="opengl-breakout">OpenGL Breakout</h5>
<p>We&rsquo;re going to take this classic arcade game as the basis of a 2D game that we&rsquo;ll completely implement with OpenGL. This version of Breakout will render its graphics on the GPU which gives us the ability to enhance the classical Breakout game with some nice extra features.</p>
<p>Other than the classic mechanics, our version of Breakout will feature:</p>
<ul>
<li>Amazing graphics!</li>
<li>Particles</li>
<li>Text rendering</li>
<li>Power-ups</li>
<li>Postprocessing effects</li>
<li>Multiple (customizable) levels</li>
</ul>
<p>To get you excited you can see what the game will look like after you&rsquo;ve finished these chapters:</p>
<p><a href="#R-image-0507d56780c3217df04f52553deb6d84" class="lightbox-link"><img src="./assets/cover.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0507d56780c3217df04f52553deb6d84"><img src="./assets/cover.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>These chapters will combine a large number of concepts from previous chapters and demonstrate how they can work together as a whole. Therefore, it is important to have at least finished the <a href="https://learnopengl.com/Getting-started/OpenGL" target="_blank">Getting started</a> chapters before working your way through these series.</p>
<p>Also, several chapters will require concepts from other chapters (Framebuffers for example from the <a href="https://learnopengl.com/Advanced-OpenGL/Framebuffers" target="_blank">Advanced OpenGL</a> section) so where necessary, the required chapters are listed.</p>
<p>If you believe you&rsquo;re ready to get your hands dirty then move on to the <a href="https://learnopengl.com/In-Practice/2D-Game/Setting-up" target="_blank">next</a> chapter.</p>
<h4 id="setting-up">Setting up</h4>
<p>Before we get started with the game mechanics, we first need to set up a simple framework for the game to reside in. The game will use several third party libraries of which most have been introduced in earlier chapters. Wherever a new library is required, it will be properly introduced.</p>
<p>First, we define a so called uber game class that contains all relevant render and gameplay code. The idea of such a game class is that it (sort of) organizes your game code, while also decoupling all windowing code from the game. This way, you could use the same class in a completely different windowing library (like SDL or SFML for example) without much effort.</p>
<p><note>There are thousands of ways of trying to abstract and generalize game/graphics code into classes and objects. What you will see in these chapters is just one (relatively simple) approach to solve this issue. If you feel there is a better approach, try to come up with your own improvement of the implementation.</note></p>
<p>The game class hosts an initialization function, an update function, a function to process input, and a render function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="c1">// game state
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>        <span class="n">GameState</span>    <span class="n">State</span><span class="p">;</span>	
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kt">bool</span>         <span class="n">Keys</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Width</span><span class="p">,</span> <span class="n">Height</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="c1">// constructor/destructor
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>        <span class="n">Game</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="o">~</span><span class="n">Game</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">// initialize game state (load all shaders/textures/levels)
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>        <span class="kt">void</span> <span class="nf">Init</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1">// game loop
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>        <span class="kt">void</span> <span class="nf">ProcessInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="kt">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="kt">void</span> <span class="nf">Render</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>The class hosts what you may expect from a game class. We initialize the game with a width and height (the resolution you want to play the game in) and use the Init function to load shaders, textures, and initialize all gameplay state. We can process input as stored within the Keys array by calling ProcessInput, and update all gameplay events (like player/ball movement) in the Update function. Last, we can render the game by calling Render. Note that we split the movement logic from the render logic.</p>
<p>The Game class also hosts a variable called State which is of type GameState as defined below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// Represents the current state of the game
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="k">enum</span> <span class="nc">GameState</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">GAME_ACTIVE</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">GAME_MENU</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">GAME_WIN</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">};</span> 
</span></span></code></pre></div><p>This allows us to keep track of what state the game is currently in. This way, we can decide to adjust rendering and/or processing based on the current state of the game (we probably render and process different items when we&rsquo;re in the game&rsquo;s menu for example).</p>
<p>As of now, the functions of the game class are completely empty since we have yet to write the actual game code, but here are the Game class&rsquo;s <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/2.game.h" target="_blank">header</a> and <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/2.game.cpp" target="_blank">code</a> file.</p>
<h5 id="utility">Utility</h5>
<p>Since we&rsquo;re creating a large application we&rsquo;ll frequently have to re-use several OpenGL concepts, like textures and shaders. It thus makes sense to create a more easy-to-use interface for these two items as similarly done in one of the earlier chapters where we created a shader class.</p>
<p>We define a shader class that generates a compiled shader (or generates error messages if it fails) from two or three strings (if a geometry shader is present). The shader class also contains a lot of useful utility functions to quickly set uniform values. We also define a texture class that generates a 2D texture image (based on its properties) from a byte array and a given width and height. Again, the texture class also hosts utility functions.</p>
<p>We won&rsquo;t delve into the details of the classes since by now you should easily understand how they work. For this reason you can find the header and code files, fully commented, below:</p>
<ul>
<li><strong>Shader</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/shader.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/shader.cpp" target="_blank">code</a>.</li>
<li><strong>Texture</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/texture.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/texture.cpp" target="_blank">code</a>.</li>
</ul>
<p>Note that the current texture class is solely designed for 2D textures only, but could easily be extended for alternative texture types.</p>
<h5 id="resource-management">Resource management</h5>
<p>While the shader and texture classes function great by themselves, they do require either a byte array or a list of strings for initialization. We could easily embed file loading code within the classes themselves, but this slightly violates the single responsibility principle. We&rsquo;d prefer these classes to only focus on either textures or shaders respectively, and not necessarily their file-loading mechanics.</p>
<p>For this reason it is often considered a more organized approach to create a single entity designed for loading game-related resources called a resource manager. There are several approaches to creating a resource manager; for this chapter we chose to use a singleton static resource manager that is (due to its static nature) always available throughout the project, hosting all loaded resources and their relevant loading functionality.</p>
<p>Using a singleton class with static functionality has several advantages and disadvantages, with its disadvantages mostly being the loss of several OOP properties and less control over construction/destruction. However, for relatively small projects like this it is easy to work with.</p>
<p>Like the other class files, the resource manager is listed below:</p>
<ul>
<li><strong>Resource Manager</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/resource_manager.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/resource_manager.cpp" target="_blank">code</a>.</li>
</ul>
<p>Using the resource manager, we can easily load shaders into the program like:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Shader</span> <span class="n">shader</span> <span class="o">=</span> <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadShader</span><span class="p">(</span><span class="s">&#34;vertex.vs&#34;</span><span class="p">,</span> <span class="s">&#34;fragment.vs&#34;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="s">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">// then use it
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="n">shader</span><span class="p">.</span><span class="n">Use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">// or
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="s">&#34;test&#34;</span><span class="p">).</span><span class="n">Use</span><span class="p">();</span></span></span></code></pre></div><p>The defined Game class, together with the resource manager and the easily manageable Shader and Texture2D classes, form the basis for the next chapters as we&rsquo;ll be extensively using these classes to implement the Breakout game.</p>
<h5 id="program">Program</h5>
<p>We still need a window for the game and set some initial OpenGL state as we make use of OpenGL&rsquo;s <a href="https://learnopengl.com/Advanced-OpenGL/Blending" target="_blank">blending</a> functionality. We do not enable depth testing, since the game is entirely in 2D. All vertices are defined with the same z-values so enabling depth testing would be of no use and likely cause z-fighting.</p>
<p>The startup code of the Breakout game is relatively simple: we create a window with GLFW, register a few callback functions, create the Game object, and propagate all relevant functionality to the game class. The code is given below:</p>
<ul>
<li><strong>Program</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/2.program.cpp" target="_blank">code</a>.</li>
</ul>
<p>Running the code should give you the following output:</p>
<p><a href="#R-image-f311afe4de911bb91f10c13ad5b3f374" class="lightbox-link"><img src="./assets/setting-up.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f311afe4de911bb91f10c13ad5b3f374"><img src="./assets/setting-up.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>By now we have a solid framework for the upcoming chapters; we&rsquo;ll be continuously extending the game class to host new functionality. Hop over to the <a href="https://learnopengl.com/In-Practice/2D-Game/Rendering-Sprites" target="_blank">next</a> chapter once you&rsquo;re ready.</p>
<h4 id="rendering-sprites">Rendering Sprites</h4>
<p>To bring some life to the currently black abyss of our game world, we will render sprites to fill the void. A sprite has many definitions, but it&rsquo;s effectively not much more than a 2D image used together with some data to position it in a larger world (e.g. position, rotation, and size). Basically, sprites are the render-able image/texture objects we use in a 2D game.</p>
<p>We can, just like we did in previous chapters, create a 2D shape out of vertex data, pass all data to the GPU, and transform it all by hand. However, in a larger application like this we rather have some abstractions on rendering 2D shapes. If we were to manually define these shapes and transformations for each object, it&rsquo;ll quickly get messy.</p>
<p>In this chapter we&rsquo;ll define a rendering class that allows us to render a large amount of unique sprites with a minimal amount of code. This way, we&rsquo;re abstracting the gameplay code from the gritty OpenGL rendering code as is commonly done in larger projects. First, we have to set up a proper projection matrix though.</p>
<h5 id="2d-projection-matrix">2D projection matrix</h5>
<p>We know from the <a href="https://learnopengl.com/Getting-started/Coordinate-Systems" target="_blank">coordinate systems</a> chapter that a projection matrix converts all view-space coordinates to clip-space (and then to normalized device) coordinates. By generating the appropriate projection matrix we can work with different coordinates that are easier to work with, compared to directly specifying all coordinates as normalized device coordinates.</p>
<p>We don&rsquo;t need any perspective applied to the coordinates, since the game is entirely in 2D, so an orthographic projection matrix would suit the rendering quite well. Because an orthographic projection matrix directly transforms all coordinates to normalized device coordinates, we can choose to specify the world coordinates as screen coordinates by defining the projection matrix as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">ortho</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">800.0f</span><span class="p">,</span> <span class="mf">600.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>  
</span></span></code></pre></div><p>The first four arguments specify in order the left, right, bottom, and top part of the projection frustum. This projection matrix transforms all <code>x</code> coordinates between <code>0</code> and <code>800</code> to <code>-1</code> and <code>1</code>, and all <code>y</code> coordinates between <code>0</code> and <code>600</code> to <code>-1</code> and <code>1</code>. Here we specified that the top of the frustum has a <code>y</code> coordinate of <code>0</code>, while the bottom has a <code>y</code> coordinate of <code>600</code>. The result is that the top-left coordinate of the scene will be at (<code>0,0</code>) and the bottom-right part of the screen is at coordinate (<code>800,600</code>), just like screen coordinates; the world-space coordinates directly correspond to the resulting pixel coordinates.</p>
<p><a href="#R-image-031c1f66636fd5394478d040b79b58d9" class="lightbox-link"><img src="./assets/projection.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-031c1f66636fd5394478d040b79b58d9"><img src="./assets/projection.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This allows us to specify all vertex coordinates equal to the pixel coordinates they end up in on the screen, which is rather intuitive for 2D games.</p>
<h5 id="rendering-sprites-1">Rendering sprites</h5>
<p>Rendering an actual sprite shouldn&rsquo;t be too complicated. We create a textured quad that we can transform with a model matrix, after which we project it using the previously defined orthographic projection matrix.</p>
<p><note>Since Breakout is a single-scene game, there is no need for a view/camera matrix. Using the projection matrix we can directly transform the world-space coordinates to normalized device coordinates.</note></p>
<p>To transform a sprite, we use the following vertex shader:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec4</span> <span class="n">vertex</span><span class="p">;</span> <span class="c1">// &lt;vec2 position, vec2 texCoords&gt;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">out</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">model</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">projection</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">projection</span> <span class="o">*</span> <span class="n">model</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Note that we store both the position and texture-coordinate data in a single vec4 variable. Because both the position and texture coordinates contain two floats, we can combine them in a single vertex attribute.</p>
<p>The fragment shader is relatively straightforward as well. We take a texture and a color vector that both affect the final color of the fragment. By having a uniform color vector, we can easily change the color of sprites from the game-code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">in</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">out</span> <span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">image</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">uniform</span> <span class="n">vec3</span> <span class="n">spriteColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>    
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">color</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">spriteColor</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>To make the rendering of sprites more organized, we define a SpriteRenderer class that is able to render a sprite with just a single function. Its definition is as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">SpriteRenderer</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="n">SpriteRenderer</span><span class="p">(</span><span class="n">Shader</span> <span class="o">&amp;</span><span class="n">shader</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="o">~</span><span class="n">SpriteRenderer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="kt">void</span> <span class="nf">DrawSprite</span><span class="p">(</span><span class="n">Texture2D</span> <span class="o">&amp;</span><span class="n">texture</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">position</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">size</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">10.0f</span><span class="p">,</span> <span class="mf">10.0f</span><span class="p">),</span> <span class="kt">float</span> <span class="n">rotate</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">Shader</span>       <span class="n">shader</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">quadVAO</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="kt">void</span> <span class="nf">initRenderData</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>The SpriteRenderer class hosts a shader object, a single vertex array object, and a render and initialization function. Its constructor takes a shader object that it uses for all future rendering.</p>
<h6 id="initialization">Initialization</h6>
<p>First, let&rsquo;s delve into the initRenderData function that configures the quadVAO:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">SpriteRenderer</span><span class="o">::</span><span class="n">initRenderData</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="c1">// configure VAO/VBO
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VBO</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kt">float</span> <span class="n">vertices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">// pos      // tex
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">10</span><span class="cl">    
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">glGenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">VBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">VBO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">vertices</span><span class="p">),</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">glBindVertexArray</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Here we first define a set of vertices with (<code>0,0</code>) being the top-left corner of the quad. This means that when we apply translation or scaling transformations on the quad, they&rsquo;re transformed from the top-left position of the quad. This is commonly accepted in 2D graphics and/or GUI systems where elements&rsquo; positions correspond to the top-left corner of the elements.</p>
<p>Next we simply sent the vertices to the GPU and configure the vertex attributes, which in this case is a single vertex attribute. We only have to define a single VAO for the sprite renderer since all sprites share the same vertex data.</p>
<h6 id="rendering">Rendering</h6>
<p>Rendering sprites is not too difficult; we use the sprite renderer&rsquo;s shader, configure a model matrix, and set the relevant uniforms. What is important here is the order of transformations:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">SpriteRenderer</span><span class="o">::</span><span class="n">DrawSprite</span><span class="p">(</span><span class="n">Texture2D</span> <span class="o">&amp;</span><span class="n">texture</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">position</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">size</span><span class="p">,</span> <span class="kt">float</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// prepare transformations
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">shader</span><span class="p">.</span><span class="n">Use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>  
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span> <span class="o">*</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">rotate</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5f</span> <span class="o">*</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5f</span> <span class="o">*</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl">  
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">shader</span><span class="p">.</span><span class="n">SetMatrix4</span><span class="p">(</span><span class="s">&#34;model&#34;</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">shader</span><span class="p">.</span><span class="n">SetVector3f</span><span class="p">(</span><span class="s">&#34;spriteColor&#34;</span><span class="p">,</span> <span class="n">color</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">texture</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="n">glBindVertexArray</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">quadVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>When trying to position objects somewhere in a scene with rotation and scaling transformations, it is advised to first scale, then rotate, and finally translate the object. Because multiplying matrices occurs from right to left, we transform the matrix in reverse order: translate, rotate, and then scale.</p>
<p>The rotation transformation may still seem a bit daunting. We know from the <a href="https://learnopengl.com/Getting-started/Transformations" target="_blank">transformations</a> chapter that rotations always revolve around the origin (<code>0,0</code>). Because we specified the quad&rsquo;s vertices with (<code>0,0</code>) as the top-left coordinate, all rotations will rotate around this point of (<code>0,0</code>). The origin of rotation is at the top-left of the quad, which produces undesirable results. What we want to do is move the origin of rotation to the center of the quad so the quad neatly rotates around this origin, instead of rotating around the top-left of the quad. We solve this by translating the quad by half its size first, so its center is at coordinate (<code>0,0</code>) before rotating.</p>
<p><a href="#R-image-f19096cc6b64f14f7a438ca24200dd03" class="lightbox-link"><img src="./assets/rotation-origin.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f19096cc6b64f14f7a438ca24200dd03"><img src="./assets/rotation-origin.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Since we first scale the quad, we have to take the size of the sprite into account when translating to the sprite&rsquo;s center, which is why we multiply with the sprite&rsquo;s size vector. Once the rotation transformation is applied, we reverse the previous translation.</p>
<p>Combining all these transformations, we can position, scale, and rotate each sprite in any way we like. Below you can find the complete source code of the sprite renderer:</p>
<ul>
<li><strong>SpriteRenderer</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/sprite_renderer.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/sprite_renderer.cpp" target="_blank">code</a></li>
</ul>
<h5 id="hello-sprite">Hello sprite</h5>
<p>With the SpriteRenderer class we finally have the ability to render actual images to the screen! Let&rsquo;s initialize one within the game code and load our favorite <a href="https://learnopengl.com/img/textures/awesomeface.png" target="_blank">texture</a> while we&rsquo;re at it:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">SpriteRenderer</span>  <span class="o">*</span><span class="n">Renderer</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="c1">// load shaders
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadShader</span><span class="p">(</span><span class="s">&#34;shaders/sprite.vs&#34;</span><span class="p">,</span> <span class="s">&#34;shaders/sprite.frag&#34;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="s">&#34;sprite&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">// configure shaders
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">ortho</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="s">&#34;sprite&#34;</span><span class="p">).</span><span class="n">Use</span><span class="p">().</span><span class="n">SetInteger</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="s">&#34;sprite&#34;</span><span class="p">).</span><span class="n">SetMatrix4</span><span class="p">(</span><span class="s">&#34;projection&#34;</span><span class="p">,</span> <span class="n">projection</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">// set render-specific controls
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>    <span class="n">Renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpriteRenderer</span><span class="p">(</span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="s">&#34;sprite&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="c1">// load textures
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/awesomeface.png&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&#34;face&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then within the render function we can render our beloved mascot to see if everything works as it should:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">Renderer</span><span class="o">-&gt;</span><span class="n">DrawSprite</span><span class="p">(</span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;face&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">200.0f</span><span class="p">,</span> <span class="mf">200.0f</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">300.0f</span><span class="p">,</span> <span class="mf">400.0f</span><span class="p">),</span> <span class="mf">45.0f</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Here we position the sprite somewhat close to the center of the screen with its height being slightly larger than its width. We also rotate it by 45 degrees and give it a green color. Note that the position we give the sprite equals the top-left vertex of the sprite&rsquo;s quad.</p>
<p>If you did everything right you should get the following output:</p>
<p><a href="#R-image-94d0d4d4b144e79b6b312739f8ea00ec" class="lightbox-link"><img src="./assets/rendering-sprites.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-94d0d4d4b144e79b6b312739f8ea00ec"><img src="./assets/rendering-sprites.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the updated game class&rsquo;s source code <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/3.game.cpp" target="_blank">here</a>.</p>
<p>Now that we got the render systems working, we can put it to good use in the <a href="https://learnopengl.com/In-Practice/2D-Game/Levels" target="_blank">next</a> chapter where we&rsquo;ll work on building the game&rsquo;s levels.</p>
<h4 id="levels">Levels</h4>
<p>Breakout is unfortunately not just about a single happy green face, but contains complete levels with a lot of playfully colored bricks. We want these levels to be configurable such that they can support any number of rows and/or columns, we want the levels to have solid bricks (that cannot be destroyed), we want the levels to support multiple brick colors, and we want them to be stored externally in (text) files.</p>
<p>In this chapter we&rsquo;ll briefly walk through the code of a game level object that is used to manage a large amount of bricks. We first have to define what an actual brick is though.</p>
<p>We create a component called a game object that acts as the base representation of an object inside the game. Such a game object holds state data like its position, size, and velocity. It holds a color, a rotation component, whether it is solid and/or destroyed, and it also stores a Texture2D variable as its sprite.</p>
<p>Each object in the game is represented as a GameObject or a derivative of this class. You can find the code of the GameObject class below:</p>
<ul>
<li><strong>GameObject</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game_object.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game_object.cpp" target="_blank">code</a></li>
</ul>
<p>A level in Breakout consists entirely of bricks so we can represent a level by exactly that: a collection of bricks. Because a brick requires the same state as a game object, we&rsquo;re going to represent each brick of the level as a GameObject. The declaration of the GameLevel class then looks as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">GameLevel</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// level state
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GameObject</span><span class="o">&gt;</span> <span class="n">Bricks</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">// constructor
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>    <span class="n">GameLevel</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">// loads level from file
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">Load</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelWidth</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelHeight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">// render level
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">Draw</span><span class="p">(</span><span class="n">SpriteRenderer</span> <span class="o">&amp;</span><span class="n">renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">// check if the level is completed (all non-solid tiles are destroyed)
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">IsCompleted</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="c1">// initialize level from tile data
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">tileData</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">17</span><span class="cl">              <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelWidth</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelHeight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">};</span>  
</span></span></code></pre></div><p>Since a level is loaded from an external (text) file, we need to propose some kind of level structure. Here is an example of what a game level may look like in a text file:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>1 1 1 1 1 1 
2 2 0 0 2 2
3 3 4 4 3 3</code></pre></div><p>A level is stored in a matrix-like structure where each number represents a type of brick, each one separated by a space. Within the level code we can then assign what each number represents. We have chosen the following representation:</p>
<ul>
<li>A number of 0: no brick, an empty space within the level.</li>
<li>A number of 1: a solid brick, a brick that cannot be destroyed.</li>
<li>A number higher than 1: a destroyable brick; each subsequent number only differs in color.</li>
</ul>
<p>The example level listed above would, after being processed by GameLevel, look like this:</p>
<p><a href="#R-image-95c2376756b0de83bede5fe4e06111f4" class="lightbox-link"><img src="./assets/levels-example.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-95c2376756b0de83bede5fe4e06111f4"><img src="./assets/levels-example.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The GameLevel class uses two functions to generate a level from file. It first loads all the numbers in a two-dimensional vector within its Load function that then processes these numbers (to create all game objects) in its init function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">GameLevel</span><span class="o">::</span><span class="n">Load</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelWidth</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">levelHeight</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="c1">// clear old data
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Bricks</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="c1">// load from file
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tileCode</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">GameLevel</span> <span class="n">level</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">fstream</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">tileData</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fstream</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">fstream</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="c1">// read each line from level file
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">istringstream</span> <span class="n">sstream</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">row</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">while</span> <span class="p">(</span><span class="n">sstream</span> <span class="o">&gt;&gt;</span> <span class="n">tileCode</span><span class="p">)</span> <span class="c1">// read each word separated by spaces
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>                <span class="n">row</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tileCode</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">tileData</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="n">tileData</span><span class="p">,</span> <span class="n">levelWidth</span><span class="p">,</span> <span class="n">levelHeight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>The loaded tileData is then passed to the game level&rsquo;s init function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">GameLevel</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">tileData</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">                     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvlWidth</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvlHeight</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// calculate dimensions
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="n">tileData</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span>  <span class="o">=</span> <span class="n">tileData</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="kt">float</span> <span class="n">unit_width</span>    <span class="o">=</span> <span class="n">lvlWidth</span> <span class="o">/</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="kt">float</span> <span class="n">unit_height</span>   <span class="o">=</span> <span class="n">lvlHeight</span> <span class="o">/</span> <span class="n">height</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">// initialize level tiles based on tileData		
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">;</span> <span class="o">++</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">width</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="c1">// check block type from level data (2D level array)
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// solid
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span>            <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">pos</span><span class="p">(</span><span class="n">unit_width</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">unit_height</span> <span class="o">*</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">size</span><span class="p">(</span><span class="n">unit_width</span><span class="p">,</span> <span class="n">unit_height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="n">GameObject</span> <span class="nf">obj</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">20</span><span class="cl">                    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;block_solid&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">21</span><span class="cl">                    <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                <span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">                <span class="n">obj</span><span class="p">.</span><span class="n">IsSolid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                <span class="k">this</span><span class="o">-&gt;</span><span class="n">Bricks</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>	
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span> <span class="c1">// original: white
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                    <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                    <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                    <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tileData</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">                    <span class="n">color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">pos</span><span class="p">(</span><span class="n">unit_width</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">unit_height</span> <span class="o">*</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">size</span><span class="p">(</span><span class="n">unit_width</span><span class="p">,</span> <span class="n">unit_height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">                <span class="k">this</span><span class="o">-&gt;</span><span class="n">Bricks</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;block&#34;</span><span class="p">),</span> <span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                <span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The init function iterates through each of the loaded numbers and adds a GameObject to the level&rsquo;s Bricks vector based on the processed number. The size of each brick is automatically calculated (unit_width and unit_height) based on the total number of bricks so that each brick perfectly fits within the screen bounds.</p>
<p>Here we load the game objects with two new textures, a <a href="https://learnopengl.com/img/in-practice/breakout/textures/block.png" target="_blank">block</a> texture and a <a href="https://learnopengl.com/img/in-practice/breakout/textures/block_solid.png" target="_blank">solid block</a> texture.</p>
<p><a href="#R-image-5ab14eb7c151a29d89421e86d6c83dfb" class="lightbox-link"><img src="./assets/block-textures.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5ab14eb7c151a29d89421e86d6c83dfb"><img src="./assets/block-textures.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>A nice little trick here is that these textures are completely in gray-scale. The effect is that we can neatly manipulate their colors within the game-code by multiplying their grayscale colors with a defined color vector; exactly as we did within the SpriteRenderer. This way, customizing the appearance of their colors doesn&rsquo;t look too weird or unbalanced.</p>
<p>The GameLevel class also houses a few other functions, like rendering all non-destroyed bricks, or validating if all non-solid bricks are destroyed. You can find the source code of the GameLevel class below:</p>
<ul>
<li><strong>GameLevel</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game_level.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game_level.cpp" target="_blank">code</a></li>
</ul>
<p>The game level class gives us a lot of flexibility since any amount of rows and columns are supported and a user could easily create his/her own levels by modifying the level files.</p>
<h5 id="within-the-game">Within the game</h5>
<p>We would like to support multiple levels in the Breakout game so we&rsquo;ll have to extend the game class a little by adding a vector that holds variables of type GameLevel. We&rsquo;ll also store the currently active level while we&rsquo;re at it:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GameLevel</span><span class="o">&gt;</span> <span class="n">Levels</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span>           <span class="n">Level</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="p">[...]</span>  
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>This series&rsquo; version of the Breakout game features a total of 4 levels:</p>
<ul>
<li><a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/levels/one.lvl" target="_blank">Standard</a></li>
<li><a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/levels/two.lvl" target="_blank">A few small gaps</a></li>
<li><a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/levels/three.lvl" target="_blank">Space invader</a></li>
<li><a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/levels/four.lvl" target="_blank">Bounce galore</a></li>
</ul>
<p>Each of the textures and levels are then initialized within the game class&rsquo;s Init function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// load textures
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/background.jpg&#34;</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="s">&#34;background&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/awesomeface.png&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&#34;face&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/block.png&#34;</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="s">&#34;block&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/block_solid.png&#34;</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="s">&#34;block_solid&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">// load levels
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>    <span class="n">GameLevel</span> <span class="n">one</span><span class="p">;</span> <span class="n">one</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#34;levels/one.lvl&#34;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">GameLevel</span> <span class="n">two</span><span class="p">;</span> <span class="n">two</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#34;levels/two.lvl&#34;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">GameLevel</span> <span class="n">three</span><span class="p">;</span> <span class="n">three</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#34;levels/three.lvl&#34;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">GameLevel</span> <span class="n">four</span><span class="p">;</span> <span class="n">four</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#34;levels/four.lvl&#34;</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">one</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">two</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">three</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">four</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Now all that is left to do, is actually render the level. We accomplish this by calling the currently active level&rsquo;s Draw function that in turn calls each GameObject&rsquo;s Draw function using the given sprite renderer. Next to the level, we&rsquo;ll also render the scene with a nice <a href="https://learnopengl.com/img/in-practice/breakout/textures/background.jpg" target="_blank">background image</a> (courtesy of Tenha):</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="c1">// draw background
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>        <span class="n">Renderer</span><span class="o">-&gt;</span><span class="n">DrawSprite</span><span class="p">(</span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;background&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">),</span> <span class="mf">0.0f</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="c1">// draw level
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The result is then a nicely rendered level that really starts to make the game feel more alive:</p>
<p><a href="#R-image-ef626562df560da5cc3b708af033f9a1" class="lightbox-link"><img src="./assets/levels.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ef626562df560da5cc3b708af033f9a1"><img src="./assets/levels.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h6 id="the-player-paddle">The player paddle</h6>
<p>While we&rsquo;re at it, we may just as well introduce a paddle at the bottom of the scene that is controlled by the player. The paddle only allows for horizontal movement and whenever it touches any of the scene&rsquo;s edges, its movement should halt. For the player paddle we&rsquo;re going to use the <a href="https://learnopengl.com/img/in-practice/breakout/textures/paddle.png" target="_blank">following</a> texture:</p>
<p><a href="#R-image-c62a98ee68e9136c249c94419d078228" class="lightbox-link"><img src="./assets/paddle.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c62a98ee68e9136c249c94419d078228"><img src="./assets/paddle.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>A paddle object will have a position, a size, and a sprite texture, so it makes sense to define the paddle as a GameObject as well:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Initial size of the player paddle
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">PLAYER_SIZE</span><span class="p">(</span><span class="mf">100.0f</span><span class="p">,</span> <span class="mf">20.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">// Initial velocity of the player paddle
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">float</span> <span class="nf">PLAYER_VELOCITY</span><span class="p">(</span><span class="mf">500.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">GameObject</span>      <span class="o">*</span><span class="n">Player</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">[...]</span>    
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/paddle.png&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&#34;paddle&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">playerPos</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">/</span> <span class="mf">2.0f</span> <span class="o">-</span> <span class="n">PLAYER_SIZE</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span> <span class="o">-</span> <span class="n">PLAYER_SIZE</span><span class="p">.</span><span class="n">y</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">Player</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GameObject</span><span class="p">(</span><span class="n">playerPos</span><span class="p">,</span> <span class="n">PLAYER_SIZE</span><span class="p">,</span> <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;paddle&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Here we defined several constant values that define the paddle&rsquo;s size and speed. Within the Game&rsquo;s Init function we calculate the starting position of the paddle within the scene. We make sure the player paddle&rsquo;s center is aligned with the horizontal center of the scene.</p>
<p>With the player paddle initialized, we also need to add a statement to the Game&rsquo;s Render function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>  
</span></span></code></pre></div><p>If you&rsquo;d start the game now, you would not only see the level, but also a fancy player paddle aligned to the bottom edge of the scene. As of now, it doesn&rsquo;t really do anything so we&rsquo;re going to delve into the Game&rsquo;s ProcessInput function to horizontally move the paddle whenever the user presses the A or D key:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">ProcessInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="kt">float</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">PLAYER_VELOCITY</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">// move playerboard
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_A</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_D</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">-</span> <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>Here we move the player paddle either in the left or right direction based on which key the user pressed (note how we multiply the velocity with the deltatime variable). If the paddle&rsquo;s <code>x</code> value would be less than <code>0</code> it would&rsquo;ve moved outside the left edge, so we only move the paddle to the left if the paddle&rsquo;s <code>x</code> value is higher than the left edge&rsquo;s <code>x</code> position (<code>0.0</code>). We do the same for when the paddle breaches the right edge, but we have to compare the right edge&rsquo;s position with the right edge of the paddle (subtract the paddle&rsquo;s width from the right edge&rsquo;s <code>x</code> position).</p>
<p>Now running the game gives us a player paddle that we can move all across the bottom edge:</p>
<p><a href="#R-image-4535919fa8d0164de4582d39a6717754" class="lightbox-link"><img src="./assets/levels-player.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4535919fa8d0164de4582d39a6717754"><img src="./assets/levels-player.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the updated code of the Game class here:</p>
<ul>
<li><strong>Game</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/4.game.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/4.game.cpp" target="_blank">code</a></li>
</ul>
<h4 id="collisions">Collisions</h4>
<h5 id="ball">Ball</h5>
<p>At this point we have a level full of bricks and a movable player paddle. The only thing missing from the classic Breakout recipe is the ball. The objective is to let the ball collide with all the bricks until each of the destroyable bricks are destroyed, but this all within the condition that the ball is not allowed to reach the bottom edge of the screen.</p>
<p>In addition to the general game object components, a ball has a radius, and an extra boolean value indicating whether the ball is stuck on the player paddle or it&rsquo;s allowed free movement. When the game starts, the ball is initially stuck on the player paddle until the player starts the game by pressing some arbitrary key.</p>
<p>Because the ball is effectively a GameObject with a few extra properties it makes sense to create a BallObject class as a subclass of GameObject:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">class</span> <span class="nc">BallObject</span> <span class="o">:</span> <span class="k">public</span> <span class="n">GameObject</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="c1">// ball state	
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>        <span class="kt">float</span>     <span class="n">Radius</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kt">bool</span>      <span class="n">Stuck</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">BallObject</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">BallObject</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">Texture2D</span> <span class="n">sprite</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">Move</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">window_width</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="kt">void</span>      <span class="nf">Reset</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">position</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">velocity</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">};</span> 
</span></span></code></pre></div><p>The constructor of BallObject initializes its own values, but also initializes the underlying GameObject. The BallObject class hosts a Move function that moves the ball based on its velocity. It also checks if it reaches any of the scene&rsquo;s edges and if so, reverses the ball&rsquo;s velocity:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">BallObject</span><span class="o">::</span><span class="n">Move</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">window_width</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="c1">// if not stuck to player board
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Stuck</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">// move the ball
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span> <span class="o">+=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="c1">// check if outside window bounds; if so, reverse velocity and restore at correct position
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">window_width</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">window_width</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>In addition to reversing the ball&rsquo;s velocity, we also want relocate the ball back along the edge; the ball is only able to move if it isn&rsquo;t stuck.</p>
<p><note>Because the player is game over (or loses a life) if the ball reaches the bottom edge, there is no code to let the ball bounce of the bottom edge. We do need to later implement this logic somewhere in the game code though.</note></p>
<p>You can find the code for the ball object below:</p>
<ul>
<li><strong>BallObject</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/5.1.ball_object_collisions.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/5.1.ball_object_collisions.cpp" target="_blank">code</a></li>
</ul>
<p>First, let&rsquo;s add the ball to the game. Just like the player paddle, we create a BallObject and define two constants that we use to initialize the ball. As for the texture of the ball, we&rsquo;re going to use an image that makes perfect sense in a LearnOpenGL Breakout game: <a href="https://learnopengl.com/img/textures/awesomeface.png" target="_blank">ball texture</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Initial velocity of the Ball
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">INITIAL_BALL_VELOCITY</span><span class="p">(</span><span class="mf">100.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">350.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">// Radius of the ball object
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">float</span> <span class="n">BALL_RADIUS</span> <span class="o">=</span> <span class="mf">12.5f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">BallObject</span>     <span class="o">*</span><span class="n">Ball</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">ballPos</span> <span class="o">=</span> <span class="n">playerPos</span> <span class="o">+</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="n">PLAYER_SIZE</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mf">2.0f</span> <span class="o">-</span> <span class="n">BALL_RADIUS</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">                                              <span class="o">-</span><span class="n">BALL_RADIUS</span> <span class="o">*</span> <span class="mf">2.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">Ball</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BallObject</span><span class="p">(</span><span class="n">ballPos</span><span class="p">,</span> <span class="n">BALL_RADIUS</span><span class="p">,</span> <span class="n">INITIAL_BALL_VELOCITY</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;face&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then we have to update the position of the ball each frame by calling its Move function within the game code&rsquo;s Update function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Move</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Furthermore, because the ball is initially stuck to the paddle, we have to give the player the ability to remove it from its stuck position. We select the space key for freeing the ball from the paddle. This means we have to change the processInput function a little:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">ProcessInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="kt">float</span> <span class="n">velocity</span> <span class="o">=</span> <span class="n">PLAYER_VELOCITY</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">// move playerboard
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_A</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">                <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_D</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span> <span class="o">-</span> <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_SPACE</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Here, if the user presses the space bar, the ball&rsquo;s Stuck variable is set to <code>false</code>. Note that we also move the position of the ball alongside the paddle&rsquo;s position whenever the ball is stuck.</p>
<p>Last, we need to render the ball which by now should be fairly obvious:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The result is a ball that follows the paddle and roams freely whenever we press the spacebar. The ball also properly bounces of the left, right, and top edge, but it doesn&rsquo;t yet seem to collide with any of the bricks as we can see:</p>
<p><video src="assets/no_collisions.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>What we want is to create one or several function(s) that check if the ball object is colliding with any of the bricks in the level and if so, destroy the brick. These so called collision detection functions is what we&rsquo;ll focus on in the <a href="https://learnopengl.com/In-Practice/2D-Game/Collisions/Collision-detection" target="_blank">next</a> chapter.</p>
<h5 id="collision-detection">Collision detection</h5>
<p>When trying to determine if a collision occurs between two objects, we generally do not use the vertex data of the objects themselves since these objects often have complicated shapes; this in turn makes the collision detection complicated. For this reason, it is a common practice to use more simple shapes (that usually have a nice mathematical definition) for collision detection that we <em>overlay</em> on top of the original object. We then check for collisions based on these simple shapes; this makes the code easier and saves a lot of performance. A few examples of such collision shapes are circles, spheres, rectangles, and boxes; these are a lot simpler to work with compared to arbitrary meshes with hundreds of triangles.</p>
<p>While the simple shapes do give us easier and more efficient collision detection algorithms, they share a common disadvantage in that these shapes usually do not fully surround the object. The effect is that a collision may be detected that didn&rsquo;t really collide with the actual object; one should always keep in mind that these shapes are just approximations of the real shapes.</p>
<h6 id="aabb---aabb-collisions">AABB - AABB collisions</h6>
<p>AABB stands for axis-aligned bounding box, a rectangular collision shape aligned to the base axes of the scene, which in 2D aligns to the x and y axis. Being axis-aligned means the rectangular box has no rotation and its edges are parallel to the base axes of the scene (e.g. left and right edge are parallel to the y axis). The fact that these boxes are always aligned to the axes of the scene makes calculations easier. Here we surround the ball object with an AABB:</p>
<p><a href="#R-image-e67570a29100101a6a74ca5d9d9c625f" class="lightbox-link"><img src="./assets/collisions_ball_aabb.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e67570a29100101a6a74ca5d9d9c625f"><img src="./assets/collisions_ball_aabb.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Almost all the objects in Breakout are rectangular based objects, so it makes perfect sense to use axis aligned bounding boxes for detecting collisions. This is exactly what we&rsquo;re going to do.</p>
<p>Axis aligned bounding boxes can be defined in several ways. One of them is to define an AABB by a top-left and a bottom-right position. The GameObject class that we defined already contains a top-left position (its Position vector), and we can easily calculate its bottom-right position by adding its size to the top-left position vector (Position<code>+</code>Size). Effectively, each GameObject contains an AABB that we can use for collisions.</p>
<p>So how do we check for collisions? A collision occurs when two collision shapes enter each other&rsquo;s regions e.g. the shape that determines the first object is in some way inside the shape of the second object. For AABBs this is quite easy to determine due to the fact that they&rsquo;re aligned to the scene&rsquo;s axes: we check for each axis if the two object&rsquo; edges on that axis overlap. So we check if the horizontal edges overlap, and if the vertical edges overlap of both objects. If both the horizontal <strong>and</strong> vertical edges overlap we have a collision.</p>
<p><a href="#R-image-3aed60f04d88102ec736d23eb0275868" class="lightbox-link"><img src="./assets/collisions_overlap.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3aed60f04d88102ec736d23eb0275868"><img src="./assets/collisions_overlap.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Translating this concept to code is relatively straightforward. We check for overlap on both axes and if so, return a collision:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">bool</span> <span class="nf">CheckCollision</span><span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">one</span><span class="p">,</span> <span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">two</span><span class="p">)</span> <span class="c1">// AABB - AABB collision
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="c1">// collision x-axis?
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="n">collisionX</span> <span class="o">=</span> <span class="n">one</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">one</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">two</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">one</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">// collision y-axis?
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="n">collisionY</span> <span class="o">=</span> <span class="n">one</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">one</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">two</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">one</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">// collision only if on both axes
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">collisionX</span> <span class="o">&amp;&amp;</span> <span class="n">collisionY</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>We check if the right side of the first object is greater than the left side of the second object <strong>and</strong> if the second object&rsquo;s right side is greater than the first object&rsquo;s left side; similarly for the vertical axis. If you have trouble visualizing this, try to draw the edges/rectangles on paper and determine this for yourself.</p>
<p>To keep the collision code a bit more organized we add an extra function to the Game class:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="kt">void</span> <span class="n">DoCollisions</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>Within DoCollisions, we check for collisions between the ball object and each brick of the level. If we detect a collision, we set the brick&rsquo;s Destroyed property to <code>true</code>, which instantly stops the level from rendering this brick:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">DoCollisions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="nl">box</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">Bricks</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="n">box</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">IsSolid</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                    <span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Then we also need to update the game&rsquo;s Update function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="c1">// update objects
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Move</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="c1">// check for collisions
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">DoCollisions</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>If we run the code now, the ball should detect collisions with each of the bricks and if the brick is not solid, the brick is destroyed. If you run the game now it&rsquo;ll look something like this:</p>
<p><video src="assets/collisions.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>While the collision detection does work, it&rsquo;s not very precise since the ball&rsquo;s rectangular collision shape collides with most of the bricks without the ball directly touching them. Let&rsquo;s see if we can figure out a more precise collision detection technique.</p>
<h6 id="aabb---circle-collision-detection">AABB - Circle collision detection</h6>
<p>Because the ball is a circle-like object, an AABB is probably not the best choice for the ball&rsquo;s collision shape. The collision code thinks the ball is a rectangular box, so the ball often collides with a brick even though the ball sprite itself isn&rsquo;t yet touching the brick.</p>
<p><a href="#R-image-829688cf96d703eacd04eb4b60771467" class="lightbox-link"><img src="./assets/collisions_ball_aabb_touch.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-829688cf96d703eacd04eb4b60771467"><img src="./assets/collisions_ball_aabb_touch.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>It makes much more sense to represent the ball with a circle collision shape instead of an AABB. For this reason we included a Radius variable within the ball object. To define a circle collision shape, all we need is a position vector and a radius.</p>
<p><a href="#R-image-f2b5cdd40ae4e491ce2c89341532bdbb" class="lightbox-link"><img src="./assets/collisions_circle.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f2b5cdd40ae4e491ce2c89341532bdbb"><img src="./assets/collisions_circle.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This does mean we have to update the detection algorithm since it currently only works between two AABBs. Detecting collisions between a circle and a rectangle is a bit more complicated, but the trick is as follows: we find the point on the AABB that is closest to the circle, and if the distance from the circle to this point is less than its radius, we have a collision.</p>
<p>The difficult part is getting this closest point 
<span class="math align-center">$\color{red}{\bar{P}}$</span> on the AABB. The following image shows how we can calculate this point for any arbitrary AABB and circle:</p>
<p><a href="#R-image-c97033d5521969b81ebfff6f09effe26" class="lightbox-link"><img src="./assets/collisions_aabb_circle.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c97033d5521969b81ebfff6f09effe26"><img src="./assets/collisions_aabb_circle.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We first need to get the difference vector between the ball&rsquo;s center 
<span class="math align-center">$\color{blue}{\bar{C}}$</span> and the AABB&rsquo;s center 
<span class="math align-center">$\color{green}{\bar{B}}$</span> to obtain 
<span class="math align-center">$\color{purple}{\bar{D}}$</span>. What we then need to do is clamp this vector 
<span class="math align-center">$\color{purple}{\bar{D}}$</span> to the AABB&rsquo;s half-extents 
<span class="math align-center">$\color{orange}{{w}}$</span> and 
<span class="math align-center">$\color{teal}{\bar{h}}$</span> and add it to 
<span class="math align-center">$\color{green}{\bar{B}}$</span>. The half-extents of a rectangle are the distances between the rectangle&rsquo;s center and its edges: its size divided by two. This returns a position vector that is always located somewhere at the edge of the AABB (unless the circle&rsquo;s center is inside the AABB).</p>
<p><note>A clamp operation <strong>clamps</strong> a value to a value within a given range. This is often expressed as:<br><a href="#R-image-bd0e8a600c8966a68eaab44fa2d61b42" class="lightbox-link"><img src="./assets/20240215083139.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd0e8a600c8966a68eaab44fa2d61b42"><img src="./assets/20240215083139.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a><br>For example, a value of <code>42.0f</code> is clamped to <code>6.0f</code> with a range of <code>3.0f</code> to <code>6.0f</code>, and a value of <code>4.20f</code> would be clamped to <code>4.20f</code>.
Clamping a 2D vector means we clamp both its <code>x</code> and its <code>y</code> component within the given range.</note></p>
<p>This clamped vector 
<span class="math align-center">$\color{red}{\bar{P}}$</span> is then the closest point from the AABB to the circle. What we then need to do is calculate a new difference vector 
<span class="math align-center">$\color{purple}{\bar{D}}$</span> that is the difference between the circle&rsquo;s center 
<span class="math align-center">$\color{blue}{\bar{C}}$</span> and the vector 
<span class="math align-center">$\color{red}{\bar{P}}$</span>.</p>
<p><a href="#R-image-4285600aa90a016b0d46bf541e67491e" class="lightbox-link"><img src="./assets/collisions_aabb_circle_radius_compare.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4285600aa90a016b0d46bf541e67491e"><img src="./assets/collisions_aabb_circle_radius_compare.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Now that we have the vector 
<span class="math align-center">$\color{purple}{\bar{D}}$</span>, we can compare its length to the radius of the circle. If the length of 
<span class="math align-center">$\color{purple}{\bar{D}}$</span> is less than the circle&rsquo;s radius, we have a collision.</p>
<p>This is all expressed in code as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">bool</span> <span class="nf">CheckCollision</span><span class="p">(</span><span class="n">BallObject</span> <span class="o">&amp;</span><span class="n">one</span><span class="p">,</span> <span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">two</span><span class="p">)</span> <span class="c1">// AABB - Circle collision
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="c1">// get center point circle first 
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">center</span><span class="p">(</span><span class="n">one</span><span class="p">.</span><span class="n">Position</span> <span class="o">+</span> <span class="n">one</span><span class="p">.</span><span class="n">Radius</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="c1">// calculate AABB info (center, half-extents)
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">aabb_half_extents</span><span class="p">(</span><span class="n">two</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="n">two</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">aabb_center</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">aabb_half_extents</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">two</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">aabb_half_extents</span><span class="p">.</span><span class="n">y</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">// get difference vector between both centers
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">difference</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="n">aabb_center</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">clamped</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">difference</span><span class="p">,</span> <span class="o">-</span><span class="n">aabb_half_extents</span><span class="p">,</span> <span class="n">aabb_half_extents</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="c1">// add clamped value to AABB_center and we get the value of box closest to circle
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">closest</span> <span class="o">=</span> <span class="n">aabb_center</span> <span class="o">+</span> <span class="n">clamped</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1">// retrieve vector between center circle and closest point AABB and check if length &lt;= radius
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>    <span class="n">difference</span> <span class="o">=</span> <span class="n">closest</span> <span class="o">-</span> <span class="n">center</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">return</span> <span class="n">glm</span><span class="o">::</span><span class="n">length</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">one</span><span class="p">.</span><span class="n">Radius</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>      
</span></span></code></pre></div><p>We create an overloaded function for CheckCollision that specifically deals with the case between a BallObject and a GameObject. Because we did not store the collision shape information in the objects themselves we have to calculate them: first the center of the ball is calculated, then the AABB&rsquo;s half-extents and its center.</p>
<p>Using these collision shape attributes we calculate vector 
<span class="math align-center">$\color{purple}{\bar{D}}$</span> as difference that we clamp to clamped and add to the AABB&rsquo;s center to get point 
<span class="math align-center">$\color{red}{\bar{P}}$</span> as closest. Then we calculate the difference vector 
<span class="math align-center">$\color{purple}{\bar{D}}$</span> between center and closest and return whether the two shapes collided or not.</p>
<p>Since we previously called CheckCollision with the ball object as its first argument, we do not have to change any code since the overloaded version of CheckCollision now automatically applies. The result is now a much more precise collision detection algorithm:</p>
<p><video src="assets/collisions_circle.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>It seems to work, but still, something is off. We properly do all the collision detection, but the ball does not <strong>react</strong> in any way to the collisions. We need to update the ball&rsquo;s position and/or velocity whenever a collision occurs. This is the topic of the <a href="https://learnopengl.com/In-Practice/2D-Game/Collisions/Collision-resolution" target="_blank">next</a> chapter.</p>
<h5 id="collision-resolution">Collision resolution</h5>
<p>At the end of the last chapter we had a working collision detection system. However, the ball does not react in any way to the detected collisions; it moves straight through all the bricks. We want the ball to <em>bounce</em> of the collided bricks. This chapter discusses how we can accomplish this so called collision resolution within the AABB - circle collision detection logic.</p>
<p>Whenever a collision occurs we want two things to happen: we want to reposition the ball so it is no longer inside the other object and second, we want to change the direction of the ball&rsquo;s velocity so it looks like it&rsquo;s bouncing of the object.</p>
<h6 id="collision-repositioning">Collision repositioning</h6>
<p>To position the ball object outside the collided AABB we have to figure out the distance the ball penetrated the bounding box. For this we&rsquo;ll revisit the diagram from the previous chapter:</p>
<p><a href="#R-image-9b8f5779956763b3ce35b9b3f566c763" class="lightbox-link"><img src="./assets/collisions_aabb_circle_resolution.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9b8f5779956763b3ce35b9b3f566c763"><img src="./assets/collisions_aabb_circle_resolution.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Here the ball moved slightly into the AABB and a collision was detected. We now want to move the ball out of the shape so that it merely touches the AABB as if no collision occurred. To figure out how much we need to move the ball out of the AABB we need to retrieve the vector 
<span class="math align-center">$\color{brown}{\bar{R}}$</span>, which is the level of penetration into the AABB. To get this vector 
<span class="math align-center">$\color{brown}{\bar{R}}$</span>, we subtract 
<span class="math align-center">$\color{green}{\bar{V}}$</span> from the ball&rsquo;s radius. Vector 
<span class="math align-center">$\color{green}{\bar{V}}$</span> is the difference between closest point 
<span class="math align-center">$\color{red}{\bar{P}}$</span> and the ball&rsquo;s center 
<span class="math align-center">$\color{blue}{\bar{C}}$</span>.</p>
<p>Knowing 
<span class="math align-center">$\color{brown}{\bar{R}}$</span>, we offset the ball&rsquo;s position by 
<span class="math align-center">$\color{brown}{\bar{R}}$</span> positioning it directly against the AABB; the ball is now properly positioned.</p>
<h6 id="collision-direction">Collision direction</h6>
<p>Next we need to figure out how to update the ball&rsquo;s velocity after a collision. For Breakout we use the following rules to change the ball&rsquo;s velocity:</p>
<ol>
<li>If the ball collides with the right or left side of an AABB, its horizontal velocity (<code>x</code>) is reversed.</li>
<li>If the ball collides with the bottom or top side of an AABB, its vertical velocity (<code>y</code>) is reversed.</li>
</ol>
<p>But how do we figure out the direction the ball hit the AABB? There are several approaches to this problem. One of them is that, instead of 1 AABB, we use 4 AABBs for each brick that we each position at one of its edges. This way we can determine which AABB and thus which edge was hit. However, a simpler approach exists with the help of the dot product.</p>
<p>ou probably still remember from the <a href="https://learnopengl.com/Getting-started/Transformations" target="_blank">transformations</a> chapter that the dot product gives us the angle between two normalized vectors. What if we were to define four vectors pointing north, south, west, and east, and calculate the dot product between them and a given vector? The resulting dot product between these four direction vectors and the given vector that is highest (dot product&rsquo;s maximum value is <code>1.0f</code> which represents a <code>0</code> degree angle) is then the direction of the vector.</p>
<p>This procedure looks as follows in code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Direction</span> <span class="nf">VectorDirection</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">compass</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">),</span>	<span class="c1">// up
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">),</span>	<span class="c1">// right
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">),</span>	<span class="c1">// down
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">)</span>	<span class="c1">// left
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kt">float</span> <span class="n">max</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">best_match</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="kt">float</span> <span class="n">dot_product</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">compass</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">dot_product</span> <span class="o">&gt;</span> <span class="n">max</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">max</span> <span class="o">=</span> <span class="n">dot_product</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="n">best_match</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">Direction</span><span class="p">)</span><span class="n">best_match</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>    
</span></span></code></pre></div><p>The function compares target to each of the direction vectors in the compass array. The compass vector target is closest to in angle, is the direction returned to the function caller. Here Direction is part of an enum defined in the game class&rsquo;s header file:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">enum</span> <span class="nc">Direction</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="n">UP</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="n">RIGHT</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="n">DOWN</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	<span class="n">LEFT</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">};</span>    
</span></span></code></pre></div><p>Now that we know how to get vector 
<span class="math align-center">$\color{brown}{\bar{R}}$</span> and how to determine the direction the ball hit the AABB, we can start writing the collision resolution code.</p>
<h6 id="aabb---circle-collision-resolution">AABB - Circle collision resolution</h6>
<p>To calculate the required values for collision resolution we need a bit more information from the collision function(s) than just a <code>true</code> or <code>false</code>. We&rsquo;re now going to return a tuple of information that tells us if a collision occurred, what direction it occurred, and the difference vector 
<span class="math align-center">$\color{brown}{\bar{R}}$</span>. You can find the <code>tuple</code> container in the <code>&lt;tuple&gt;</code> header.</p>
<p>To keep the code slightly more organized we&rsquo;ll typedef the collision relevant data as Collision:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">Direction</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="o">&gt;</span> <span class="n">Collision</span><span class="p">;</span>    
</span></span></code></pre></div><p>Then we change the code of the CheckCollision function to not only return <code>true</code> or <code>false</code>, but also the direction and difference vector:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Collision</span> <span class="nf">CheckCollision</span><span class="p">(</span><span class="n">BallObject</span> <span class="o">&amp;</span><span class="n">one</span><span class="p">,</span> <span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">two</span><span class="p">)</span> <span class="c1">// AABB - AABB collision
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">length</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">one</span><span class="p">.</span><span class="n">Radius</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">VectorDirection</span><span class="p">(</span><span class="n">difference</span><span class="p">),</span> <span class="n">difference</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="n">UP</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The game&rsquo;s DoCollision function now doesn&rsquo;t just check if a collision occurred, but also acts appropriately whenever a collision did occur. The function now calculates the level of penetration (as shown in the diagram at the start of this tutorial) and adds or subtracts it from the ball&rsquo;s position based on the direction of the collision.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">DoCollisions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="nl">box</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">Bricks</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="n">Collision</span> <span class="n">collision</span> <span class="o">=</span> <span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">))</span> <span class="c1">// if collision is true
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>            <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                <span class="c1">// destroy block if not solid
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">IsSolid</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                    <span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                <span class="c1">// collision resolution
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span>                <span class="n">Direction</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">diff_vector</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="n">LEFT</span> <span class="o">||</span> <span class="n">dir</span> <span class="o">==</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="c1">// horizontal collision
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>                <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// reverse horizontal velocity
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>                    <span class="c1">// relocate
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>                    <span class="kt">float</span> <span class="n">penetration</span> <span class="o">=</span> <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Radius</span> <span class="o">-</span> <span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">diff_vector</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="n">LEFT</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">penetration</span><span class="p">;</span> <span class="c1">// move ball to right
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"></span>                    <span class="k">else</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">penetration</span><span class="p">;</span> <span class="c1">// move ball to left;
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span>                <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="k">else</span> <span class="c1">// vertical collision
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c1"></span>                <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// reverse vertical velocity
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>                    <span class="c1">// relocate
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="c1"></span>                    <span class="kt">float</span> <span class="n">penetration</span> <span class="o">=</span> <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Radius</span> <span class="o">-</span> <span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">diff_vector</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="n">UP</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">penetration</span><span class="p">;</span> <span class="c1">// move ball back up
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c1"></span>                    <span class="k">else</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">penetration</span><span class="p">;</span> <span class="c1">// move ball back down
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="c1"></span>                <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>    
</span></span></code></pre></div><p>Don&rsquo;t get too scared by the function&rsquo;s complexity since it is basically a direct translation of the concepts introduced so far. First we check for a collision and if so, we destroy the block if it is non-solid. Then we obtain the collision direction dir and the vector 
<span class="math align-center">$\color{green}{\bar{V}}$</span> as diff_vector from the tuple and finally do the collision resolution.</p>
<p>We first check if the collision direction is either horizontal or vertical and then reverse the velocity accordingly. If horizontal, we calculate the penetration value 
<span class="math align-center">$\color{brown}{\bar{R}}$</span> from the diff_vector&rsquo;s x component and either add or subtract this from the ball&rsquo;s position. The same applies to the vertical collisions, but this time we operate on the <code>y</code> component of all the vectors.</p>
<p>Running your application should now give you working collision resolution, but it&rsquo;s probably difficult to really see its effect since the ball will bounce towards the bottom edge as soon as you hit a single block and be lost forever. We can fix this by also handling player paddle collisions.</p>
<h6 id="player---ball-collisions">Player - ball collisions</h6>
<p>Collisions between the ball and the player is handled slightly different from what we&rsquo;ve previously discussed, since this time the ball&rsquo;s horizontal velocity should be updated based on how far it hit the paddle from its center. The further the ball hits the paddle from its center, the stronger its horizontal velocity change should be.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">DoCollisions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">Collision</span> <span class="n">result</span> <span class="o">=</span> <span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="o">*</span><span class="n">Player</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span> <span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="c1">// check where it hit the board, and change velocity based on where it hit the board
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>        <span class="kt">float</span> <span class="n">centerBoard</span> <span class="o">=</span> <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="kt">float</span> <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Radius</span><span class="p">)</span> <span class="o">-</span> <span class="n">centerBoard</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="kt">float</span> <span class="n">percentage</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">Player</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">// then move accordingly
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>        <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">oldVelocity</span> <span class="o">=</span> <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">INITIAL_BALL_VELOCITY</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">percentage</span> <span class="o">*</span> <span class="n">strength</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">normalize</span><span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">)</span> <span class="o">*</span> <span class="n">glm</span><span class="o">::</span><span class="n">length</span><span class="p">(</span><span class="n">oldVelocity</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  
</span></span></code></pre></div><p>After we checked collisions between the ball and each brick, we&rsquo;ll check if the ball collided with the player paddle. If so (and the ball is not stuck to the paddle) we calculate the percentage of how far the ball&rsquo;s center is moved from the paddle&rsquo;s center compared to the half-extent of the paddle. The horizontal velocity of the ball is then updated based on the distance it hit the paddle from its center. In addition to updating the horizontal velocity, we also have to reverse the y velocity.</p>
<p>Note that the old velocity is stored as oldVelocity. The reason for storing the old velocity is that we update the horizontal velocity of the ball&rsquo;s velocity vector while keeping its <code>y</code> velocity constant. This would mean that the length of the vector constantly changes, which has the effect that the ball&rsquo;s velocity vector is much larger (and thus stronger) if the ball hit the edge of the paddle compared to if the ball would hit the center of the paddle. For this reason, the new velocity vector is normalized and multiplied by the length of the old velocity vector. This way, the velocity of the ball is always consistent, regardless of where it hits the paddle.</p>
<h6 id="sticky-paddle">Sticky paddle</h6>
<p>You may or may not have noticed it when you ran the code, but there is still a large issue with the player and ball collision resolution. The following shows what may happen:</p>
<p><video src="assets/collisions_sticky_paddle.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>This issue is called the sticky paddle issue. This happens, because the player paddle moves with a high velocity towards the ball with the ball&rsquo;s center ending up inside the player paddle. Since we did not account for the case where the ball&rsquo;s center is inside an AABB, the game tries to continuously react to all the collisions. Once it finally breaks free, it will have reversed its <code>y</code> velocity so much that it&rsquo;s unsure whether to go up or down after breaking free.</p>
<p>We can easily fix this behavior by introducing a small hack made possible by the fact that the we can always assume we have a collision at the top of the paddle. Instead of reversing the <code>y</code> velocity, we simply always return a positive <code>y</code> direction so whenever it does get stuck, it will immediately break free.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"> <span class="c1">//Ball-&gt;Velocity.y = -Ball-&gt;Velocity.y;
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0f</span> <span class="o">*</span> <span class="n">abs</span><span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>  
</span></span></code></pre></div><p>If you try hard enough the effect is still noticeable, but I personally find it an acceptable trade-off.</p>
<h6 id="the-bottom-edge">The bottom edge</h6>
<p>The only thing that is still missing from the classic Breakout recipe is some loss condition that resets the level and the player. Within the game class&rsquo;s Update function we want to check if the ball reached the bottom edge, and if so, reset the game.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">)</span> <span class="c1">// did ball reach bottom edge?
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetLevel</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The ResetLevel and ResetPlayer functions re-load the level and reset the objects&rsquo; values to their original starting values. The game should now look a bit like this:</p>
<p><video src="assets/collisions_complete.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>And there you have it, we just finished creating a clone of the classical Breakout game with similar mechanics. You can find the game class&rsquo; source code here: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/5.game.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/5.game.cpp" target="_blank">code</a>.</p>
<h6 id="a-few-notes">A few notes</h6>
<p>Collision detection is a difficult topic of video game development and possibly its most challenging. Most collision detection and resolution schemes are combined with physics engines as found in most modern-day games. The collision scheme we used for the Breakout game is a very simple scheme and one specialized specifically for this type of game.</p>
<p>It should be stressed that this type of collision detection and resolution is not perfect. It calculates possible collisions only per frame and only for the positions exactly as they are at that timestep; this means that if an object would have such a velocity that it would pass over another object within a single frame, it would look like it never collided with this object. So if there are framedrops, or you reach high enough velocities, this collision detection scheme will not hold.</p>
<p>Several of the issues that can still occur:</p>
<ul>
<li>If the ball goes too fast, it may skip over an object entirely within a single frame, not detecting any collisions.</li>
<li>If the ball hits more than one object within a single frame, it will have detected two collisions and reversed its velocity twice; not affecting its original velocity.</li>
<li>Hitting a corner of a brick could reverse the ball&rsquo;s velocity in the wrong direction since the distance it travels in a single frame could decide the difference between VectorDirection returning a vertical or horizontal direction.</li>
</ul>
<p>These chapters are however aimed to teach the readers the basics of several aspects of graphics and game-development. For this reason, this collision scheme serves its purpose; its understandable and works quite well in normal scenarios. Just keep in mind that there exist better (more complicated) collision schemes that work well in almost all scenarios (including movable objects) like the separating axis theorem.</p>
<p>Thankfully, there exist large, practical, and often quite efficient physics engines (with timestep-independent collision schemes) for use in your own games. If you wish to delve further into such systems or need more advanced physics and have trouble figuring out the mathematics, <a href="http://box2d.org/" target="_blank">Box2D</a> is a perfect 2D physics library for implementing physics and collision detection in your applications.</p>
<h4 id="particles">Particles</h4>
<p>A particle is a point moving in space based on some simulation rules. These points are often rendered as tiny 2D quads that are always facing the camera (billboarding) and (usually) contain a texture with large parts of the texture being transparent. A particle, in our OpenGL game case, is then effectively just a moving sprite as we&rsquo;ve been using so far. However, when you put hundreds or even thousands of these particles together you can create amazing effects.</p>
<p>When working with particles, there is usually an object called a particle emitter or particle generator that, from its location, continuously spawns new particles that decay over time. If such a particle emitter would for example spawn tiny particles with a smoke-like texture, color them less bright the larger the distance from the emitter, and give them a glowy appearance, you&rsquo;d get a fire-like effect:</p>
<p><a href="#R-image-568457be35bb78e4b2fc7e7c4a18c433" class="lightbox-link"><img src="./assets/particles_example.jpg" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-568457be35bb78e4b2fc7e7c4a18c433"><img src="./assets/particles_example.jpg" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>A single particle often has a life variable that slowly decays once it&rsquo;s spawned. Once its life is less than a certain threshold (usually <code>0</code>), we kill the particle so it can be replaced with a new particle when the next particle spawns. A particle emitter controls all its spawned particles and changes their behavior based on their attributes. A particle generally has the following attributes:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="nc">Particle</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">Position</span><span class="p">,</span> <span class="n">Velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">glm</span><span class="o">::</span><span class="n">vec4</span> <span class="n">Color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="kt">float</span>     <span class="n">Life</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">Particle</span><span class="p">()</span> 
</span></span><span class="line"><span class="ln">7</span><span class="cl">      <span class="o">:</span> <span class="n">Position</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">),</span> <span class="n">Velocity</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">),</span> <span class="n">Color</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span> <span class="n">Life</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">};</span>    
</span></span></code></pre></div><p>Looking at the fire example, the particle emitter probably spawns each particle with a position close to the emitter and with an upwards velocity. It seems to have 3 different regions, so it probably gives some particles a higher velocity than others. We can also see that the higher the <code>y</code> position of the particle, the less <em>yellow</em> or <em>bright</em> its color becomes. After the particles have reached a certain height, their life is depleted and the particles are killed; never reaching the stars.</p>
<p>You can imagine that with systems like these we can create interesting effects like fire, smoke, fog, magic effects, gunfire residue etc. In Breakout, we&rsquo;re going to add a simple particle generator that follows the ball to make it all look just a bit more interesting. It&rsquo;ll look something like this:</p>
<p><video src="assets/particles.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>Here, the particle generator spawns each particle at the ball&rsquo;s position, gives it a velocity equal to a fraction of the ball&rsquo;s velocity, and changes the color of the particle based on how long it lived.</p>
<p>For rendering the particles we&rsquo;ll be using a different set of shaders:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec4</span> <span class="n">vertex</span><span class="p">;</span> <span class="c1">// &lt;vec2 position, vec2 texCoords&gt;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">out</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">out</span> <span class="n">vec4</span> <span class="n">ParticleColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">uniform</span> <span class="n">mat4</span> <span class="n">projection</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">uniform</span> <span class="n">vec2</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">uniform</span> <span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">10.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">ParticleColor</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">projection</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">((</span><span class="n">vertex</span><span class="p">.</span><span class="n">xy</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>And the fragment shader:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">in</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">in</span> <span class="n">vec4</span> <span class="n">ParticleColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">out</span> <span class="n">vec4</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">sprite</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">)</span> <span class="o">*</span> <span class="n">ParticleColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>We take the standard position and texture attributes per particle and also accept an offset and a color uniform for changing the outcome per particle. Note that in the vertex shader we scale the particle quad by <code>10.0f</code>; you can also set the scale as a uniform and control this individually per particle.</p>
<p>First, we need a list of particles that we instantiate with default Particle structs:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_particles</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span> <span class="n">particles</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nr_particles</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">particles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Particle</span><span class="p">());</span></span></span></code></pre></div><p>Then in each frame, we spawn several new particles with starting values. For each particle that is (still) alive we also update their values:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_new_particles</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">// add new particles
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nr_new_particles</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kt">int</span> <span class="n">unusedParticle</span> <span class="o">=</span> <span class="n">FirstUnusedParticle</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">RespawnParticle</span><span class="p">(</span><span class="n">particles</span><span class="p">[</span><span class="n">unusedParticle</span><span class="p">],</span> <span class="n">object</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">// update all particles
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nr_particles</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">Particle</span> <span class="o">&amp;</span><span class="n">p</span> <span class="o">=</span> <span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">p</span><span class="p">.</span><span class="n">Life</span> <span class="o">-=</span> <span class="n">dt</span><span class="p">;</span> <span class="c1">// reduce life
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Life</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">{</span>	<span class="c1">// particle is alive, thus update
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>        <span class="n">p</span><span class="p">.</span><span class="n">Position</span> <span class="o">-=</span> <span class="n">p</span><span class="p">.</span><span class="n">Velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">a</span> <span class="o">-=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mf">2.5f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The first loop may look a little daunting. As particles die over time we want to spawn nr_new_particles particles each frame, but since we don&rsquo;t want to infinitely keep spawning new particles (we&rsquo;ll quickly run out of memory this way) we only spawn up to a max of nr_particles. If were to push all new particles to the end of the list we&rsquo;ll quickly get a list filled with thousands of particles. This isn&rsquo;t really efficient considering only a small portion of that list has particles that are alive.</p>
<p>What we want is to find the first particle that is dead (life &lt; <code>0.0f</code>) and update that particle as a new respawned particle.</p>
<p>The function FirstUnusedParticle tries to find the first particle that is dead and returns its index to the caller.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lastUsedParticle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">FirstUnusedParticle</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">// search from last used particle, this will usually return almost instantly
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lastUsedParticle</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nr_particles</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Life</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="n">lastUsedParticle</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">// otherwise, do a linear search
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lastUsedParticle</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">particles</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Life</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="n">lastUsedParticle</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1">// override first particle if all others are alive
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>    <span class="n">lastUsedParticle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The function stores the index of the last dead particle it found. Since the next dead particle will most likely be right after the last particle index, we first search from this stored index. If we found no dead particles this way, we simply do a slower linear search. If no particles are dead, it will return index <code>0</code> which results in the first particle being overwritten. Note that if it reaches this last case, it means your particles are alive for too long; you&rsquo;d need to spawn less particles per frame and/or reserve a larger number of particles.</p>
<p>Then, once the first dead particle in the list is found, we update its values by calling RespawnParticle that takes the particle, a GameObject, and an offset vector:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="nf">RespawnParticle</span><span class="p">(</span><span class="n">Particle</span> <span class="o">&amp;</span><span class="n">particle</span><span class="p">,</span> <span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">object</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="kt">float</span> <span class="n">random</span> <span class="o">=</span> <span class="p">((</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="kt">float</span> <span class="n">rColor</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">+</span> <span class="p">((</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">particle</span><span class="p">.</span><span class="n">Position</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="n">Position</span> <span class="o">+</span> <span class="n">random</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">particle</span><span class="p">.</span><span class="n">Color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">rColor</span><span class="p">,</span> <span class="n">rColor</span><span class="p">,</span> <span class="n">rColor</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">particle</span><span class="p">.</span><span class="n">Life</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">    <span class="n">particle</span><span class="p">.</span><span class="n">Velocity</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="n">Velocity</span> <span class="o">*</span> <span class="mf">0.1f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>This function simply resets the particle&rsquo;s life to <code>1.0f</code>, randomly gives it a brightness (via the color vector) starting from <code>0.5</code>, and assigns a (slightly random) position and velocity based on the game object&rsquo;s data.</p>
<p>The second particle loop within the update function loops over all particles and for each particle reduces their life by the delta time variable; this way, each particle&rsquo;s life corresponds to exactly the second(s) it&rsquo;s allowed to live multiplied by some scalar. Then we check if the particle is alive and if so, update its position and color attributes. We also slowly reduce the alpha component of each particle so it looks like they&rsquo;re slowly disappearing over time.</p>
<p>Then what&rsquo;s left to do is render the particles:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">glBlendFunc</span><span class="p">(</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_ONE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">particleShader</span><span class="p">.</span><span class="n">Use</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">Particle</span> <span class="nl">particle</span> <span class="p">:</span> <span class="n">particles</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">particle</span><span class="p">.</span><span class="n">Life</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">particleShader</span><span class="p">.</span><span class="n">SetVector2f</span><span class="p">(</span><span class="s">&#34;offset&#34;</span><span class="p">,</span> <span class="n">particle</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">particleShader</span><span class="p">.</span><span class="n">SetVector4f</span><span class="p">(</span><span class="s">&#34;color&#34;</span><span class="p">,</span> <span class="n">particle</span><span class="p">.</span><span class="n">Color</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">particleTexture</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">particleVAO</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">glBlendFunc</span><span class="p">(</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">);</span></span></span></code></pre></div><p>Here, for each particle, we set their offset and color uniform values, bind the texture, and render the 2D quad. What&rsquo;s interesting to note here are the two calls to glBlendFunc. When rendering the particles, instead of the default destination blend mode of <code>GL_ONE_MINUS_SRC_ALPHA</code>, we use the <code>GL_ONE</code> (additive) blend mode that gives the particles a very neat glow effect when stacked onto each other. This is also likely the blend mode used when rendering the fire at the top of the chapter, since the fire is more &lsquo;glowy&rsquo; at the center where most of the particles are.</p>
<p>Because we (like most other parts of the Breakout chapters) like to keep things organized, we create another class called ParticleGenerator that hosts all the functionality we just described. You can find the source code below:</p>
<ul>
<li><a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/particle_generator.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/particle_generator.cpp" target="_blank">code</a></li>
</ul>
<p>Within the game code, we create a particle generator and initialize it with <a href="https://learnopengl.com/img/in-practice/breakout/textures/particle.png" target="_blank">this</a> texture.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">ParticleGenerator</span>   <span class="o">*</span><span class="n">Particles</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadShader</span><span class="p">(</span><span class="s">&#34;shaders/particle.vs&#34;</span><span class="p">,</span> <span class="s">&#34;shaders/particle.frag&#34;</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="s">&#34;particle&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&#34;textures/particle.png&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&#34;particle&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">Particles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ParticleGenerator</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="s">&#34;particle&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetTexture</span><span class="p">(</span><span class="s">&#34;particle&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="mi">500</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then we change the game class&rsquo;s Update function by adding an update statement for the particle generator:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="c1">// update particles
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span>    <span class="n">Particles</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Radius</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Each of the particles will use the game object properties from the ball object, spawn 2 particles each frame, and their positions will be offset towards the center of the ball. Last up is rendering the particles:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">// draw player
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>        <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="c1">// draw particles	
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>        <span class="n">Particles</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1">// draw ball
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Note that we render the particles before we render the ball. This way, the particles end up rendered in front of all other objects, but behind the ball. You can find the updated game class code <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/6.game.cpp" target="_blank">here</a>.</p>
<p>If you&rsquo;d now compile and run your application you should see a trail of particles following the ball, just like at the beginning of the chapter, giving the game a more modern look. The system can also easily be extended to host more advanced effects, so feel free to experiment with the particle generation and see if you can come up with your own creative effects.</p>
<h4 id="postprocessing">Postprocessing</h4>
<p>Wouldn&rsquo;t it be fun if we could completely spice up the visuals of the Breakout game with just a few postprocessing effects? We could create a blurry shake effect, inverse all the colors of the scene, do crazy vertex movement, and/or make use of other interesting effects with relative ease thanks to OpenGL&rsquo;s framebuffers.</p>
<p><note>This chapters makes extensive use of concepts from the <a href="https://learnopengl.com/Advanced-OpenGL/Framebuffers" target="_blank">framebuffers</a> and <a href="https://learnopengl.com!advanced-opengl/Anti-Aliasing" target="_blank">anti-aliasing</a> chapters.</note></p>
<p>In the framebuffers chapter we demonstrated how we could use postprocessing to achieve interesting effects using just a single texture. In Breakout we&rsquo;re going to do something similar: we&rsquo;re going to create a framebuffer object with a multisampled renderbuffer object attached as its color attachment. All the game&rsquo;s render code should render to this multisampled framebuffer that then blits its content to a different framebuffer with a texture attachment as its color buffer. This texture contains the rendered anti-aliased image of the game that we&rsquo;ll render to a full-screen 2D quad with zero or more postprocessing effects applied.</p>
<p>So to summarize, the rendering steps are:</p>
<ol>
<li>Bind to multisampled framebuffer.</li>
<li>Render game as normal.</li>
<li>Blit multisampled framebuffer to normal framebuffer with texture attachment.</li>
<li>Unbind framebuffer (use default framebuffer).</li>
<li>Use color buffer texture from normal framebuffer in postprocessing shader.</li>
<li>Render quad of screen-size as output of postprocessing shader.</li>
</ol>
<p>The postprocessing shader allows for three type of effects: shake, confuse, and chaos.</p>
<ul>
<li><strong>shake</strong>: slightly shakes the scene with a small blur.</li>
<li><strong>confuse</strong>: inverses the colors of the scene, but also the <code>x</code> and <code>y</code> axis.</li>
<li><strong>chaos</strong>: makes use of an edge detection kernel to create interesting visuals and also moves the textured image in a circular fashion for an interesting <em>chaotic</em> effect.</li>
</ul>
<p>Below is a glimpse of what these effects are going to look like:</p>
<p><a href="#R-image-e6ef838e791f85484b5ce57216255992" class="lightbox-link"><img src="./assets/postprocessing_effects.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e6ef838e791f85484b5ce57216255992"><img src="./assets/postprocessing_effects.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Operating on a 2D quad, the vertex shader looks as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">layout</span> <span class="p">(</span><span class="n">location</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">in</span> <span class="n">vec4</span> <span class="n">vertex</span><span class="p">;</span> <span class="c1">// &lt;vec2 position, vec2 texCoords&gt;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">out</span> <span class="n">vec2</span> <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span>  <span class="n">chaos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span>  <span class="n">confuse</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span>  <span class="n">shake</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">uniform</span> <span class="kt">float</span> <span class="n">time</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vertex</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">vec2</span> <span class="n">texture</span> <span class="o">=</span> <span class="n">vertex</span><span class="p">.</span><span class="n">zw</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">chaos</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="n">vec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">texture</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="n">strength</span><span class="p">,</span> <span class="n">texture</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="n">strength</span><span class="p">);</span>        
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">confuse</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">texture</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">texture</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">TexCoords</span> <span class="o">=</span> <span class="n">texture</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">shake</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="kt">float</span> <span class="n">strength</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="n">gl_Position</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">cos</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">strength</span><span class="p">;</span>        
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">gl_Position</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">cos</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">strength</span><span class="p">;</span>        
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Based on whatever uniform is set to <code>true</code>, the vertex shader takes different paths. If either chaos or confuse is set to <code>true</code>, the vertex shader will manipulate the texture coordinates to move the scene around (either translate texture coordinates in a circle-like fashion, or inverse them). Because we set the texture wrapping methods to <code>GL_REPEAT</code>, the chaos effect will cause the scene to repeat itself at various parts of the quad. Additionally if shake is set to <code>true</code>, it will move the vertex positions around by a small amount, as if the screen shakes. Note that chaos and confuse shouldn&rsquo;t be <code>true</code> at the same time while shake is able to work with any of the other effects on.</p>
<p>In addition to offsetting the vertex positions or texture coordinates, we&rsquo;d also like to create some visual change as soon as any of the effects are active. We can accomplish this within the fragment shader:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#version 330 core
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="n">in</span>  <span class="n">vec2</span>  <span class="n">TexCoords</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">out</span> <span class="n">vec4</span>  <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">scene</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">uniform</span> <span class="n">vec2</span>      <span class="n">offsets</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">uniform</span> <span class="kt">int</span>       <span class="n">edge_kernel</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">uniform</span> <span class="kt">float</span>     <span class="n">blur_kernel</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span> <span class="n">chaos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span> <span class="n">confuse</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">uniform</span> <span class="kt">bool</span> <span class="n">shake</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">color</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">vec3</span> <span class="n">sample</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1">// sample from texture offsets if using convolution matrix
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="n">chaos</span> <span class="o">||</span> <span class="n">shake</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">.</span><span class="n">st</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="c1">// process effects
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">chaos</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">{</span>           
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">color</span> <span class="o">+=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">edge_kernel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">confuse</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="n">color</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">texture</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">shake</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="n">color</span> <span class="o">+=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">blur_kernel</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">color</span> <span class="o">=</span>  <span class="n">texture</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">TexCoords</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This long shader almost directly builds upon the fragment shader from the framebuffers chapter and processes several postprocessing effects based on the effect type activated. This time though, the offset matrix and convolution kernels are defined as a uniform that we set from the OpenGL code. The advantage is that we only have to set this once, instead of recalculating these matrices each fragment shader run. For example, the offsets matrix is configured as follows:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">float</span> <span class="n">offset</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mf">300.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kt">float</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">{</span> <span class="o">-</span><span class="n">offset</span><span class="p">,</span>  <span class="n">offset</span>  <span class="p">},</span>  <span class="c1">// top-left
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="mf">0.0f</span><span class="p">,</span>    <span class="n">offset</span>  <span class="p">},</span>  <span class="c1">// top-center
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="n">offset</span><span class="p">,</span>  <span class="n">offset</span>  <span class="p">},</span>  <span class="c1">// top-right
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="p">{</span> <span class="o">-</span><span class="n">offset</span><span class="p">,</span>  <span class="mf">0.0f</span>    <span class="p">},</span>  <span class="c1">// center-left
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="mf">0.0f</span><span class="p">,</span>    <span class="mf">0.0f</span>    <span class="p">},</span>  <span class="c1">// center-center
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="n">offset</span><span class="p">,</span>  <span class="mf">0.0f</span>    <span class="p">},</span>  <span class="c1">// center - right
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>    <span class="p">{</span> <span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="o">-</span><span class="n">offset</span>  <span class="p">},</span>  <span class="c1">// bottom-left
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="mf">0.0f</span><span class="p">,</span>   <span class="o">-</span><span class="n">offset</span>  <span class="p">},</span>  <span class="c1">// bottom-center
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>  <span class="n">offset</span><span class="p">,</span> <span class="o">-</span><span class="n">offset</span>  <span class="p">}</span>   <span class="c1">// bottom-right    
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">glUniform2fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">shader</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">&#34;offsets&#34;</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">offsets</span><span class="p">);</span>  
</span></span></code></pre></div><p>Since all of the concepts of managing (multisampled) framebuffers were already extensively discussed in earlier chapters, I won&rsquo;t delve into the details this time. Below you&rsquo;ll find the code of a PostProcessor class that manages initialization, writing/reading the framebuffers, and rendering a screen quad. You should be able to understand the code if you understood the framebuffers and anti-aliasing chapter:</p>
<ul>
<li><strong>PostProcessor</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/post_processor.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/post_processor.cpp" target="_blank">code</a>.</li>
</ul>
<p>What is interesting to note here are the BeginRender and EndRender functions. Since we have to render the entire game scene into the framebuffer we can conventiently call BeginRender() and EndRender() before and after the scene&rsquo;s rendering code respectively. The class will then handle the behind-the-scenes framebuffer operations. For example, using the PostProcessor class will look like this within the game&rsquo;s Render function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">PostProcessor</span>   <span class="o">*</span><span class="n">Effects</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">BeginRender</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="c1">// draw background
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>            <span class="c1">// draw level
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>            <span class="c1">// draw player
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>            <span class="c1">// draw particles	
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>            <span class="c1">// draw ball
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">EndRender</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">(</span><span class="n">glfwGetTime</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Wherever we want, we can now conveniently set the required effect property of the postprocessing class to <code>true</code> and its effect will be immediately active.</p>
<h5 id="shake-it">Shake it</h5>
<p>As a (practical) demonstration of these effects we&rsquo;ll emulate the visual impact of the ball when it hits a solid concrete block. By enabling the shake effect for a short period of time wherever a solid collision occurs, it&rsquo;ll look like the collision had a stronger impact.</p>
<p>We want to enable the screen shake effect only over a small period of time. We can get this to work by creating a variable called ShakeTime that manages the duration the shake effect is supposed to be active. Wherever a solid collision occurs, we reset this variable to a specific duration:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">float</span> <span class="n">ShakeTime</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>  
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">DoCollisions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="nl">box</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">Bricks</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="n">Collision</span> <span class="n">collision</span> <span class="o">=</span> <span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">))</span> <span class="c1">// if collision is true
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>            <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="c1">// destroy block if not solid
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">IsSolid</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                    <span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="p">{</span>   <span class="c1">// if block is solid, enable shake effect
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span>                    <span class="n">ShakeTime</span> <span class="o">=</span> <span class="mf">0.05f</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                    <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Shake</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>    
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Then within the game&rsquo;s Update function, we decrease the ShakeTime variable until it&rsquo;s <code>0.0</code> after which we disable the shake effect:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShakeTime</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="n">ShakeTime</span> <span class="o">-=</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">ShakeTime</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Shake</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Then each time we hit a solid block, the screen briefly starts to shake and blur, giving the player some visual feedback the ball collided with a solid object.</p>
<p><video src="assets/postprocessing_shake.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>You can find the updated source code of the game class <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/7.game.cpp" target="_blank">here</a>.</p>
<p>In the <a href="https://learnopengl.com/In-Practice/2D-Game/Powerups" target="_blank">next</a> chapter about powerups we&rsquo;ll bring the other two postprocessing effects to good use.</p>
<h4 id="powerups">Powerups</h4>
<p>Breakout is close to finished, but it would be cool to add at least one more gameplay mechanic so it&rsquo;s not your average standard Breakout clone; what about powerups?</p>
<p>The idea is that whenever a brick is destroyed, the brick has a small chance of spawning a powerup block. Such a block will slowly fall downwards and if it collides with the player paddle, an interesting effect occurs based on the type of powerup. For example, one powerup makes the paddle larger, and another powerup allows the ball to pass through objects. We also include several negative powerups that affect the player in a negative way.</p>
<p>We can model a powerup as a GameObject with a few extra properties. That&rsquo;s why we define a class PowerUp that inherits from GameObject:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">SIZE</span><span class="p">(</span><span class="mf">60.0f</span><span class="p">,</span> <span class="mf">20.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">VELOCITY</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">150.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">class</span> <span class="nc">PowerUp</span> <span class="o">:</span> <span class="k">public</span> <span class="n">GameObject</span> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">// powerup state
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Type</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kt">float</span>       <span class="n">Duration</span><span class="p">;</span>	
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="kt">bool</span>        <span class="n">Activated</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">// constructor
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>    <span class="n">PowerUp</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">duration</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">position</span><span class="p">,</span> <span class="n">Texture2D</span> <span class="n">texture</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="o">:</span> <span class="n">GameObject</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">SIZE</span><span class="p">,</span> <span class="n">texture</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">VELOCITY</span><span class="p">),</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">          <span class="n">Type</span><span class="p">(</span><span class="n">type</span><span class="p">),</span> <span class="n">Duration</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span> <span class="n">Activated</span><span class="p">()</span> 
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">};</span>  
</span></span></code></pre></div><p>A PowerUp is just a GameObject with extra state, so we can simply define it in a single header file which you can find <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/power_up.h" target="_blank">here</a>.</p>
<p>Each powerup defines its type as a string, a duration for how long it is active, and whether it is currently activated. Within Breakout we&rsquo;re going to feature a total of 4 positive powerups and 2 negative powerups:</p>
<p><a href="#R-image-2b748bb75c2f384d025ff99febad3ea7" class="lightbox-link"><img src="./assets/powerups.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2b748bb75c2f384d025ff99febad3ea7"><img src="./assets/powerups.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<ul>
<li><strong>Speed</strong>: increases the velocity of the ball by 20%.</li>
<li><strong>Sticky</strong>: when the ball collides with the paddle, the ball remains stuck to the paddle unless the spacebar is pressed again. This allows the player to better position the ball before releasing it.</li>
<li><strong>Pass-Through</strong>: collision resolution is disabled for non-solid blocks, allowing the ball to pass through multiple blocks.</li>
<li><strong>Pad-Size-Increase</strong>: increases the width of the paddle by 50 pixels.</li>
<li><strong>Confuse</strong>: activates the confuse postprocessing effect for a short period of time, confusing the user.</li>
<li><strong>Chaos</strong>: activates the chaos postprocessing effect for a short period of time, heavily disorienting the user.</li>
</ul>
<p>You can find the textures here:</p>
<ul>
<li><strong>Textures</strong>: <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_speed.png" target="_blank">Speed</a>, <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_sticky.png" target="_blank">Sticky</a>, <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_passthrough.png" target="_blank">Pass-Through</a>, <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_increase.png" target="_blank">Pad-Size-Increase</a>, <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_confuse.png" target="_blank">Confuse</a>, <a href="https://learnopengl.com/img/in-practice/breakout/textures/powerup_chaos.png" target="_blank">Chaos</a>.</li>
</ul>
<p>Similar to the level block textures, each of the powerup textures is completely grayscale. This makes sure the color of the powerups remain balanced whenever we multiply them with a color vector.</p>
<p>Because powerups have state, a duration, and certain effects associated with them, we would like to keep track of all the powerups currently active in the game; we store them in a vector:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PowerUp</span><span class="o">&gt;</span>  <span class="n">PowerUps</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="kt">void</span> <span class="n">SpawnPowerUps</span><span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="kt">void</span> <span class="nf">UpdatePowerUps</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>We&rsquo;ve also defined two functions for managing powerups. SpawnPowerUps spawns a powerups at the location of a given block and UpdatePowerUps manages all powerups currently active within the game.</p>
<h5 id="spawning-powerups">Spawning PowerUps</h5>
<p>Each time a block is destroyed we would like to, given a small chance, spawn a powerup. This functionality is found inside the game&rsquo;s SpawnPowerUps function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">bool</span> <span class="nf">ShouldSpawn</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chance</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">random</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">chance</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">return</span> <span class="n">random</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">SpawnPowerUps</span><span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">75</span><span class="p">))</span> <span class="c1">// 1 in 75 chance
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">             <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;speed&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_speed</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">         <span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">75</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;sticky&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">),</span> <span class="mf">20.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_sticky</span> 
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">75</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;pass-through&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">),</span> <span class="mf">10.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_pass</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">));</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">75</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;pad-size-increase&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_size</span>    
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span> <span class="c1">// negative powerups should spawn more often
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;confuse&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">),</span> <span class="mf">15.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_confuse</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="p">));</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ShouldSpawn</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">PowerUp</span><span class="p">(</span><span class="s">&#34;chaos&#34;</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.25f</span><span class="p">,</span> <span class="mf">0.25f</span><span class="p">),</span> <span class="mf">15.0f</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">tex_chaos</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="p">));</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The SpawnPowerUps function creates a new PowerUp object based on a given chance (1 in 75 for normal powerups and 1 in 15 for negative powerups) and sets their properties. Each powerup is given a specific color to make them more recognizable for the user and a duration in seconds based on its type; here a duration of <code>0.0f</code> means its duration is infinite. Additionally, each powerup is given the position of the destroyed block and one of the textures from the beginning of this chapter.</p>
<h5 id="activating-powerups">Activating PowerUps</h5>
<p>We then have to update the game&rsquo;s DoCollisions function to not only check for brick and paddle collisions, but also collisions between the paddle and each non-destroyed PowerUp. Note that we call SpawnPowerUps directly after a block is destroyed.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">DoCollisions</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="nl">box</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">Bricks</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="n">Collision</span> <span class="n">collision</span> <span class="o">=</span> <span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Ball</span><span class="p">,</span> <span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">))</span> <span class="c1">// if collision is true
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>            <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                <span class="c1">// destroy block if not solid
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">IsSolid</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                    <span class="n">box</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                    <span class="k">this</span><span class="o">-&gt;</span><span class="n">SpawnPowerUps</span><span class="p">(</span><span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>        
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">[...]</span> 
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">PowerUp</span> <span class="o">&amp;</span><span class="nl">powerUp</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="n">powerUp</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">CheckCollision</span><span class="p">(</span><span class="o">*</span><span class="n">Player</span><span class="p">,</span> <span class="n">powerUp</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="p">{</span>	<span class="c1">// collided with player, now activate powerup
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>                <span class="n">ActivatePowerUp</span><span class="p">(</span><span class="n">powerUp</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                <span class="n">powerUp</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="n">powerUp</span><span class="p">.</span><span class="n">Activated</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>For all powerups not yet destroyed, we check if the powerup either reached the bottom edge of the screen or collided with the paddle. In both cases the powerup is destroyed, but when collided with the paddle, it is also activated.</p>
<p>Activating a powerup is accomplished by settings its Activated property to <code>true</code> and enabling the powerup&rsquo;s effect by giving it to the ActivatePowerUp function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="nf">ActivatePowerUp</span><span class="p">(</span><span class="n">PowerUp</span> <span class="o">&amp;</span><span class="n">powerUp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;speed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Velocity</span> <span class="o">*=</span> <span class="mf">1.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;sticky&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Sticky</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;pass-through&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">PassThrough</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;pad-size-increase&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">50</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;confuse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Chaos</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Confuse</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// only activate if chaos wasn&#39;t already active
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;chaos&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Confuse</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Chaos</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>The purpose of ActivatePowerUp is exactly as it sounds: it activates the effect of a powerup as we&rsquo;ve described at the start of this chapter. We check the type of the powerup and change the game state accordingly. For the <code>&quot;sticky&quot;</code> and <code>&quot;pass-through&quot;</code> effect, we also change the color of the paddle and the ball respectively to give the user some feedback as to which effect is currently active.</p>
<p>Because the sticky and pass-through effects somewhat change the game logic we store their effect as a property of the ball object; this way we can change the game logic based on whatever effect on the ball is currently active. The only thing we&rsquo;ve changed in the BallObject header is the addition of these two properties, but for completeness&rsquo; sake its updated code is listed below:</p>
<ul>
<li><strong>BallObject</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/ball_object.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/ball_object.cpp" target="_blank">code</a>.</li>
</ul>
<p>We can then easily implement the sticky effect by slightly updating the DoCollisions function at the collision code between the ball and the paddle:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span> <span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Stuck</span> <span class="o">=</span> <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Sticky</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Here we set the ball&rsquo;s Stuck property equal to the ball&rsquo;s Sticky property. If the sticky effect is activated, the ball will end up stuck to the player paddle whenever it collides; the user then has to press the spacebar again to release the ball.</p>
<p>A similar small change is made for the pass-through effect within the same DoCollisions function. When the ball&rsquo;s PassThrough property is set to <code>true</code> we do not perform any collision resolution on the non-solid bricks.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Direction</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span> <span class="n">diff_vector</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">collision</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">PassThrough</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">box</span><span class="p">.</span><span class="n">IsSolid</span><span class="p">))</span> 
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">dir</span> <span class="o">==</span> <span class="n">LEFT</span> <span class="o">||</span> <span class="n">dir</span> <span class="o">==</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="c1">// horizontal collision
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">else</span> 
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The other effects are activated by simply modifying the game&rsquo;s state like the ball&rsquo;s velocity, the paddle&rsquo;s size, or an effect of the PostProcesser object.</p>
<h5 id="updating-powerups">Updating PowerUps</h5>
<p>Now all that is left to do is make sure that powerups are able to move once they&rsquo;ve spawned and that they&rsquo;re deactivated as soon as their duration runs out; otherwise powerups will stay active forever.</p>
<p>Within the game&rsquo;s UpdatePowerUps function we move the powerups based on their velocity and decrease the active powerups their duration. Whenever a powerup&rsquo;s duration is decreased to <code>0.0f</code>, its effect is deactivated and the relevant variables are reset to their original state:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">UpdatePowerUps</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">PowerUp</span> <span class="o">&amp;</span><span class="nl">powerUp</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="n">powerUp</span><span class="p">.</span><span class="n">Position</span> <span class="o">+=</span> <span class="n">powerUp</span><span class="p">.</span><span class="n">Velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Activated</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="n">powerUp</span><span class="p">.</span><span class="n">Duration</span> <span class="o">-=</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Duration</span> <span class="o">&lt;=</span> <span class="mf">0.0f</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="c1">// remove powerup from list (will later be removed)
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>                <span class="n">powerUp</span><span class="p">.</span><span class="n">Activated</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">                <span class="c1">// deactivate effects
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;sticky&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isOtherPowerUpActive</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">,</span> <span class="s">&#34;sticky&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                    <span class="p">{</span>	<span class="c1">// only reset if no other PowerUp of type sticky is active
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span>                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Sticky</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                        <span class="n">Player</span><span class="o">-&gt;</span><span class="n">Color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;pass-through&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isOtherPowerUpActive</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">,</span> <span class="s">&#34;pass-through&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                    <span class="p">{</span>	<span class="c1">// only reset if no other PowerUp of type pass-through is active
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c1"></span>                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">PassThrough</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                        <span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Color</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;confuse&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isOtherPowerUpActive</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">,</span> <span class="s">&#34;confuse&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                    <span class="p">{</span>	<span class="c1">// only reset if no other PowerUp of type confuse is active
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="c1"></span>                        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Confuse</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&#34;chaos&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isOtherPowerUpActive</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">,</span> <span class="s">&#34;chaos&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                    <span class="p">{</span>	<span class="c1">// only reset if no other PowerUp of type chaos is active
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1"></span>                        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Chaos</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">                <span class="p">}</span>                
</span></span><span class="line"><span class="ln">45</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">remove_if</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="p">[](</span><span class="k">const</span> <span class="n">PowerUp</span> <span class="o">&amp;</span><span class="n">powerUp</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">powerUp</span><span class="p">.</span><span class="n">Destroyed</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Activated</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="p">),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>You can see that for each effect we disable it by resetting the relevant items to their original state. We also set the powerup&rsquo;s Activated property to <code>false</code>. At the end of UpdatePowerUps we then loop through the PowerUps vector and erase each powerup if they are destroyed <strong>and</strong> deactivated. We use the remove_if function from the algorithm header to erase these items given a lambda predicate.</p>
<p><note>The remove_if function moves all elements for which the lambda predicate is true to the end of the container object and returns an iterator to the start of this <em>removed elements</em> range. The container&rsquo;s erase function then takes this iterator and the vector&rsquo;s end iterator to remove all the elements between these two iterators.</note></p>
<p>It may happen that while one of the powerup effects is active, another powerup of the same type collides with the player paddle. In that case we have more than 1 powerup of that type currently active within the game&rsquo;s PowerUps vector. Whenever one of these powerups gets deactivated, we don&rsquo;t want to disable its effects yet since another powerup of the same type may still be active. For this reason we use the IsOtherPowerUpActive function to check if there is still another powerup active of the same type. Only if this function returns <code>false</code> we deactivate the powerup. This way, the powerup&rsquo;s duration of a given type is extended to the duration of its last activated powerup:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">bool</span> <span class="nf">IsOtherPowerUpActive</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PowerUp</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">powerUps</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">PowerUp</span> <span class="o">&amp;</span><span class="nl">powerUp</span> <span class="p">:</span> <span class="n">powerUps</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Activated</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The function checks for all activated powerups if there is still a powerup active of the same type and if so, returns <code>true</code>.</p>
<p>The last thing left to do is render the powerups:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">PowerUp</span> <span class="o">&amp;</span><span class="nl">powerUp</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">PowerUps</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">powerUp</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">                <span class="n">powerUp</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="o">*</span><span class="n">Renderer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>    
</span></span></code></pre></div><p>Combine all this functionality and we have a working powerup system that not only makes the game more fun, but also a lot more challenging. It&rsquo;ll look a bit like this:</p>
<p><video src="assets/powerups.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>You can find the updated game code here (there we also reset all powerup effects whenever the level is reset):</p>
<ul>
<li><strong>Game</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/8.game.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/8.game.cpp" target="_blank">code</a>.</li>
</ul>
<h4 id="audio">Audio</h4>
<p>The game&rsquo;s making great progress, but it still feels a bit empty as there&rsquo;s no audio whatsoever. In this chapter we&rsquo;re going to fix that.</p>
<p>OpenGL doesn&rsquo;t offer us any support for audio capabilities (like many other aspects of game development). We have to manually load audio files into a collection of bytes, process and convert them to an audio stream, and manage multiple audio streams appropriately for use in our game. This can get complicated pretty quick and requires some low-level knowledge of audio engineering.</p>
<p>If it is your cup of tea then feel free to manually load audio streams from one or more audio file extensions. We are, however, going to make use of a library for audio management called <strong>irrKlang</strong>.</p>
<h5 id="irrklang">Irrklang</h5>
<p><img src="./assets/irrklang.png" class="right medium" /></p>
<p>IrrKlang is a high level 2D and 3D cross platform (Windows, Mac OS X, Linux) sound engine and audio library that plays WAV, MP3, OGG, and FLAC files to name a few. It also features several audio effects like reverb, delay, and distortion that can be extensively tweaked.</p>
<p><note>3D audio means that an audio source can have a 3D position that will attenuate its volume based on the camera&rsquo;s distance to the audio source, making it feel natural in a 3D world (think of gunfire in a 3D world; most often you&rsquo;ll be able to hear where it came from just by the direction/location of the sound).</note></p>
<p>IrrKlang is an easy-to-use audio library that can play most audio files with just a few lines of code, making it a perfect candidate for our Breakout game. Note that irrKlang has a slightly restrictive license: you are allowed to use irrKlang as you see fit for non-commercial purposes, but you have to pay for their pro version whenever you want to use irrKlang commercially.</p>
<p>You can download irrKlang from their <a href="http://www.ambiera.com/irrklang/downloads.html" target="_blank">download</a> page; we&rsquo;re using version 1.5 for this chapter. Because irrKlang is closed-source, we cannot compile the library ourselves so we&rsquo;ll have to do with whatever irrKlang provided for us. Luckily they have plenty of precompiled library files.</p>
<p>Once you include the header files of irrKlang, add their (64-bit) library (<code>irrKlang.lib</code>) to the linker settings, and copy the dll file(s) to the appropriate locations (usually the same location where the <code>.exe</code> resides) we&rsquo;re set to go. Note that if you want to load MP3 files, you&rsquo;ll also have to include the <code>ikpMP3.dll</code> file.</p>
<h5 id="adding-music">Adding music</h5>
<p>Specifically for this game I created a small little audio track so the game feels a bit more alive. You can find the audio track <a href="https://learnopengl.com/audio/in-practice/breakout/breakout.mp3" target="_blank">here</a> that we&rsquo;ll use as the game&rsquo;s background music. This track is what we&rsquo;ll play whenever the game starts and that continuously loops until the player closes the game. Feel free to replace it with your own tracks or use it in any way you like.</p>
<audio controls="">
  <source src="./assets/breakout.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<p>Adding this to the Breakout game is extremely easy with the irrKlang library. We include the irrKlang header file, create an <code>irrKlang::ISoundEngine</code>, initialize it with createIrrKlangDevice, and then use the engine to load and play audio files:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;irrklang/irrKlang.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">irrklang</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">ISoundEngine</span> <span class="o">*</span><span class="n">SoundEngine</span> <span class="o">=</span> <span class="n">createIrrKlangDevice</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">SoundEngine</span><span class="o">-&gt;</span><span class="n">play2D</span><span class="p">(</span><span class="s">&#34;audio/breakout.mp3&#34;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Here we created a SoundEngine that we use for all audio-related code. Once we&rsquo;ve initialized the sound engine, all we need to do to play audio is simply call its play2D function. Its first parameter is the filename, and the second parameter whether we want the file to loop (play again once it&rsquo;s finished).</p>
<p>And that is all there is to it! Running the game should now cause your speakers (or headset) to violently blast out sound waves.</p>
<h5 id="adding-sounds">Adding sounds</h5>
<p>We&rsquo;re not there yet, since music by itself is not enough to make the game as great as it could be. We want to play sounds whenever something interesting happens in the game, as extra feedback to the player. Like when we hit a brick, or when we activate a powerup. Below you can find all the sounds we&rsquo;re going to use (courtesy of freesound.org):</p>
<p><a href="https://learnopengl.com/audio/in-practice/breakout/bleep.mp3" target="_blank"><strong>bleep.mp3</strong></a>: the sound for when the ball hit a non-solid block.</p>
<audio controls="">
  <source src="./assets/bleep.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<p><a href="https://learnopengl.com/audio/in-practice/breakout/solid.wav" target="_blank"><strong>solid.wav</strong></a>: the sound for when the ball hit a solid block.</p>
<audio controls="">
  <source src="./assets/solid.wav" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<p><a href="https://learnopengl.com/audio/in-practice/breakout/powerup.wav" target="_blank"><strong>powerup.wav</strong></a>: the sound for when we the player paddle collided with a powerup block.</p>
<audio controls="">
  <source src="./assets/powerup.wav" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<p><a href="https://learnopengl.com/audio/in-practice/breakout/bleep.wav" target="_blank"><strong>bleep.wav</strong></a>: the sound for when we the ball bounces of the player paddle.</p>
<audio controls="">
  <source src="./assets/bleep.wav" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
<p>Wherever a collision occurs, we play the corresponding sound. I won&rsquo;t walk through each of the lines of code where this is supposed to happen, but simply list the updated game code <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/progress/9.game.cpp" target="_blank">here</a>. You should easily be able to add the sound effects at their appropriate locations.</p>
<p>Putting it all together gives us a game that feels a lot more complete. All together it looks (and sounds) like this:</p>
<p><video src="assets/audio.mp4" width="600" height="450" controls="" preload="auto"></video></p>
<p>IrrKlang allows for much more fine-grained control of audio controls like advanced memory management, audio effects, or sound event callbacks. Check out their simple C++ <a href="http://www.ambiera.com/irrklang/tutorials.html" target="_blank">tutorials</a> and try to experiment with its features.</p>
<h4 id="render-text">Render text</h4>
<p>In this chapter we&rsquo;ll be adding the final enhancements to the game by adding a life system, a win condition, and feedback in the form of rendered text. This chapter heavily builds upon the earlier introduced <a href="https://learnopengl.com/In-Practice/Text-Rendering" target="_blank">Text Rendering</a> chapter so it is highly advised to first work your way through that chapter if you haven&rsquo;t already.</p>
<p>In Breakout all text rendering code is encapsulated within a class called TextRenderer that features the initialization of the FreeType library, render configuration, and the actual render code. You can find the code of the TextRenderer class here:</p>
<ul>
<li><strong>TextRenderer</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/text_renderer.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/text_renderer.cpp" target="_blank">code</a>.</li>
<li><strong>Text shaders</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/shaders/text.vs" target="_blank">vertex</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/shaders/text.frag" target="_blank">fragment</a>.</li>
</ul>
<p>The content of the text renderer&rsquo;s functions is almost exactly the same as the code from the text rendering chapter. However, the code for rendering glyphs onto the screen is slightly different:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">TextRenderer</span><span class="o">::</span><span class="n">RenderText</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">text</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span> <span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">text</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kt">float</span> <span class="n">xpos</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">ch</span><span class="p">.</span><span class="n">Bearing</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="kt">float</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Characters</span><span class="p">[</span><span class="sc">&#39;H&#39;</span><span class="p">].</span><span class="n">Bearing</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ch</span><span class="p">.</span><span class="n">Bearing</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="kt">float</span> <span class="n">w</span> <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="kt">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">ch</span><span class="p">.</span><span class="n">Size</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">// update VBO for each character
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>        <span class="kt">float</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span><span class="p">,</span>     <span class="n">ypos</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span>       <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span><span class="p">,</span>     <span class="n">ypos</span><span class="p">,</span>       <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span><span class="p">,</span>     <span class="n">ypos</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">ypos</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="p">{</span> <span class="n">xpos</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span>       <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>    
</span></span></code></pre></div><p>The reason for it being slightly different is that we use a different orthographic projection matrix from the one we&rsquo;ve used in the text rendering chapter. In the text rendering chapter all <code>y</code> values ranged from bottom to top, while in the Breakout game all <code>y</code> values range from top to bottom with a <code>y</code> coordinate of <code>0.0</code> corresponding to the top edge of the screen. This means we have to slightly modify how we calculate the vertical offset.</p>
<p>Since we now render downwards from RenderText&rsquo;s y parameter, we calculate the vertical offset as the distance a glyph is pushed downwards from the top of the glyph space. Looking back at the glyph metrics image from FreeType, this is indicated by the red arrow:</p>
<p><a href="#R-image-12de469f000d551d7745b0f49885779c" class="lightbox-link"><img src="./assets/glyph_offset_1.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-12de469f000d551d7745b0f49885779c"><img src="./assets/glyph_offset_1.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To calculate this vertical offset we need to get the top of the glyph space (the length of the black vertical arrow from the origin). Unfortunately, FreeType has no such metric for us. What we do know is that that some glyphs always touch this top edge; characters like &lsquo;H&rsquo;, &lsquo;T&rsquo; or &lsquo;X&rsquo;. So what if we calculate the length of this red vector by subtracting <code>bearingY</code> from any of these <em>top-reaching</em> glyphs by <code>bearingY</code> of the glyph in question. This way, we push the glyph down based on how far its top point differs from the top edge.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">float</span> <span class="n">ypos</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Characters</span><span class="p">[</span><span class="sc">&#39;H&#39;</span><span class="p">].</span><span class="n">Bearing</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">ch</span><span class="p">.</span><span class="n">Bearing</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>  
</span></span></code></pre></div><p>In addition to updating the <code>ypos</code> calculation, we also switched the order of the vertices a bit to make sure all the vertices are still front facing when multiplied with the current orthographic projection matrix (as discussed in the <a href="https://learnopengl.com/Advanced-OpenGL/Face-culling" target="_blank">face culling</a> chapter).</p>
<p>Adding the TextRenderer to the game is easy:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">TextRenderer</span>  <span class="o">*</span><span class="n">Text</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">Text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextRenderer</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Width</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">Text</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="s">&#34;fonts/ocraext.TTF&#34;</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The text renderer is initialized with a font called OCR A Extended that you can download from <a href="http://fontzone.net/font-details/ocr-a-extended" target="_blank">here</a>. If the font is not to your liking, feel free to use a different font.</p>
<p>Now that we have a text renderer, let&rsquo;s finish the gameplay mechanics.</p>
<h5 id="player-lives">Player lives</h5>
<p>Instead of immediately resetting the game as soon as the ball reaches the bottom edge, we&rsquo;d like to give the player a few extra chances. We do this in the form of player lives, where the player begins with an initial number of lives (say <code>3</code>) and each time the ball touches the bottom edge, the player&rsquo;s life total is decreased by 1. Only when the player&rsquo;s life total becomes <code>0</code> we reset the game. This makes it easier for the player to finish a level while also building tension.</p>
<p>We keep count of the lives of a player by adding it to the game class (initialized within the constructor to a value of <code>3</code>):</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">public</span><span class="o">:</span>  
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Lives</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We then modify the game&rsquo;s Update function to, instead of resetting the game, decrease the player&rsquo;s life total, and only reset the game once the life total reaches <code>0</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">Ball</span><span class="o">-&gt;</span><span class="n">Position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Height</span><span class="p">)</span> <span class="c1">// did ball reach bottom edge?
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="o">--</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Lives</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="c1">// did the player lose all his lives? : Game over
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Lives</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetLevel</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">GAME_MENU</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>As soon as the player is game over (lives equals <code>0</code>), we reset the level and change the game state to GAME_MENU which we&rsquo;ll get to later.</p>
<p>Don&rsquo;t forget to reset the player&rsquo;s life total as soon as we reset the game/level:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">ResetLevel</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Lives</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>The player now has a working life total, but has no way of seeing how many lives he currently has while playing the game. That&rsquo;s where the text renderer comes in:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span> <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Lives</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">        <span class="n">Text</span><span class="o">-&gt;</span><span class="n">RenderText</span><span class="p">(</span><span class="s">&#34;Lives:&#34;</span> <span class="o">+</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">(),</span> <span class="mf">5.0f</span><span class="p">,</span> <span class="mf">5.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Here we convert the number of lives to a string, and display it at the top-left of the screen. It&rsquo;ll now look a bit like this:</p>
<p><a href="#R-image-d82eeecbccc7e834ed9907179d5f7486" class="lightbox-link"><img src="./assets/render_text_lives.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d82eeecbccc7e834ed9907179d5f7486"><img src="./assets/render_text_lives.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>As soon as the ball touches the bottom edge, the player&rsquo;s life total is decreased which is instantly visible at the top-left of the screen.</p>
<h5 id="level-selection">Level selection</h5>
<p>Whenever the user is in the game state GAME_MENU, we&rsquo;d like to give the player the control to select the level he&rsquo;d like to play in. With either the &lsquo;w&rsquo; or &rsquo;s&rsquo; key the player should be able to scroll through any of the levels we loaded. Whenever the player feels like the chosen level is indeed the level he&rsquo;d like to play in, he can press the enter key to switch from the game&rsquo;s GAME_MENU state to the GAME_ACTIVE state.</p>
<p>Allowing the player to choose a level is not too difficult. All we have to do is increase or decrease the game class&rsquo;s Level variable based on whether he pressed &lsquo;w&rsquo; or &rsquo;s&rsquo; respectively:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_MENU</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">GAME_ACTIVE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_W</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_S</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="o">--</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>   
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>We use the modulus operator (<code>%</code>) to make sure the Level variable remains within the acceptable level range (between <code>0</code> and <code>3</code>).</p>
<p>We also want to define what we want to render when we&rsquo;re in the menu state. We&rsquo;d like to give the player some instructions in the form of text and also display the selected level in the background.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span> <span class="o">||</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_MENU</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="p">[...]</span> <span class="c1">// Game state&#39;s rendering code
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_MENU</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">Text</span><span class="o">-&gt;</span><span class="n">RenderText</span><span class="p">(</span><span class="s">&#34;Press ENTER to start&#34;</span><span class="p">,</span> <span class="mf">250.0f</span><span class="p">,</span> <span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">Text</span><span class="o">-&gt;</span><span class="n">RenderText</span><span class="p">(</span><span class="s">&#34;Press W or S to select level&#34;</span><span class="p">,</span> <span class="mf">245.0f</span><span class="p">,</span> <span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">20.0f</span><span class="p">,</span> <span class="mf">0.75f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Here we render the game whenever we&rsquo;re in either the GAME_ACTIVE state or the GAME_MENU state, and whenever we&rsquo;re in the GAME_MENU state we also render two lines of text to inform the player to select a level and/or accept his choice. Note that for this to work when launching the game you do have to set the game&rsquo;s state as GAME_MENU by default.</p>
<p><a href="#R-image-cc9f84345523c042883528d36838a5d8" class="lightbox-link"><img src="./assets/render_text_select.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cc9f84345523c042883528d36838a5d8"><img src="./assets/render_text_select.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>It looks great, but once you try to run the code you&rsquo;ll probably notice that as soon as you press either the &lsquo;w&rsquo; or the &rsquo;s&rsquo; key, the game rapidly scrolls through the levels making it difficult to select the level you want to play in. This happens because the game records the key press over frames until we release the key. This causes the ProcessInput function to process the pressed key more than once.</p>
<p>We can solve this issue with a little trick commonly found within GUI systems. The trick is to, not only record the keys currently pressed, but also store the keys that have been processed once, until released again. We then check (before processing) whether the key has not yet been processed, and if so, process this key after which we store this key as being processed. Once we want to process the same key again without the key having been released, we do not process the key. This probably sounds somewhat confusing, but as soon as you see it in practice it (probably) starts to make sense.</p>
<p>First we have to create another array of bool values to indicate which keys have been processed. We define this within the game class:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">public</span><span class="o">:</span>  
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="kt">bool</span> <span class="n">KeysProcessed</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>We then set the relevant key(s) to <code>true</code> as soon as they&rsquo;re processed and make sure to only process the key if it wasn&rsquo;t processed before (until released):</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">ProcessInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_MENU</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">GAME_ACTIVE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_W</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_W</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_W</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_S</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_S</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                <span class="o">--</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_S</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Now as soon as the key&rsquo;s value in the KeysProcessed array has not yet been set, we process the key and set its value to <code>true</code>. Next time we reach the <code>if</code> condition of the same key, it will have been processed so we&rsquo;ll pretend we never pressed the button until it&rsquo;s released again.</p>
<p>Within GLFW&rsquo;s key callback function we then need to reset the key&rsquo;s processed value as soon as it&rsquo;s released so we can process it again the next time it&rsquo;s pressed:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="nf">key_callback</span><span class="p">(</span><span class="n">GLFWwindow</span><span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">scancode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">action</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">GLFW_PRESS</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="n">Breakout</span><span class="p">.</span><span class="n">Keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">GLFW_RELEASE</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="n">Breakout</span><span class="p">.</span><span class="n">Keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="n">Breakout</span><span class="p">.</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Launching the game gives us a neat level select screen that now precisely selects a single level per key press, no matter how long we press he key.</p>
<h5 id="winning">Winning</h5>
<p>Currently the player is able to select levels, play the game, and fail in doing so to lose. It is kind of unfortunate if the player finds out after destroying all the bricks he cannot in any way win the game. So let&rsquo;s fix that.</p>
<p>The player wins when all of the non-solid blocks have been destroyed. We already created a function to check for this condition in the GameLevel class:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln">1</span><span class="cl"><span class="kt">bool</span> <span class="n">GameLevel</span><span class="o">::</span><span class="n">IsCompleted</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">GameObject</span> <span class="o">&amp;</span><span class="nl">tile</span> <span class="p">:</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Bricks</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tile</span><span class="p">.</span><span class="n">IsSolid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">tile</span><span class="p">.</span><span class="n">Destroyed</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>We check all bricks in the game level and if a single non-solid brick isn&rsquo;t yet destroyed we return <code>false</code>. All we have to do is check for this condition in the game&rsquo;s Update function and as soon as it returns <code>true</code> we change the game state to GAME_WIN:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_ACTIVE</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Levels</span><span class="p">[</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Level</span><span class="p">].</span><span class="n">IsCompleted</span><span class="p">())</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetLevel</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">ResetPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Chaos</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">GAME_WIN</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Whenever the level is completed while the game is active, we reset the game and display a small victory message in the GAME_WIN state. For fun we&rsquo;ll also enable the chaos effect while in the GAME_WIN screen. In the Render function we&rsquo;ll congratulate the player and ask him to either restart or quit the game:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_WIN</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="n">Text</span><span class="o">-&gt;</span><span class="n">RenderText</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">            <span class="s">&#34;You WON!!!&#34;</span><span class="p">,</span> <span class="mf">320.0</span><span class="p">,</span> <span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">Text</span><span class="o">-&gt;</span><span class="n">RenderText</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="s">&#34;Press ENTER to retry or ESC to quit&#34;</span><span class="p">,</span> <span class="mf">130.0</span><span class="p">,</span> <span class="n">Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>Then we of course have to actually catch the mentioned keys:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kt">void</span> <span class="n">Game</span><span class="o">::</span><span class="n">ProcessInput</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="p">[...]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">==</span> <span class="n">GAME_WIN</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">Keys</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">])</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">KeysProcessed</span><span class="p">[</span><span class="n">GLFW_KEY_ENTER</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="n">Effects</span><span class="o">-&gt;</span><span class="n">Chaos</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="k">this</span><span class="o">-&gt;</span><span class="n">State</span> <span class="o">=</span> <span class="n">GAME_MENU</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>  
</span></span></code></pre></div><p>If you&rsquo;re then good enough to actually win the game, you&rsquo;d get the following image:</p>
<p><a href="#R-image-7154daea99d0e3ce433894ffa99c4a9e" class="lightbox-link"><img src="./assets/render_text_win.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7154daea99d0e3ce433894ffa99c4a9e"><img src="./assets/render_text_win.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>And that is it! The final piece of the puzzle of the Breakout game we&rsquo;ve been actively working on. Try it out, customize it to your liking, and show it to all your family and friends!</p>
<p>You can find the final version of the game&rsquo;s code below:</p>
<ul>
<li><strong>Game</strong>: <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game.h" target="_blank">header</a>, <a href="https://learnopengl.com/code_viewer_gh.php?code=src/7.in_practice/3.2d_game/0.full_source/game.cpp" target="_blank">code</a>.</li>
</ul>
<h5 id="further-reading">Further reading</h5>
<ul>
<li><a href="https://www.websiteplanet.com/blog/best-free-fonts/" target="_blank">70+ Best Free Fonts for Designers</a>: summarized list of a large group of fonts to use in your project for personal or commercial use.</li>
</ul>
<h4 id="final-thoughts">Final thoughts</h4>
<p>These last chapter gave a glimpse of what it&rsquo;s like to create something more than just a tech demo in OpenGL. We created a complete 2D game from scratch and learned how to abstract from certain low-level graphics concepts, use basic collision detection techniques, create particles, and we&rsquo;ve shown a practical scenario for an orthographic projection matrix. All this using concepts we&rsquo;ve discussed in all previous chapters. We didn&rsquo;t really learn new and exciting graphics techniques using OpenGL, but more as to how to combine all the knowledge so far into a larger whole.</p>
<p>Creating a simple game like Breakout can be accomplished in thousands of different ways, of which this approach is just one of many. The larger a game becomes, the more you start applying abstractions and design patterns. For further reading you can find a lot more on these abstractions and design patterns in the wonderful <a href="http://gameprogrammingpatterns.com/" target="_blank">game programming patterns</a> website.</p>
<p>Keep in mind that it is a difficult feat to create a game with extremely clean and well-thought out code (often close to impossible). Simply make your game in whatever way you think feels right at the time. The more you practice video-game development, the more you learn new and better approaches to solve problems. Don&rsquo;t let the struggle to want to create perfect code demotivate you; keep on coding!</p>
<h5 id="optimizations">Optimizations</h5>
<p>The content of these chapters and the finished game code were all focused on explaining concepts as simple as possible, without delving too much in optimization details. Therefore, many performance considerations were left out of the chapters. We&rsquo;ll list some of the more common improvements you&rsquo;ll find in modern 2D OpenGL games to boost performance for when your framerate starts to drop:</p>
<ul>
<li><strong>Sprite sheet / Texture atlas</strong>: instead of rendering a sprite with a single texture at a time, we combine all required textures into a single large texture (like bitmap fonts) and select the appropriate sprite texture with a targeted set of texture coordinates. Switching texture states can be expensive so a sprite sheet makes sure we rarely have to switch between textures; this also allows the GPU to more efficiently cache the texture in memory for faster lookups.</li>
<li><strong>Instanced rendering</strong>: instead of rendering a quad at a time, we could&rsquo;ve also batched all the quads we want to render and then, with an <a href="https://learnopengl.com/Advanced-OpenGL/Instancing" target="_blank">instanced renderer</a>, render all the batched sprites with just a single draw call. This is relatively easy to do since each sprite is composed of the same vertices, but differs in only a model matrix; something that we can easily include in an instanced array. This allows OpenGL to render a lot more sprites per frame. Instanced rendering can also be used to render particles and/or characters glyphs.</li>
<li><strong>Triangle strips</strong>: instead of rendering each quad as two triangles, we could&rsquo;ve rendered them with OpenGL&rsquo;s TRIANGLE_STRIP render primitive that takes only <code>4</code> vertices instead of <code>6</code>. This saves a third of the data sent to the GPU.</li>
<li><strong>Space partitioning algorithms</strong>: when checking for collisions, we compare the ball object to <strong>each</strong> of the bricks in the active level. This is a bit of a waste of CPU resources since we can easily tell that most of the bricks won&rsquo;t even come close to the ball within this frame. Using space partitioning algorithms like BSP, Octrees, or k-d trees, we partition the visible space into several smaller regions and first determine in which region(s) the ball is in. We then only check collisions between other bricks in whatever region(s) the ball is in, saving us a significant amount of collision checks. For a simple game like Breakout this will likely be overkill, but for more complicated games with more complicated collision detection algorithms this will significantly increase performance.</li>
<li><strong>Minimize state changes</strong>: state changes (like binding textures or switching shaders) are generally quite expensive in OpenGL, so you want to avoid doing a large amount of state changes. One approach to minimize state changes is to create your own state manager that stores the current value of an OpenGL state (like which texture is bound) and only switch if this value needs to change; this prevents unnecessary state changes. Another approach is to sort all the renderable objects by state change: first render all the objects with shader one, then all objects with shader two, and so on; this can of course be extended to blend state changes, texture binds, framebuffer switches etc.</li>
</ul>
<p>These should give you some hints as to what kind of advanced tricks we can apply to further boost the performance of a 2D game. This also gives you a glimpse of the power of OpenGL: by doing most rendering by hand we have full control over the entire process and thus also complete power over how to optimize the process. If you&rsquo;re not satisfied with Breakout&rsquo;s performance then feel free to take any of these as an exercise.</p>
<h5 id="get-creative">Get creative</h5>
<p>Now that you&rsquo;ve seen how to create a simple game in OpenGL it is up to you to create your own rendering/game applications. Many of the techniques that we&rsquo;ve discussed so far can be used in most 2D (and even 3D) games like sprite rendering, collision detection, postprocessing, text rendering, and particles. It is now up to you to take these techniques and combine/modify them in whichever way you think is right and develop your own handcrafted game.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          
<span style="font-size:26px">Êôü‰∏ñÊ∏ÖÈ£é</span>
        </div>
        <form action="../../../../../search.html" method="get"><div class="searchbox default-animation">
          <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
          <label class="a11y-only" for="R-search-by">Search</label>
          <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
          <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
        </div></form>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="../../../../../js/auto-complete.js?1708235101" defer></script>
        <script src="../../../../../js/lunr/lunr.min.js?1708235101" defer></script>
        <script src="../../../../../js/lunr/lunr.stemmer.support.min.js?1708235101" defer></script>
        <script src="../../../../../js/lunr/lunr.multi.min.js?1708235101" defer></script>
        <script src="../../../../../js/lunr/lunr.en.min.js?1708235101" defer></script>
        <script src="../../../../../js/search.js?1708235101" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="../../../../../index.html"><i class='fas fa-home'></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
          <li data-nav-id="/programming/index.html" class=""><input type="checkbox" id="R-section-d205f2b94e06f539e77f2bc392064cb6" aria-controls="R-subsections-d205f2b94e06f539e77f2bc392064cb6"><label for="R-section-d205f2b94e06f539e77f2bc392064cb6"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Á®ãÂ∫èËÆæËÆ°‰∏éÂºÄÂèë</span></label><a class="padding" href="../../../../../programming/index.html">Á®ãÂ∫èËÆæËÆ°‰∏éÂºÄÂèë</a><ul id="R-subsections-d205f2b94e06f539e77f2bc392064cb6" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/index.html" class="alwaysopen"><input type="checkbox" id="R-section-1a585580994f9dab2d4547c8eaf11987" aria-controls="R-subsections-1a585580994f9dab2d4547c8eaf11987" checked><label for="R-section-1a585580994f9dab2d4547c8eaf11987"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Java ËØ≠Ë®Ä</span></label><a class="padding" href="../../../../../programming/java/index.html">Java ËØ≠Ë®Ä</a><ul id="R-subsections-1a585580994f9dab2d4547c8eaf11987" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/java_basics/index.html" class=""><a class="padding" href="../../../../../programming/java/java_basics/index.html">Java Âü∫Á°ÄÁü•ËØÜ</a></li>
          <li data-nav-id="/programming/java/java_collection_framework/index.html" class=""><a class="padding" href="../../../../../programming/java/java_collection_framework/index.html">Java ÈõÜÂêàÊ°ÜÊû∂</a></li>
          <li data-nav-id="/programming/java/java_concurrency/index.html" class=""><a class="padding" href="../../../../../programming/java/java_concurrency/index.html">Java Âπ∂ÂèëÁºñÁ®ã</a></li>
          <li data-nav-id="/programming/java/java_memory_model/index.html" class=""><a class="padding" href="../../../../../programming/java/java_memory_model/index.html">Java ÂÜÖÂ≠òÊ®°Âûã</a></li>
          <li data-nav-id="/programming/java/java_annotation/index.html" class=""><a class="padding" href="../../../../../programming/java/java_annotation/index.html">Java Ê≥®Ëß£Áõ∏ÂÖ≥</a></li></ul></li></ul></li>
          <li data-nav-id="/test/index.html" class=""><input type="checkbox" id="R-section-40aaf63da4d8c6f43df4cc726b56321f" aria-controls="R-subsections-40aaf63da4d8c6f43df4cc726b56321f"><label for="R-section-40aaf63da4d8c6f43df4cc726b56321f"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Test</span></label><a class="padding" href="../../../../../test/index.html">Test</a><ul id="R-subsections-40aaf63da4d8c6f43df4cc726b56321f" class="morespace collapsible-menu">
          <li data-nav-id="/test/demo/index.html" class=""><a class="padding" href="../../../../../test/demo/index.html">Test</a></li></ul></li>
          <li data-nav-id="/algorithms_and_data_structures/index.html" class=""><a class="padding" href="../../../../../algorithms_and_data_structures/index.html">Êï∞ÊçÆÁªìÊûÑ‰∏éÁÆóÊ≥ï</a></li>
          <li data-nav-id="/computer_graphics/index.html" class="parent "><input type="checkbox" id="R-section-17dabdd0438dc68716ce11b90ee5aa30" aria-controls="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" checked><label for="R-section-17dabdd0438dc68716ce11b90ee5aa30"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</span></label><a class="padding" href="../../../../../computer_graphics/index.html">ËÆ°ÁÆóÊú∫ÂõæÂΩ¢Â≠¶</a><ul id="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/index.html" class="parent "><input type="checkbox" id="R-section-0e0951862a264269c87df7fac4f297fb" aria-controls="R-subsections-0e0951862a264269c87df7fac4f297fb" checked><label for="R-section-0e0951862a264269c87df7fac4f297fb"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ÁªèÂÖ∏ÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/index.html">ÁªèÂÖ∏ÊïôÁ®ã</a><ul id="R-subsections-0e0951862a264269c87df7fac4f297fb" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/basics_tutorial/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/basics_tutorial/index.html">Âü∫Á°ÄÊïôÁ®ã</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/shader_tutorial/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/shader_tutorial/index.html">ÁùÄËâ≤ÊïôÁ®ã</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/index.html" class=""><input type="checkbox" id="R-section-06ac295778bd74c824886a3ab22c212c" aria-controls="R-subsections-06ac295778bd74c824886a3ab22c212c"><label for="R-section-06ac295778bd74c824886a3ab22c212c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ÂÖâÁ∫øËøΩË∏™</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/index.html">ÂÖâÁ∫øËøΩË∏™</a><ul id="R-subsections-06ac295778bd74c824886a3ab22c212c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html">Ray Tracing in One Weekend</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html">Ray Tracing The Next Week</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html">Ray Tracing The Rest of Your Life</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html" class=""><input type="checkbox" id="R-section-c33da7e0886830ccf91b260ac3fff456" aria-controls="R-subsections-c33da7e0886830ccf91b260ac3fff456"><label for="R-section-c33da7e0886830ccf91b260ac3fff456"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Scratchapixe Á≥ªÂàóÁü≠Êñá</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html">Scratchapixe Á≥ªÂàóÁü≠Êñá</a><ul id="R-subsections-c33da7e0886830ccf91b260ac3fff456" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html">Chapter - 6</a></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/index.html" class="parent "><input type="checkbox" id="R-section-23d956a7f1e516a9e3d46517dfb799dd" aria-controls="R-subsections-23d956a7f1e516a9e3d46517dfb799dd" checked><label for="R-section-23d956a7f1e516a9e3d46517dfb799dd"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OpenGLÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/index.html">OpenGLÊïôÁ®ã</a><ul id="R-subsections-23d956a7f1e516a9e3d46517dfb799dd" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html" class="parent "><input type="checkbox" id="R-section-57f86dac108257fe13450c17c0c3086c" aria-controls="R-subsections-57f86dac108257fe13450c17c0c3086c" checked><label for="R-section-57f86dac108257fe13450c17c0c3086c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Learn OpenGL</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html">Learn OpenGL</a><ul id="R-subsections-57f86dac108257fe13450c17c0c3086c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2d_game/index.html" class="active"><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/2d_game/index.html"></a></li></ul></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html" class=""><input type="checkbox" id="R-section-ae6b71edd18a266dbd92162060f7614e" aria-controls="R-subsections-ae6b71edd18a266dbd92162060f7614e"><label for="R-section-ae6b71edd18a266dbd92162060f7614e"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OGL dev ÊïôÁ®ã</span></label><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html">OGL dev ÊïôÁ®ã</a><ul id="R-subsections-ae6b71edd18a266dbd92162060f7614e" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html">Chapter - 6</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html">Chapter - 7</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html">Chapter - 8</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html">Chapter - 9</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html">Chapter - 10</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html">Chapter - 11</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html">Chapter - 12</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html">Chapter - 13</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html">Chapter - 14</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html">Chapter - 15</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html">Chapter - 16</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html">Chapter - 17</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html">Chapter - 18</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html">Chapter - 19</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html">Chapter - 20</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html">Chapter - 21</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html">Chapter - 22</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html">Chapter - 23</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html">Chapter - 24</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html">Chapter - 25</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html">Chapter - 26</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html">Chapter - 27</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html">Chapter - 28</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html">Chapter - 29</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html">Chapter - 30</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html">Chapter - 31</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html">Chapter - 32</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html">Chapter - 33</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html">Chapter - 34</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html">Chapter - 35</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html">Chapter - 36</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html">Chapter - 37</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html">Chapter - 38</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html">Chapter - 39</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html">Chapter - 40</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html">Chapter - 41</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html">Chapter - 42</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html">Chapter - 43</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html">Chapter - 44</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html">Chapter - 45</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html">Chapter - 46</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html">Chapter - 47</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html">Chapter - 48</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html" class=""><a class="padding" href="../../../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html">Chapter - 49</a></li></ul></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/book_recommend/index.html" class=""><a class="padding" href="../../../../../computer_graphics/book_recommend/index.html">‰π¶Á±çÊé®Ëçê</a></li>
          <li data-nav-id="/computer_graphics/blog_article/index.html" class=""><a class="padding" href="../../../../../computer_graphics/blog_article/index.html">ÂçöÂÆ¢ÊñáÁ´†</a></li>
          <li data-nav-id="/computer_graphics/reference/index.html" class=""><a class="padding" href="../../../../../computer_graphics/reference/index.html">ÂèÇËÄÉËµÑÊñô</a></li></ul></li>
          <li data-nav-id="/computer_science/index.html" class=""><input type="checkbox" id="R-section-7d71eaebfb32275fa70e6b3397a5fe7c" aria-controls="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c"><label for="R-section-7d71eaebfb32275fa70e6b3397a5fe7c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ËÆ°ÁÆóÊú∫ÁßëÂ≠¶</span></label><a class="padding" href="../../../../../computer_science/index.html">ËÆ°ÁÆóÊú∫ÁßëÂ≠¶</a><ul id="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_science/blog_article/index.html" class=""><a class="padding" href="../../../../../computer_science/blog_article/index.html">ÂçöÂÆ¢ÊñáÁ´†</a></li>
          <li data-nav-id="/computer_science/operating_system/index.html" class=""><a class="padding" href="../../../../../computer_science/operating_system/index.html">Êìç‰ΩúÁ≥ªÁªü</a></li></ul></li>
          <li data-nav-id="/computer_networks/index.html" class=""><a class="padding" href="../../../../../computer_networks/index.html">ËÆ°ÁÆóÊú∫ÁΩëÁªú</a></li>
          <li data-nav-id="/game_programming/index.html" class=""><a class="padding" href="../../../../../game_programming/index.html">Ê∏∏ÊàèÁºñÁ®ã</a></li>
          <li data-nav-id="/database/index.html" class=""><a class="padding" href="../../../../../database/index.html">Êï∞ÊçÆÂ∫ì</a></li>
          </ul>
        </div>
        <div id="R-shortcuts">
          <div class="nav-title padding">More</div>
          <ul class="space">
            <li><a class="padding" href="https://github.com/McShelby/hugo-theme-relearn"><i class='fab fa-fw fa-github'></i> GitHub repo</a></li>
            <li><a class="padding" href="../../../../../tags/index.html"><i class='fas fa-fw fa-tags'></i> Tags</a></li>
            <li><a class="padding" href="../../../../../categories/index.html"><i class='fas fa-fw fa-layer-group'></i> Categories</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVariantSwitch">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-language fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = baseUri + this.value;">
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch showVariantSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-paint-brush fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-auto" value="auto" selected>Auto</option>
                      <option id="R-relearn-light" value="relearn-light">Relearn Light</option>
                      <option id="R-relearn-dark" value="relearn-dark">Relearn Dark</option>
                      <option id="R-zen-light" value="zen-light">Zen Light</option>
                      <option id="R-zen-dark" value="zen-dark">Zen Dark</option>
                      <option id="R-neon" value="neon">Neon</option>
                      <option id="R-learn" value="learn">Learn</option>
                      <option id="R-blue" value="blue">Blue</option>
                      <option id="R-green" value="green">Green</option>
                      <option id="R-red" value="red">Red</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fas fa-history fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
          <span class="github-buttons"></span>
          <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
          <script>
            function githubButtonsScheme(){
              var scheme = 'light';
              var colorPropertyValue = window.getComputedStyle( document.querySelector( '#R-sidebar' ) ).getPropertyValue( 'background-color' );
              var colorValues = colorPropertyValue.match( /\d+/g ).map( function( e ){ return parseInt(e,10); });
              if( colorValues.length === 3 && ((0.2126 * colorValues[0]) + (0.7152 * colorValues[1]) + (0.0722 * colorValues[2]) < 165) ){
                
                scheme = 'dark';
              }
              return scheme;
            }
            function githubButtonsInit(){
              if( !window.githubButtons ){
                
                setTimeout( githubButtonsInit, 50 );
                return;
              }
              var scheme = githubButtonsScheme();
              var githubButtonsHTML = `
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/archive/main.zip" data-color-scheme="${scheme}" data-icon="octicon-cloud-download" aria-label="Download McShelby/hugo-theme-relearn on GitHub">Download</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn" data-color-scheme="${scheme}" data-icon="octicon-star" data-show-count="true" aria-label="Star McShelby/hugo-theme-relearn on GitHub">Star</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/fork" data-color-scheme="${scheme}" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork McShelby/hugo-theme-relearn on GitHub">Fork</a>
               `;
              document.querySelector( '.github-buttons' ).innerHTML = githubButtonsHTML;
              document.querySelectorAll( '.github-button' ).forEach( function( anchor ){
                anchor.dataset.colorScheme = scheme;
                window.githubButtons.render( anchor, function( el ){
                  anchor.parentNode.replaceChild( el, anchor );
                });
              });
            }
            document.addEventListener( 'themeVariantLoaded', function( e ){
              
              setTimeout( githubButtonsInit, 400 );
            });
          </script>
          <script async src="../../../../../js/github-buttons.js?1708235102"></script>
          </div>
        </div>
      </div>
    </aside>
    <script src="../../../../../js/clipboard.min.js?1708235102" defer></script>
    <script src="../../../../../js/perfect-scrollbar.min.js?1708235102" defer></script>
    <script>
      function useMathJax( config ){
        if( !Object.assign ){
          
          return;
        }
        window.MathJax = Object.assign( window.MathJax || {}, {
          loader: {
            load: ['[tex]/mhchem']
          },
          startup: {
            elements: [
              '.math'
            ]
          },
          tex: {
            inlineMath: [
              ['$', '$'], 
              ['\\(', '\\)']
            ]
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="../../../../../js/mathjax/tex-mml-chtml.js?1708235102"></script>
    <script src="../../../../../js/theme.js?1708235102" defer></script>
  </body>
</html>
