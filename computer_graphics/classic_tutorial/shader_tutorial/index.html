<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.122.0">
    <meta name="generator" content="Relearn 5.23.2+tip">
    <meta name="description" content="å•Šå•Šå•Šå•Š">
    <meta name="author" content="SÃ¶ren Weber">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://example.com/images/hero.png">
    <meta name="twitter:title" content="ç€è‰²æ•™ç¨‹ :: Hugo Relearn Theme">
    <meta name="twitter:description" content="å•Šå•Šå•Šå•Š">
    <meta property="og:title" content="ç€è‰²æ•™ç¨‹ :: Hugo Relearn Theme">
    <meta property="og:description" content="å•Šå•Šå•Šå•Š">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/computer_graphics/classic_tutorial/shader_tutorial/index.html">
    <meta property="og:image" content="https://example.com/images/hero.png">
    <meta property="og:site_name" content="Hugo Relearn Theme">
    <title>ç€è‰²æ•™ç¨‹ :: Hugo Relearn Theme</title>
    <link href="../../../computer_graphics/classic_tutorial/shader_tutorial/index.xml" rel="alternate" type="application/rss+xml" title="ç€è‰²æ•™ç¨‹ :: Hugo Relearn Theme">
    <link href="../../../computer_graphics/classic_tutorial/shader_tutorial/index.print.html" rel="alternate" type="text/html" title="ç€è‰²æ•™ç¨‹ :: Hugo Relearn Theme"><link rel="icon" href="../../../images/favicon.ico">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../../css/fontawesome-all.min.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fontawesome-all.min.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../css/nucleus.css?1708235101" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/auto-complete.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../css/perfect-scrollbar.min.css?1708235101" rel="stylesheet">
    <link href="../../../css/fonts.css?1708235101" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../../css/fonts.css?1708235101" rel="stylesheet"></noscript>
    <link href="../../../css/theme.css?1708235101" rel="stylesheet">
    <link href="../../../css/theme-auto.css?1708235101" rel="stylesheet" id="R-variant-style">
    <link href="../../../css/variant.css?1708235101" rel="stylesheet">
    <link href="../../../css/print.css?1708235101" rel="stylesheet" media="print">
    <link href="../../../css/ie.css?1708235101" rel="stylesheet">
    <script src="../../../js/url.js?1708235101"></script>
    <script src="../../../js/variant.js?1708235101"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../../index.search.js";
      var root_url="../../../";
      var baseUri=root_url.replace(/\/$/, '');
      window.relearn = window.relearn || {};
      window.relearn.baseUriFull='https:\/\/example.com/';
      // variant stuff
      window.variants && variants.init( [ 'auto', 'relearn-light', 'relearn-dark', 'zen-light', 'zen-dark', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    <style>
      #R-body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support html" data-url="../../../computer_graphics/classic_tutorial/shader_tutorial/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
              <button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)">
                <i class="fa-fw fas fa-bars"></i>
              </button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)">
                <i class="fa-fw fas fa-list-alt"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#shadertoy-tutorial">Shadertoy Tutorial</a>
      <ul>
        <li><a href="#æ•™ç¨‹ç›®å½•">æ•™ç¨‹ç›®å½•</a></li>
        <li><a href="#tutorial-part-1---intro">Tutorial Part 1 - Intro</a></li>
        <li><a href="#tutorial-part-2---circles-and-animation">Tutorial Part 2 - Circles and Animation</a></li>
        <li><a href="#tutorial-part-3---squares-and-rotation">Tutorial Part 3 - Squares and Rotation</a></li>
        <li><a href="#tutorial-part-4---multiple-2d-shapes-and-mixing">Tutorial Part 4 - Multiple 2D Shapes and Mixing</a></li>
        <li><a href="#tutorial-part-5---2d-sdf-operations-and-more-2d-shapes">Tutorial Part 5 - 2D SDF Operations and More 2D Shapes</a></li>
        <li><a href="#tutorial-part-6---3d-scenes-with-ray-marching">Tutorial Part 6 - 3D Scenes with Ray Marching</a></li>
        <li><a href="#tutorial-part-7---unique-colors-and-multiple-3d-objects">Tutorial Part 7 - Unique Colors and Multiple 3D Objects</a></li>
        <li><a href="#tutorial-part-8---3d-rotation">Tutorial Part 8 - 3D Rotation</a></li>
        <li><a href="#tutorial-part-9---camera-movement">Tutorial Part 9 - Camera Movement</a></li>
        <li><a href="#tutorial-part-10---camera-model-with-a-lookat-point">Tutorial Part 10 - Camera Model with a Lookat Point</a></li>
        <li><a href="#tutorial-part-11---phong-reflection-model">Tutorial Part 11 - Phong Reflection Model</a></li>
        <li><a href="#tutorial-part-12---fresnel-and-rim-lighting">Tutorial Part 12 - Fresnel and Rim Lighting</a></li>
        <li><a href="#tutorial-part-13---shadows">Tutorial Part 13 - Shadows</a></li>
        <li><a href="#tutorial-part-14---sdf-operations">Tutorial Part 14 - SDF Operations</a></li>
        <li><a href="#tutorial-part-15---channels-textures-and-buffers">Tutorial Part 15 - Channels, Textures, and Buffers</a></li>
        <li><a href="#tutorial-part-16---cubemaps-and-reflections">Tutorial Part 16 - Cubemaps and Reflections</a></li>
        <li><a href="#snowman-shader-in-shadertoy">Snowman Shader in Shadertoy</a></li>
        <li><a href="#shader-resources">Shader Resources</a></li>
        <li><a href="#glow-shader-in-shadertoy">Glow Shader in Shadertoy</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../index.html"><span itemprop="name">ä¸»é¡µ</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../computer_graphics/index.html"><span itemprop="name">è®¡ç®—æœºå›¾å½¢å­¦</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../../computer_graphics/classic_tutorial/index.html"><span itemprop="name">ç»å…¸æ•™ç¨‹</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">ç€è‰²æ•™ç¨‹</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../computer_graphics/classic_tutorial/shader_tutorial/index.print.html" title="Print whole chapter (CTRL&#43;ALT&#43;p)">
                <i class="fa-fw fas fa-print"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../computer_graphics/classic_tutorial/basics_tutorial/index.html" title="åŸºç¡€æ•™ç¨‹ (ğŸ¡)">
                <i class="fa-fw fas fa-chevron-left"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
              <a class="topbar-control" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/index.html" title="å…‰çº¿è¿½è¸ª (ğŸ¡’)">
                <i class="fa-fw fas fa-chevron-right"></i>
              </a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
              <button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More">
                <i class="fa-fw fas fa-ellipsis-v"></i>
              </button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="ç€è‰²æ•™ç¨‹">ç€è‰²æ•™ç¨‹</h1>

<h2 id="shadertoy-tutorial">Shadertoy Tutorial</h2>
<p>ä¸€ä¸ªå¤§ç‰›åˆ›ä½œçš„ä¸€ç³»åˆ—æ•™ç¨‹æ–‡ç« ï¼ˆ<a href="https://inspirnathan.com/posts/47-shadertoy-tutorial-part-1" target="_blank">å®˜æ–¹ç½‘å€</a>ï¼‰ï¼Œéå¸¸é€‚åˆå…¥é—¨å­¦ä¹ ã€‚å¯ä»¥é…åˆç€ <a href="https://gitee.com/link?target=https%3A%2F%2Fwww.shadertoy.com%2F" target="_blank">Shadertoy</a> åœ¨çº¿ GLSL ES ç€è‰²å™¨å·¥å…·ä¸€èµ·å­¦ä¹ ã€‚ç†è®ºè”ç³»å®è·µå—ï¼Œå¾—åŠ¨æ‰‹å®éªŒå„ç§ç¤ºä¾‹æ‰æœ‰æ•ˆæœã€‚å¦å¤–è¿˜è¦å‚è€ƒ Inigo Quilez è¿™ä½å¤§ç‰›çš„<a href="https://gitee.com/link?target=https%3A%2F%2Fiquilezles.org%2Farticles%2F" target="_blank">åšå®¢</a>ï¼Œæœ‰å¤§é‡å…³äºç€è‰²æ–¹é¢çš„æ–‡ç« ï¼Œå¹¶ä¸”ä»–ä¹Ÿæ˜¯ shadertoy.com çš„åˆ›å§‹äººä¹‹ä¸€ï¼Œæ‰€ä»¥ä»–åœ¨ Shadertoy å®˜ç½‘åˆ›ä½œäº†å¤§é‡ç¤ºä¾‹ç¨‹åºï¼Œéƒ½æ˜¯éå¸¸å…·æœ‰å‚è€ƒä»·å€¼çš„ã€‚</p>
<p>è¿™é‡Œæˆ‘æŠŠè¿™ä¸ªæ•™ç¨‹å¤åˆ¶ä¸‹æ¥äº†ï¼Œä¹‹æ‰€ä»¥è´¹é‚£ä¹ˆå¤§åŠ²ï¼ŒåŸå› æœ‰äºŒï¼šä¸€æ˜¯æˆ‘éå¸¸å–œæ¬¢ä¸ªå…¥é—¨æ•™ç¨‹ï¼Œç¤ºä¾‹çŸ­å°ç²¾æ‚ï¼Œç®€å•æ˜“æ‡‚ï¼›äºŒæ˜¯é‰´äºæŸäº›ä¸å¯è¯´çš„åŸå› ï¼Œè¯´ä¸å®šè¿™å›½å¤–çš„ç½‘è®¿é—®ä¸äº†äº†ã€‚</p>
<h3 id="æ•™ç¨‹ç›®å½•">æ•™ç¨‹ç›®å½•</h3>
<ul>
<li><a href="#tutorial-part-1---intro">Tutorial Part 1 - Intro</a></li>
<li><a href="#tutorial-part-2---circles-and-animation">Tutorial Part 2 - Circles and Animation</a></li>
<li><a href="#tutorial-part-3---squares-and-rotation">Tutorial Part 3 - Squares and Rotation</a></li>
<li><a href="#tutorial-part-4---multiple-2d-shapes-and-mixing">Tutorial Part 4 - Multiple 2D Shapes and Mixing</a></li>
<li><a href="#tutorial-part-5---2d-sdf-operations-and-more-2d-shapes">Tutorial Part 5 - 2D SDF Operations and More 2D Shapes</a></li>
<li><a href="#tutorial-part-6---3d-scenes-with-ray-marching">Tutorial Part 6 - 3D Scenes with Ray Marching</a></li>
<li><a href="#tutorial-part-7---unique-colors-and-multiple-3d-objects">Tutorial Part 7 - Unique Colors and Multiple 3D Objects</a></li>
<li><a href="#tutorial-part-8---3d-rotation">Tutorial Part 8 - 3D Rotation</a></li>
<li><a href="#tutorial-part-9---camera-movement">Tutorial Part 9 - Camera Movement</a></li>
<li><a href="#tutorial-part-10---camera-model-with-a-lookat-point">Tutorial Part 10 - Camera Model with a Lookat Point</a></li>
<li><a href="#tutorial-part-11---phong-reflection-model">Tutorial Part 11 - Phong Reflection Model</a></li>
<li><a href="#tutorial-part-12---fresnel-and-rim-lighting">Tutorial Part 12 - Fresnel and Rim Lighting</a></li>
<li><a href="#tutorial-part-13---shadows">Tutorial Part 13 - Shadows</a></li>
<li><a href="#tutorial-part-14---sdf-operations">Tutorial Part 14 - SDF Operations</a></li>
<li><a href="#tutorial-part-15---channels-textures-and-buffers">Tutorial Part 15 - Channels, Textures, and Buffers</a></li>
<li><a href="#tutorial-part-16---cubemaps-and-reflections">Tutorial Part 16 - Cubemaps and Reflections</a></li>
<li><a href="#snowman-shader-in-shadertoy">Snowman Shader in Shadertoy</a></li>
<li><a href="#shader-resources">Shader Resources</a></li>
<li><a href="#glow-shader-in-shadertoy">Glow Shader in Shadertoy</a></li>
</ul>
<h3 id="tutorial-part-1---intro">Tutorial Part 1 - Intro</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/47-shadertoy-tutorial-part-1/</p>
</blockquote>
<p>Greetings, friends! I&rsquo;ve recently been fascinated with shaders and how amazing they are. Today, I will talk about how we can create pixel shaders using an amazing online tool called <a href="https://www.shadertoy.com/" target="_blank">Shadertoy</a>, created by <a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a> and <a href="http://www.poljeremias.com/" target="_blank">Pol Jeremias</a>, two extremely talented people.</p>
<h4 id="what-are-shaders">What are Shaders?</h4>
<p><a href="https://en.wikipedia.org/wiki/Shader" target="_blank">Shaders</a> are powerful programs that were originally meant for shading objects in a 3D scene. Nowadays, shaders serve multiple purposes. Shader programs typically run on your computer&rsquo;s graphics processing unit (GPU) where they can run in parallel.</p>
<blockquote>
<p>TIP</p>
<p>Understanding that shaders run in parallel on your GPU is extremely important. Your program will independently run for every pixel in Shadertoy at the same time.</p>
</blockquote>
<p>Shader languages such as the <a href="https://en.wikipedia.org/wiki/High-Level_Shading_Language" target="_blank">High-Level Shading Language (HLSL)</a> and <a href="https://en.wikipedia.org/wiki/OpenGL_Shading_Language" target="_blank">OpenGL Shading Language (GLSL)</a> are the most common languages used to program the GPU&rsquo;s rendering pipeline. These languages have syntax similar to the <a href="https://en.wikipedia.org/wiki/C_%28programming_language%29" target="_blank">C programming language</a>.</p>
<p>When you&rsquo;re playing a game such as Minecraft, shaders are used to make the world seem 3D as you&rsquo;re viewing it from a 2D screen (i.e. your computer monitor or your phone&rsquo;s screen). Shaders can also drastically change the look of a game by adjusting how light interacts with objects or how objects are rendered to the screen. This <a href="https://www.youtube.com/watch?v=1BnNAu_L4FA" target="_blank">YouTube video</a> showcases 10 shaders that can make Minecraft look totally different and demonstrate the beauty of shaders.</p>
<p>You&rsquo;ll mostly see shaders come in two forms: vertex shaders and fragment shaders. The vertex shader is used to create vertices of 3D meshes of all kinds of objects such as sphere, cubes, elephants, protagonists of a 3D game, etc. The information from the vertex shader is passed to the geometry shader which can then manipulate these vertices or perform extra operations before the fragment shader. You typically won&rsquo;t hear geometry shaders being discussed much. The final part of the pipeline is the fragment shader. The fragment shader calculates the final color of the pixel and determines if a pixel should even be shown to the user or not.</p>
<p><a href="#R-image-d818f6ada54d9a517d95abdf32b8da9e" class="lightbox-link"><img src="./assets/shadertoy-1.png?classes=border" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d818f6ada54d9a517d95abdf32b8da9e"><img src="./assets/shadertoy-1.png?classes=border" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><em>Stages of the graphics pipeline by <a href="https://learnopengl.com/Getting-started/Hello-Triangle" target="_blank">Learn OpenGL</a></em></p>
<p>As an example, suppose we have a vertex shader that draws three points/vertices to the screen in the shape of a triangle. Once those vertices pass to the fragment shader, the pixel color between each vertex can be filled in automatically. The GPU understands how to interpolate values extremely well. Assuming a color is assigned to each vertex in the vertex shader, the GPU can interpolate colors between each vertex to fill in the triangle.</p>
<p><a href="#R-image-8959ebba0cc82fe6e3e5aabe90026a66" class="lightbox-link"><img src="./assets/shadertoy-2.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8959ebba0cc82fe6e3e5aabe90026a66"><img src="./assets/shadertoy-2.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In game engines like <a href="https://unity.com/" target="_blank">Unity</a> or <a href="https://www.unrealengine.com/en-US/" target="_blank">Unreal</a>, vertex shaders and fragment shaders are used heavily for 3D games. Unity provides an abstraction on top of shaders called <a href="https://docs.unity3d.com/Manual/SL-Shader.html" target="_blank">ShaderLab</a>, which is a language that sits on top of HLSL to help write shaders easier for your games. Additionally, Unity provides a visual tool called <a href="https://unity.com/shader-graph" target="_blank">Shader Graph</a> that lets you build shaders without writing code. If you search for &ldquo;Unity shaders&rdquo; on Google, you&rsquo;ll find hundreds of shaders that perform lots of different functions. You can create shaders that make objects glow, make characters become translucent, and even create &ldquo;image effects&rdquo; that apply a shader to the entire view of your game. There are an infinite number of ways you can use shaders.</p>
<p>You may often hear fragment shaders be referred to as pixel shaders. The term, &ldquo;fragment shader,&rdquo; is more accurate because shaders can prevent pixels from being drawn to the screen. In some applications such as Shadertoy, you&rsquo;re stuck drawing every pixel to the screen, so it makes more sense to call them pixel shaders in that context.</p>
<p>Shaders are also responsible for rendering the shading and lighting in your game, but they can be used for more than that. A shader program can run on the GPU, so why not take advantage of the parallelization it offers? You can create a <a href="https://www.khronos.org/opengl/wiki/Compute_Shader" target="_blank">compute shader</a> that runs heavy calculations in the GPU instead of the CPU. In fact, <a href="https://github.com/tensorflow/tfjs" target="_blank">Tensorflow.js</a> takes advantage of the GPU to train machine learning models faster in the browser.</p>
<p>Shaders are powerful programs indeed!</p>
<h4 id="what-is-shadertoy">What is Shadertoy?</h4>
<p>In the next series of posts, I will be talking about Shadertoy. Shadertoy is a website that helps users create pixel shaders and share them with others, similar to <a href="https://codepen.io/" target="_blank">Codepen</a> with HTML, CSS, and JavaScript.</p>
<blockquote>
<p>TIP</p>
<p>When following along this tutorial, please make sure you&rsquo;re using a modern browser that supports WebGL 2.0 such as Google Chrome.</p>
</blockquote>
<p>Shadertoy leverages the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API" target="_blank">WebGL API</a> to render graphics in the browser using the GPU. WebGL lets you write shaders in GLSL and supports hardware acceleration. That is, you can leverage the GPU to manipulate pixels on the screen in parallel to speed up rendering. Remember how you had to use <code>ctx.getContext('2d')</code> when working with the <a href="https://inspirnathan.com/posts/38-html5-canvas-api-tutorial-part-1" target="_blank">HTML Canvas API</a>? Shadertoy uses a canvas with the <code>webgl</code> context instead of 2d, so you can draw pixels to the screen with higher performance using WebGL.</p>
<blockquote>
<p>WARNING</p>
<p>Although Shadertoy uses the GPU to help boost rendering performance, your computer may slow down a bit when opening someone&rsquo;s Shadertoy shader that performs heavy calculations. Please make sure your computer&rsquo;s GPU can handle it, and understand that it may drain a device&rsquo;s battery fairly quickly.</p>
</blockquote>
<p>Modern 3D game engines such as Unity and the Unreal Engine and 3D modelling software such as <a href="https://www.blender.org/" target="_blank">Blender</a> run very quickly because they use both a vertex and fragment shader, and they perform a lot of optimizations for you. In Shadertoy, you don&rsquo;t have access to a vertex shader. You have to rely on algorithms such as ray marching and signed distance fields/functions (SDFs) to render 3D scenes which can be computationally expensive.</p>
<p>Please note that writing shaders in Shadertoy does not guarantee they will work in other environments such as Unity. You may have to translate the GLSL code to syntax supported by your target environment such as HLSL. Shadertoy also provides global variables that may not be supported in other environments. Don&rsquo;t let that stop you though! It&rsquo;s entirely possible to make adjustments to your Shadertoy code and use them in your games or modelling software. It just requires a bit of extra work. In fact, Shadertoy is a great way to experiment with shaders before using them in your preferred game engine or modelling software.</p>
<p>Shadertoy is a great way to practice creating shaders with GLSL and helps you think more mathematically. Drawing 3D scenes requires a lot of vector arithmetic. It&rsquo;s intellectually stimulating and a great way to show off your skills to your friends. If you <a href="https://www.shadertoy.com/browse" target="_blank">browse</a> across Shadertoy, you&rsquo;ll see tons of beautiful creations that were drawn with just math and code! Once you get the hang of Shadertoy, you&rsquo;ll find it&rsquo;s really fun!</p>
<h4 id="introduction-to-shadertoy">Introduction to Shadertoy</h4>
<p>Shadertoy takes care of setting up an HTML canvas with WebGL support, so all you have to worry about is writing the shader logic in the GLSL programming language. As a downside, Shadertoy doesn&rsquo;t let you write vertex shaders and only lets you write pixel shaders. It essentially provides an environment for experimenting with the fragment side of shaders, so you can manipulate all pixels on the canvas in parallel.</p>
<p>On the top navigation bar of Shadertoy, you can click on <a href="https://www.shadertoy.com/new" target="_blank">New</a> to start a new shader.</p>
<p><a href="#R-image-28464f8d7c4c9b80fcb89b991780efe7" class="lightbox-link"><img src="./assets/shadertoy-3.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-28464f8d7c4c9b80fcb89b991780efe7"><img src="./assets/shadertoy-3.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s analyze everything we see on the screen. Obviously, we see a code editor on the right-hand side for writing our GLSL code, but let me go through most of the tools available as they are numbered in the image above.</p>
<ol>
<li>The canvas for displaying the output of your shader code. Your shader will run for every pixel in the canvas in parallel.</li>
<li>Left: rewind time back to zero. Center: play/pause the shader animations. Right: Time in seconds since page loaded.</li>
<li>The frames per second (fps) will let you know how well your computer can handle the shader. Typically runs around 60fps or lower.</li>
<li>Canvas resolution in width by height. These values are given to you in the &ldquo;iResolution&rdquo; global variable.</li>
<li>Left: record an html video by pressing it, recording, and pressing it again. Middle: Adjust volume for audio playing in your shader. Right: Press the symbol to expand the canvas to full screen mode.</li>
<li>Click the plus icon to add additional scripts. The buffers (A, B, C, D) can be accessed using &ldquo;channels&rdquo; Shadertoy provides. Use &ldquo;Common&rdquo; to share code between scripts. Use &ldquo;Sound&rdquo; when you want to write a shader that generates audio. Use &ldquo;Cubemap&rdquo; to generate a cubemap.</li>
<li>Click on the small arrow to see a list of global variables that Shadertoy provides. You can use these variables in your shader code.</li>
<li>Click on the small arrow to compile your shader code and see the output in the canvas. You can use Alt+Enter or Option+Enter to quickly compile your code. You can click on the &ldquo;Compiled in &hellip;&rdquo; text to see the compiled code.</li>
<li>Shadertoy provides four channels that can be accessed in your code through global variables such as &ldquo;iChannel0&rdquo;, &ldquo;iChannel1&rdquo;, etc. If you click on one of the channels, you can add textures or interactivity to your shader in the form of keyboard, webcam, audio, and more.</li>
<li>Shadertoy gives you the option to adjust the size of your text in the code window. If you click the question mark, you can see information about the compiler being used to run your code. You can also see what functions or inputs were added by Shadertoy.</li>
</ol>
<p>Shadertoy provides a nice environment to write GLSL code, but keep in mind that it injects variables, functions, and other utilities that may make it slightly different from GLSL code you may write in other environments. Shadertoy provides these as a convenience to you as you&rsquo;re developing your shader. For example, the variable, &ldquo;iTime&rdquo;, is a global variable given to you to access the time (in seconds) that has passed since the page loaded.</p>
<h4 id="understanding-shader-code">Understanding Shader Code</h4>
<p>When you first start a new shader in Shadertoy, you will find the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="o">+</span><span class="n">uv</span><span class="p">.</span><span class="n">xyx</span><span class="o">+</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>You can run the code by pressing the small arrow as mentioned in section 8 in the image above or you by pressing <code>Alt+Center</code> or <code>Option+Enter</code> as a keyboard shortcut.</p>
<p>If you&rsquo;ve never worked with shaders before, that&rsquo;s okay! I&rsquo;ll try my best to explain the GLSL syntax you use to write shaders in Shadertoy. Right away, you will notice that this is a statically typed language like C, C++, Java, and C#. GLSL uses the concept of <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29" target="_blank">types</a> too. Some of these types include: <code>bool</code> (boolean), <code>int</code> (integer), <code>float</code> (decimal), and <code>vec</code> (vector). GLSL also requires semicolons to be placed at the end of each line. Otherwise, the compiler will throw an error.</p>
<p>In the code snippet above, we are defining a <code>mainImage</code> function that must be present in our Shadertoy shader. It returns nothing, so the return type is <code>void</code>. It accepts two parameters: <code>fragColor</code> and <code>fragCoord</code>.</p>
<p>You may be scratching your head at the <code>in</code> and <code>out</code>. For Shadertoy, you generally have to worry about these keywords inside the <code>mainImage</code> function only. Remember how I said that the shaders allow us to write programs for the GPU rendering pipeline? Think of the <code>in</code> and <code>out</code> as the input and output. Shadertoy gives us an input, and we are writing a color as the output.</p>
<p>Before we continue, let&rsquo;s change the code to something a bit simpler:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// RGB values</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run the shader program, we should end up with a completely blue canvas. The shader program runs for every pixel on the canvas IN PARALLEL. This is extremely important to keep in mind. You have to think about how to write code that will change the color of the pixel depending on the pixel coordinate. It turns out we can create amazing pieces of artwork with just the pixel coordinates!</p>
<p><a href="#R-image-6c484082437015ecc9c0aae5810cb8d7" class="lightbox-link"><img src="./assets/shadertoy-4.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6c484082437015ecc9c0aae5810cb8d7"><img src="./assets/shadertoy-4.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In shaders, we specify RGB (red, green, blue) values using a range between zero and one. If you have color values that are between 0 and 255, you can normalize them by dividing by 255.</p>
<p>So we&rsquo;ve seen how to change the color of the canvas, but what&rsquo;s going on inside our shader program? The first line inside the <code>mainImage</code> function declares a variable called <code>uv</code> that is of type <code>vec2</code>. If you remember your vector arithmetic in school, this means we have a vector with an &ldquo;x&rdquo; component and a &ldquo;y&rdquo; component. A variable with the type, <code>vec3</code>, would have an additional &ldquo;z&rdquo; component.</p>
<p>You may have learned in school about the <a href="https://en.wikipedia.org/wiki/Three-dimensional_space" target="_blank">3D coordinate system</a>. It lets us graph 3D coordinates on pieces of paper or some other flat surface. Obviously, visualizing 3D on a 2D surface is a bit difficult, so brilliant mathematicians of old created a 3D coordinate system to help us visualize points in 3D space.</p>
<p>However, you should think of vectors in shader code as &ldquo;arrays&rdquo; that can hold between one and four values. Sometimes, vectors can hold information about the XYZ coordinates in 3D space or they can contain information about RGB values. Therefore, the following are equivalent in shader programs:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>color.r = color.x
color.g = color.y
color.b = color.z
color.a = color.w</code></pre></div><p>Yes, there can be variables with the type, <code>vec4</code>, and the letter, <code>w</code> or <code>a</code>, is used to represent a fourth value. The <code>a</code> stands for &ldquo;alpha&rdquo;, since colors can have an alpha channel as well as the normal RGB values. I guess they chose <code>w</code> because it&rsquo;s before <code>x</code> in the alphabet, and they already reached the last letter ğŸ¤·.</p>
<p>The <code>uv</code> variable doesn&rsquo;t really represent an acronym for anything. It refers to the topic of <a href="https://en.wikipedia.org/wiki/UV_mapping" target="_blank">UV Mapping</a> that is commonly used to map pieces of a texture (such as an image) on 3D objects. The concept of UV mapping is more applicable to environments that give you access to a vertex shader unlike Shadertoy, but you can still leverage texture data in Shadertoy.</p>
<p>The <code>fragCoord</code> variable represents the XY coordinate of the canvas. The bottom-left corner starts at (0, 0) and the top-right corner is (iResolution.x, iResolution.y). By dividing <code>fragCoord</code> by <code>iResolution.xy</code>, we are able to normalize the pixel coordinates between zero and one.</p>
<p>Notice that we can perform arithmetic quite easily between two variables that are the same type, even if they are vectors. It&rsquo;s the same as performing operations on the individual components:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1">// The above is the same as:</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">x</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="p">.</span><span class="n">y</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span></span></span></code></pre></div><p>When we say something like <code>iResolution.xy</code>, the <code>.xy</code> portion refers to only the XY component of the vector. This lets us strip off only the components of the vector we care about even if <code>iResolution</code> happens to be of type <code>vec3</code>.</p>
<p>According to this <a href="https://stackoverflow.com/questions/27888323/what-does-iresolution-mean-in-a-shader" target="_blank">Stack Overflow post</a>, the z-component represents the pixel aspect ratio, which is usually <code>1.0</code>. A value of one means your display has square pixels. You typically won&rsquo;t see people using the z-component of <code>iResolution</code> that often, if at all.</p>
<p>We can also perform shortcuts when defining vectors. The following code snippet below will set the color of the entire canvas to black.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// Same as vec3(0, 0, 0)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-be294402170424e2fc78f02817f154b1" class="lightbox-link"><img src="./assets/shadertoy-5.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-be294402170424e2fc78f02817f154b1"><img src="./assets/shadertoy-5.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When we define a vector, the shader code is smart enough to apply the same value across all values of the vector if you only specify one value. Therefore <code>vec3(0)</code> gets expanded to <code>vec3(0,0,0)</code>.</p>
<blockquote>
<p>TIP</p>
<p>If you try to use values less than zero as the output fragment color, it will be clamped to zero. Likewise, any values greater than one will be clamped to one. This only applies to color values in the final fragment color.</p>
</blockquote>
<p>It&rsquo;s important to keep in mind that debugging in Shadertoy and in most shader environments, in general, is mostly visual. You don&rsquo;t have anything like <code>console.log</code> to come to your rescue. You have to use color to help you debug.</p>
<p>Let&rsquo;s try visualizing the pixel coordinates on the screen with the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// This is the same as vec3(uv.x, uv.y, 0)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We should end up with a canvas that is a mixture of black, red, green, and yellow.</p>
<p><a href="#R-image-59bf02a0891938730c94142d3a6937f3" class="lightbox-link"><img src="./assets/shadertoy-6.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-59bf02a0891938730c94142d3a6937f3"><img src="./assets/shadertoy-6.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This looks pretty, but how does it help us? The <code>uv</code> variable represents the normalized canvas coordinates between zero and one on both the x-axis and the y-axis. The bottom-left corner of the canvas has the coordinate (0, 0). The top-right corner of the canvas has the coordinate (1, 1).</p>
<p>Inside the <code>col</code> variable, we are setting it equal to <code>(uv.x, uv.y, 0)</code>, which means we shouldn&rsquo;t expect any blue color in the canvas. When <code>uv.x</code> and <code>uv.y</code> equal zero, then we get black. When they are both equal to one, then we get yellow because in computer graphics, yellow is a combination of red and green values. The top-left corner of the canvas is (0, 1), which would mean the <code>col</code> variable would be equal to (0, 1, 0) which is the color green. The bottom-right corner has the coordinate of (1, 0), which means <code>col</code> equals (1, 0, 0) which is the color red.</p>
<p>Let the colors guide you in your debugging process!</p>
<h4 id="conclusion">Conclusion</h4>
<p>Phew! I covered quite a lot about shaders and Shadertoy in this article. I hope you&rsquo;re still with me! When I was learning shaders for the first time, it was like entering a completely new realm of programming. It&rsquo;s completely different from what I&rsquo;m used to, but it&rsquo;s exciting and challenging! In the next series of posts, I&rsquo;ll discuss how we can create shapes on the canvas and make animations!</p>
<h4 id="resources">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/howto" target="_blank">ShaderToy Documentation</a></li>
<li><a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29" target="_blank">OpenGL Data Types</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API" target="_blank">MDN: WebGL</a></li>
<li><a href="https://thebookofshaders.com/appendix/04/" target="_blank">GLSL for JavaScript Developers</a></li>
</ul>
<h3 id="tutorial-part-2---circles-and-animation">Tutorial Part 2 - Circles and Animation</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/48-shadertoy-tutorial-part-2</p>
</blockquote>
<p>Greetings, friends! Today, we&rsquo;ll talk about how to draw and animate a circle in a pixel shader using <a href="http://shadertoy.com/" target="_blank">Shadertoy</a>.</p>
<h4 id="practice">Practice</h4>
<p>Before we draw our first 2D shape, let&rsquo;s practice a bit more with Shadertoy. Create a <a href="http://shadertoy.com/new" target="_blank">new</a> shader and replace the starting code with the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// start with black</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">.5</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// make the right half of the canvas white</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Since our shader is run in parallel across all pixels, we have to rely on <code>if</code> statements to draw pixels different colors depending on their location on the screen. Depending on your graphics card and the compiler being used for your shader code, it might be more performant to use built-in functions such as <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/step.xhtml" target="_blank">step</a>.</p>
<p>Let&rsquo;s look at the same example but use the <code>step</code> function instead:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// start with black</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">));</span> <span class="c1">// make the right half of the canvas white</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The left half of the canvas will be black and the right half of the canvas will be white.</p>
<p><a href="#R-image-f20833351f02a4c09bbbdb20fe06a3c0" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-7.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f20833351f02a4c09bbbdb20fe06a3c0"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-7.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/step.xhtml" target="_blank">step</a> function accepts two inputs: the edge of the step function, and a value used to generate the step function. If the second parameter in the function argument is greater than the first, then return a value of one. Otherwise, return a value of zero.</p>
<p>You can perform the step function across each component in a vector as well:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// start with black</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">uv</span><span class="p">),</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// perform step function across the x-component and y-component of uv</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Since the step function operates on both the X component and Y component of the canvas, you should see the canvas get split into four colors.</p>
<p><a href="#R-image-531f93314c854ad17e6be45119de9269" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-8.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-531f93314c854ad17e6be45119de9269"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-8.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="how-to-draw-circles">How to Draw Circles</h4>
<p>The <a href="https://www.wolframalpha.com/input/?i=equation&#43;of&#43;a&#43;circle" target="_blank">equation of a circle</a> is defined by the following:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>x^2 + y^2 = r^2

x = x-coordinate on graph
y = y-coordinate on graph
r = radius of circle</code></pre></div><p>We can re-arrange the variables to make the equation equal to zero:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>x^2 + y^2 - r^2 = 0</code></pre></div><p>To visualize this on a graph, you can use the <a href="https://www.desmos.com/calculator" target="_blank">Desmos calculator</a> to graph the following:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>x^2 + y^2 - 4 = 0</code></pre></div><p>If you copy the above snippet and paste it into the Desmos calculator, then you should see a graph of a circle with a radius of two. The center of the circle is located at the coordinate, (0, 0).</p>
<p><a href="#R-image-3bcff27b59546b5e7b4591ce6c60c2c6" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-9.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3bcff27b59546b5e7b4591ce6c60c2c6"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-9.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In Shadertoy, we can use the left-hand side (LHS) of this equation to make a circle. Let&rsquo;s create a function called <code>sdfCircle</code> that returns the color, white, for each pixel at an XY-coordinate such that the equation is greater than zero and the color, blue, otherwise.</p>
<p>The <code>sdf</code> part of the function refers to a concept called <a href="https://en.wikipedia.org/wiki/Signed_distance_function" target="_blank">signed distance functions (SDF)</a>, aka signed distance fields. It&rsquo;s more common to use SDFs when drawing in 3D, but I will use this term for 2D shapes as well.</p>
<p>We will call our new function in the <code>mainImage</code> function to use it.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">);</span> <span class="c1">// Call this function on each pixel to check if the coordinate lies inside or outside of the circle</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If you&rsquo;re wondering why I use <code>0.</code> instead of simply <code>0</code> without a decimal, it&rsquo;s because adding a decimal at the end of an integer will make it make it have a type of <code>float</code> instead of <code>int</code>. When you&rsquo;re using functions that require numbers that are of type <code>float</code>, placing a decimal at the end of an integer is the easiest way to satisfy the compiler.</p>
<p>We&rsquo;re using a radius of <code>0.2</code> because our coordinate system is set up to only have UV values that are between zero and one. When you run the code, you&rsquo;ll notice that something appears wrong.</p>
<p><a href="#R-image-09bce0786ea76de4f93c3387ccdec70f" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-10.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-09bce0786ea76de4f93c3387ccdec70f"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-10.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>There seems to be a quarter of a blue dot in the bottom-left corner of the canvas. Why? Because our coordinate system is currently setup such that the origin is at the bottom-left corner. We need to shift every value by <code>0.5</code> to get the origin of the coordinate system at the center of the canvas.</p>
<p>Subtract <code>0.5</code> from the UV coordinates:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5, 0.5&gt;</span></span></span></code></pre></div><p>Now the range is between <code>-0.5</code> and <code>0.5</code> on both the x-axis and y-axis, which means the origin of the coordinate system is in the center of the canvas. However, we face another issue&hellip;</p>
<p><a href="#R-image-71e8545ba406672965bb2cec5f7db61f" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-11.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-71e8545ba406672965bb2cec5f7db61f"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-11.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Our circle appears a bit stretched, so it looks more like an ellipse. This is caused by the aspect ratio of the canvas. When the width and the height of the canvas don&rsquo;t match, the circle appears stretched. We can fix this issue by multiplying the X component of the UV coordinates by the aspect ratio of the canvas.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span></span></span></code></pre></div><p>This means the X component no longer goes between <code>-0.5</code> and <code>0.5</code>. It will go between values proportional to the aspect ratio of your canvas which will be determined by the width of your browser or webpage (if you&rsquo;re using something like Chrome DevTools to alter the width).</p>
<p>Your finished code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Once you run the code, you should see a perfectly proportional blue circle! ğŸ‰</p>
<blockquote>
<p>TIP</p>
<p>Please note that this is simply one way of coloring a circle. We will learn an alternative approach in <a href="https://inspirnathan.com/posts/50-shadertoy-tutorial-part-4" target="_blank">Part 4</a> of this tutorial series. It will help us draw multiple shapes to the canvas.</p>
</blockquote>
<p><a href="#R-image-14539e6eb0870fbf7bf125727d8aaecb" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-12.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-14539e6eb0870fbf7bf125727d8aaecb"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-12.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We can have some fun with this! We can use the global <code>iTime</code> variable to change colors over time. By using a cosine (cos) function, we can cycle through the same set of colors over and over. Since cosine functions oscillate between the values <code>-1</code> and <code>1</code>, we need to adjust this range to values between zero and one.</p>
<p>Remember, any color values in the final fragment color that are less than zero will automatically be clamped to zero. Likewise, any color values greater than one will be clamped to one. By adjusting the range, we get a wider range of colors.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="o">:</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span> <span class="o">+</span> <span class="n">uv</span><span class="p">.</span><span class="n">xyx</span> <span class="o">+</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Once you run the code, you should see the circle change between various colors.</p>
<p><a href="#R-image-3ddbe8f07047b8a230521dda29785ec3" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-1.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3ddbe8f07047b8a230521dda29785ec3"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-1.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You might be confused by the syntax in <code>uv.xyx</code>. This is called <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Swizzling" target="_blank">Swizzling</a>. We can create new vectors using components of a variable. Let&rsquo;s look at an example.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">col</span><span class="p">.</span><span class="n">xyx</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span> <span class="n">col3</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span></span></span></code></pre></div><p>In the code snippet above, <code>col2</code> and <code>col3</code> are identical.</p>
<h4 id="moving-the-circle">Moving the Circle</h4>
<p>To move the circle, we need to apply an offset to the XY coordinates inside the equation for a circle. Therefore, our equation will look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">offsetX</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">offsetY</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r</span><span class="o">^</span><span class="mi">2</span> <span class="o">=</span> <span class="mo">0</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">coordinate</span> <span class="n">on</span> <span class="n">graph</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">coordinate</span> <span class="n">on</span> <span class="n">graph</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">radius</span> <span class="n">of</span> <span class="n">circle</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">offsetX</span> <span class="o">=</span> <span class="n">how</span> <span class="n">much</span> <span class="n">to</span> <span class="n">move</span> <span class="n">the</span> <span class="n">center</span> <span class="n">of</span> <span class="n">the</span> <span class="n">circle</span> <span class="k">in</span> <span class="n">the</span> <span class="n">x</span><span class="o">-</span><span class="n">axis</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">offsetY</span> <span class="o">=</span> <span class="n">how</span> <span class="n">much</span> <span class="n">to</span> <span class="n">move</span> <span class="n">the</span> <span class="n">center</span> <span class="n">of</span> <span class="n">the</span> <span class="n">circle</span> <span class="k">in</span> <span class="n">the</span> <span class="n">y</span><span class="o">-</span><span class="n">axis</span></span></span></code></pre></div><p>You can experiment in the <a href="https://www.desmos.com/calculator" target="_blank">Desmos calculator</a> again by copying and pasting the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>(x - 2)^2 + (y - 2)^2 - 4 = 0</code></pre></div><p><a href="#R-image-0f96c7fd8da83a85ec06f482e953634b" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-13.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0f96c7fd8da83a85ec06f482e953634b"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-13.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Inside Shadertoy, we can adjust our <code>sdfCircle</code> function to allow offsets and then move the center of the circle by <code>0.2</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span> <span class="c1">// move the circle 0.2 units to the right and 0.2 units up</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-844550d311a950be4a139ba6fa50eac9" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-14.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-844550d311a950be4a139ba6fa50eac9"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-14.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can again use the global <code>iTime</code> variable in certain places to give life to your canvas and animate your circle.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="o">*</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="o">*</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="mf">0.2</span><span class="p">);</span> <span class="c1">// move the circle clockwise</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The above code will move the circle along a circular path in the clockwise direction as if it&rsquo;s rotating about the origin. By multiplying <code>iTime</code> by a value, you can speed up the animation. By multiplying the output of the sine or cosine function by a value, you can control how far the circle moves from the center of the canvas. You&rsquo;ll use sine and cosine functions a lot with <code>iTime</code> because they create oscillation.</p>
<p><a href="#R-image-6e03615dc48106f237b307b0f0116327" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-2.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6e03615dc48106f237b307b0f0116327"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-2.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="conclusion-1">Conclusion</h4>
<p>In this lesson, we learned how to fix the coordinate system of the canvas, draw a circle, and animate the circle along a circular path. Circles, circles, circles! ğŸ”µ</p>
<p>In the next lesson, I&rsquo;ll show you how to draw a square to the screen. Then, we&rsquo;ll learn how to rotate it!</p>
<h3 id="tutorial-part-3---squares-and-rotation">Tutorial Part 3 - Squares and Rotation</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/49-shadertoy-tutorial-part-3</p>
</blockquote>
<p>Greetings, friends! In the previous article, we learned how to draw circles and animate them. In this tutorial, we will learn how to draw squares and rotate them using a rotation matrix.</p>
<h4 id="how-to-draw-squares">How to Draw Squares</h4>
<p>Drawing a square is very similar to drawing a circle except we will use a different equation. In fact, you can draw practically any 2D shape you want if you have an equation for it!</p>
<p>The equation of a square is defined by the following:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>max(abs(x),abs(y)) = r

x = x-coordinate on graph
y = y-coordinate on graph
r = radius of square</code></pre></div><p>We can re-arrange the variables to make the equation equal to zero:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>max(abs(x), abs(y)) - r = 0</code></pre></div><p>To visualize this on a graph, you can use the <a href="https://www.desmos.com/calculator" target="_blank">Desmos calculator</a> to graph the following:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>max(abs(x), abs(y)) - 2 = 0</code></pre></div><p>If you copy the above snippet and paste it into the Desmos calculator, then you should see a graph of a square with a radius of two. The center of the square is located at the origin, (0, 0).</p>
<p><a href="#R-image-13033d4eab6ed909b0de98a522dc322e" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-15.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-13033d4eab6ed909b0de98a522dc322e"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-15.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can also include an offset:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>max(abs(x - offsetX), abs(y - offsetY)) - r = 0

offsetX = how much to move the center of the square in the x-axis
offsetY = how much to move the center of the square in the y-axis</code></pre></div><p><a href="#R-image-7bc5dd99f3e12ee727049d0833eaab6b" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-16.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7bc5dd99f3e12ee727049d0833eaab6b"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-16.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The steps for drawing a square using a pixel shader is very similar to the <a href="https://inspirnathan.com/posts/48-shadertoy-tutorial-part-2" target="_blank">previous tutorial</a> where we created a circle. Instead, we&rsquo;ll be creating a function specifically for a square.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Yay! Now we have a red square! ğŸŸ¥</p>
<p><a href="#R-image-f8a48548aeb6032876a29de357dbf0b0" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-17.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f8a48548aeb6032876a29de357dbf0b0"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-17.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="rotating-shapes">Rotating shapes</h4>
<p>You can rotate shapes by using a <a href="https://mathworld.wolfram.com/RotationMatrix.html" target="_blank">rotation matrix</a> given by the following notation:</p>
<p>$$
R=\begin{bmatrix}\cos\theta&amp;-\sin\theta\\sin\theta&amp;\cos\theta\end{bmatrix}
$$
Matrices can help us work with multiple <a href="https://en.wikipedia.org/wiki/Matrix_%28mathematics%29#Linear_equations" target="_blank">linear equations</a> and <a href="https://en.wikipedia.org/wiki/Matrix_%28mathematics%29#Linear_transformations" target="_blank">linear transformations</a>. In fact, a rotational matrix is a type of transformation matrix. We can use matrices to perform other transformations such as shearing, translation, or reflection.</p>
<blockquote>
<p>TIP</p>
<p>If you want to play around with matrix arithmetic, you can use either the <a href="https://www.desmos.com/matrix" target="_blank">Demos Matrix Calculator</a> or <a href="https://www.wolframalpha.com/" target="_blank">WolframAlpha</a>. If you need a refresher on matrices, you can watch this <a href="https://www.youtube.com/watch?v=l3S1gKQLm4s" target="_blank">amazing video</a> by Derek Banas on YouTube.</p>
</blockquote>
<p>We can use a graph I created on <a href="https://www.desmos.com/calculator/htynhlnbvs" target="_blank">Desmos</a> to help visualize rotations. I have created a set of parametric equations that use the rotation matrix in its linear equation form.</p>
<p><a href="#R-image-d352fb0329a8655e814a142e5577480a" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-19.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d352fb0329a8655e814a142e5577480a"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-19.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The linear equation form is obtained by multiplying the rotation matrix by the vector <code>[x,y]</code> as calculated by <a href="https://www.wolframalpha.com/input/?i=[[cos%28t%29%2C-sin%28t%29]%2C[sin%28t%29%2Ccos%28t%29]]&#43;*[x%2Cy]" target="_blank">WolframAlpha</a>. The result is an equation for the transformed x-coordinate and transformed y-coordinate after the rotation.</p>
<p>In Shadertoy, we only care about the rotation matrix, not the linear equation form. I only discuss the linear equation form for the purpose of showing rotations in Desmos.</p>
<p>We can create a <code>rotate</code> function in our shader code that accepts UV coordinates and an angle by which to rotate the square. It will return the rotation matrix multiplied by the UV coordinates. Then, we&rsquo;ll call the <code>rotate</code> function inside the <code>sdfSquare</code> function by passing in our XY coordinates, shifted by an offset (if it exists). We will use <code>iTime</code> as the angle, so that the square animates.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec2</span> <span class="n">rotate</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">th</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">))</span> <span class="o">*</span> <span class="n">uv</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec2</span> <span class="n">rotated</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">iTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">rotated</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">rotated</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Notice how we defined the matrix in Shadertoy. Let&rsquo;s inspect the <code>rotate</code> function more closely.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">rotate</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">th</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">))</span> <span class="o">*</span> <span class="n">uv</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>According to this <a href="https://en.wikibooks.org/wiki/GLSL_Programming/Vector_and_Matrix_Operations" target="_blank">wiki on GLSL</a>, we define a matrix by comma-separated values, but we go through the matrix column-first. Since this is a matrix of type <code>mat2</code>, it is a 2x2 matrix. The first two values represent the first column, and the last two values represent the second-column. In tools such as <a href="https://www.wolframalpha.com/input/?i=[[cos%28t%29%2C-sin%28t%29]%2C[sin%28t%29%2Ccos%28t%29]]&#43;*[x%2Cy]" target="_blank">WolframAlpha</a>, you insert values row-first instead and use square brackets to separate each row. Keep this in mind as you&rsquo;re experimenting with matrices.</p>
<p>Our <code>rotate</code> function returns a value that is of type <code>vec2</code> because a 2x2 matrix (<code>mat2</code>) multiplied by a <code>vec2</code> vector returns another <code>vec2</code> vector.</p>
<p>When we run the code, we should see the square rotate in the clockwise direction.</p>
<p><a href="#R-image-1170cd7d745d6490ece9610b9131fc4c" class="lightbox-link"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-3.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1170cd7d745d6490ece9610b9131fc4c"><img src="D:%5cGitee_repository%5cknowledage%5cNote%5cBlog_Backup%5cShadertoy_Tutorial%5cassets%5cshadertoy-3.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="conclusion-2">Conclusion</h4>
<p>In this lesson, we learned how to draw a square and rotate it using a transformation matrix. Using the knowledge you have gained from this tutorial and the previous one, you can draw any 2D shape you want using an equation or <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">SDF</a> for that shape!</p>
<p>In the next article, I&rsquo;ll discuss how to draw multiple shapes on the canvas while being able to change the background color as well.</p>
<h4 id="resources-1">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/3tGBWR" target="_blank">2D Rotation Example</a></li>
<li><a href="https://en.wikibooks.org/wiki/GLSL_Programming/Vector_and_Matrix_Operations" target="_blank">Vector and Matrix Operations in GLSL</a></li>
<li><a href="https://learnopengl.com/Getting-started/Transformations" target="_blank">Vector and Matrix Transformations</a></li>
<li><a href="https://www.youtube.com/watch?v=l3S1gKQLm4s" target="_blank">Matrix Arithmetic</a></li>
<li><a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">2D SDFs</a></li>
</ul>
<h3 id="tutorial-part-4---multiple-2d-shapes-and-mixing">Tutorial Part 4 - Multiple 2D Shapes and Mixing</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/50-shadertoy-tutorial-part-4</p>
</blockquote>
<p><a href="#R-image-9abab8f1ea57ac8be1fe123b6721eb2d" class="lightbox-link"><img src="./assets/shadertoy-20.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9abab8f1ea57ac8be1fe123b6721eb2d"><img src="./assets/shadertoy-20.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<blockquote>
<p>UPDATE</p>
<p>This article has been revamped as of May 3, 2021. I replaced most of the code snippets with a cleaner solution for drawing 2D shapes.</p>
</blockquote>
<p>Greetings, friends! In the past couple tutorials, we&rsquo;ve learned how to draw 2D shapes to the canvas using <a href="http://shadertoy.com/" target="_blank">Shadertoy</a>. In this article, I&rsquo;d like to discuss a better approach to drawing 2D shapes, so we can easily add multiple shapes to the canvas. We&rsquo;ll also learn how to change the background color independent from the shape colors.</p>
<h4 id="the-mix-function">The Mix Function</h4>
<p>Before we continue, let&rsquo;s take a look at the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml" target="_blank">mix</a> function. This function will be especially useful to us as we render multiple 2D shapes to the scene.</p>
<p>The <code>mix</code> function linearly interpolates between two values. In other shader languages such as <a href="https://inspirnathan.com/posts/%28https://en.wikipedia.org/wiki/High-Level_Shading_Language%29" target="_blank">HLSL</a>, this function is known as <a href="https://docs.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-lerp" target="_blank">lerp</a> instead.</p>
<p>Linear interpolation for the function, <code>mix(x, y, a)</code>, is based on the following formula:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>x * (1 - a) + y * a

x = first value
y = second value
a = value that linearly interpolates between x and y</code></pre></div><p>Think of the third parameter, <code>a</code>, as a slider that lets you choose values between <code>x</code> and <code>y</code>.</p>
<p>You will see the <code>mix</code> function used heavily in shaders. It&rsquo;s a great way to create color gradients. Let&rsquo;s look at an example:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">float</span> <span class="n">interpolatedValue</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">interpolatedValue</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>In the above code, we are using the <code>mix</code> function to get an interpolated value per pixel on the screen across the x-axis. By using the same value across the red, green, and blue channels, we get a gradient that goes from black to white, with shades of gray in between.</p>
<p><a href="#R-image-3b8db42622a29ada79aa41c18b33e183" class="lightbox-link"><img src="./assets/shadertoy-21.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3b8db42622a29ada79aa41c18b33e183"><img src="./assets/shadertoy-21.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We can also use the <code>mix</code> function along the y-axis:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">interpolatedValue</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-ec27ef990396db8ac766ba4077f5da22" class="lightbox-link"><img src="./assets/shadertoy-22.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ec27ef990396db8ac766ba4077f5da22"><img src="./assets/shadertoy-22.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Using this knowledge, we can create a colored gradient in our pixel shader. Let&rsquo;s define a function specifically for setting the background color of the canvas.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="n">uv</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This will produce a cool gradient that goes between shades of purple and cyan.</p>
<p><a href="#R-image-3467df24a8cd5383eacc17c1708b83cb" class="lightbox-link"><img src="./assets/shadertoy-23.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3467df24a8cd5383eacc17c1708b83cb"><img src="./assets/shadertoy-23.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When using the <code>mix</code> function on vectors, it will use the third parameter to interpolate each vector on a component basis. It will run through the interpolator function for the red component (or x-component) of the <code>gradientStartColor</code> vector and the red component of the <code>gradientEndColor</code> vector. The same tactic will be applied to the green (y-component) and blue (z-component) channels of each vector.</p>
<p>We added <code>0.5</code> to the value of <code>uv</code> because in most situations, we will be working with values of <code>uv</code> that range between a negative number and positive number. If we pass a negative value into the final <code>fragColor</code>, then it&rsquo;ll be clamped to zero. We shift the range away from negative values for the purpose of displaying color in the full range.</p>
<h4 id="an-alternative-way-to-draw-2d-shapes">An Alternative Way to Draw 2D Shapes</h4>
<p>In the previous tutorials, we learned how to use 2D SDFs to create 2D shapes such as circles and squares. However, the <code>sdfCircle</code> and <code>sdfSquare</code> functions were returning a color in the form of a <code>vec3</code> vector.</p>
<p>Typically, SDFs return a <code>float</code> and not <code>vec3</code> value. Remember, &ldquo;SDF&rdquo; is an acronym for &ldquo;signed distance fields.&rdquo; Therefore, we expect them to return a distance of type <code>float</code>. In 3D SDFs, this is usually true, but in 2D SDFs, I find it&rsquo;s more useful to return either a one or zero depending on whether the pixel is inside the shape or outside the shape as we&rsquo;ll see later.</p>
<p>The distance is relative to some point, typically the center of the shape. If a circle&rsquo;s center is at the origin, (0, 0), then we know that any point on the edge of the circle is equal to the radius of the circle, hence the equation:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>x^2 + y^2 = r^2

Or, when rearranged,
x^2 + y^2 - r^2 = 0

where x^2 + y^2 - r^2 = distance = d</code></pre></div><p>If the distance is greater than zero, then we know that we are outside the circle. If the distance is less than zero, then we are inside the circle. If the distance is equal to zero exactly, then we&rsquo;re on the edge of the circle. This is where the &ldquo;signed&rdquo; part of the &ldquo;signed distance field&rdquo; comes into play. The distance can be negative or positive depending on whether the pixel coordinate is inside or outside the shape.</p>
<p>In <a href="https://inspirnathan.com/posts/48-shadertoy-tutorial-part-2" target="_blank">Part 2</a> of this tutorial series, we drew a blue circle using the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">:</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">// draw background color if outside the shape</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// draw circle color if inside the shape</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The problem with this approach is that we&rsquo;re forced to draw a circle with the color, blue, and a background with the color, white.</p>
<p>We need to make the code a bit more abstract, so we can draw the background and shape colors independent of each other. This will allow us to draw multiple shapes to the scene and select any color we want for each shape and the background.</p>
<p>Let&rsquo;s look at an alternative way of drawing the blue circle:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">circle</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>In the code above, we are now abstracting out a few things. We have a <code>drawScene</code> function that will be responsible for rendering the scene, and the <code>sdfCircle</code> now returns a <code>float</code> that represents the &ldquo;signed distance&rdquo; between a pixel on the screen and a point on the circle.</p>
<p>We learned about the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/step.xhtml" target="_blank">step</a> function in <a href="https://inspirnathan.com/posts/48-shadertoy-tutorial-part-2/" target="_blank">Part 2</a>. It returns a value of one or zero depending on the value of the second parameter. In fact, the following are equivalent:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">result</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">circle</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">float</span> <span class="n">result</span> <span class="o">=</span> <span class="n">circle</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="o">?</span> <span class="mf">1.</span> <span class="o">:</span> <span class="mf">0.</span><span class="p">;</span></span></span></code></pre></div><p>If the &ldquo;signed distance&rdquo; value is greater than zero, then that means, the point is inside the circle. If the value is less than or equal to zero, then the point is outside or on the edge of the circle.</p>
<p>Inside the <code>drawScene</code> function, we are using the <code>mix</code> function to blend the white background color with the color, blue. The value of <code>circle</code> will determine if the pixel is white (the background) or blue (the circle). In this sense, we can use the <code>mix</code> function as a &ldquo;toggle&rdquo; that will switch between the shape color or background color depending on the value of the third parameter.</p>
<p><a href="#R-image-483718335d4d2bd0fe22556aac81479b" class="lightbox-link"><img src="./assets/shadertoy-24.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-483718335d4d2bd0fe22556aac81479b"><img src="./assets/shadertoy-24.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Using an SDF in this way basically lets us draw the shape only if the pixel is at a coordinate that lies within the shape. Otherwise, it should draw the color that was there before.</p>
<p>Let&rsquo;s add a square that is offset from the center a bit.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>  
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">float</span> <span class="n">square</span> <span class="o">=</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">circle</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">square</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Using the <code>mix</code> function with this approach lets us easily render multiple 2D shapes to the scene!</p>
<p><a href="#R-image-90abfbcf80c6a39c33d2e507b2c837d5" class="lightbox-link"><img src="./assets/shadertoy-25.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-90abfbcf80c6a39c33d2e507b2c837d5"><img src="./assets/shadertoy-25.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="custom-background-and-multiple-2d-shapes">Custom Background and Multiple 2D Shapes</h4>
<p>With the knowledge we&rsquo;ve learned, we can easily customize our background while leaving the color of our shapes intact. Let&rsquo;s add a function that returns a gradient color for the background and use it at the top of the <code>drawScene</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="n">uv</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0,1&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">float</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">float</span> <span class="n">square</span> <span class="o">=</span> <span class="n">sdfSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">circle</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">square</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Simply stunning! ğŸ¤©</p>
<p><a href="#R-image-07a37f4a7c55857efed65f186b14540f" class="lightbox-link"><img src="./assets/shadertoy-26.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-07a37f4a7c55857efed65f186b14540f"><img src="./assets/shadertoy-26.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Would this piece of abstract digital art make a lot of money as a <a href="https://en.wikipedia.org/wiki/Non-fungible_token" target="_blank">non-fungible token</a> ğŸ¤”. Probably not, but one can hope ğŸ˜….</p>
<h4 id="conclusion-3">Conclusion</h4>
<p>In this lesson, we created a beautiful piece of digital art. We learned how to use the <code>mix</code> function to create a color gradient and how to use it to render shapes on top of each other or on top of a background layer. In the next lesson, I&rsquo;ll talk about other 2D shapes we can draw such as hearts and stars.</p>
<h4 id="resources-2">Resources</h4>
<ul>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml" target="_blank">Mix Function</a></li>
<li><a href="https://www.shadertoy.com/view/sdX3zN" target="_blank">Multiple 2D Shapes Example</a></li>
</ul>
<h3 id="tutorial-part-5---2d-sdf-operations-and-more-2d-shapes">Tutorial Part 5 - 2D SDF Operations and More 2D Shapes</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/51-shadertoy-tutorial-part-5</p>
<p>UPDATE</p>
<p>This article has been heavily revamped as of May 3, 2021. I added a new section on 2D SDF operations, replaced all the code snippets with a cleaner solution for drawing 2D shapes, and added a section on Quadratic BÃ©zier curves. Enjoy!</p>
</blockquote>
<p>Greetings, friends! In this tutorial, I&rsquo;ll discuss how to use 2D SDF operations to create more complex shapes from primitive shapes, and I&rsquo;ll discuss how to draw more primitive 2D shapes, including hearts and stars. I&rsquo;ll help you utilize <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">this list</a> of 2D SDFs that was popularized by the talented <a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a>, one of the co-creators of <a href="http://shadertoy.com/" target="_blank">Shadertoy</a>. Let&rsquo;s begin!</p>
<h4 id="combination-2d-sdf-operations">Combination 2D SDF Operations</h4>
<p>In the previous tutorials, we&rsquo;ve seen how to draw primitive 2D shapes such as circles and squares, but we can use 2D SDF operations to create more complex shapes by combining primitive shapes together.</p>
<p>Let&rsquo;s start with some simple boilerplate code for 2D shapes:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0.25,0.75&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">sdSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">d1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Please note how I&rsquo;m now using <code>sdCircle</code> for the function name instead of <code>sdfCircle</code> (which was used in previous tutorials). Inigo Quilez&rsquo;s website commonly uses <code>sd</code> in front of the shape name, but I was using <code>sdf</code> to help make it clear that these are signed distance fields (SDF).</p>
<p>When you run the code, you should see a red circle with a gradient background color, similar to what we learned in the <a href="https://inspirnathan.com/posts/50-shadertoy-tutorial-part-4" target="_blank">previous tutorial</a>.</p>
<p><a href="#R-image-2a20db32035060b74afb921f5dc80b5d" class="lightbox-link"><img src="./assets/shadertoy-27.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2a20db32035060b74afb921f5dc80b5d"><img src="./assets/shadertoy-27.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Pay attention to where we use the <code>mix</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span></span></span></code></pre></div><p>This line says to take the result and either pick the color red or the value of <code>col</code> (currently the background color) depending on the value of <code>res</code> (the result).</p>
<p>Now, let&rsquo;s discuss the various SDF operations that can be performed. We will look at the interaction between a circle and a square.</p>
<p>Union: combine two shapes together.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span> <span class="c1">// union</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-62f1e35957f613a31957e0481ad90943" class="lightbox-link"><img src="./assets/shadertoy-28.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-62f1e35957f613a31957e0481ad90943"><img src="./assets/shadertoy-28.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Intersection: take only the part where the two shapes intersect.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span> <span class="c1">// intersection</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-183af9f3e9ba73e6ec8f9d2677def74c" class="lightbox-link"><img src="./assets/shadertoy-29.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-183af9f3e9ba73e6ec8f9d2677def74c"><img src="./assets/shadertoy-29.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Subtraction: subtract d1 from d2.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span> <span class="c1">// subtraction - subtract d1 from d2</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-f0ab0a3823d06c5c123e23bb3763f440" class="lightbox-link"><img src="./assets/shadertoy-30.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f0ab0a3823d06c5c123e23bb3763f440"><img src="./assets/shadertoy-30.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Subtraction: subtract d2 from d1.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">);</span> <span class="c1">// subtraction - subtract d2 from d1</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-dab855d4a6a0feea3cfd5035934532c8" class="lightbox-link"><img src="./assets/shadertoy-31.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dab855d4a6a0feea3cfd5035934532c8"><img src="./assets/shadertoy-31.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>XOR: an exclusive &ldquo;OR&rdquo; operation will take the parts of the two shapes that do not intersect with each other.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">),</span> <span class="o">-</span><span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">));</span> <span class="c1">// xor</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-8445d67ad3ec414e905c88efbb186089" class="lightbox-link"><img src="./assets/shadertoy-32.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8445d67ad3ec414e905c88efbb186089"><img src="./assets/shadertoy-32.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We can also create &ldquo;smooth&rdquo; 2D SDF operations that smoothly blend the edges around where the shapes meet. You&rsquo;ll find these operations to be more applicable when I discuss 3D shapes, but they work in 2D too!</p>
<p>Add the following functions to the top of your code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// smooth min</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">float</span> <span class="n">smin</span><span class="p">(</span><span class="k">float</span> <span class="n">a</span><span class="p">,</span> <span class="k">float</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// smooth max</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">smax</span><span class="p">(</span><span class="k">float</span> <span class="n">a</span><span class="p">,</span> <span class="k">float</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="o">-</span><span class="n">smin</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Smooth union: combine two shapes together, but smoothly blend the edges where they meet.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">smin</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span> <span class="c1">// smooth union</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-0773bd097fed6391a10a36757511e94c" class="lightbox-link"><img src="./assets/shadertoy-33.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0773bd097fed6391a10a36757511e94c"><img src="./assets/shadertoy-33.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Smooth intersection: take only the two parts where the two shapes intersect, but smoothly blend the edges where they meet.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">smax</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span> <span class="c1">// smooth intersection</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-3b0f8e5eb215d3878c6dd841bfc2373d" class="lightbox-link"><img src="./assets/shadertoy-34.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3b0f8e5eb215d3878c6dd841bfc2373d"><img src="./assets/shadertoy-34.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code below. Uncomment out the lines for any of the combination 2D SDF operations you want to see.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// smooth min</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">float</span> <span class="n">smin</span><span class="p">(</span><span class="k">float</span> <span class="n">a</span><span class="p">,</span> <span class="k">float</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// smooth max</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">smax</span><span class="p">(</span><span class="k">float</span> <span class="n">a</span><span class="p">,</span> <span class="k">float</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="o">-</span><span class="n">smin</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0.25,0.75&gt;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">float</span> <span class="n">sdCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">float</span> <span class="n">sdSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">d1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="c1">//res = d2;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="c1">//res = min(d1, d2); // union</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="c1">//res = max(d1, d2); // intersection</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="c1">//res = max(-d1, d2); // subtraction - subtract d1 from d2</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="c1">//res = max(d1, -d2); // subtraction - subtract d2 from d1</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="c1">//res = max(min(d1, d2), -max(d1, d2)); // xor</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="c1">//res = smin(d1, d2, 0.05); // smooth union</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="c1">//res = smax(d1, d2, 0.05); // smooth intersection</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// Same as res &gt; 0. ? 1. : 0.;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="positional-2d-sdf-operations">Positional 2D SDF Operations</h4>
<p><a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s 3D SDFs page</a> describes a set of positional 3D SDF operations, but we can use these operations in 2D as well. I discuss 3D SDF operations later in <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a>. In this tutorial, I&rsquo;ll go over positional 2D SDF operations that can help save us time and increase performance when drawing 2D shapes.</p>
<p>If you&rsquo;re drawing a symmetrical scene, then it may be useful to use the <code>opSymX</code> operation. This operation will create a duplicate 2D shape along the x-axis using the SDF you provide. If we draw a circle at an offset of vec2(0.2, 0), then an equivalent circle will be drawn at vec2(-0.2, 0).</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSymX</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opSymX</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-f5adf8892f04dcbe80806f893a1b4af4" class="lightbox-link"><img src="./assets/shadertoy-35.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f5adf8892f04dcbe80806f893a1b4af4"><img src="./assets/shadertoy-35.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We can also perform a similar operation along the y-axis. Using the <code>opSymY</code> operation, if we draw a circle at an offset of vec2(0, 0.2), then an equivalent circle will be drawn at vec2(0, -0.2).</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSymY</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opSymY</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-d66bf0f6ce968964563f677bbaef08ea" class="lightbox-link"><img src="./assets/shadertoy-36.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d66bf0f6ce968964563f677bbaef08ea"><img src="./assets/shadertoy-36.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you want to draw circles along two axes instead of just one, then you can use the <code>opSymXY</code> operation. This will create a duplicate along both the x-axis and y-axis, resulting in four circles. If we draw a circle with an offset of vec2(0.2, 0), then a circle will be drawn at vec2(0.2, 0.2), vec2(0.2, -0.2), vec2(-0.2, -0.2), and vec2(-0.2, 0.2).</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSymXY</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opSymXY</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-bd42642f8c71d2ccdd647c11450e8d43" class="lightbox-link"><img src="./assets/shadertoy-37.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd42642f8c71d2ccdd647c11450e8d43"><img src="./assets/shadertoy-37.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Sometimes, you may want to create an infinite number of 2D objects across one or more axes. You can use the <code>opRep</code> operation to repeat circles along the axes of your choice. The parameter, <code>c</code>, is a vector used to control the spacing between the 2D objects along each axis.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opRep</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-65699f059f100b87f192f3af8adacdcc" class="lightbox-link"><img src="./assets/shadertoy-38.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-65699f059f100b87f192f3af8adacdcc"><img src="./assets/shadertoy-38.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you want to repeat the 2D objects only a certain number of times instead of an infinite amount, you can use the <code>opRepLim</code> operation. The parameter, <code>c</code>, is now a float value and still controls the spacing between each repeated 2D object. The parameter, <code>l</code>, is a vector that lets you control how many times the shape should be repeated along a given axis. For example, a value of <code>vec2(2, 2)</code> would draw an extra circle along the positive and negative x-axis and y-axis.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opRepLim</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">float</span> <span class="n">c</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">l</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">clamp</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opRepLim</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-070bbdbe703e26328bb1508f494cdbf7" class="lightbox-link"><img src="./assets/shadertoy-39.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-070bbdbe703e26328bb1508f494cdbf7"><img src="./assets/shadertoy-39.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can also perform deformations or distortions to an SDF by manipulating the value of <code>p</code>, the <code>uv</code> coordinate, and adding it to the value returned from an SDF. Inside the <code>opDisplace</code> operation, you can create any type of mathematical operation you want to displace the value of <code>p</code> and then add that result to the original value you get back from an SDF.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opDisplace</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// scaling factor</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">);</span> <span class="c1">// Some arbitrary values I played around with</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opDisplace</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span> <span class="c1">// Kinda looks like an egg</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-96229d437537f78fac0f944431689af2" class="lightbox-link"><img src="./assets/shadertoy-40.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-96229d437537f78fac0f944431689af2"><img src="./assets/shadertoy-40.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code below. Uncomment out the lines for any of the positional 2D SDF operations you want to see.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0.25,0.75&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">opSymX</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">float</span> <span class="n">opSymY</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="k">float</span> <span class="n">opSymXY</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="k">float</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="k">vec2</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="k">float</span> <span class="n">opRepLim</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">float</span> <span class="n">c</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">l</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec2</span> <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">clamp</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">return</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="k">float</span> <span class="n">opDisplace</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// scaling factor</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">);</span> <span class="c1">// Some arbitrary values I played around with</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opSymX</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="c1">//res = opSymY(uv, 0.1);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="c1">//res = opSymXY(uv, 0.1);</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="c1">//res = opRep(uv, 0.05, vec2(0.2, 0.2));</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="c1">//res = opRepLim(uv, 0.05, 0.15, vec2(2, 2));</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="c1">//res = opDisplace(uv, 0.1);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl">
</span></span><span class="line"><span class="ln">77</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">
</span></span><span class="line"><span class="ln">79</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">80</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="anti-aliasing">Anti-aliasing</h4>
<p>If you want to add any <a href="https://en.wikipedia.org/wiki/Spatial_anti-aliasing" target="_blank">anti-aliasing</a>, then you can use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/smoothstep.xhtml" target="_blank">smoothstep</a> function to smooth out the edges of your shapes. The <code>smoothstep(edge0, edge1, x)</code> function accepts three parameters and performs a <a href="https://en.wikipedia.org/wiki/Hermite_interpolation" target="_blank">Hermite interpolation</a> between zero and one when <code>edge0 &lt; x &lt; edge1 </code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">edge0</span><span class="o">:</span> <span class="n">Specifies</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">lower</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Hermite</span> <span class="n">function</span><span class="p">.</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">edge1</span><span class="o">:</span> <span class="n">Specifies</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">upper</span> <span class="n">edge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Hermite</span> <span class="n">function</span><span class="p">.</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">x</span><span class="o">:</span> <span class="n">Specifies</span> <span class="n">the</span> <span class="n">source</span> <span class="n">value</span> <span class="k">for</span> <span class="n">interpolation</span><span class="p">.</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">edge0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">edge1</span> <span class="o">-</span> <span class="n">edge0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">t</span><span class="p">);</span></span></span></code></pre></div><blockquote>
<p>TIP</p>
<p>The <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/smoothstep.xhtml" target="_blank">docs</a> will say if <code>edge0</code> is greater than or equal to <code>edge1</code>, then the <code>smoothstep</code> function will return a value of <code>undefined</code>. However, this is <a href="https://stackoverflow.com/questions/57631669/what-is-the-case-for-edge0-greater-than-or-equal-to-edge1-for-smoothstep-functio" target="_blank">incorrect</a>. The result of the <code>smoothstep</code> function is still determined by the Hermite interpolation function even if <code>edge0</code> is greater than <code>edge1</code>.</p>
</blockquote>
<p>If you&rsquo;re still confused, this page from <a href="https://thebookofshaders.com/glossary/?search=smoothstep" target="_blank">The Book of Shaders</a> may help you visualize the <code>smoothstep</code> function. Essentially, it behaves like the <code>step</code> function with a few extra steps (no pun intended) ğŸ˜‚.</p>
<p>Let&rsquo;s replace the <code>step</code> function with the <code>smoothstep</code> function to see how the result between a union of a circle and square behaves.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0.25,0.75&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">sdSquare</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSquare</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span> <span class="c1">// union</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// antialias entire result</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We end up with a shape that is slightly blurred around the edges.</p>
<p><a href="#R-image-6e1241bcb55cb8592c87fc9217262179" class="lightbox-link"><img src="./assets/shadertoy-41.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6e1241bcb55cb8592c87fc9217262179"><img src="./assets/shadertoy-41.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The <code>smoothstep</code> function helps us create smooth transitions between colors, useful for implementing anti-aliasing. You may also see people use <code>smoothstep</code> to create emissive objects or neon glow effects. It is used very often in shaders.</p>
<h4 id="drawing-a-heart-">Drawing a Heart â¤ï¸</h4>
<p>In this section, I&rsquo;ll teach you how to draw a heart using Shadertoy. Keep in mind that there are multiple styles of hearts. I&rsquo;ll show you how to create just one particular style of heart using an equation from <a href="https://mathworld.wolfram.com/HeartCurve.html" target="_blank">Wolfram MathWorld</a>.</p>
<p><a href="#R-image-66d045a9622eb5cc80a9ad085c3089c6" class="lightbox-link"><img src="./assets/shadertoy-42.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-66d045a9622eb5cc80a9ad085c3089c6"><img src="./assets/shadertoy-42.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If we want to apply an offset to this heart curve, then we need to subtract it from the x-component and y-component before applying any sort of operation (such as exponentiation) on them.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>s = x - offsetX
t = y - offsetY

(s^2 + t^2 - 1)^3 - s^2 * t^3 = 0

x = x-coordinate on graph
y = y-coordinate on graph</code></pre></div><p>You can play around with offsets on a heart curve using the graph I created on <a href="https://www.desmos.com/calculator/1ihio0t4bb" target="_blank">Desmos</a>.</p>
<p>Now, how do we create an SDF for a heart in Shadertoy? We simply set the left-hand side (LHS) of the equation equal to the distance, <code>d</code>. Then, it&rsquo;s the same process as we learned in <a href="https://inspirnathan.com/posts/50-shadertoy-tutorial-part-4" target="_blank">Part 4</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdHeart</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">yyy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">group</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">group</span> <span class="o">*</span> <span class="n">group</span> <span class="o">*</span> <span class="n">group</span> <span class="o">-</span> <span class="n">xx</span> <span class="o">*</span> <span class="n">yyy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">float</span> <span class="n">heart</span> <span class="o">=</span> <span class="n">sdHeart</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">heart</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-f7e13e42c3705e793b7c2875b0fb39de" class="lightbox-link"><img src="./assets/shadertoy-43.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f7e13e42c3705e793b7c2875b0fb39de"><img src="./assets/shadertoy-43.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="understanding-the-pow-function">Understanding the pow Function</h4>
<p>You may be wondering why I created the <code>sdHeart</code> function in such a weird manner. Why not use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/pow.xhtml" target="_blank">pow</a> function that is available to us? The <code>pow(x,y)</code> function takes in a value, <code>x</code>, and raises it to the power of <code>y</code>.</p>
<p>If you tried using the <code>pow</code> function, you&rsquo;ll see right away how odd the heart behaves.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdHeart</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">group</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span> <span class="o">+</span> <span class="n">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mf">3.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-92b91b18f90b37724d0ce3b07316b1de" class="lightbox-link"><img src="./assets/shadertoy-44.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-92b91b18f90b37724d0ce3b07316b1de"><img src="./assets/shadertoy-44.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Well, that doesn&rsquo;t look right ğŸ¤”. If you sent that to someone on Valentine&rsquo;s Day, they might think it&rsquo;s an <a href="https://en.wikipedia.org/wiki/Rorschach_test" target="_blank">inkblot test</a>.</p>
<p>So why does the <code>pow(x,y)</code> function behave so strangely? If you look closer at the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/pow.xhtml" target="_blank">documentation</a> for this function, then you&rsquo;ll see that this function returns <code>undefined</code> if <code>x</code> is less than zero or if both <code>x</code> equals zero and <code>y</code> is less than or equal to zero.</p>
<p>Keep in mind that the implementation of the <code>pow</code> function varies by compiler and hardware, so you may not encounter this issue when developing shaders for other platforms outside Shadertoy, or you may experience different issues.</p>
<p>Because our coordinate system is set up to have negative values for <code>x</code> and <code>y</code>, we sometimes get <code>undefined</code> as a result of the <code>pow</code> function. In Shadertoy, the compiler will use <code>undefined</code> in mathematical operations which will then lead to confusing results.</p>
<p>We can experiment with how <code>undefined</code> behaves with different arithmetic operations by debugging the canvas using color. Let&rsquo;s try adding a number to <code>undefined</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1">// Screen is gray which means undefined is treated as zero</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s try subtracting a number from <code>undefined</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">-=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1">// Screen is gray which means undefined is treated as zero</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s try multiplying a number by <code>undefined</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">*=</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1">// Screen is black which means undefined is treated as zero</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s try dividing <code>undefined</code> by a number:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">/=</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1">// Screen is black which means undefined is treated as zero</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>From the observations we&rsquo;ve gathered, we can conclude that <code>undefined</code> is treated as a value of zero when used in arithmetic operations. However, this could still vary by compiler and graphics hardware. Therefore, you need to be careful how you use the <code>pow</code> function in your shader code.</p>
<p>If you want to square a value, a common trick is to use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/dot.xhtml" target="_blank">dot</a> function to compute the dot product between a vector and itself. This lets us rewrite the <code>sdHeart</code> function to be a bit cleaner:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdHeart</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">size</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">group</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">group</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Calling <code>dot(x,x)</code> is the same as squaring the value of <code>x</code>, but you don&rsquo;t have to deal with the hassles of the <code>pow</code> function.</p>
<h4 id="using-the-sdstar5-sdf">Using the sdStar5 SDF</h4>
<p><a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a> has created many 2D SDFs and 3D SDFs that developers across Shadertoy utilize. In this section, I&rsquo;ll discuss how we can use his <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">2D SDF list</a> together with techniques we learned in <a href="https://inspirnathan.com/posts/50-shadertoy-tutorial-part-4" target="_blank">Part 4</a> of my Shadertoy series to draw 2D shapes.</p>
<p>When creating shapes using SDFs, they are commonly referred to as &ldquo;primitives&rdquo; because they form the building blocks for creating more abstract shapes. For 2D, it&rsquo;s pretty simple to draw shapes on the canvas, but it&rsquo;ll become more complex when we discuss 3D shapes.</p>
<p>Let&rsquo;s practice with a star SDF because drawing stars is always fun. Navigate to Inigo Quilez&rsquo;s <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">website</a> and scroll down to the SDF called &ldquo;Star 5 - exact&rdquo;. It should have the following definition:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">rf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Don&rsquo;t worry about the <a href="https://www.khronos.org/opengl/wiki/Core_Language_%28GLSL%29#Parameters" target="_blank">in</a> qualifiers in the function. You can remove them if you want, since <code>in</code> is the default qualifier if none is specified.</p>
<p>Let&rsquo;s create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> Shadertoy shader with the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">rf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">star</span> <span class="o">=</span> <span class="n">sdStar5</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">star</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run this code, you should be able to see a bright yellow star! â­</p>
<p><a href="#R-image-b931e2ce505b539501d45c5b5df99df5" class="lightbox-link"><img src="./assets/shadertoy-45.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b931e2ce505b539501d45c5b5df99df5"><img src="./assets/shadertoy-45.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>One thing is missing though. We need to add an offset at the beginning of the <code>sdStar5</code> function by shifting the UV coordinates a bit. We can add a new parameter called <code>offset</code>, and we can subtract this offset from the vector, <code>p</code>, which represents the UV coordinates we passed into this function.</p>
<p>Our finished code should like this this:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">rf</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span> <span class="c1">// This will subtract offset.x from p.x and subtract offset.y from p.y</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">float</span> <span class="n">star</span> <span class="o">=</span> <span class="n">sdStar5</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span> <span class="c1">// Add an offset to shift the star&#39;s position</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">star</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="using-the-sdbox-sdf">Using the sdBox SDF</h4>
<p>It&rsquo;s quite common to draw boxes/rectangles, so we&rsquo;ll select the SDF titled &ldquo;Box - exact.&rdquo; It has the following definition:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll add an offset parameter to the function declaration.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, we should be able to render both the box and star without any issues:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">in</span> <span class="k">float</span> <span class="n">rf</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span> <span class="c1">// This will subtract offset.x from p.x and subtract offset.y from p.y</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">float</span> <span class="n">box</span> <span class="o">=</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">float</span> <span class="n">star</span> <span class="o">=</span> <span class="n">sdStar5</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">star</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">box</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-6c6cd02f3e2cf1cf4ed67fdd9673bcda" class="lightbox-link"><img src="./assets/shadertoy-46.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6c6cd02f3e2cf1cf4ed67fdd9673bcda"><img src="./assets/shadertoy-46.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>With only a few small tweaks, we can pick many 2D SDFs from Inigo Quilez&rsquo;s website and draw them to the canvas with an offset.</p>
<p>Note, however, that some of the SDFs require functions defined on his <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">3D SDF</a> page:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dot2</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">v</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">float</span> <span class="n">dot2</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec3</span> <span class="n">v</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">float</span> <span class="n">ndot</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">a</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="p">}</span></span></span></code></pre></div><h4 id="using-the-sdsegment-sdf">Using the sdSegment SDF</h4>
<p>Some of the 2D SDFs on Inigo Quilez&rsquo;s <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">website</a> are for segments or curves, so we may need to alter our approach slightly. Let&rsquo;s look at the SDF titled &ldquo;Segment - exact&rdquo;. It has the following definition:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdSegment</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">a</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s try using this SDF and see what happens.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSegment</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">a</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">sdSegment</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">segment</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run this code, we&rsquo;ll see a completely black canvas. Some SDFs require us to look at the code a bit more closely. Currently, the segment is too thin to see in our canvas. To give the segment some thickness, we can subtract a value from the returned distance.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSegment</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">a</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">sdSegment</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">segment</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">));</span> <span class="c1">// Subtract 0.02 from the returned &#34;signed distance&#34; value of the segment</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, we can see our segment appear! It starts at the coordinate, (0, 0), and ends at (0, 0.2). Play around with the input vectors, <code>a</code> and <code>b</code>, inside the call to the <code>sdSegment</code> function to move the segment around and stretch it different ways. You can replace <code>0.02</code> with another number if you want to make the segment thinner or wider.</p>
<p><a href="#R-image-755c457919acd2f1e244f40a6b89b0b1" class="lightbox-link"><img src="./assets/shadertoy-47.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-755c457919acd2f1e244f40a6b89b0b1"><img src="./assets/shadertoy-47.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can also use the <code>smoothstep</code> function to make the segment look blurry around the edges.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSegment</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">a</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">sdSegment</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">segment</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The segment now looks like it&rsquo;s glowing!</p>
<p><a href="#R-image-28a528322bc20a352b0f124fc2064322" class="lightbox-link"><img src="./assets/shadertoy-48.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-28a528322bc20a352b0f124fc2064322"><img src="./assets/shadertoy-48.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="using-the-sdbezier-sdf">Using the sdBezier SDF</h4>
<p>Inigo Quilez&rsquo;s <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">website</a> also has an SDF for <a href="https://en.wikipedia.org/wiki/B%c3%a9zier_curve" target="_blank">BÃ©zier curves</a>. More specifically, he has an SDF for a Quadratic BÃ©zier curve. Look for the SDF titled &ldquo;Quadratic Bezier - exact&rdquo;. It has the following definition:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdBezier</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">pos</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">A</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">B</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">C</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>    
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">vec2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">vec2</span> <span class="n">b</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">vec2</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">float</span> <span class="n">kk</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">float</span> <span class="n">kx</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">float</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">float</span> <span class="n">kz</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>      
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">float</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ky</span> <span class="o">-</span> <span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">float</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">kx</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="n">ky</span><span class="p">)</span> <span class="o">+</span> <span class="n">kz</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">q</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">p3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">vec2</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">float</span> <span class="n">v</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span> <span class="n">q</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">float</span> <span class="n">m</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">float</span> <span class="n">n</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="mf">1.732050808</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">vec3</span>  <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                   <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="c1">// the third root cannot be the closest</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="c1">// res = min(res,dot2(d+(c+b*t.z)*t.z));</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">res</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>That&rsquo;s quite a large function! Notice that this function uses a utility function, <code>dot2</code>. This is defined on his <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">3D SDF</a> page.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dot2</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">v</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span></span></span></code></pre></div><p>Quadratic BÃ©zier curves accept three control points. In 2D, each control point will be a <code>vec2</code> value with an x-component and y-component. You can play around with the control points using a graph I created on <a href="https://www.desmos.com/calculator/xdhowj4wkk" target="_blank">Desmos</a>.</p>
<p>Like the <code>sdSegment</code>, we will have to subtract a small value from the returned &ldquo;signed distance&rdquo; to see the curve properly. Let&rsquo;s see how to draw a Quadratic BÃ©zier curve using GLSL code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">dot2</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">v</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">float</span> <span class="n">sdBezier</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">pos</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">A</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">B</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">C</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>    
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">vec2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec2</span> <span class="n">b</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">vec2</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">float</span> <span class="n">kk</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">float</span> <span class="n">kx</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">float</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">float</span> <span class="n">kz</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>      
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">float</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ky</span> <span class="o">-</span> <span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">float</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">kx</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="n">ky</span><span class="p">)</span> <span class="o">+</span> <span class="n">kz</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">q</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">p3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">vec2</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">float</span> <span class="n">v</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span> <span class="n">q</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">float</span> <span class="n">m</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">float</span> <span class="n">n</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="mf">1.732050808</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">vec3</span>  <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                   <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="c1">// the third root cannot be the closest</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="c1">// res = min(res,dot2(d+(c+b*t.z)*t.z));</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">res</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">vec2</span> <span class="n">A</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">vec2</span> <span class="n">B</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="k">vec2</span> <span class="n">C</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="k">float</span> <span class="n">curve</span> <span class="o">=</span> <span class="n">sdBezier</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">curve</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl">    <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see the Quadratic BÃ©zier curve appear.</p>
<p><a href="#R-image-48833cbbb980d5d9588975e1ff19665d" class="lightbox-link"><img src="./assets/shadertoy-49.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-48833cbbb980d5d9588975e1ff19665d"><img src="./assets/shadertoy-49.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Try playing around with the control points! Remember! You can use my <a href="https://www.desmos.com/calculator/xdhowj4wkk" target="_blank">Desmos graph</a> to help!</p>
<p>You can use 2D operations together with BÃ©zier curves to create interesting effects. We can subtract two BÃ©zier curves from a circle to get some kind of tennis ball ğŸ¾. It&rsquo;s up to you to explore what all you can create with the tools presented to you!</p>
<p><a href="#R-image-aa9e6415fb2dfc842c4a1ddfb0b3aaa6" class="lightbox-link"><img src="./assets/shadertoy-50.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aa9e6415fb2dfc842c4a1ddfb0b3aaa6"><img src="./assets/shadertoy-50.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Below you can find the finished code used to make the tennis ball:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// remap uv from &lt;-0.5,0.5&gt; to &lt;0.25,0.75&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientStartColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">gradientEndColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span><span class="n">gradientStartColor</span><span class="p">,</span> <span class="n">gradientEndColor</span><span class="p">,</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// gradient goes from bottom to top</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">sdCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">dot2</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">v</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">float</span> <span class="n">sdBezier</span><span class="p">(</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">pos</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">A</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">B</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">C</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">{</span>    
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">vec2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">vec2</span> <span class="n">b</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">B</span> <span class="o">+</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">vec2</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">float</span> <span class="n">kk</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">float</span> <span class="n">kx</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">float</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">float</span> <span class="n">kz</span> <span class="o">=</span> <span class="n">kk</span> <span class="o">*</span> <span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>      
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">float</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ky</span> <span class="o">-</span> <span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">float</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">kx</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">kx</span><span class="o">*</span><span class="n">kx</span><span class="o">-</span><span class="mf">3.0</span><span class="o">*</span><span class="n">ky</span><span class="p">)</span> <span class="o">+</span> <span class="n">kz</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">q</span> <span class="o">+</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">p3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> 
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="k">vec2</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">pow</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="k">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">float</span> <span class="n">v</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span> <span class="n">q</span><span class="o">/</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">z</span><span class="o">*</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="k">float</span> <span class="n">m</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">float</span> <span class="n">n</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="mf">1.732050808</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">vec3</span>  <span class="n">t</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">z</span><span class="o">-</span><span class="n">kx</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">                   <span class="n">dot2</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="c1">// the third root cannot be the closest</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">        <span class="c1">// res = min(res,dot2(d+(c+b*t.z)*t.z));</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">res</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">getBackgroundColor</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">vec2</span> <span class="n">A</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="k">vec2</span> <span class="n">B</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="k">vec2</span> <span class="n">C</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdBezier</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="k">float</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">sdBezier</span><span class="p">(</span><span class="n">uv</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="k">float</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// result</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">);</span> <span class="c1">// subtraction - subtract d2 from d1</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="o">-</span><span class="n">d3</span><span class="p">);</span> <span class="c1">// subtraction - subtract d3 from the result</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span> <span class="c1">// antialias entire result</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">
</span></span><span class="line"><span class="ln">70</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mf">.8</span><span class="p">,</span><span class="mf">.9</span><span class="p">,</span><span class="mf">.2</span><span class="p">),</span> <span class="n">col</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">
</span></span><span class="line"><span class="ln">74</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl">
</span></span><span class="line"><span class="ln">80</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">
</span></span><span class="line"><span class="ln">82</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">83</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-4">Conclusion</h4>
<p>In this tutorial, we learned how to show more love to our shaders by drawing a heart â¤ï¸ and other shapes. We learned how to draw stars, segments, and Quadratic BÃ©zier curves. Of course, my technique for drawing shapes with 2D SDFs is just a personal preference. There are multiple ways we can draw 2D shapes to the canvas. We also learned how to combine primitive shapes together to create more complex shapes. In the next article, we&rsquo;ll begin learning how to draw 3D shapes and scenes using raymarching! ğŸ‰</p>
<h4 id="resources-3">Resources</h4>
<ul>
<li><a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">List of 2D SDFs</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/pow.xhtml" target="_blank">Khronos: pow</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/smoothstep.xhtml" target="_blank">Khronos: smoothstep</a></li>
<li><a href="https://stackoverflow.com/questions/12222746/why-does-glsls-arithmetic-functions-yield-so-different-results-on-the-ipad-than" target="_blank">Why does the pow function behave strangely?</a></li>
<li><a href="https://thebookofshaders.com/glossary/?search=smoothstep" target="_blank">Book of Shaders: Smoothstep</a></li>
<li><a href="https://stackoverflow.com/questions/57631669/what-is-the-case-for-edge0-greater-than-or-equal-to-edge1-for-smoothstep-functio" target="_blank">What happens when edge0 is greater than edge1?</a></li>
<li><a href="https://www.shadertoy.com/view/sdX3zN" target="_blank">Shadertoy: Multiple 2D Shapes Example</a></li>
</ul>
<h3 id="tutorial-part-6---3d-scenes-with-ray-marching">Tutorial Part 6 - 3D Scenes with Ray Marching</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/52-shadertoy-tutorial-part-6</p>
</blockquote>
<p>Greetings, friends! It&rsquo;s the moment you&rsquo;ve all been waiting for! In this tutorial, you&rsquo;ll take the first steps toward learning how to draw 3D scenes in Shadertoy using ray marching!</p>
<h4 id="introduction-to-rays">Introduction to Rays</h4>
<p>Have you ever <a href="https://www.shadertoy.com/browse" target="_blank">browsed</a> across Shadertoy, only to see amazing creations that leave you in awe? How do people create such amazing scenes with only a pixel shader and no 3D models? Is it magic? Do they have a PhD in mathematics or graphics design? Some of them might, but most of them don&rsquo;t!</p>
<p>Most of the 3D scenes you see on Shadertoy use some form of a <a href="https://en.wikipedia.org/wiki/Ray_tracing_%28graphics%29" target="_blank">ray tracing</a> or ray marching algorithm. These algorithms are commonly used in the realm of <a href="https://en.wikipedia.org/wiki/Computer_graphics_%28computer_science%29" target="_blank">computer graphics</a>. The first step toward creating a 3D scene in Shadertoy is understanding <a href="https://mathworld.wolfram.com/Ray.html" target="_blank">rays</a>.</p>
<p>Behold! The ray! ğŸ™Œ</p>
<p><a href="#R-image-b1b6a5b7d301fb43578b045f6d657243" class="lightbox-link"><img src="./assets/shadertoy-51.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b1b6a5b7d301fb43578b045f6d657243"><img src="./assets/shadertoy-51.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>That&rsquo;s it? It looks like a dot with an arrow pointing out it. Yep, indeed it is! The black dot represents the ray origin, and the red arrow represents that it&rsquo;s pointing in a direction. You&rsquo;ll be using rays a lot when creating 3D scenes, so it&rsquo;s best to understand how they work.</p>
<p>A ray consists of an origin and direction, but what do I mean by that?</p>
<p>A ray origin is simply the starting point of the ray. In 2D, we can create a variable in GLSL to represent an origin:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">rayOrigin</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span></span></span></code></pre></div><p>You may be confused if you&rsquo;ve taken some linear algebra or calculus courses. Why are we assigning a point as a vector? Don&rsquo;t all vectors have directions? Mathematically speaking, <a href="https://en.wikipedia.org/wiki/Euclidean_vector" target="_blank">vectors</a> have both a length and direction, but we&rsquo;re talking about a vector data type in this context.</p>
<p>In shader languages such as GLSL, we can use a <code>vec2</code> to store any two values we want in it as if it were an array (not to be confused with actual arrays in the GLSL language specification). In variables of type <code>vec3</code>, we can store three values. These values can represent a variety of things: color, coordinates, a circle radius, or whatever else you want. For a ray origin, we have chosen our values to represent an XY coordinate such as (0, 0).</p>
<p>A ray direction is a vector that is normalized such that it has a magnitude of one. In 2D, we can create a variable in GLSL to represent a direction:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">rayDirection</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span></span></span></code></pre></div><p>By setting the ray direction equal to <code>vec2(1, 0)</code>, we are saying that the ray is pointing one unit to the right.</p>
<p><a href="#R-image-2294dc7a7efa4b76f2b0d6b46d3b62c7" class="lightbox-link"><img src="./assets/shadertoy-52.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2294dc7a7efa4b76f2b0d6b46d3b62c7"><img src="./assets/shadertoy-52.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>2D vectors can have an x-component and y-component. Here&rsquo;s an example of a ray with a direction of <code>vec2(2, 2)</code> where the black line represents the ray. It&rsquo;s pointing diagonally up and to the right at a 45 degree angle from the origin. The red horizontal line represents the x-component of the ray, and the green vertical line represents the y-component. You can play around with vectors using a graph I created in <a href="https://www.desmos.com/calculator/mvdjc2mvp5" target="_blank">Desmos</a>.</p>
<p><a href="#R-image-27a41b5b4401773face26e21b0754627" class="lightbox-link"><img src="./assets/shadertoy-53.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-27a41b5b4401773face26e21b0754627"><img src="./assets/shadertoy-53.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This ray is not normalized though. If we find the magnitude of the ray direction, we&rsquo;ll discover that it&rsquo;s not equal to one. The magnitude can be calculated using the following equation for 2D vectors:</p>
<p><a href="#R-image-019aa86ad3e93a00b3c782559011133c" class="lightbox-link"><img src="./assets/shadertoy-54.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-019aa86ad3e93a00b3c782559011133c"><img src="./assets/shadertoy-54.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s calculate the magnitude (length) of the ray, <code>vec2(2,2)</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>length(vec2(2,2)) = sqrt(x^2 + y^2) = sqrt(2^2 + 2^2) = sqrt(4 + 4) = sqrt(8)</code></pre></div><p>The magnitude is equal to the square root of eight. This value is not equal to one, so we need to normalize it. In GLSL, we can normalize vectors using the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/normalize.xhtml" target="_blank">normalize</a> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">normalizedRayDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span></span></span></code></pre></div><p>Behind the scenes, the <code>normalize</code> function is dividing each component of the vector by the magnitude (length) of the vector.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Given</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">x</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.7071</span> <span class="p">(</span><span class="n">approximately</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">y</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.7071</span> <span class="p">(</span><span class="n">approximately</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">normalize</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.7071</span><span class="p">,</span> <span class="mf">0.7071</span><span class="p">)</span></span></span></code></pre></div><p>After normalization, it looks like we have the new vector, <code>vec2(0.7071, 0.7071)</code>. If we calculate the length of this vector, we&rsquo;ll discover that it equals one.</p>
<p>We use normalized vectors to represent directions as a convention. Some of the algorithms we&rsquo;ll be using only care about the direction and not the magnitude (or length) of a ray. We don&rsquo;t care how long the ray is.</p>
<p>If you&rsquo;ve taken any linear algebra courses, then you should know that you can use a linear combination of <a href="https://en.wikipedia.org/wiki/Basis_%28linear_algebra%29" target="_blank">basis vectors</a> to form any other vector. Likewise, we can multiply a normalized ray by some scalar value to make it longer, but it stays in the same direction.</p>
<h4 id="3d-euclidean-space">3D Euclidean Space</h4>
<p>Everything we&rsquo;ve been discussing about rays in 2D also applies to 3D. The magnitude or length of a ray in 3D is defined by the following equation.</p>
<p><a href="#R-image-bd7b3914d968e43e337e34f3abb4e5d8" class="lightbox-link"><img src="./assets/shadertoy-55.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd7b3914d968e43e337e34f3abb4e5d8"><img src="./assets/shadertoy-55.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In 3D Euclidean space (the typical 3D space you&rsquo;re probably used to dealing with in school), vectors are also a linear combination of basis vectors. You can use a combination of basis vectors or normalized vectors to form a new vector.</p>
<p><a href="#R-image-3668ecff1df69b4e028c3b1e2138cd47" class="lightbox-link"><img src="./assets/shadertoy-56.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3668ecff1df69b4e028c3b1e2138cd47"><img src="./assets/shadertoy-56.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>3D Vector Space by <a href="https://en.wikipedia.org/wiki/Standard_basis" target="_blank">Wikipedia</a></p>
<p>In the image above, there are three axes, representing the x-axis (blue), y-axis (red), and z-axis (green). The vectors, <code>i</code>, <code>j</code>, and <code>k</code>, represent fundamental basis (or unit) vectors that can be combined, shrunk, or stretched to create any new vector such as vector <code>a</code> that has an x-component, y-component, and z-component.</p>
<p>Keep in mind that the image above is just one portrayal of 3D coordinate space. We can rotate the coordinate system in any way we want. As long as the three axes stay perpendicular (or orthogonal) to each other, then we can still keep all the vector arithmetic the same.</p>
<p>In Shadertoy, it&rsquo;s very common for people to make a coordinate system where the x-axis is along the horizontal axis of the canvas, the y-axis is along the vertical axis of the canvas, and the z-axis is pointing toward you or away from you.</p>
<p><a href="#R-image-e0390c22e49770619d82a71090b75b42" class="lightbox-link"><img src="./assets/shadertoy-57.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e0390c22e49770619d82a71090b75b42"><img src="./assets/shadertoy-57.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Notice the colors I&rsquo;m using in the image above. The x-axis is colored red, the y-axis is colored green, and the z-axis is colored blue. This is intentional. As mentioned in <a href="https://inspirnathan.com/posts/47-shadertoy-tutorial-part-1" target="_blank">Part 1</a> of this tutorial series, each axis corresponds to a color component:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>vec3 someVariable = vec3(1, 2, 3);

someVariable.r == someVariable.x
someVariable.g == someVariable.y
someVariable.b == someVariable.z</code></pre></div><p>In the image above, the z-axis is considered positive when it&rsquo;s coming toward us and negative when it&rsquo;s going away from us. This convention uses the <a href="https://en.wikipedia.org/wiki/Right-hand_rule" target="_blank">right-hand rule</a>. Using your right hand, you point your thumb to the right, index finger straight up, and your middle finger toward you such that each of your three fingers are pointing in perpendicular directions like a coordinate system. Each finger is pointing in the positive direction.</p>
<p>You&rsquo;ll sometimes see this convention reversed along the z-axis when you&rsquo;re reading other peoples&rsquo; code or reading other tutorials online. They might make the z-axis positive when it&rsquo;s going away from you and negative when it&rsquo;s coming toward you, but the x-axis and y-axis remain unchanged. This is known as the left-hand rule.</p>
<h4 id="ray-algorithms">Ray Algorithms</h4>
<p>Let&rsquo;s finally talk about &ldquo;ray algorithms&rdquo; such as ray marching and ray tracing. Ray marching is the most common algorithm used to develop 3D scenes in Shadertoy, but you&rsquo;ll see people leverage ray tracing or path tracing as well.</p>
<p>Both ray marching and ray tracing are algorithms used to draw 3D scenes on a 2D screen using rays. In real life, light sources such as the sun casts light rays in the form of photons in tons of different directions. When a photon hits an object, the energy is absorbed by the object&rsquo;s crystal lattice of atoms, and another photon is released. Depending on the crystal structure of the material&rsquo;s atomic lattice, photons can be emitted in a random direction (diffuse reflection), or at the same angle it entered the material (specular or mirror-like reflection).</p>
<p>I could talk about physics all day, but what we care about is how this relates to ray marching and ray tracing. Well, if we tried modelling a 3D scene starting at a light source and tracing it back to the camera, then we&rsquo;d end up with a waste of computational resources. This &ldquo;forward&rdquo; simulation would lead to a ton of those rays never hitting our camera.</p>
<p>You&rsquo;ll mostly see &ldquo;backward&rdquo; simulations where rays are shot out of a camera or &ldquo;eye&rdquo; instead. We work backwards! Light usually comes from a light source such as the sun, bounces off a bunch of objects, and hits our camera. Instead, our camera will shoot out rays in lots of different directions. These rays will bounce off objects in our scene, including a surface such as a floor, and some of them will hit a light source. If a ray bounces off a surface and hits an object instead of the light source, then it&rsquo;s considered a &ldquo;shadow ray&rdquo; and tells us that we should draw a dark colored pixel to represent a shadow.</p>
<p><a href="#R-image-8fb09708f44c7bb0ad4b2bd69292c96b" class="lightbox-link"><img src="./assets/shadertoy-58.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8fb09708f44c7bb0ad4b2bd69292c96b"><img src="./assets/shadertoy-58.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Ray tracing diagram by <a href="https://en.wikipedia.org/wiki/Ray_tracing_%28graphics%29" target="_blank">Wikipedia</a></p>
<p>In the image above, a camera shoots out rays in different directions. How many rays? One for each pixel in our canvas! We use each pixel in the Shadertoy canvas to generate a ray. Clever, right? Each pixel has a coordinate along the x-axis and y-axis, so why not use them to create rays with a z-component?</p>
<p>How many different directions will there be? One for each pixel as well! This is why it&rsquo;s important to understand how rays work.</p>
<p>The ray origin for each ray fired from the camera will be the same as the position of our camera. Each ray will have a ray direction with an x-component, y-component, and z-component. Notice where the shadow rays originate from. The ray origin of the shadow rays will be equal to the point where the camera ray hit the surface. Every time the ray hits a surface, we can simulate a ray &ldquo;bounce&rdquo; or reflection by generating a new ray from that point. Keep this in mind later when we talk about illumination and shadows.</p>
<h4 id="difference-between-ray-algorithms">Difference between Ray Algorithms</h4>
<p>Let&rsquo;s discuss the difference between all the ray algorithms you might see out there online. These include <a href="https://en.wikipedia.org/wiki/Ray_casting" target="_blank">ray casting</a>, <a href="https://en.wikipedia.org/wiki/Ray_tracing_%28graphics%29" target="_blank">ray tracing</a>, ray marching, and <a href="https://en.wikipedia.org/wiki/Path_tracing" target="_blank">path tracing</a>.</p>
<p><strong>Ray Casting</strong>: A simpler form of ray tracing used in games like <a href="https://en.wikipedia.org/wiki/Wolfenstein_3D" target="_blank">Wolfenstein 3D</a> and <a href="https://en.wikipedia.org/wiki/Doom_%281993_video_game%29" target="_blank">Doom</a> that fires a single ray and stops when it hits a target.</p>
<p><strong>Ray Marching</strong>: A method of ray casting that uses signed distance fields (SDF) and commonly a sphere tracing algorithm that &ldquo;marches&rdquo; rays incrementally until it hits the closest object.</p>
<p><strong>Ray Tracing</strong>: A more sophisticated version of ray casting that fires off rays, calculates <a href="https://www.iquilezles.org/www/articles/intersectors/intersectors.htm" target="_blank">ray-surface intersections</a>, and recursively creates new rays upon each reflection.</p>
<p><strong>Path Tracing</strong>: A type of ray tracing algorithm that shoots out hundreds or thousands of rays per pixel instead of just one. The rays are shot in random directions using the <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method" target="_blank">Monte Carlo method</a>, and the final pixel color is determined from sampling the rays that make it to the light source.</p>
<p>If you ever see &ldquo;Monte Carlo&rdquo; anywhere, then that tells you right away you&rsquo;ll probably be dealing with math related to probability and statistics.</p>
<p>You may also hear ray marching sometimes called &ldquo;sphere tracing.&rdquo; There is a good discussion about the difference between ray marching and sphere tracing on the computer graphics <a href="https://computergraphics.stackexchange.com/questions/161/what-is-ray-marching-is-sphere-tracing-the-same-thing/163" target="_blank">Stack Exchange</a>. Basically, sphere tracing is one type of implementation of ray marching. Most of the ray marching techniques you see on Shadertoy will use sphere tracing, which is still a type of ray marching algorithm.</p>
<p>In case you&rsquo;re wondering about spelling, I commonly see people use &ldquo;raymarching&rdquo; or &ldquo;raytracing&rdquo; as one word. When you&rsquo;re googling for resources on these topics or using <code>Cmd+F</code> (or <code>Ctrl+F</code>) to search for any reference of ray marching or ray tracing, keep this in mind.</p>
<h4 id="ray-marching">Ray Marching</h4>
<p>For the rest of this article, I&rsquo;ll be discussing how to use the ray marching algorithm in Shadertoy. There are many excellent online tutorials that teach about ray marching such as this <a href="http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/" target="_blank">tutorial</a> by Jamie Wong. To help you visualize ray marching and why it&rsquo;s sometimes called sphere tracing, this <a href="https://www.shadertoy.com/view/4dSfRc" target="_blank">tutorial</a> on Shadertoy is a valuable resource.</p>
<p>I&rsquo;ll help break down the process of ray marching step by step, so you can start creating 3D scenes even with very little computer graphics experience.</p>
<p>We&rsquo;ll create a simple camera so we can simulate a 3D scene in the Shadertoy canvas. Let&rsquo;s imagine what our scene will look like first. We&rsquo;ll start with the most basic object: a sphere.</p>
<p><a href="#R-image-4b71b8bb58f53a29319c2b37127d0770" class="lightbox-link"><img src="./assets/shadertoy-59.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-4b71b8bb58f53a29319c2b37127d0770"><img src="./assets/shadertoy-59.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The image above shows a side view of the 3D scene we&rsquo;ll be creating in Shadertoy. The x-axis is not pictured because it is pointing toward the viewer. Our camera will be treated as a point with a coordinate such as (0, 0, 5) which means it is 5 units away from the canvas along the z-axis. Like previous tutorials, we&rsquo;ll remap the UV coordinates such that the origin is at the center of the canvas.</p>
<p><a href="#R-image-c2dbe2584935fd5eaca33dbab463084c" class="lightbox-link"><img src="./assets/shadertoy-60.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c2dbe2584935fd5eaca33dbab463084c"><img src="./assets/shadertoy-60.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The image above represents the canvas from our perspective with an x-axis (red) and y-axis (green). We&rsquo;ll be looking at the scene from the view of the camera. The ray shooting straight out of the camera through the origin of the canvas will hit our sphere. The diagonal ray fires from the camera at an angle and hits the ground (if it exists in the scene). If the ray doesn&rsquo;t hit anything, then we&rsquo;ll render a background color.</p>
<p>Now that we understand what we&rsquo;re going to build, let&rsquo;s start coding! Create a new <a href="https://www.shadertoy.com/new" target="_blank">Shadertoy</a> shader and replace the contents with the following to setup our canvas:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>To make our code cleaner, we can remap the UV coordinates in a single line instead of 3 lines. We&rsquo;re used to what this code does by now!</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// Condense 3 lines down to a single line!</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The ray origin, <code>ro</code> will be the position of our camera. We&rsquo;ll set it 5 units behind the &ldquo;canvas&rdquo; we&rsquo;re looking through.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span></span></span></code></pre></div><p>Next, we&rsquo;ll add a ray direction, <code>rd</code>, that will change based on the pixel coordinates. We&rsquo;ll set the z-component to <code>-1</code> so that each ray is fired toward our scene. We&rsquo;ll then normalize the entire vector.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span></span></span></code></pre></div><p>We&rsquo;ll then setup a variable that returns the distance from the ray marching algorithm:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span></span></span></code></pre></div><p>Let&rsquo;s create a function called <code>rayMarch</code> that implements the ray marching algorithm:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s examine the ray marching algorithm a bit more closely. We start with a depth of zero and increment the depth gradually. Our test point is equal to the ray origin (our camera position) plus the depth times the ray direction. Remember, the ray marching algorithm will run for each pixel, and each pixel will determine a different ray direction.</p>
<p>We take the test point, <code>p</code>, and pass it to the <code>sdSphere</code> function which we will define as:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span> <span class="c1">// p is the test point and r is the radius of the sphere</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll then increment the depth by the value of the distance returned by the <code>sdSphere</code> function. If the distance is within <code>0.001</code> units away from the sphere, then we consider this close enough to the sphere. This represents a precision. You can make this value lower if you want to make it more accurate.</p>
<p>If the distance is greater than a certain threshold, <code>100</code> in our case, then the ray has gone too far, and we should stop the ray marching loop. We don&rsquo;t want the ray to continue off to infinity because that&rsquo;s a waste of computational resources and would make a for loop run forever if the ray doesn&rsquo;t hit anything.</p>
<p>Finally, we&rsquo;ll add a color depending on whether the ray hit something or not:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mf">100.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.6</span><span class="p">);</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// ray hit something</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Our finished code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mf">100.0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.6</span><span class="p">);</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// ray hit something</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We seem to be reusing some numbers, so let&rsquo;s set some constant global variables. In GLSL, we can use the <code>const</code> keyword to tell the compiler that we don&rsquo;t plan on changing these variables:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span></span></span></code></pre></div><p>Alternatively, we can also use <a href="https://www.khronos.org/opengl/wiki/Core_Language_%28GLSL%29#Preprocessor_directives" target="_blank">preprocessor directives</a>. You may see people use preprocessor directives such as <code>#define</code> when they are defining constants. An advantage of using <code>#define</code> is that you&rsquo;re able to use <code>#ifdef</code> to check if a variable is defined later in your code. There are <a href="https://stackoverflow.com/questions/6442328/what-is-the-difference-between-define-and-const" target="_blank">differences</a> between <code>#define</code> and <code>const</code>, so choose which one you prefer and which ones works best for your scenario.</p>
<p>If we rewrote the constant variables to use the <code>#define</code> preprocessor directive, then we&rsquo;d have the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="cp">#define MAX_MARCHING_STEPS 255</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="cp">#define MIN_DIST 0.0</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="cp">#define MAX_DIST 100.0</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="cp">#define PRECISION 0.001</span></span></span></code></pre></div><p>Notice that we don&rsquo;t use an equals sign or include a semicolon at the end of each line that uses a preprocessor directive.</p>
<p>The <code>#define</code> keyword lets us define both variables and functions, but I prefer to use <code>const</code> instead because of type safety.</p>
<p>Using these constant global variables, the code should now look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.6</span><span class="p">);</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// ray hit something</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run the code, we should see an image of a sphere. It looks like a circle, but it&rsquo;s definitely a sphere!</p>
<p><a href="#R-image-526b3f8e877bf2e5af0cc6b4ddaf29ea" class="lightbox-link"><img src="./assets/shadertoy-61.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-526b3f8e877bf2e5af0cc6b4ddaf29ea"><img src="./assets/shadertoy-61.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If we change the position of the camera, we can zoom in and out to prove that we&rsquo;re looking at a 3D object. Increasing the distance between the camera and the virtual canvas in our scene from <code>5</code> to <code>3</code> should make the sphere appear bigger as if we stepped forward a bit.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin</span></span></span></code></pre></div><p><a href="#R-image-0de7cbb570b48ba762377c17555d17a9" class="lightbox-link"><img src="./assets/shadertoy-62.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0de7cbb570b48ba762377c17555d17a9"><img src="./assets/shadertoy-62.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>There is one issue though. Currently, the center of our sphere is at the coordinate, (0, 0, 0) which is different than the image I presented earlier. Our scene is setup that the camera is very close to the sphere.</p>
<p><a href="#R-image-606eeb7fe034c3635b152bf062ff1258" class="lightbox-link"><img src="./assets/shadertoy-63.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-606eeb7fe034c3635b152bf062ff1258"><img src="./assets/shadertoy-63.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s add an offset to the sphere similar to what we did with circles in <a href="https://inspirnathan.com/posts/48-shadertoy-tutorial-part-2" target="_blank">Part 2</a> of my tutorial series.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This will push the sphere forward along the z-axis by two units. This should make the sphere appear smaller since it&rsquo;s now farther away from the camera.</p>
<h4 id="lighting">Lighting</h4>
<p>To make this shape look more like a sphere, we need to add lighting. In the real world, light rays are scattered off objects in random directions.</p>
<p><a href="#R-image-b89ab0523d1627ce23cb90f8471543ab" class="lightbox-link"><img src="./assets/shadertoy-64.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b89ab0523d1627ce23cb90f8471543ab"><img src="./assets/shadertoy-64.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Objects appear differently depending on how much they are lit by a light source such as the sun.</p>
<p><a href="#R-image-fe7ef0936dd1d1147c3f722c568481b0" class="lightbox-link"><img src="./assets/shadertoy-65.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fe7ef0936dd1d1147c3f722c568481b0"><img src="./assets/shadertoy-65.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The black arrows in the image above represent a few surface normals of the sphere. If the surface normal points toward the light source, then that spot on the sphere appears brighter than the rest of the sphere. If the surface normal points completely away from the light source, then that part of the sphere will appear darker.</p>
<p>There are multiple types of lighting models used to simulate the real world. We&rsquo;ll look into <a href="https://en.wikipedia.org/wiki/Lambertian_reflectance" target="_blank">Lambert lighting</a> to simulate diffuse reflection. This is commonly done by taking the dot product between the ray direction of a light source and the direction of a <a href="https://en.wikipedia.org/wiki/Normal_%28geometry%29" target="_blank">surface normal</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">diffuseReflection</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">);</span></span></span></code></pre></div><p>A surface normal is commonly a normalized vector because we only care about the direction. To find this direction, we need to use the <a href="https://mathworld.wolfram.com/Gradient.html" target="_blank">gradient</a>. The surface normal will be equal to the gradient of a surface at a point on the surface.</p>
<p>Finding the gradient is like finding the slope of a line. You were probably told in school to memorize the phrase, &ldquo;rise over run.&rdquo; In 3D coordinate space, we can use the gradient to find the &ldquo;direction&rdquo; a point on the surface is pointing.</p>
<p>If you&rsquo;ve taken a Calculus class, then you probably learned that the slope of a line is actually just an infinitesimally small difference between two points on the line.</p>
<p><a href="#R-image-fde79725fb5c7376638ad87851ba6338" class="lightbox-link"><img src="./assets/shadertoy-66.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fde79725fb5c7376638ad87851ba6338"><img src="./assets/shadertoy-66.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s find the slope by performing &ldquo;rise over run&rdquo;:</p>
<div class="wrap-code highlight"><pre tabindex="0"><code>Point 1 = (1, 1)
Point 2 = (1.2, 1.2)

Rise / Run = (y2 - y1) / (x2 - x1) = (1.2 - 1) / (1.2 - 1) = 0.2 / 0.2 = 1

Therefore, the slope is equal to one.</code></pre></div><p>To find the gradient of a surface, we need two points. We&rsquo;ll take a point on the surface of the sphere and subtract a small number from it to get the second point. That&rsquo;ll let us perform a cheap trick to find the gradient. We can then use this gradient value as the surface normal.</p>
<p>Given a surface, <code>f(x,y,z)</code>, the gradient along the surface will have the following equation:</p>
<p><a href="#R-image-cbb9f5582c123eaa3bf3beae0c681bd3" class="lightbox-link"><img src="./assets/shadertoy-67.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cbb9f5582c123eaa3bf3beae0c681bd3"><img src="./assets/shadertoy-67.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The curly symbol that looks like the letter, &ldquo;e&rdquo;, is the greek letter, epsilon. It will represent a tiny value next to a point on the surface of our sphere.</p>
<p>In GLSL, we&rsquo;ll create a function called <code>calcNormal</code> that takes in a sample point we get back from the <code>rayMarch</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="n">r</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="n">r</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span>  <span class="o">+</span> <span class="n">e</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">e</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We can actually use <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Swizzling" target="_blank">Swizzling</a> and vector arithmetic to create an alternative way of calculating a small gradient. Remember, our goal is to create a small gradient between two close points on the surface of the sphere (or approximately on the surface of the sphere). Although this new approach is not exactly the same as the code above, it works quite well for creating a small value that approximately points in the direction of the normal vector. That is to say, it works well at creating a gradient.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><blockquote>
<p>TIP</p>
<p>If you want to compare the differences between each <code>calcNormal</code> implementation, I have created a small JavaScript <a href="https://gist.github.com/inspirnathan/aec5d735194ba556cad69af15d76c831" target="_blank">program</a> that emulates some behavior of GLSL code.</p>
</blockquote>
<p>The important thing to realize is that the <code>calcNormal</code> function returns a ray direction that represents the direction a point on the sphere is facing.</p>
<p>Next, we need to make a position for the light source. Think of it as a tiny point in 3D space.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span></span></span></code></pre></div><p>For now, we&rsquo;ll have the light source always pointing toward the sphere. Therefore, the light ray direction will be the difference between the light position and a point we get back from the ray march loop.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span></span></span></code></pre></div><p>To find the amount of light hitting the surface of our sphere, we must calculate the <a href="https://mathworld.wolfram.com/DotProduct.html" target="_blank">dot product</a>. In GLSL, we use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/dot.xhtml" target="_blank">dot</a> function to calculate this value.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">);</span> <span class="c1">// dif = diffuse reflection</span></span></span></code></pre></div><p>When we take the dot product between the normal and light direction vectors, we may end up with a negative value. To keep the value between zero and one so that we get a bigger range of values, we can use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/clamp.xhtml" target="_blank">clamp</a> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span></span></span></code></pre></div><p>Putting this altogether, we end up with the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.6</span><span class="p">);</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on sphere we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run this code, you should see a lit sphere! Now, you know I was telling the truth. Definitely looks like a sphere now! ğŸ˜</p>
<p><a href="#R-image-f0914a506c7b1bc30230788092d8bfbe" class="lightbox-link"><img src="./assets/shadertoy-68.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f0914a506c7b1bc30230788092d8bfbe"><img src="./assets/shadertoy-68.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you play around with the <code>lightPosition</code> variable, you should be able to move the light around in the 3D world coordinates. Moving the light around should affect how much shading the sphere gets. If you move the light source behind the camera, you should see the center of the sphere appear a lot brighter.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span></span></span></code></pre></div><p>You can also change the color of the sphere by multiplying the diffuse reflection value by a color vector:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-019e94fcf842e8ed700daa71b2adea25" class="lightbox-link"><img src="./assets/shadertoy-69.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-019e94fcf842e8ed700daa71b2adea25"><img src="./assets/shadertoy-69.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you want to add a bit of ambient light color, you can adjust the clamped range, so the sphere doesn&rsquo;t appear completely black in the shaded regions:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span></span></span></code></pre></div><p>You can also change the background color and add a bit of this color to the color of the sphere, so it blends in well. Looks a bit like the reference image we saw earlier in this tutorial, huh? ğŸ˜</p>
<p><a href="#R-image-e197afc227475cad5b673399833a91dd" class="lightbox-link"><img src="./assets/shadertoy-70.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e197afc227475cad5b673399833a91dd"><img src="./assets/shadertoy-70.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>For reference, here is the completed code I used to create the image above.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">,</span> <span class="n">r</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on sphere we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">)</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-5">Conclusion</h4>
<p>Phew! This article took about a weekend to write and get right, but I hope you had fun learning about ray marching! Please consider <a href="https://ko-fi.com/inspirnathan" target="_blank">donating</a> if you found this tutorial or any of my other past tutorials useful. We took the first step toward creating a 3D object using nothing but pixels on the screen and a clever algorithm. Til next time, happy coding!</p>
<h4 id="resources-4">Resources</h4>
<ul>
<li><a href="https://alain.xyz/blog/real-time-ray-tracing" target="_blank">Difference between Ray Algorithms</a></li>
<li><a href="http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/" target="_blank">Ray Marching Tutorial by Jamie Wong</a></li>
<li><a href="https://en.wikipedia.org/wiki/Ray_tracing_%28graphics%29" target="_blank">Wikipedia: Ray Tracing</a></li>
<li><a href="https://en.wikipedia.org/wiki/Lambertian_reflectance" target="_blank">Wikipedia: Lambertian Reflectance</a></li>
<li><a href="https://en.wikipedia.org/wiki/Normal_%28geometry%29" target="_blank">Wikipedia: Surface Normals</a></li>
<li><a href="https://mathworld.wolfram.com/Gradient.html" target="_blank">Wolfram MathWorld: Gradient</a></li>
<li><a href="https://mathworld.wolfram.com/DotProduct.html" target="_blank">Wolfram MathWorld: Dot Product</a></li>
<li><a href="https://www.shadertoy.com/view/4dSfRc" target="_blank">Shadertoy: Visual Ray Marching Tutorial</a></li>
<li><a href="https://www.shadertoy.com/view/4dSBz3" target="_blank">Shadertoy: Super Simple Ray Marching Tutorial</a></li>
<li><a href="https://www.shadertoy.com/view/Xl2XWt" target="_blank">Shadertoy: Box and Balloon</a></li>
<li><a href="https://www.shadertoy.com/view/MdBfRK" target="_blank">Shadertoy: Let&rsquo;s Make a Ray Marcher</a></li>
<li><a href="https://www.shadertoy.com/view/Xds3zN" target="_blank">Shadertoy: Ray Marching Primitives</a></li>
<li><a href="https://www.shadertoy.com/view/XsB3Rm" target="_blank">Shadertoy: Ray Marching Sample Code</a></li>
<li><a href="https://www.shadertoy.com/view/3styDs" target="_blank">Shadertoy: Ray Marching Template</a></li>
</ul>
<h3 id="tutorial-part-7---unique-colors-and-multiple-3d-objects">Tutorial Part 7 - Unique Colors and Multiple 3D Objects</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/53-shadertoy-tutorial-part-7</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 7 of my Shadertoy tutorial series. Let&rsquo;s add some color to our 3D scene and learn how to add multiple 3D objects to our scene such as a floor!</p>
<h4 id="drawing-multiple-3d-shapes">Drawing Multiple 3D Shapes</h4>
<p>In the last tutorial, we learned how to draw a sphere using <a href="http://shadertoy.com/" target="_blank">Shadertoy</a>, but our scene was only set up to handle drawing one shape.</p>
<p>Let&rsquo;s restructure our code so that a function called <code>sdScene</code> is responsible for returning the closest shape in our scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on sphere we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">)</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">
</span></span><span class="line"><span class="ln">67</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Notice how every instance of <code>sdSphere</code> has been replaced with <code>sdScene</code>. If we want to add more objects to the scene, we can use the <code>min</code> function to get the nearest object in our scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Currently, the spheres are on top of each other though. Let&rsquo;s add an <code>offset</code> parameter to our <code>sdSphere</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we can add offsets to each of our spheres:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The completed code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span> <span class="c1">// radius of sphere</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// distance to sphere</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on sphere we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">)</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>After running our code, we should see two orange spheres slightly apart from each other.</p>
<p><a href="#R-image-9b0852b527d2a23620e9375397fd5b90" class="lightbox-link"><img src="./assets/shadertoy-71.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9b0852b527d2a23620e9375397fd5b90"><img src="./assets/shadertoy-71.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="adding-a-floor">Adding a Floor</h4>
<p>We can add a floor that will sit one unit below our spheres through the following function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>By writing <code>p.y + 1</code>, it&rsquo;s like saying <code>p.y - (-1)</code>, which means we&rsquo;re subtracting an offset from the floor and pushing it down one unit.</p>
<p>We can then add the floor to our <code>sdScene</code> function by using the <code>min</code> function again:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run our code, the floor looks brown because it&rsquo;s using the same orange color as the spheres and not much light is hitting the surface of the floor.</p>
<p><a href="#R-image-29e4a6b07af91e498f72a39a1cba7426" class="lightbox-link"><img src="./assets/shadertoy-72.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-29e4a6b07af91e498f72a39a1cba7426"><img src="./assets/shadertoy-72.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="adding-unique-colors---method-1">Adding Unique Colors - Method 1</h4>
<p>There are multiple techniques people across Shadertoy use to add colors to 3D shapes. One way would be to modify our SDFs to return both the distance to our shape and a color. Therefore, we&rsquo;d have to modify multiple places in our code to return a <code>vec4</code> datatype instead of a <code>float</code>. The first value of the <code>vec4</code> variable would hold the &ldquo;signed distance&rdquo; value we normally return from an SDF, and the last three values will hold our color value.</p>
<p>The finished code should look something like this:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">vec4</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">vec4</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">vec4</span> <span class="n">minWithColor</span><span class="p">(</span><span class="k">vec4</span> <span class="n">obj1</span><span class="p">,</span> <span class="k">vec4</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span> <span class="c1">// The x component of the object holds the &#34;signed distance&#34; value</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">vec4</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec4</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec4</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span> <span class="c1">// co = closest object containing &#34;signed distance&#34; and color</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="k">vec4</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">yzw</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// point on sphere or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">
</span></span><span class="line"><span class="ln">74</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">
</span></span><span class="line"><span class="ln">78</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">80</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">yzw</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">82</span><span class="cl">
</span></span><span class="line"><span class="ln">83</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">84</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">85</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-b884cafe532de2a435c914823f3e6892" class="lightbox-link"><img src="./assets/shadertoy-73.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b884cafe532de2a435c914823f3e6892"><img src="./assets/shadertoy-73.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>There are multiple places in our code where we had to make adjustments to satisfy the compiler. The first thing we changed was modifying the SDFs to return a <code>vec4</code> value instead of a <code>float</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec4</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec4</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Both of these functions now accept a new parameter for color. However, that breaks the <code>min</code> function we were using inside the <code>sdScene</code> function, so we had to modify that too and create our own <code>min</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec4</span> <span class="n">minWithColor</span><span class="p">(</span><span class="k">vec4</span> <span class="n">obj1</span><span class="p">,</span> <span class="k">vec4</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">vec4</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec4</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec4</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span> <span class="c1">// co = closest object containing &#34;signed distance&#34; and color</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The <code>minWithColor</code> function performs the same operation as the <code>min</code> function, except it returns a <code>vec4</code> that holds both the &ldquo;signed distance&rdquo; value and the color of the object that is closest during the ray marching loop. Speaking of ray marching, we had to modify our <code>rayMarch</code> function to satisfy the compiler as well.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec4</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">yzw</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="k">vec4</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We also had to modify the <code>calcNormal</code> function to extract out the x-component of the object we get back from the <code>sdScene</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Finally, we modified the <code>mainImage</code> function to use the changes as well.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec4</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// point on sphere or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">yzw</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We extract out the &ldquo;signed distance&rdquo; value using <code>col.x</code>, and we get the color by using <code>col.yzw</code>.</p>
<p>Using this method allowed you to store values inside <code>vec4</code> as if they were arrays in other languages. GLSL lets you use <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Arrays" target="_blank">arrays</a> as well, but they&rsquo;re not as flexible as languages such as JavaScript. You have to know how many values are in the arrays, and you can only store the same type of values in the arrays.</p>
<h4 id="adding-unique-colors---method-2">Adding Unique Colors - Method 2</h4>
<p>If using <code>vec4</code> to store both the distance and color felt like a dirty solution, another option would be to use <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Structs" target="_blank">structs</a>. Structs are a great way to organize your GLSL code. Structs are defined similar to C++ syntax. If you&rsquo;re not familiar with C++ and are more familiar with JavaScript, then you can think of structs as like a combination of objects and classes. Let&rsquo;s see what I mean by that.</p>
<p>A struct can have properties on them. Let&rsquo;s create a struct called &ldquo;Surface.&rdquo;</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">signedDistance</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>You can create functions that return &ldquo;Surface&rdquo; structs, and you can create new instances of a struct:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">// This function&#39;s return value is of type &#34;Surface&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span> <span class="c1">// We&#39;re initializing a new &#34;Surface&#34; struct here and then returning it</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>You can access properties of the struct using the dot syntax:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span> <span class="c1">// The sd component of the struct holds the &#34;signed distance&#34; value</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>With our new knowledge of structs, we can modify our code to use structs instead of using <code>vec4</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span> <span class="c1">// The sd component of the struct holds the &#34;signed distance&#34; value</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">Surface</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">Surface</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span> <span class="c1">// co = closest object containing &#34;signed distance&#34; and color</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on sphere or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">
</span></span><span class="line"><span class="ln">79</span><span class="cl">    <span class="c1">// Calculate diffuse reflection by taking the dot product of </span>
</span></span><span class="line"><span class="ln">80</span><span class="cl">    <span class="c1">// the normal and the light direction.</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">82</span><span class="cl">
</span></span><span class="line"><span class="ln">83</span><span class="cl">    <span class="c1">// Multiply the diffuse reflection value by an orange color and add a bit</span>
</span></span><span class="line"><span class="ln">84</span><span class="cl">    <span class="c1">// of the background color to the sphere to blend it more with the background.</span>
</span></span><span class="line"><span class="ln">85</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">86</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">87</span><span class="cl">
</span></span><span class="line"><span class="ln">88</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">89</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">90</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This code should behave the same as when we used <code>vec4</code> earlier. In my opinion, structs are easier to reason about and look much cleaner. You&rsquo;re also not limited to four values like you were in <code>vec4</code> vectors. Choose whichever approach you prefer.</p>
<h4 id="making-a-tiled-floor">Making a Tiled Floor</h4>
<p>If you want to make a fancy tiled floor, you can adjust the color of the floor like so:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">Surface</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">Surface</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">sphereLeft</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-9ea2d9f4923aa077a8a0cc10b020a5d6" class="lightbox-link"><img src="./assets/shadertoy-74.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9ea2d9f4923aa077a8a0cc10b020a5d6"><img src="./assets/shadertoy-74.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Tiled floors helps people visualize depth and make your 3D scenes stand out more. The <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mod.xhtml" target="_blank">mod</a> function is commonly used to create checkered patterns or to divide a piece of the scene into repeatable chunks that can be colored or styled differently.</p>
<h4 id="adding-unique-colors---method-3">Adding Unique Colors - Method 3</h4>
<p>When viewing shaders on Shadertoy, you may see code that uses identifiers or IDs to color each unique object in your scene. It&rsquo;s common to see people use a <code>map</code> function instead of a <code>sdScene</code> function. You may also see a <code>render</code> function used to handle assigning colors to each object by looking at the ID of the closest object returned from the ray marching algorithm. Let&rsquo;s see how the code looks using this more conventional approach.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">float</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">vec2</span> <span class="n">opU</span><span class="p">(</span> <span class="k">vec2</span> <span class="n">d1</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">d2</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">?</span> <span class="n">d1</span> <span class="o">:</span> <span class="n">d2</span><span class="p">;</span> <span class="c1">// the x-component is the signed distance value</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">vec2</span> <span class="n">map</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec2</span> <span class="n">res</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="n">e10</span><span class="p">,</span> <span class="mf">0.</span><span class="p">);</span> <span class="c1">// ID = 0</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">vec2</span> <span class="n">flooring</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">);</span> <span class="c1">// ID = 0.5</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">vec2</span> <span class="n">sphereLeft</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">);</span> <span class="c1">// ID = 1.5</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">vec2</span> <span class="n">sphereRight</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">);</span> <span class="c1">// ID = 2.5</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opU</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">flooring</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opU</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">sphereLeft</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">res</span> <span class="o">=</span> <span class="n">opU</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">sphereRight</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">return</span> <span class="n">res</span><span class="p">;</span> <span class="c1">// the y-component is the ID of the object hit by the ray</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="k">vec2</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="k">vec2</span> <span class="n">res</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span> <span class="c1">// initialize result to zero for signed distance value and ID</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">float</span> <span class="n">id</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="n">res</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// find resulting target hit by ray</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">res</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="n">id</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">return</span> <span class="k">vec2</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">x</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">map</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="k">vec3</span> <span class="n">render</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">COLOR_BACKGROUND</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">    
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="k">vec2</span> <span class="n">res</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">return</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// render background color since ray hit nothing</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">
</span></span><span class="line"><span class="ln">67</span><span class="cl">	<span class="k">float</span> <span class="n">id</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// id of object</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">    
</span></span><span class="line"><span class="ln">69</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on sphere or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">
</span></span><span class="line"><span class="ln">74</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">
</span></span><span class="line"><span class="ln">76</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mf">2.</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl">    
</span></span><span class="line"><span class="ln">80</span><span class="cl">    <span class="n">col</span> <span class="o">+=</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// add a bit of the background color to blend objects more with the scene</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">    
</span></span><span class="line"><span class="ln">82</span><span class="cl">    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">83</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">84</span><span class="cl">
</span></span><span class="line"><span class="ln">85</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">86</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">87</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">88</span><span class="cl">
</span></span><span class="line"><span class="ln">89</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">90</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">91</span><span class="cl">  
</span></span><span class="line"><span class="ln">92</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">93</span><span class="cl">
</span></span><span class="line"><span class="ln">94</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">95</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">96</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>You&rsquo;ll notice that the <code>minWithColor</code> function is now called <code>opU</code> which stands for &ldquo;operation, union&rdquo; because it is a union operation that adds shapes to the scene. We&rsquo;ll learn more about 3D SDF operations in <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> of my tutorial series. The <code>opU</code> function is comparing the signed distance values of two objects to see which object is closer to the ray during the ray marching algorithm.</p>
<p>The <code>map</code> function is used to add or &ldquo;map&rdquo; objects to our scene. We use a <code>vec2</code> to store a value of the signed distance value in the x-component and an ID in the y-component. You&rsquo;ll typically see a fractional value used for the ID. This is because we can check the ID in the <code>render</code> function by seeing if this fractional value is greater than a whole number. You may be wondering why we don&rsquo;t use whole numbers for the ID and then use a <code>==</code> operator to check if the ID is equal to the ID of the closest object found from ray marching. This might work for you and your compiler, but it might not for everyone. Using fractional values and a greater than (<code>&gt;</code>) check ensures the scene is guaranteed to render correctly. When using floats such as <code>1.</code> or <code>2.</code>, you could find weird issues where <code>id == 1.</code> or <code>id == 2.</code> don&rsquo;t behave as you&rsquo;d expect. By checking if <code>id &gt; 1.</code> or <code>id &gt; 2.</code> when the ID is either <code>0.5</code> or <code>1.5</code>, we can be sure that the code behaves predictably for everyone.</p>
<p>It&rsquo;s important to understand this method for adding unique colors to the scene because you&rsquo;ll likely see it used by many developers in the Shadertoy community.</p>
<h4 id="conclusion-6">Conclusion</h4>
<p>In this article, we learned how to draw multiple 3D objects to the scene and give each of them a unique color. We learned three techniques for adding colors to each object in our scene, but there are definitely other approaches out there! Use whatever method works best for you. I find working with structs gives my code a more &ldquo;structured&rdquo; approach ğŸ™‚.</p>
<h4 id="resources-5">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/fdlGWX" target="_blank">Ray Marching with Unique Colors</a></li>
<li><a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Arrays" target="_blank">Khronos: Arrays</a></li>
<li><a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Structs" target="_blank">Khronos: Structs</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mod.xhtml" target="_blank">Khronos: mod</a></li>
</ul>
<h3 id="tutorial-part-8---3d-rotation">Tutorial Part 8 - 3D Rotation</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/54-shadertoy-tutorial-part-8</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 8 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how to rotate 3D objects using transformation matrices.</p>
<h4 id="initial-setup">Initial Setup</h4>
<p>Let&rsquo;s create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and use the code from the end of <a href="https://inspirnathan.com/posts/53-shadertoy-tutorial-part-7" target="_blank">Part 7</a> of this Shadertoy series. However, we&rsquo;ll remove the spheres.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">
</span></span><span class="line"><span class="ln">73</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">
</span></span><span class="line"><span class="ln">76</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Once the code is run, you should see a tiled floor and light blue background color.</p>
<p><a href="#R-image-cba138c633e8150117becbd92e18bfb7" class="lightbox-link"><img src="./assets/shadertoy-75.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cba138c633e8150117becbd92e18bfb7"><img src="./assets/shadertoy-75.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="adding-a-cube">Adding a Cube</h4>
<p>Next, we&rsquo;ll add a cube by leveraging a list of 3D SDFs from <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s website</a>. Under the &ldquo;Primitives&rdquo; section, you will find an SDF labelled &ldquo;Box - exact&rdquo; which we will use to render a cube.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>To make this compatible with the code we learned in the previous tutorial and to add a unique color to the object, we need to return a value of type <code>Surface</code> instead of a <code>float</code>. We&rsquo;ll also add two parameters to the function: offset and color.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The first parameter, <code>p</code>, is the sample point, and the second parameter, <code>b</code>, is a <code>vec3</code> variable that represents the boundaries of the box. Use the x,y, and z components to control the width, height, and depth of the box. If we make all three the same value, then we end up with a cube.</p>
<p>Let&rsquo;s insert a cube into our 3D scene:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This cube will be 1x1x1 in dimensions, have the position, (0, 0.5, -4), and have the color, red.</p>
<p><a href="#R-image-2dc5330458a9a310525eeee378fbbe06" class="lightbox-link"><img src="./assets/shadertoy-76.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2dc5330458a9a310525eeee378fbbe06"><img src="./assets/shadertoy-76.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="rotation-matrices">Rotation Matrices</h4>
<p>In linear algebra, <a href="https://en.wikipedia.org/wiki/Transformation_matrix" target="_blank">transformation matrices</a> are used to perform a variety of operations on 2D and 3D shapes: stretching, squeezing, rotation, shearing, and reflection. Each matrix represents an operation.</p>
<p>By multiplying points on a graph (or sample points in our GLSL code) by a transformation matrix, we can perform any of these operations. We can also multiply any of these transformation matrices together to create new transformation matrices that perform more than one operation.</p>
<p>Since matrix multiplication is <a href="https://en.wikipedia.org/wiki/Matrix_multiplication#Non-commutativity" target="_blank">non-commutative</a>, the order by which we multiply the matrices together matters. If you rotate a shape and then shear it, you&rsquo;ll end up with a different result than if you sheared it first and then rotated it. Similarly, if you rotate a shape across the x-axis first and then the z-axis, you may end up with a different result had you reversed the order of these operations instead.</p>
<p>A rotation matrix is a type of transformation matrix. Let&rsquo;s take a look at the <a href="https://en.wikipedia.org/wiki/Rotation_matrix#Basic_rotations" target="_blank">rotation matrices</a> we&rsquo;ll be using in this tutorial.</p>
<p><a href="#R-image-12d789f476355833494465c7ab196780" class="lightbox-link"><img src="./assets/shadertoy-77.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-12d789f476355833494465c7ab196780"><img src="./assets/shadertoy-77.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Rotation Matrices by <a href="https://en.wikipedia.org/wiki/Rotation_matrix#Basic_rotations" target="_blank">Wikipedia</a></p>
<p>In the image above, we have three rotation matrices, one for each axis in 3D. These will let us spin a shape around an axis as if it were a gymnast swinging around a bar or pole.</p>
<p>At the top of our code, let&rsquo;s add functions for rotation matrices across each axis. We&rsquo;ll also add a function that returns an <a href="https://en.wikipedia.org/wiki/Identity_matrix" target="_blank">identity matrix</a> so that we can choose not to perform any sort of transformation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We now need to adjust the <code>sdBox</code> function to accept matrix transformations as another parameter. We will multiply the sample point by the rotation matrix. This transformation will be applied after the sample point is moved to a certain world coordinate defined by the offset.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We then need to modify the <code>sdScene</code> function to insert a new parameter inside the call to the <code>sdBox</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">rotateX</span><span class="p">(</span><span class="n">iTime</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We can use between <code>rotateX</code>, <code>rotateY</code>, and <code>rotateZ</code> to rotate the cube across the x-axis, y-axis, and z-axis, respectively. The angle will be set to <code>iTime</code>, so we can see animate the cube rotation with time. The cube&rsquo;s pivot point will be its own center.</p>
<p>Here&rsquo;s an example of rotating the cube across the x-axis using <code>rotateX(iTime)</code> in the call to the <code>sdBox</code> function.</p>
<p><a href="#R-image-9c89431d5694b88dca3043ff470b14be" class="lightbox-link"><img src="./assets/shadertoy-4.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9c89431d5694b88dca3043ff470b14be"><img src="./assets/shadertoy-4.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Here&rsquo;s an example of rotating the cube across the y-axis using <code>rotateY(iTime)</code> in the call to the <code>sdBox</code> function.</p>
<p><a href="#R-image-457bf48e92b36285ac798b8eb4d5b4bb" class="lightbox-link"><img src="./assets/shadertoy-5.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-457bf48e92b36285ac798b8eb4d5b4bb"><img src="./assets/shadertoy-5.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Here&rsquo;s an example of rotating the cube across the z-axis using <code>rotateZ(iTime)</code> in the call to the <code>sdBox</code> function.</p>
<p><a href="#R-image-16bcbe71e320222f18ea489685f004fd" class="lightbox-link"><img src="./assets/shadertoy-6.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-16bcbe71e320222f18ea489685f004fd"><img src="./assets/shadertoy-6.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To prevent any sort of rotation, we can call the <code>identity</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// By using the identity matrix, the cube&#39;s orientation remains the same</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>You can also combine individual matrix transforms by multiplying them together. This will cause the cube to rotate across all of the axes simultaneously.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      <span class="n">p</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      <span class="n">rotateX</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotateZ</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="c1">// Combine rotation matrices</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-732600b116657eb9e42086233b0f43f0" class="lightbox-link"><img src="./assets/shadertoy-7.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-732600b116657eb9e42086233b0f43f0"><img src="./assets/shadertoy-7.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find an example of the completed code below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">      <span class="n">p</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">      <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">      <span class="n">rotateX</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span><span class="o">*</span><span class="n">rotateY</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span><span class="o">*</span><span class="n">rotateZ</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="c1">// Combine rotation matrices</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="p">));</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">
</span></span><span class="line"><span class="ln"> 84</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">
</span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">
</span></span><span class="line"><span class="ln">109</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">
</span></span><span class="line"><span class="ln">128</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">
</span></span><span class="line"><span class="ln">130</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">
</span></span><span class="line"><span class="ln">133</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="rotation-around-a-pivot-point">Rotation around a Pivot Point</h4>
<p>If we wanted to make it seem like the cube is rotating around an external pivot point that is not the cube&rsquo;s center, then we&rsquo;d have to modify the <code>sdBox</code> function to move the cube a certain distance after the transformation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// Move the cube as it is rotating</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If we use <code>rotateY(iTime)</code> inside the <code>sdScene</code> function, the cube appears to be rotating around the y-axis along a pivot point that is a certain distance away from the cube. In this example, we use <code>vec3(3, 0, 0)</code> to keep the cube 3 units away while it is rotating around the pivot point located at (0, 0.5, -4), which is the offset we assigned to <code>sdBox</code> inside the <code>sdScene</code> function.</p>
<p><a href="#R-image-775e8c227015ae9e5c7ae93497bba82e" class="lightbox-link"><img src="./assets/shadertoy-8.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-775e8c227015ae9e5c7ae93497bba82e"><img src="./assets/shadertoy-8.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Here is the full code used to create the image above:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// Move the cube as it is rotating</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">iTime</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">
</span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-7">Conclusion</h4>
<p>In this tutorial, we learned how to rotate our cube across each axis in 3D space. We also learned how to rotate cubes around an external pivot point to make it look like they&rsquo;re orbiting around a point in space. What you learned today can be applied to all other 3D objects as well. We chose a cube instead of a sphere because it&rsquo;s easier to check if our rotation matrices work against cubes rather than spheres ğŸ™‚.</p>
<h4 id="resources-6">Resources</h4>
<ul>
<li><a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">3D SDF List</a></li>
<li><a href="https://en.wikipedia.org/wiki/Transformation_matrix" target="_blank">Transformation Matrix</a></li>
<li><a href="https://en.wikipedia.org/wiki/Rotation_matrix#Basic_rotations" target="_blank">Rotation Matrices</a></li>
<li><a href="https://en.wikipedia.org/wiki/Identity_matrix" target="_blank">Identity Matrix</a></li>
<li><a href="https://www.shadertoy.com/view/fdjGRD" target="_blank">3D Rotation Example</a></li>
</ul>
<h3 id="tutorial-part-9---camera-movement">Tutorial Part 9 - Camera Movement</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/55-shadertoy-tutorial-part-9</p>
</blockquote>
<p>Greetings, friends! It&rsquo;s April Fools&rsquo; day! I hope you don&rsquo;t fall for many pranks today! ğŸ˜‚ Welcome to Part 9 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how move the camera around the scene.</p>
<h4 id="initial-setup-1">Initial Setup</h4>
<p>Let&rsquo;s create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and add the following boilerplate code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span> <span class="c1">// apply transformation matrix</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">
</span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This code creates a scene with a tiled floor, sky (background color), and a red cube. It also contains the rotation matrices we learned about in the <a href="https://inspirnathan.com/posts/53-shadertoy-tutorial-part-7" target="_blank">last tutorial</a>.</p>
<p><a href="#R-image-94c2a6f4968c2e8becc4f7a3b866275f" class="lightbox-link"><img src="./assets/shadertoy-78.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-94c2a6f4968c2e8becc4f7a3b866275f"><img src="./assets/shadertoy-78.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="panning-the-camera">Panning the Camera</h4>
<p>Panning the camera is actually very basic. The camera is currently pointing toward a cube that is floating slightly in the air a certain distance from the camera along the z-axis. Since our coordinate system uses the right-hand rule, the z-axis is negative when it goes away from the camera and positive when it comes toward the camera.</p>
<p><a href="#R-image-2367d7cee98d2fa1df838f90e0de953e" class="lightbox-link"><img src="./assets/shadertoy-79.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2367d7cee98d2fa1df838f90e0de953e"><img src="./assets/shadertoy-79.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Our camera is sitting at a position defined by the variable, <code>ro</code>, which is the ray origin. Currently, it&rsquo;s set equal to <code>vec3(0, 0, 3)</code>. To pan the camera along the x-direction, we simply adjust the x-component of <code>ro</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></div><p>Our camera has now shifted to the right, which creates the effect of moving the cube to the left.</p>
<p><a href="#R-image-bc03fc00d92271f2d7dacf8428d49c15" class="lightbox-link"><img src="./assets/shadertoy-80.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bc03fc00d92271f2d7dacf8428d49c15"><img src="./assets/shadertoy-80.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Likewise, we can adjust the y-component of <code>ro</code> to move the camera up or down.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></div><p>Moving the camera up has the effect of moving the cube and floor down.</p>
<p><a href="#R-image-6baf14f1abce46fbbf918aed09c4a861" class="lightbox-link"><img src="./assets/shadertoy-81.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6baf14f1abce46fbbf918aed09c4a861"><img src="./assets/shadertoy-81.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can pan the camera along a circular path by using <code>cos</code> and <code>sin</code> functions along the x-axis and y-axis, respectively.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-c7cfb03aca320adaa784d9edea82d33d" class="lightbox-link"><img src="./assets/shadertoy-9.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c7cfb03aca320adaa784d9edea82d33d"><img src="./assets/shadertoy-9.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Obviously, it starts looking strange as you dip into the floor a bit, so I added <code>0.1</code> to the y-component to prevent flashing effects that may occur.</p>
<h4 id="tiltingrotating-the-camera">Tilting/Rotating the Camera</h4>
<p>Suppose we want to keep the camera position, <code>ro</code>, the same, but we want to tilt the camera up, down, left, or right. Maybe we want to even turn the camera all the way around such that the camera turns around at a 180 degree angle. This involves applying a transformation matrix to the ray direction, <code>rd</code>.</p>
<p>Let&rsquo;s set the ray origin back to normal:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></div><p>The cube should look centered on the canvas now. Currently, our scene from a side view is similar to the following illustration:</p>
<p><a href="#R-image-9c8859f8eedbcf4f0d2d6468afe793d9" class="lightbox-link"><img src="./assets/shadertoy-82.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9c8859f8eedbcf4f0d2d6468afe793d9"><img src="./assets/shadertoy-82.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We want to keep the camera position the same but be able to tilt it in any direction. Suppose we wanted to tilt the camera upwards. Our scene would be similar to the following illustration:</p>
<p><a href="#R-image-e378f96734e39715eb8f00b934f08ea6" class="lightbox-link"><img src="./assets/shadertoy-83.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e378f96734e39715eb8f00b934f08ea6"><img src="./assets/shadertoy-83.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Notice how the rays being shot out of the camera have tilted upwards too. To tilt the camera means tilting all of the rays being fired out of the camera.</p>
<p>Tilting the camera is similar to the <a href="https://en.wikipedia.org/wiki/Aircraft_principal_axes" target="_blank">aircraft principal axes</a>.</p>
<p><a href="#R-image-634c7bc621abad9cfb5ee78e7bf2bcce" class="lightbox-link"><img src="./assets/shadertoy-84.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-634c7bc621abad9cfb5ee78e7bf2bcce"><img src="./assets/shadertoy-84.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Aircraft principal axes by <a href="https://en.wikipedia.org/wiki/Aircraft_principal_axes" target="_blank">Wikipedia</a></p>
<p>The camera can not only pan along the x-axis, y-axis, or z-axis, but it can also tilt (or rotate) along three rotational axes: <a href="https://simple.wikipedia.org/wiki/Pitch,_yaw,_and_roll" target="_blank">pitch, yaw, and roll</a>. This means the camera has six degrees of freedom: three positional axes and three rotational axes.</p>
<p><a href="#R-image-f6a647283d731f9db27959f665e02009" class="lightbox-link"><img src="./assets/shadertoy-85.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f6a647283d731f9db27959f665e02009"><img src="./assets/shadertoy-85.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Six degrees of freedom (DOF) by <a href="https://simple.wikipedia.org/wiki/Pitch,_yaw,_and_roll" target="_blank">Simple English Wikipedia</a></p>
<p>Luckily for us, we can use the same <a href="https://en.wikipedia.org/wiki/Rotation_matrix#General_rotations" target="_blank">rotation matrices</a> we used in the last tutorial to apply pitch, yaw, and roll.</p>
<p>&ldquo;Pitch&rdquo; is applied using the <code>rotateX</code> function, &ldquo;yaw&rdquo; is applied using the <code>rotateY</code> function, and &ldquo;roll&rdquo; is applied using the <code>rotateZ</code> function.</p>
<p>If we want to tilt the camera up/down, or apply &ldquo;pitch,&rdquo; then we need to apply the <code>rotateX</code> function to the ray direction, <code>rd</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateX</span><span class="p">(</span><span class="mf">0.3</span><span class="p">);</span></span></span></code></pre></div><p>We simply multiply the ray direction by one or more rotation matrices to tilt the camera. That will tilt the direction of every ray fired from the camera, changing the view we see in the Shadertoy canvas.</p>
<p>Let&rsquo;s animate the tilt such that the &ldquo;pitch&rdquo; angle oscillates between <code>-0.5</code> and <code>0.5</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateX</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-9bc2f359c355dfca1b48b58169970d19" class="lightbox-link"><img src="./assets/shadertoy-10.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9bc2f359c355dfca1b48b58169970d19"><img src="./assets/shadertoy-10.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To tilt the camera left/right, or apply &ldquo;yaw&rdquo;, we need to apply the <code>rotateY</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-92132966bf83ed8fd7e4b02cfb078fa7" class="lightbox-link"><img src="./assets/shadertoy-11.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-92132966bf83ed8fd7e4b02cfb078fa7"><img src="./assets/shadertoy-11.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To tilt the camera from side to side, or apply &ldquo;roll&rdquo;, we need to apply the <code>rotateZ</code> function. Do a barrel roll! ğŸ°</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateZ</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-b0c6d5bc0b0855d70a130f2fdd69b72e" class="lightbox-link"><img src="./assets/shadertoy-12.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b0c6d5bc0b0855d70a130f2fdd69b72e"><img src="./assets/shadertoy-12.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="rotating-the-camera-a-full-360">Rotating the Camera a Full 360</h4>
<p>We can also apply yaw between negative pi and positive pi to spin the scene around a complete 360 degree angle.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">PI</span><span class="p">);</span> <span class="c1">// 0.5 is used to slow the animation down</span></span></span></code></pre></div><p><a href="#R-image-6cb73578248f83566def105842c2ed27" class="lightbox-link"><img src="./assets/shadertoy-13.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6cb73578248f83566def105842c2ed27"><img src="./assets/shadertoy-13.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When you look behind the camera, you&rsquo;ll likely find a glowy spot on the ground. This glowy spot is the position of the light, currently set up at <code>vec3(2, 2, 7)</code>. Since the positive z-axis is setup to be behind the camera typically, you end up seeing the light when you turn the camera around.</p>
<p><a href="#R-image-c71bb59364e200ac9673ce9a4439c502" class="lightbox-link"><img src="./assets/shadertoy-86.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c71bb59364e200ac9673ce9a4439c502"><img src="./assets/shadertoy-86.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You make think the glowy spot is an April Fools&rsquo; joke, but it&rsquo;s actually a result of the diffuse reflection calculation from <a href="https://inspirnathan.com/posts/52-shadertoy-tutorial-part-6" target="_blank">Part 6</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span></span></span></code></pre></div><p>Since we&rsquo;re coloring the floor based on the diffuse reflection and the surface normal, the floor appears brightest where the light position is located. If you want to remove this sunspot, you&rsquo;ll have to remove the floor from the lighting calculations.</p>
<p>Typically, this shouldn&rsquo;t be an issue since the light is behind the camera. If you want to have scenes with a floor where the camera turns around, then you&rsquo;ll probably want to remove the glowy spot.</p>
<p>Once approach to removing this &ldquo;sun spot&rdquo; or &ldquo;sun glare&rdquo; as I like to call it is to assign an ID to each object in the scene. Then, you can remove the floor from the lighting calculation by checking if the floor is the closest object in the scene after performing ray marching.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">    <span class="k">int</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// identifier for each surface/object</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="cm">Surface IDs:
</span></span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="cm">1. Floor
</span></span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="cm">2. Box
</span></span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">
</span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.5</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">PI</span><span class="p">);</span> <span class="c1">// 0.5 is used to slow the animation down</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">
</span></span><span class="line"><span class="ln">124</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">            
</span></span><span class="line"><span class="ln">130</span><span class="cl">    <span class="c1">// check material ID        </span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="n">co</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">// floor</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">        <span class="n">col</span> <span class="o">=</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">      <span class="c1">// lighting</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">
</span></span><span class="line"><span class="ln">139</span><span class="cl">      <span class="c1">// color</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">      <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">
</span></span><span class="line"><span class="ln">145</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>With this approach, the floor lighting will look a bit different, but the sun spot will be gone!</p>
<p><a href="#R-image-238fdde3731819ae9437b4bb918ac01d" class="lightbox-link"><img src="./assets/shadertoy-14.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-238fdde3731819ae9437b4bb918ac01d"><img src="./assets/shadertoy-14.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>By assigning IDs to each surface, material, or object, we can keep track of which object was hit by a ray after ray marching is performed. This can be useful for applying lighting or coloring calculations that are unique to one or more objects.</p>
<h4 id="understanding-imouse">Understanding iMouse</h4>
<p>Shadertoy provides a set of global variables that you can use in your shader code to make it more interactive. If you open a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and click on the arrow next to &ldquo;Shader inputs,&rdquo; then you&rsquo;ll see a list of global variables.</p>
<p><a href="#R-image-c7ab26dff5b4714246e77260beb32964" class="lightbox-link"><img src="./assets/shadertoy-87.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c7ab26dff5b4714246e77260beb32964"><img src="./assets/shadertoy-87.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Below is a list of global variables you can use in Shadertoy shaders.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-markup" data-lang="markup">Shader Inputs
uniform vec3      iResolution;           // viewport resolution (in pixels)
uniform float     iTime;                 // shader playback time (in seconds)
uniform float     iTimeDelta;            // render time (in seconds)
uniform int       iFrame;                // shader playback frame
uniform float     iChannelTime[4];       // channel playback time (in seconds)
uniform vec3      iChannelResolution[4]; // channel resolution (in pixels)
uniform vec4      iMouse;                // mouse pixel coords. xy: current (if MLB down), zw: click
uniform samplerXX iChannel0..3;          // input channel. XX = 2D/Cube
uniform vec4      iDate;                 // (year, month, day, time in seconds)
uniform float     iSampleRate;           // sound sample rate (i.e., 44100)</code></pre></div><p>Among them, you&rsquo;ll see a variable called <code>iMouse</code> that can be used to get the position of your mouse as you click somewhere on the canvas. This variable is of type <code>vec4</code> and therefore contains four pieces of information about a left mouse click.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-markup" data-lang="markup">vec4 mouse = iMouse;

mouse.xy = mouse position during last button down
abs(mouse.zw) = mouse position during last button click
sign(mouze.z) = button is down (positive if down)
sign(mouze.w) = button is clicked (positive if clicked)</code></pre></div><p>A mouse click is what happens immediately after you press the mouse. A mouse down event is what happens after you continue holding it down.</p>
<p>This <a href="https://www.shadertoy.com/view/Mss3zH" target="_blank">tutorial</a> by Inigo Quilez, one of the co-creators of Shadertoy, shows you how to use each piece of data stored in <code>iMouse</code>. When you click anywhere in the scene, a white circle appears when you perform a mouse click. If you continue holding the mouse down and move the mouse around, a yellow line will appear between two circles. Once you release the mouse, the yellow line will disappear.</p>
<p>What we really care about for the purpose of this tutorial are the mouse coordinates. I made a small <a href="https://www.shadertoy.com/view/7dsGzS" target="_blank">demo</a> to show how you can move a circle around in the canvas using your mouse. Let&rsquo;s look at the code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">mp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">blueCircle</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mp</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">blueCircle</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="c1">// mp = mouse position of the last click</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec2</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">mp</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">mp</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Notice how getting the mouse position is very similar to the UV coordinates. We can normalize the coordinates through the following statement:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="c1">// range is between 0 and 1</span></span></span></code></pre></div><p>This will normalize the mouse coordinates to be between zero and one. By subtracting <code>0.5</code>, we can normalize the mouse coordinates to be between <code>-0.5</code> and <code>0.5</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mp</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="c1">// range is between -0.5 and 0.5</span></span></span></code></pre></div><h4 id="panning-the-camera-with-the-mouse">Panning the Camera with the Mouse</h4>
<p>Now that we understand how to use the <code>iMouse</code> global variable, let&rsquo;s apply it to our camera. We can use the mouse to control panning by changing the value of the ray origin, <code>ro</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">mouse</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin will move as you click on the canvas and drag the mouse</span></span></span></code></pre></div><p>If you click on the canvas and drag your mouse, you&rsquo;ll be able to pan the camera between -0.5 and 0.5 on both the x-axis and y-axis. The center of the canvas will be the point, (0, 0), which should move the cube back in the center of the canvas.</p>
<p>If you want to pan more, you can always multiply the mouse position values by a multiplier.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">mouse</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-2a3129f1d94996ffd56acb1408610af6" class="lightbox-link"><img src="./assets/shadertoy-15.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2a3129f1d94996ffd56acb1408610af6"><img src="./assets/shadertoy-15.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="tiltingrotating-the-camera-with-the-mouse">Tilting/Rotating the Camera with the Mouse</h4>
<p>We can tilt/rotate the camera with the mouse by changing the value of <code>theta</code>, the angle we supply to our rotation matrices such as <code>rotateX</code>, <code>rotateY</code>, and <code>rotateZ</code>. Make sure that you&rsquo;re no longer using the mouse to control the ray origin, <code>ro</code>. Otherwise, you may end up with a very strange camera.</p>
<p>Let&rsquo;s apply &ldquo;yaw&rdquo; to the ray direction to tilt the camera left to right.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">);</span> <span class="c1">// apply yaw</span></span></span></code></pre></div><p>Since <code>mouse.x</code> is currently constrained between <code>-0.5</code> and <code>0.5</code>, it might make more sense to remap this range to something like negative pi (-Ï€) to positive pi (+Ï€). To remap a range to a new range, we can make use of the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml" target="_blank">mix</a> function. It&rsquo;s already built to handle linear interpolation, so it&rsquo;s perfect for remapping values from one range to another.</p>
<p>Let&rsquo;s remap the range, <code>&lt;-0.5, 0.5&gt;</code>, to <code>&lt;-Ï€, Ï€&gt;</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">));</span> <span class="c1">// apply yaw with a 360 degree range</span></span></span></code></pre></div><p>Now, we can make a complete 360 rotation using our mouse!</p>
<p>You may be wondering how we can use the <code>mouse.y</code> value. We can use this value to tilt the camera up and down as the &ldquo;pitch&rdquo; angle. That means we need to leverage the <code>rotateX</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateX</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// apply pitch</span></span></span></code></pre></div><p>This will let us tilt the camera up and down between the values of <code>-0.5</code> and <code>0.5</code>.</p>
<p>If you want to use the mouse to change the &ldquo;yaw&rdquo; angle with <code>mouse.x</code> and &ldquo;pitch&rdquo; with <code>mouse.y</code> simultaneously, then we need to multiply the rotation matrices together.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotateX</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// apply yaw and pitch</span></span></span></code></pre></div><p>Now, you can freely tilt the camera with your mouse to look around the scene! This can be handy for troubleshooting complex 3D scenes built with Shadertoy. In software such as Unity or Blender, you already have a powerful camera you can use to look around 3D scenes.</p>
<p><a href="#R-image-e8236d26bbe5b4ac281a44eae958f050" class="lightbox-link"><img src="./assets/shadertoy-16.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e8236d26bbe5b4ac281a44eae958f050"><img src="./assets/shadertoy-16.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">    <span class="k">int</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// identifier for each surface/object</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="cm">Surface IDs:
</span></span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="cm">1. Floor
</span></span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="cm">2. Box
</span></span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">
</span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.5</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span> <span class="c1">// epsilon</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouse</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="n">rd</span> <span class="o">*=</span> <span class="n">rotateY</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotateX</span><span class="p">(</span><span class="n">mouse</span><span class="p">.</span><span class="n">y</span><span class="p">);</span> <span class="c1">// apply yaw and pitch</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl">
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="c1">// check material ID        </span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="k">if</span><span class="p">(</span> <span class="n">co</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">// floor</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">        <span class="n">col</span> <span class="o">=</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">      <span class="c1">// lighting</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">
</span></span><span class="line"><span class="ln">140</span><span class="cl">      <span class="c1">// color</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">      <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">
</span></span><span class="line"><span class="ln">146</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-8">Conclusion</h4>
<p>In this tutorial, we learned how to move the camera in six degrees of freedom. We learned how to pan the camera around along the x-axis, y-axis, and z-axis. We also learned how to use rotation matrices to apply yaw, pitch, and roll, so we can control the camera&rsquo;s tilt. Using the knowledge you&rsquo;ve learned today, you can debug 3D scenes in Shadertoy and make interesting animations.</p>
<h4 id="resources-7">Resources</h4>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Aircraft_principal_axes" target="_blank">Aircraft Principal Axes</a></li>
<li><a href="https://simple.wikipedia.org/wiki/Pitch,_yaw,_and_roll" target="_blank">Pitch, Yaw, and Roll</a></li>
<li><a href="https://en.wikipedia.org/wiki/Rotation_matrix#General_rotations" target="_blank">Rotation Matrices</a></li>
<li><a href="https://www.shadertoy.com/view/Mss3zH" target="_blank">Shadertoy: Input - Mouse</a></li>
<li><a href="https://www.shadertoy.com/view/7dsGzS" target="_blank">Shadertoy: 2D Movement with Mouse</a></li>
<li><a href="https://www.shadertoy.com/view/fd23Dz" target="_blank">Shadertoy: Panning and Tilting the Camera Example</a></li>
</ul>
<h3 id="tutorial-part-10---camera-model-with-a-lookat-point">Tutorial Part 10 - Camera Model with a Lookat Point</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/56-shadertoy-tutorial-part-10</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 10 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how to make a more flexible camera model that uses a lookat point. This will make it easier to change what objects the camera is looking at.</p>
<h4 id="initial-setup-2">Initial Setup</h4>
<p>Let&rsquo;s create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and add the following boilerplate code we&rsquo;ll use for this tutorial. Notice how the constants are now defined at the top of the code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Constants</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">
</span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span> <span class="c1">// apply transformation matrix</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">
</span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// left cube</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// center cube</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// right cube</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">
</span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">
</span></span><span class="line"><span class="ln">117</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">
</span></span><span class="line"><span class="ln">129</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">
</span></span><span class="line"><span class="ln">132</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This code will produce a scene with three cubes, each with different colors: red, green, and blue.</p>
<p><a href="#R-image-ae359831c2155baf18fdc177b296cde6" class="lightbox-link"><img src="./assets/shadertoy-88.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ae359831c2155baf18fdc177b296cde6"><img src="./assets/shadertoy-88.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="the-lookat-point">The LookAt Point</h4>
<p>Currently, when we want to move the camera, we have to adjust the values of the ray origin. To tilt the camera, we need to multiply the ray direction by a rotation matrix.</p>
<p>An alternative approach is to create a <code>camera</code> function that accepts the camera position (or ray origin), and a lookat point. Then, this function will return a 3x3 transformation matrix we can multiply the ray direction by.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>To understand how we came up with this matrix, let&rsquo;s look at the image below. It was created on the website, <a href="https://learnopengl.com/" target="_blank">Learn OpenGL</a>, an amazing resource for learning the OpenGL graphics API.</p>
<p><a href="#R-image-944d2a3859267bcdbd6ae615692ae11a" class="lightbox-link"><img src="./assets/shadertoy-89.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-944d2a3859267bcdbd6ae615692ae11a"><img src="./assets/shadertoy-89.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Camera/view space by <a href="https://learnopengl.com/Getting-started/Camera" target="_blank">Learn OpenGL</a></p>
<p>The image above conveys a lot about how the 3x3 matrix was created. We need to figure out where the camera is looking at and how it&rsquo;s tilted by analyzing three important camera vectors: the &ldquo;camera direction&rdquo; vector, the &ldquo;camera right&rdquo; vector, and the &ldquo;camera up&rdquo; vector.</p>
<p>In step 1, we start with the camera position, which is equal to the ray origin, <code>ro</code>, in our code.</p>
<p>In step 2, we create a camera direction vector that is relative to a &ldquo;lookat&rdquo; point. In the image, the lookat point is located at the origin in 3D space, but we can shift this point anywhere we want. Notice how the camera direction is pointing away from the camera. This means it&rsquo;s using the right-hand rule we learned about in <a href="https://inspirnathan.com/posts/52-shadertoy-tutorial-part-6" target="_blank">Part 6</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span></span></span></code></pre></div><p>In step 3, there is a gray vector pointing straight up from the camera. The direction vector, (0, 1, 0), represents a unit vector for the y-axis. we create the &ldquo;camera right&rdquo; vector by taking the <a href="https://mathworld.wolfram.com/CrossProduct.html" target="_blank">cross product</a> between the unit vector of the y-axis and the camera direction. This creates the red vector pointing to the right of the camera.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span></span></span></code></pre></div><p>In step 4, we then find the &ldquo;camera up&rdquo; vector by taking the cross product between the camera direction vector and the &ldquo;camera right&rdquo; vector. This &ldquo;camera up&rdquo; vector is depicted in the image by a green vector sticking out of the camera.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span></span></span></code></pre></div><p>Finally, we create a transformation matrix by combining these vectors together:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span> <span class="c1">// negative signs can be turned positive (or vice versa) to flip coordinate space conventions</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s look at the return statement for the <code>camera</code> function:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span></span></span></code></pre></div><p>Where did the negative signs come from? It&rsquo;s up to us to define a convention for how we want to label which direction is positive or negative for each axis in 3D space. This is the convention I will use in this tutorial. We&rsquo;ll see what happens when we flip the signs soon.</p>
<h4 id="applying-the-camera-matrix">Applying the Camera Matrix</h4>
<p>Now that we have created a <code>camera</code> function, let&rsquo;s use it in our <code>mainImage</code> function. We&rsquo;ll create a lookat point and pass it to the <code>camera</code> function. Then, we&rsquo;ll multiply the matrix it returns by the ray direction, similar to what we did in <a href="https://inspirnathan.com/posts/55-shadertoy-tutorial-part-9" target="_blank">Part 9</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span></span></span></code></pre></div><p>When you run your code, the scene should look almost the same. However, the camera is now targeting the origin in 3D space. Since the cubes are <code>0.5</code> units off the ground, the camera is slightly tilted from the center. We can point the camera directly at the center of the green cube by changing the lookat point to match the position of the green cube.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span></span></span></code></pre></div><p>Suppose we want to look at the red cube now. It currently has the position, <code>(-4, 0.5, -4)</code> in 3D space. Let&rsquo;s change the lookat point to match that position.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span></span></span></code></pre></div><p>You should see the camera now pointing at the red cube, and it should be in the center of the canvas.</p>
<p><a href="#R-image-ec1323c9286e31689583f1dcae976a95" class="lightbox-link"><img src="./assets/shadertoy-90.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ec1323c9286e31689583f1dcae976a95"><img src="./assets/shadertoy-90.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s now look at the blue cube. It has the position, <code>(4, 0.5, -4)</code> in 3D space, so we&rsquo;ll change the lookat point to equal that value.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span></span></span></code></pre></div><p>You should see the camera now pointing at the blue cube, and it should be in the center of the canvas.</p>
<p><a href="#R-image-af3723d571fb24cfdbca9dd00127851e" class="lightbox-link"><img src="./assets/shadertoy-91.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af3723d571fb24cfdbca9dd00127851e"><img src="./assets/shadertoy-91.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Constants</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">
</span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span> <span class="c1">// apply transformation matrix</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">
</span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// left cube</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// center cube</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// right cube</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">
</span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">	
</span></span><span class="line"><span class="ln">113</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">
</span></span><span class="line"><span class="ln">126</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">
</span></span><span class="line"><span class="ln">128</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">
</span></span><span class="line"><span class="ln">136</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">
</span></span><span class="line"><span class="ln">138</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">
</span></span><span class="line"><span class="ln">141</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="adjusting-the-sign-convention">Adjusting the Sign Convention</h4>
<p>Earlier, we saw that the <code>camera</code> function returns a matrix consisting of the three camera vectors.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If we setup the lookat point to point the camera at the green cube, we have the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span></span></span></code></pre></div><p>This produces the scene from the beginning of this tutorial where the red cube is on the left of the green cube, and the blue cube is on the right of the green cube.</p>
<p><a href="#R-image-76e7736285234b23be1206e53b42893a" class="lightbox-link"><img src="./assets/shadertoy-92.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-76e7736285234b23be1206e53b42893a"><img src="./assets/shadertoy-92.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If we decide to use a positive <code>cr</code> value in the <code>camera</code> function, then let&rsquo;s see what happens.</p>
<p><a href="#R-image-76f2c7cb00884e8fcbe819f229397a31" class="lightbox-link"><img src="./assets/shadertoy-93.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-76f2c7cb00884e8fcbe819f229397a31"><img src="./assets/shadertoy-93.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The red cube and blue cube seem to switch places, but pay attention to the floor tiles. They are switched too. The &ldquo;camera right&rdquo; vector is reversed which causes the whole scene to flip like looking at a mirror image of the original scene.</p>
<p>Using a positive <code>cr</code> impacts what the camera sees and also makes the position of our cubes seem confusing. Our x-axis is designed to be negative on the left of the center of the canvas and positive on the right of the center. Flipping <code>cr</code> means flipping that convention too.</p>
<p>If we flipped the value of the camera direction, <code>cd</code> to be positive instead of negative, it would turn the camera around because it would flip our z-axis convention.</p>
<p>Another way you can flip the z-axis convention is by using a positive value for the z-component of the ray direction.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">// positive one is being used instead of negative one</span></span></span></code></pre></div><p>When you use this alternative camera model with a lookat point, it&rsquo;s good to know the conventions you&rsquo;ve set for what&rsquo;s positive or negative across each axis.</p>
<p>You can play around with <code>cr</code>, <code>cu</code>, and <code>cd</code> to make some interesting effects. Make sure to change the ray direction, <code>rd</code>, back to using negative one.</p>
<p>The following code can create a slingshot effect across the z-axis to make it look like the camera zooms out and zooms in really quickly. Maybe this could be used to create a &ldquo;warp drive&rdquo; effect? ğŸ¤”</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="n">abs</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-0ac905c1344a24170596f0be3967309a" class="lightbox-link"><img src="./assets/shadertoy-17.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0ac905c1344a24170596f0be3967309a"><img src="./assets/shadertoy-17.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Go ahead and change the camera matrix back to normal before continuing to the next part of the tutorial.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="rotating-the-camera-around-a-target">Rotating the Camera Around a Target</h4>
<p>Suppose we wanted to rotate our camera in a circular path around the scene while keeping our camera pointed at the green cube. We&rsquo;ll keep the camera at a constant height (y-component) above the floor. Since all three cubes have a position with a y-component of <code>0.5</code>, we will make sure the y-component of <code>ro</code>, the ray origin (camera position), equals <code>0.5</code> as well.</p>
<p>If we want to make the camera follow a circular path around the size of the cubes, then we should focus on changing the x-component and z-component of the ray origin, <code>ro</code>.</p>
<p>If we looked at the cubes from a top-down perspective, then we would see a view similar to the following illustration.</p>
<p><a href="#R-image-9685557409031141fbd7402af2592abe" class="lightbox-link"><img src="./assets/shadertoy-94.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9685557409031141fbd7402af2592abe"><img src="./assets/shadertoy-94.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In the image above, the camera will follow a circular path (black). From a top-down perspective, the scene appears 2D with just an x-axis (red) and z-axis (blue).</p>
<p>The idea is to alter the x-component and z-component values of <code>ro</code> such that it follows a circular path. We can accomplish this by converting <code>ro.x</code> and <code>ro.z</code> into <a href="https://mathworld.wolfram.com/PolarCoordinates.html" target="_blank">polar coordinates</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span></span></span></code></pre></div><p>The value of the camera radius will be increased until we can see all the cubes in our scene. We currently have three cubes at the following positions in 3D space (defined in the <code>sdScene</code> function):</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// left cube</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// center cube</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// right cube</span></span></span></code></pre></div><p>Therefore, it might be safe to make the radius something like <code>10</code> because the distance between the left cube and right cube is <code>4 - (-4) = 8</code> units.</p>
<p>In our code, we&rsquo;ll convert the x-component and z-component of the ray origin to polar coordinates with a radius of ten. Then, we&rsquo;ll also shift our circular path by an offset such that the lookat point is the center of the circle made by the circular path.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// convert x-component to polar and add offset </span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="c1">// convert z-component to polar and add offset</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span></span></span></code></pre></div><p>When you run the code, you should see the camera spinning around the scene because it&rsquo;s following a circular path, but it&rsquo;s still looking at the green cube using our lookat point.</p>
<p><a href="#R-image-b93ce3410477d3383ca65bd94a4bad05" class="lightbox-link"><img src="./assets/shadertoy-18.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b93ce3410477d3383ca65bd94a4bad05"><img src="./assets/shadertoy-18.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>From a top-down perspective, our camera is moving in a circle that is offset by the lookat point&rsquo;s x-component and z-component, so we can make sure the lookat point stays in the center of our circle. This ensures that the distance from the green cube, the radius of the circle, stays equidistant from the green cube throughout the whole revolution.</p>
<p><a href="#R-image-284a17e49a71bc23c87b4df9686a608e" class="lightbox-link"><img src="./assets/shadertoy-19.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-284a17e49a71bc23c87b4df9686a608e"><img src="./assets/shadertoy-19.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can use the graph I created on <a href="https://www.desmos.com/calculator/5emxoibru1" target="_blank">Desmos</a> to experiment with the circular path. Imagine the green cube is located in the center of the circle.</p>
<p>Using a lookat point makes our camera more flexible. We can raise the camera higher along the y-axis and rotate around in a circle again, but get a bird&rsquo;s-eye view of the cubes instead.</p>
<p>Let&rsquo;s try adjusting the height of the camera (ray origin) and see what happens.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span></span></span></code></pre></div><p>When we run the code, we should see the camera now circling around the three cubes, but it&rsquo;s at a higher position. It&rsquo;s like we&rsquo;re a news reporter flying around in a helicopter.</p>
<p><a href="#R-image-834b4a720313aae5da0a9f07b491c9b1" class="lightbox-link"><img src="./assets/shadertoy-20.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-834b4a720313aae5da0a9f07b491c9b1"><img src="./assets/shadertoy-20.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you change the lookat point, you should start rotating around that new point instead!</p>
<p>You can find the finished code below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Constants</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">
</span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span> <span class="c1">// apply transformation matrix</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">
</span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// left cube</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// center cube</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// right cube</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">
</span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">	
</span></span><span class="line"><span class="ln">113</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// convert to polar </span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">  
</span></span><span class="line"><span class="ln">129</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">
</span></span><span class="line"><span class="ln">131</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">
</span></span><span class="line"><span class="ln">133</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">
</span></span><span class="line"><span class="ln">146</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="rotating-the-camera-with-the-mouse">Rotating the Camera with the Mouse</h4>
<p>You can also use the mouse to move the camera around the scene, but it requires some extra setup. As we learned in <a href="https://inspirnathan.com/posts/55-shadertoy-tutorial-part-9" target="_blank">Part 9</a> of this tutorial series, the <code>iMouse</code> global variable provides the mouse position data.</p>
<p>We can create &ldquo;mouse UV&rdquo; coordinates using the following line:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Range: &lt;0, 1&gt;</span></span></span></code></pre></div><p>We&rsquo;ll replace the following three lines, since we&rsquo;re using our mouse to rotate around the scene instead of using time.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">;</span> <span class="c1">// convert to polar </span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">)</span> <span class="o">+</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">;</span></span></span></code></pre></div><p>The following code will replace the above code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span> <span class="c1">// remap mouseUV.x to &lt;-pi, pi&gt; range</span></span></span></code></pre></div><p>Again, we&rsquo;re using the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml" target="_blank">mix</a> function to remap the x-component of the mouse position. This time, we&rsquo;re remapping values from the <code>&lt;0,1&gt;</code> range to the <code>&lt;-Ï€, Ï€&gt;</code> range. We also need to add the x-component and z-component of the lookat point.</p>
<p>Notice that we have a <code>rotate2d</code> function that doesn&rsquo;t specify an axis. This function will provide a 2D rotation using a 2D matrix. Add the following function at the top of your code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Like before, you may need to play around with the <code>cameraRadius</code> until it looks decent. Your finished code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="c1">// Constants</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="c1">// Rotate around a circular path</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="c1">// Rotation matrix around the X axis.</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateX</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">
</span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="c1">// Rotation matrix around the Y axis.</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateY</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">
</span></span><span class="line"><span class="ln"> 37</span><span class="cl"><span class="c1">// Rotation matrix around the Z axis.</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="c1">// Identity matrix.</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="n">mat3</span> <span class="n">identity</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">        <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBox</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">,</span> <span class="n">mat3</span> <span class="n">transform</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">transform</span><span class="p">;</span> <span class="c1">// apply transformation matrix</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span> <span class="o">+</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">q</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">
</span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">
</span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="n">Surface</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">
</span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="n">Surface</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// left cube</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// center cube</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">minWithColor</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">identity</span><span class="p">()));</span> <span class="c1">// right cube</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">
</span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">start</span><span class="p">,</span> <span class="k">float</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  
</span></span><span class="line"><span class="ln">102</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">
</span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">	
</span></span><span class="line"><span class="ln">119</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">
</span></span><span class="line"><span class="ln">122</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Range: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">
</span></span><span class="line"><span class="ln">128</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">  
</span></span><span class="line"><span class="ln">132</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">  
</span></span><span class="line"><span class="ln">136</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">
</span></span><span class="line"><span class="ln">138</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">MIN_DIST</span><span class="p">,</span> <span class="n">MAX_DIST</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">
</span></span><span class="line"><span class="ln">140</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on cube or floor we discovered from ray marching</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">
</span></span><span class="line"><span class="ln">148</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">
</span></span><span class="line"><span class="ln">150</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">backgroundColor</span> <span class="o">*</span> <span class="mf">.2</span><span class="p">;</span> <span class="c1">// Add a bit of background color to the diffuse color</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">
</span></span><span class="line"><span class="ln">153</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, you use your mouse to rotate around the scene! ğŸ‰ More specifically, you can use your mouse to rotate around your lookat point.</p>
<h4 id="conclusion-9">Conclusion</h4>
<p>I hope you now see how powerful this alternative camera model can be! The lookat point can make it easier to move the camera around the scene while focusing on a single target.</p>
<h4 id="resources-8">Resources</h4>
<ul>
<li><a href="https://learnopengl.com/Getting-started/Camera" target="_blank">Learn OpenGL: Camera</a></li>
<li><a href="https://mathworld.wolfram.com/CrossProduct.html" target="_blank">Cross Product</a></li>
<li><a href="https://mathworld.wolfram.com/PolarCoordinates.html" target="_blank">Polar Coordinates</a></li>
</ul>
<h3 id="tutorial-part-11---phong-reflection-model">Tutorial Part 11 - Phong Reflection Model</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/57-shadertoy-tutorial-part-11</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 11 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how to make our 3D objects a bit more realistic by using an improved lighting model called the <a href="https://en.wikipedia.org/wiki/Phong_reflection_model" target="_blank">Phong reflection model</a>.</p>
<h4 id="the-phong-reflection-model">The Phong Reflection Model</h4>
<p>In <a href="https://inspirnathan.com/posts/52-shadertoy-tutorial-part-6" target="_blank">Part 6</a> of this tutorial series, we learned how to color 3D objects using diffuse reflection aka <a href="https://en.wikipedia.org/wiki/Lambertian_reflectance" target="_blank">Lambertian reflection</a>. We&rsquo;ve been using this lighting model up until now, but this model is a bit limited.</p>
<p>The Phong reflection model, named after the creator, <a href="https://en.wikipedia.org/wiki/Bui_Tuong_Phong" target="_blank">Bui Tuong Phong</a>, is sometimes called &ldquo;Phong illumination&rdquo; or &ldquo;Phong lighting.&rdquo; It is composed of three parts: ambient lighting, diffuse reflection (Lambertian reflection), and specular reflection.</p>
<p><a href="#R-image-8e6bf6356a4fe978ce49c99df542644e" class="lightbox-link"><img src="./assets/shadertoy-95.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8e6bf6356a4fe978ce49c99df542644e"><img src="./assets/shadertoy-95.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Phong Reflection Model by <a href="https://en.wikipedia.org/wiki/Phong_reflection_model" target="_blank">Wikipedia</a></p>
<p>The Phong reflection model provides an equation for computing the illumination on each point on a surface, <code>I_p</code>.</p>
<p><a href="#R-image-dfd3a4788b652b5b3dffa45839555558" class="lightbox-link"><img src="./assets/shadertoy-96.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dfd3a4788b652b5b3dffa45839555558"><img src="./assets/shadertoy-96.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Phong Reflection Equation by <a href="https://en.wikipedia.org/wiki/Phong_reflection_model" target="_blank">Wikipedia</a></p>
<p>This equation may look complex, but I&rsquo;ll explain each part of it! This equation is composed of three main parts: ambient, diffuse, and specular. The subscript, &ldquo;m,&rdquo; refers to the number of lights in our scene. We&rsquo;ll assume just one light exists for now.</p>
<p><a href="#R-image-7f43583f8408677c251a0b3de3a2b17e" class="lightbox-link"><img src="./assets/shadertoy-97.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7f43583f8408677c251a0b3de3a2b17e"><img src="./assets/shadertoy-97.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The first part represents the ambient light term. In GLSL code, it can be represented by the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">k_a</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="c1">// a value of our choice, typically between zero and one</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">i_a</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// a color of our choice</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">vec3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">k_a</span> <span class="o">*</span> <span class="n">i_a</span><span class="p">;</span></span></span></code></pre></div><p>The <code>k_a</code> value is the ambient reflection constant, the ratio of reflection of the ambient term present in all points in the scene rendered. The <code>i_a</code> value controls the ambient lighting and is sometimes computed as a sum of contributions from all light sources.</p>
<p>The second part of the Phong reflection equation represents the diffusion reflection term. In GLSL code, it can be represented by the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on surface found by ray marching</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">vec3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">vec3</span> <span class="n">L</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">k_d</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// a value of our choice, typically between zero and one</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec3</span> <span class="n">dotLN</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">i_d</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span> <span class="c1">// a color of our choice</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">k_d</span> <span class="o">*</span> <span class="n">dotLN</span> <span class="o">*</span> <span class="n">i_d</span><span class="p">;</span></span></span></code></pre></div><p>The value, <code>k_d</code>, is the diffuse reflection constant, the ratio of reflection of the diffuse term of incoming light <a href="https://en.wikipedia.org/wiki/Lambertian_reflectance" target="_blank">Lambertian reflectance</a>. The value, <code>dotLN</code>, is the diffuse reflection we&rsquo;ve been using in previous tutorials. It represents the Lambertian reflection. The value, <code>i_d</code>, is the intensity of a light source in your scene, defined by a color value in our case.</p>
<p>The third part of the Phong reflection equation is a bit more complex. It represents the specular reflection term. In real life, materials such as metals and polished surfaces have specular reflection that look brighter depending on the camera angle or where the viewer is facing the object. Therefore, this term is a function of the camera position in our scene.</p>
<p><a href="#R-image-930aabfbae94511e456c54df5d39f205" class="lightbox-link"><img src="./assets/shadertoy-98.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-930aabfbae94511e456c54df5d39f205"><img src="./assets/shadertoy-98.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In GLSL code, it can be represented by the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on surface found by ray marching</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">vec3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">vec3</span> <span class="n">L</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">k_s</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span> <span class="c1">// a value of our choice, typically between zero and one</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">vec3</span> <span class="n">R</span> <span class="o">=</span> <span class="n">reflect</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">vec3</span> <span class="n">V</span> <span class="o">=</span> <span class="o">-</span><span class="n">rd</span><span class="p">;</span> <span class="c1">// direction pointing toward viewer (V) is just the negative of the ray direction</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">vec3</span> <span class="n">dotRV</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">V</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">vec3</span> <span class="n">i_s</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// a color of our choice</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">k_s</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">dotRV</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">i_s</span><span class="p">;</span></span></span></code></pre></div><p>The value, <code>k_s</code>, is the specular reflection constant, the ratio of reflection of the specular term of incoming light.</p>
<p>The vector, <code>R</code>, is the direction that a perfectly reflected ray of light would take if it bounced off the surface.</p>
<p><a href="#R-image-31d01c383fee20041998c3848f623410" class="lightbox-link"><img src="./assets/shadertoy-99.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-31d01c383fee20041998c3848f623410"><img src="./assets/shadertoy-99.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>According to Wikipedia, the Phong reflection model calculates the reflected ray direction using the following formula.</p>
<p><a href="#R-image-c55cb7a0f2b37329b77380c9971556cc" class="lightbox-link"><img src="./assets/shadertoy-100.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c55cb7a0f2b37329b77380c9971556cc"><img src="./assets/shadertoy-100.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>As mentioned previously, the subscript, &ldquo;m,&rdquo; refers to the number of lights in our scene. The little hat, <code>^</code>, above each letter means we should use the normalized version of each vector. The vector, <code>L</code>, refers to the light direction. The vector, <code>N</code> refers to the surface normal.</p>
<p>GLSL provides a handly function called <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/reflect.xhtml" target="_blank">reflect</a> that calculates the direction of the reflected ray from the incident ray for us. This function takes two parameters: the incident ray direction vector, and the normal vector.</p>
<p>Internally, the <code>reflect</code> function is equal to <code>I - 2.0 * dot(N, I) * N</code> where <code>I</code> is the incident ray direction and <code>N</code> is the normal vector. If we multiplied this equation by <code>-1</code>, we&rsquo;d end up with the same equation as the reflection equation on Wikipedia. It&rsquo;s all a matter of axes conventions.</p>
<p>The vector, <code>V</code>, in the code snippet for specular reflection represents the direction pointing towards the viewer or camera. We can set this equal to the negative of the ray direction, <code>rd</code>.</p>
<p>The <code>alpha</code> term is used to control the amount of &ldquo;shininess&rdquo; on the sphere. A lower value makes it appear shinier.</p>
<h4 id="putting-it-all-together">Putting it All Together</h4>
<p>Let&rsquo;s put everything we&rsquo;ve learned so far together in our code. We&rsquo;ll start with a simple sphere in our scene and use a lookat point for our camera model like we learned in <a href="https://inspirnathan.com/posts/56-shadertoy-tutorial-part-10" target="_blank">Part 10</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">	
</span></span><span class="line"><span class="ln">42</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">
</span></span><span class="line"><span class="ln">54</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">      <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">      <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">      <span class="k">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDirection</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">
</span></span><span class="line"><span class="ln">68</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">diffuse</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see a simple sphere in the scene with diffuse lighting.</p>
<p><a href="#R-image-f767c128327af791febd7de66de3c9be" class="lightbox-link"><img src="./assets/shadertoy-101.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f767c128327af791febd7de66de3c9be"><img src="./assets/shadertoy-101.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This is boring though. We want a shiny sphere! Currently, we&rsquo;re only coloring the sphere based on diffuse lighting, or Lambertian reflection. Let&rsquo;s add an ambient and specular component to complete the Phong reflection model. We&rsquo;ll also adjust the light direction a bit, so we get a shine to appear on the top-right part of the sphere.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on surface found by ray marching</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">      <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">      <span class="c1">// light</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="c1">// ambient</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">      <span class="k">float</span> <span class="n">k_a</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="k">vec3</span> <span class="n">i_a</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">      <span class="k">vec3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">k_a</span> <span class="o">*</span> <span class="n">i_a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="c1">// diffuse</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="k">float</span> <span class="n">k_d</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="k">float</span> <span class="n">dotLN</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDirection</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="k">vec3</span> <span class="n">i_d</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="k">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">k_d</span> <span class="o">*</span> <span class="n">dotLN</span> <span class="o">*</span> <span class="n">i_d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="c1">// specular</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="k">float</span> <span class="n">k_s</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">      <span class="k">float</span> <span class="n">dotRV</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDirection</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="k">vec3</span> <span class="n">i_s</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">      <span class="k">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">      <span class="k">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">k_s</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">dotRV</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">i_s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">      <span class="c1">// final sphere color</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">ambient</span> <span class="o">+</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Like before, we clamp the result of each dot product, so that the value is between zero and one. When we run the code, we should see the sphere glisten a bit on the top-right part of the sphere.</p>
<p><a href="#R-image-ca2e4f37580182d10fc313d8db6e70fb" class="lightbox-link"><img src="./assets/shadertoy-102.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ca2e4f37580182d10fc313d8db6e70fb"><img src="./assets/shadertoy-102.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="multiple-lights">Multiple Lights</h4>
<p>You may have noticed that the Phong reflection equation uses a <a href="https://en.wikipedia.org/wiki/Summation" target="_blank">summation</a> for the diffuse and specular components. If you add more lights to the scene, then you&rsquo;ll have a diffuse and specular component for each light.</p>
<p><a href="#R-image-b8ee0fea574e1a0d388c9940c2122dc3" class="lightbox-link"><img src="./assets/shadertoy-103.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b8ee0fea574e1a0d388c9940c2122dc3"><img src="./assets/shadertoy-103.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To make it easier to handle multiple lights, we&rsquo;ll create a <code>phong</code> function. Since this scene is only coloring one object, we can place the reflection coefficients (<code>k_a</code>, <code>k_d</code>, <code>k_s</code>) and intensities in the <code>phong</code> function too.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">
</span></span><span class="line"><span class="ln"> 28</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">
</span></span><span class="line"><span class="ln"> 37</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="k">vec3</span> <span class="n">phong</span><span class="p">(</span><span class="k">vec3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">normal</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">  <span class="c1">// ambient</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">  <span class="k">float</span> <span class="n">k_a</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">  <span class="k">vec3</span> <span class="n">i_a</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">  <span class="k">vec3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">k_a</span> <span class="o">*</span> <span class="n">i_a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">  <span class="c1">// diffuse</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">  <span class="k">float</span> <span class="n">k_d</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="k">float</span> <span class="n">dotLN</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">  <span class="k">vec3</span> <span class="n">i_d</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  <span class="k">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">k_d</span> <span class="o">*</span> <span class="n">dotLN</span> <span class="o">*</span> <span class="n">i_d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="c1">// specular</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">float</span> <span class="n">k_s</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">float</span> <span class="n">dotRV</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">vec3</span> <span class="n">i_s</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="k">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="k">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">k_s</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">dotRV</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">i_s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">return</span> <span class="n">ambient</span> <span class="o">+</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">      <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point on surface found by ray marching</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">      <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">      <span class="c1">// light #1</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition1</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition1</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">      <span class="k">float</span> <span class="n">lightIntensity1</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">      <span class="c1">// light #2</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition2</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition2</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">      <span class="k">float</span> <span class="n">lightIntensity2</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">      <span class="c1">// final sphere color</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">lightIntensity1</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection1</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">      <span class="n">col</span> <span class="o">+=</span> <span class="n">lightIntensity2</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection2</span><span class="p">,</span> <span class="n">normal</span> <span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We can multiply the result of the <code>phong</code> function by light intensity values so that the sphere doesn&rsquo;t appear too bright. When you run the code, your sphere should look shinier!!!</p>
<p><a href="#R-image-44381645d7c88cf1a6599e400b15f81e" class="lightbox-link"><img src="./assets/shadertoy-104.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-44381645d7c88cf1a6599e400b15f81e"><img src="./assets/shadertoy-104.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="coloring-multiple-objects">Coloring Multiple Objects</h4>
<p>Placing all the reflection coefficients and intensities inside the <code>phong</code> function isn&rsquo;t very practical. You could have multiple objects in your scene with different types of materials. Some objects could appear glossy and reflective while other objects have little to no specular reflectance.</p>
<p>It makes more sense to create materials that can be applied to one or more objects. Each material will have its own coefficients for ambient, diffuse, and specular components. We can create a <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Structs" target="_blank">struct</a> for materials that will hold all the information needed for the Phong reflection model.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="n">Material</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">vec3</span> <span class="n">ambientColor</span><span class="p">;</span> <span class="c1">// k_a * i_a</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">diffuseColor</span><span class="p">;</span> <span class="c1">// k_d * i_d</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec3</span> <span class="n">specularColor</span><span class="p">;</span> <span class="c1">// k_s * i_s</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">alpha</span><span class="p">;</span> <span class="c1">// shininess</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>Then, we could create another struct for each surface or object in the scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">int</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// id of object</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value from SDF</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">Material</span> <span class="n">mat</span><span class="p">;</span> <span class="c1">// material of object</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll be creating a scene with a tiled floor and two spheres. First, we&rsquo;ll create three materials. We&rsquo;ll create a <code>gold</code> function that returns a gold material, a <code>silver</code> function that returns a silver material, and a <code>checkerboard</code> function that returns a checkerboard pattern. As you might expect, the checkerboard pattern won&rsquo;t be very shiny, but the metals will!</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Material</span> <span class="n">gold</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">Material</span> <span class="n">silver</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">Material</span> <span class="n">checkerboard</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll create a <code>opUnion</code> function that will act identical to the <code>minWithColor</code> function we used in previous tutorials.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Our scene will use the <code>opUnion</code> function to add the tiled floor and spheres to the scene:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">Surface</span> <span class="n">sFloor</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">checkerboard</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">Surface</span> <span class="n">sSphereGold</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">gold</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">Surface</span> <span class="n">sSphereSilver</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">silver</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sFloor</span><span class="p">,</span> <span class="n">sSphereGold</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sSphereSilver</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll add a parameter to the <code>phong</code> function that accepts a <code>Material</code>. This material will hold all the color values we need for each component of the Phong reflection model.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">phong</span><span class="p">(</span><span class="k">vec3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">normal</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="n">Material</span> <span class="n">mat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="c1">// ambient</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">ambientColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="c1">// diffuse</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">dotLN</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">diffuseColor</span> <span class="o">*</span> <span class="n">dotLN</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// specular</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">dotRV</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">specularColor</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">dotRV</span><span class="p">,</span> <span class="n">mat</span><span class="p">.</span><span class="n">alpha</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">ambient</span> <span class="o">+</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Inside the <code>mainImage</code> function, we can pass the material of the closest object to the <code>phong</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">lightIntensity1</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection1</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">co</span><span class="p">.</span><span class="n">mat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">col</span> <span class="o">+=</span> <span class="n">lightIntensity2</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection2</span><span class="p">,</span> <span class="n">normal</span> <span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">co</span><span class="p">.</span><span class="n">mat</span><span class="p">);</span></span></span></code></pre></div><p>Putting this all together, we get the following code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="k">struct</span> <span class="n">Material</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">  <span class="k">vec3</span> <span class="n">ambientColor</span><span class="p">;</span> <span class="c1">// k_a * i_a</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">  <span class="k">vec3</span> <span class="n">diffuseColor</span><span class="p">;</span> <span class="c1">// k_d * i_d</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">  <span class="k">vec3</span> <span class="n">specularColor</span><span class="p">;</span> <span class="c1">// k_s * i_s</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">  <span class="k">float</span> <span class="n">alpha</span><span class="p">;</span> <span class="c1">// shininess</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">  <span class="k">int</span> <span class="n">id</span><span class="p">;</span> <span class="c1">// id of object</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">  <span class="n">Material</span> <span class="n">mat</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">Material</span> <span class="n">gold</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">
</span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="n">Material</span> <span class="n">silver</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="n">Material</span> <span class="n">checkerboard</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">  <span class="k">vec3</span> <span class="n">aCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="k">vec3</span> <span class="n">dCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">  <span class="k">vec3</span> <span class="n">sCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">  <span class="k">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">  <span class="k">return</span> <span class="n">Material</span><span class="p">(</span><span class="n">aCol</span><span class="p">,</span> <span class="n">dCol</span><span class="p">,</span> <span class="n">sCol</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="n">Surface</span> <span class="n">sFloor</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">checkerboard</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">Surface</span> <span class="n">sSphereGold</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">gold</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="n">Surface</span> <span class="n">sSphereSilver</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">silver</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sFloor</span><span class="p">,</span> <span class="n">sSphereGold</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sSphereSilver</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">
</span></span><span class="line"><span class="ln"> 91</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span> <span class="c1">// camera direction</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span> <span class="c1">// camera right</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span> <span class="c1">// camera up</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="k">vec3</span> <span class="n">phong</span><span class="p">(</span><span class="k">vec3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">normal</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="n">Material</span> <span class="n">mat</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="c1">// ambient</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="k">vec3</span> <span class="n">ambient</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">ambientColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="c1">// diffuse</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="k">float</span> <span class="n">dotLN</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="k">vec3</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">diffuseColor</span> <span class="o">*</span> <span class="n">dotLN</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">
</span></span><span class="line"><span class="ln">107</span><span class="cl">  <span class="c1">// specular</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="k">float</span> <span class="n">dotRV</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="k">vec3</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">mat</span><span class="p">.</span><span class="n">specularColor</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">dotRV</span><span class="p">,</span> <span class="n">mat</span><span class="p">.</span><span class="n">alpha</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="k">return</span> <span class="n">ambient</span> <span class="o">+</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">specular</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">
</span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">.341</span><span class="p">,</span> <span class="mf">.2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point (aka camera target)</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">      <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point on surface found by ray marching</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">      <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">
</span></span><span class="line"><span class="ln">133</span><span class="cl">      <span class="c1">// light #1</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition1</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition1</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">      <span class="k">float</span> <span class="n">lightIntensity1</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">      
</span></span><span class="line"><span class="ln">138</span><span class="cl">      <span class="c1">// light #2</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightPosition2</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">      <span class="k">vec3</span> <span class="n">lightDirection2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition2</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">      <span class="k">float</span> <span class="n">lightIntensity2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">
</span></span><span class="line"><span class="ln">143</span><span class="cl">      <span class="c1">// final color of object</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">      <span class="n">col</span> <span class="o">=</span> <span class="n">lightIntensity1</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection1</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">co</span><span class="p">.</span><span class="n">mat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">      <span class="n">col</span> <span class="o">+=</span> <span class="n">lightIntensity2</span> <span class="o">*</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection2</span><span class="p">,</span> <span class="n">normal</span> <span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">co</span><span class="p">.</span><span class="n">mat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">
</span></span><span class="line"><span class="ln">148</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When we run this code, we should see a golden sphere and silver sphere floating in front of a sunset. Gorgeous!</p>
<p><a href="#R-image-0cab5c2293e961a0fd88cf722f9a33ce" class="lightbox-link"><img src="./assets/shadertoy-105.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0cab5c2293e961a0fd88cf722f9a33ce"><img src="./assets/shadertoy-105.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="conclusion-10">Conclusion</h4>
<p>In this lesson, we learned how the Phong reflection model can really improve the look of our scene by adding a bit of glare or gloss to our objects. We also learned how to assign different materials to each object in the scene by using structs. Making shaders sure is fun! ğŸ˜ƒ</p>
<h4 id="resources-9">Resources</h4>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Phong_reflection_model" target="_blank">Phong Reflection Model</a></li>
<li><a href="https://en.wikipedia.org/wiki/Lambertian_reflectance" target="_blank">Lambertian Reflectance</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/reflect.xhtml" target="_blank">Khronos: Reflect</a></li>
<li><a href="https://www.shadertoy.com/view/NdB3Dc" target="_blank">Shadertoy: Phong Reflection Model</a></li>
<li><a href="https://www.shadertoy.com/view/sslXR8" target="_blank">Shadertoy: Gold and Silver Spheres</a></li>
</ul>
<h3 id="tutorial-part-12---fresnel-and-rim-lighting">Tutorial Part 12 - Fresnel and Rim Lighting</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/58-shadertoy-tutorial-part-12</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 12 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how to add rim lighting around a sphere using fresnel reflection.</p>
<h4 id="initial-setup-3">Initial Setup</h4>
<p>We&rsquo;ll start with a basic ray marching template.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="k">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="k">vec3</span> <span class="n">diffuseColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">diffuse</span> <span class="o">*</span> <span class="n">diffuseColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run this code, you should see a blue sphere with only diffuse (Lambertian) reflection.</p>
<p><a href="#R-image-e286645b693f8a4636102168a19a236c" class="lightbox-link"><img src="./assets/shadertoy-106.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e286645b693f8a4636102168a19a236c"><img src="./assets/shadertoy-106.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="fresnel-reflection">Fresnel Reflection</h4>
<p>The <a href="https://en.wikipedia.org/wiki/Fresnel_equations" target="_blank">Fresnel equations</a> describe the reflection and transmission of light when it is incident on an interface between two different optical media. In simpler terms, this means that objects can be lit a bit differently when you look at them from grazing angles.</p>
<p>The term, <a href="https://en.wikipedia.org/wiki/Medium_%28optics%29" target="_blank">optical media</a>, refers to the type of material light passes through. Different materials tend to have different <a href="https://en.wikipedia.org/wiki/Refractive_index" target="_blank">refractive indices</a> which makes it appear that light is bending.</p>
<p><a href="#R-image-cd61f5617a0ad455213e7766176fceec" class="lightbox-link"><img src="./assets/shadertoy-107.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cd61f5617a0ad455213e7766176fceec"><img src="./assets/shadertoy-107.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Refraction by <a href="https://en.wikipedia.org/wiki/Refractive_index" target="_blank">Wikipedia</a></p>
<p>Air is a type of medium. It typically has an <a href="https://en.wikipedia.org/wiki/List_of_refractive_indices" target="_blank">index of refraction</a> of about 1.000293. Materials such as diamonds have a high index of refraction. Diamond has an index of refraction of 2.417. A high index of refraction means light will appear to bend even more.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Fresnel_equations" target="_blank">Fresnel equations</a> can get pretty complicated. For computer graphics, you will typically see people use the <a href="https://en.wikipedia.org/wiki/Schlick%27s_approximation" target="_blank">Schlick&rsquo;s approximation</a> for approximating the Fresnel contribution of reflection.</p>
<p><a href="#R-image-8bff2c95da143688232b8be02a6b3b0a" class="lightbox-link"><img src="./assets/shadertoy-108.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8bff2c95da143688232b8be02a6b3b0a"><img src="./assets/shadertoy-108.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Schlick&rsquo;s approximation by <a href="https://en.wikipedia.org/wiki/Schlick%27s_approximation" target="_blank">Wikipedia</a></p>
<p>The above equation calculates the Fresnel contribution to reflection, <code>R</code> where <code>R0</code> is the reflection coefficient for light incoming parallel to the normal (typically when <code>Î¸</code> equals zero).</p>
<p>The value of <code>cos Î¸</code> is equal to the dot product between the surface normal and the direction the incident light is coming from. In our code, however, we&rsquo;ll use the ray direction, <code>rd</code>.</p>
<p>For the purposes of our examples, we will assume that the refractive index of air and the sphere are both equal to one. This will help simplify our calculations. This means that <code>R0</code> is equal to zero.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-markup" data-lang="markup">n1 = 1
n2 = 1

R0 = ((n1 - n2)/(n1 + n2)) ^ 2
R0 = ((1 - 1)/(1 + 1)) ^ 2
R0 = 0</code></pre></div><p>With <code>R0</code> equal to zero, we can simplify the Fresnel reflection equation even more.</p>
<div class="wrap-code highlight"><pre tabindex="0"><code class="language-markup" data-lang="markup">R = R0 + (1 - R0)(1 - cosÎ¸)^5

Since R0 = 0,
R = (1 - cosÎ¸)^5</code></pre></div><p>In GLSL code, this can be written as:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">fresnel</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">5.</span><span class="p">);</span></span></span></code></pre></div><p>However, we clamp the values to make sure we keep the range between zero and one. We also use <code>-rd</code>. If you used positive <code>rd</code>, then you might not see the color only being applied to the rim of the sphere.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">fresnel</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">5.</span><span class="p">);</span></span></span></code></pre></div><p>We can multiply this fresnel value by a color value, so we can apply a colored rim around our blue sphere. Below is the finished code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">offset</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="k">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="k">vec3</span> <span class="n">diffuseColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">float</span> <span class="n">fresnel</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">5.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">    <span class="k">vec3</span> <span class="n">rimColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">diffuse</span> <span class="o">*</span> <span class="n">diffuseColor</span> <span class="o">+</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">rimColor</span><span class="p">;</span> <span class="c1">// add the fresnel contribution</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If you run this code, you should see a thin white rim of our blue sphere. This simulates the effect of light hitting a grazing angle of our sphere.</p>
<p><a href="#R-image-980904efa16d3fe6f641b13f64c519ea" class="lightbox-link"><img src="./assets/shadertoy-109.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-980904efa16d3fe6f641b13f64c519ea"><img src="./assets/shadertoy-109.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can play around with the exponent and the rim color to get a &ldquo;force field&rdquo; like effect.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">fresnel</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">rimColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">diffuse</span> <span class="o">*</span> <span class="n">diffuseColor</span> <span class="o">+</span> <span class="n">fresnel</span> <span class="o">*</span> <span class="n">rimColor</span><span class="p">;</span></span></span></code></pre></div><p><a href="#R-image-5c98751ef72d9669e7952591c515b892" class="lightbox-link"><img src="./assets/shadertoy-110.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5c98751ef72d9669e7952591c515b892"><img src="./assets/shadertoy-110.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="conclusion-11">Conclusion</h4>
<p>In this article we learned how to add rim lighting around objects by applying fresnel reflection. If you&rsquo;re dealing with objects that mimic glass or plastic, then adding fresnel can help make them a bit more realistic.</p>
<h4 id="resources-10">Resources</h4>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Fresnel_equations" target="_blank">Wikipedia: Fresnel Equations</a></li>
<li><a href="https://en.wikipedia.org/wiki/Medium_%28optics%29" target="_blank">Wikipedia: Medium (optics)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Refractive_index" target="_blank">Wikipedia: Refractive Index</a></li>
<li><a href="https://en.wikipedia.org/wiki/Schlick%27s_approximation" target="_blank">Wikipedia: Schlick&rsquo;s Approximation</a></li>
<li><a href="https://www.shadertoy.com/view/sdjGR3" target="_blank">Shadertoy: Sphere Rim Lighting with Fresnel</a></li>
</ul>
<h3 id="tutorial-part-13---shadows">Tutorial Part 13 - Shadows</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/59-shadertoy-tutorial-part-13</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 13 of my Shadertoy tutorial series. In this tutorial, we&rsquo;ll learn how to add shadows to our 3D scene.</p>
<h4 id="initial-setup-4">Initial Setup</h4>
<p>Our starting code for this tutorial is going to be a bit different this time. We&rsquo;re going to go back to rendering scenes with just one color and we&rsquo;ll go back to using a basic camera with no lookat point. I&rsquo;ve also made the <code>rayMarch</code> function a bit simpler. It accepts two parameters instead of four. We weren&rsquo;t really using the last two parameters anyways.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">co</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// signed distance value to closest object</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection clamped between zero and one</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">
</span></span><span class="line"><span class="ln">68</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>After running the code, we should see a very basic 3D scene with a sphere, a floor, and diffuse reflection. The color from the diffuse reflection will be shades of gray between black and white.</p>
<p><a href="#R-image-6cb303ab9796c36b29705f801aecf06e" class="lightbox-link"><img src="./assets/shadertoy-111.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-6cb303ab9796c36b29705f801aecf06e"><img src="./assets/shadertoy-111.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="basic-shadows">Basic Shadows</h4>
<p>Let&rsquo;s start with learning how to add very simple shadows. Before we start coding, let&rsquo;s look at the image below to visualize how the algorithm will work.</p>
<p><a href="#R-image-eaa1e77fbab959c2bd125c24e7327c4f" class="lightbox-link"><img src="./assets/shadertoy-112.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-eaa1e77fbab959c2bd125c24e7327c4f"><img src="./assets/shadertoy-112.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Ray tracing diagram by <a href="https://en.wikipedia.org/wiki/Ray_tracing_%28graphics%29" target="_blank">Wikipedia</a></p>
<p>Our <code>rayMarch</code> function implements the ray marching algorithm. We currently use it for discovering a point in the scene that hits the nearest object or surface. However, we can use it a second time to generate a new ray and point this ray toward our light source in the scene. In the image above, there are &ldquo;shadow rays&rdquo; that are casted toward the light source from the floor.</p>
<p>In our code, we will perform ray marching a second time, where the new ray origin is equal to <code>p</code>, the point on the sphere or floor we discovered from the first ray marching step. The new ray direction will be equal to <code>lightDirection</code>. In our code, it&rsquo;s as simple as adding three lines underneath the diffuse reflection calculation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection clamped between zero and one</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">float</span> <span class="n">shadowRayLength</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">newRayOrigin</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">);</span> <span class="c1">// cast shadow ray to the light source</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">shadowRayLength</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">newRayOrigin</span><span class="p">))</span> <span class="n">dif</span> <span class="o">*=</span> <span class="mf">0.</span><span class="p">;</span> <span class="c1">// if the shadow ray hits the sphere, set the diffuse reflection to zero, simulating a shadow</span></span></span></code></pre></div><p>However, when you run this code, the screen will appear almost completely black. What&rsquo;s going on? During the first ray march loop, we fire off rays from the camera. If our ray hits a point, <code>p</code>, that is closer to the floor than the sphere, then the signed distance value will equal to the length from the camera to the floor.</p>
<p>When we use this same <code>p</code> value in the second ray march loop, we already know it&rsquo;s closer to the floor than the surface of the sphere. Therefore almost everything will seem like it&rsquo;s in the shadow, causing the screen to go black. We need to choose a value very close to <code>p</code> during the second ray march step, so we don&rsquo;t have this issue occurring.</p>
<p>A common approach is to add the surface normal, multiplied by a tiny value, to the value of <code>p</code>, so we get a neighboring point. We will use the <code>PRECISION</code> variable as the tiny value that will slightly nudge <code>p</code> to a neighboring point.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="n">PRECISION</span><span class="p">;</span></span></span></code></pre></div><p>When you run the code, you should now see a shadow appear below the sphere. However, there&rsquo;s a strange artifact near the center of the sphere.</p>
<p><a href="#R-image-cd0e7eb36e72014ac6c3d28d57ffe86b" class="lightbox-link"><img src="./assets/shadertoy-113.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cd0e7eb36e72014ac6c3d28d57ffe86b"><img src="./assets/shadertoy-113.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We can multiply the precision value by two to make it go away.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="n">PRECISION</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">;</span></span></span></code></pre></div><p><a href="#R-image-5cbd9611e9f2077bd15607c7801fa68a" class="lightbox-link"><img src="./assets/shadertoy-114.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5cbd9611e9f2077bd15607c7801fa68a"><img src="./assets/shadertoy-114.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When adding shadows to your scene, you may need to keep adjusting <code>newRayOrigin</code> by multiplying by different factors to see what works. Making realistic shadows is not an easy task, and you may find yourself playing around with values until it looks good.</p>
<p>You finished code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">float</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">co</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// signed distance value to closest object</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection clamped between zero and one</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    
</span></span><span class="line"><span class="ln">68</span><span class="cl">    <span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="n">PRECISION</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">    <span class="k">float</span> <span class="n">shadowRayLength</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">newRayOrigin</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">shadowRayLength</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">newRayOrigin</span><span class="p">))</span> <span class="n">dif</span> <span class="o">*=</span> <span class="mf">0.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl">
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">
</span></span><span class="line"><span class="ln">75</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="adding-shadows-to-colored-scenes">Adding Shadows to Colored Scenes</h4>
<p>Using the same technique, we can apply shadows to the colored scenes we&rsquo;ve been working with in the past few tutorials.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">
</span></span><span class="line"><span class="ln">71</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">76</span><span class="cl">
</span></span><span class="line"><span class="ln">77</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl">    
</span></span><span class="line"><span class="ln">80</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">    
</span></span><span class="line"><span class="ln">82</span><span class="cl">    <span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="n">PRECISION</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">83</span><span class="cl">    <span class="k">float</span> <span class="n">shadowRayLength</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">newRayOrigin</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">).</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// cast shadow ray to the light source</span>
</span></span><span class="line"><span class="ln">84</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">shadowRayLength</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">newRayOrigin</span><span class="p">))</span> <span class="n">dif</span> <span class="o">*=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="c1">// shadow</span>
</span></span><span class="line"><span class="ln">85</span><span class="cl">
</span></span><span class="line"><span class="ln">86</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">87</span><span class="cl">    
</span></span><span class="line"><span class="ln">88</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">89</span><span class="cl">
</span></span><span class="line"><span class="ln">90</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">91</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If you run this code, you should see a red sphere with a moving light source (and therefore &ldquo;moving&rdquo; shadow), but the entire scene appears a bit too dark.</p>
<p><a href="#R-image-258789ade3aa9ee6d9e88343ac485681" class="lightbox-link"><img src="./assets/shadertoy-115.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-258789ade3aa9ee6d9e88343ac485681"><img src="./assets/shadertoy-115.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="gamma-correction">Gamma Correction</h4>
<p>We can apply a bit of <a href="https://en.wikipedia.org/wiki/Gamma_correction" target="_blank">gamma correction</a> to make the darker colors brighter. We&rsquo;ll add this line right before we output the final color to the screen.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.2</span><span class="p">));</span> <span class="c1">// Gamma correction</span></span></span></code></pre></div><p>Your <code>mainImage</code> function should now look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">vec3</span> <span class="n">newRayOrigin</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">normal</span> <span class="o">*</span> <span class="n">PRECISION</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">float</span> <span class="n">shadowRayLength</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">newRayOrigin</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">).</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// cast shadow ray to the light source</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">shadowRayLength</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">newRayOrigin</span><span class="p">))</span> <span class="n">dif</span> <span class="o">*=</span> <span class="mf">0.</span><span class="p">;</span> <span class="c1">// shadow</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span><span class="p">;</span> 
</span></span><span class="line"><span class="ln">28</span><span class="cl">    
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.2</span><span class="p">));</span> <span class="c1">// Gamma correction</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see the entire scene appear brighter.</p>
<p><a href="#R-image-ec11533f0ceb5e6b169a3e8f817b439c" class="lightbox-link"><img src="./assets/shadertoy-116.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ec11533f0ceb5e6b169a3e8f817b439c"><img src="./assets/shadertoy-116.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The shadow seems a bit too dark still. We can lighten it by adjusting how much we should scale the diffuse reflection by. Currently, we&rsquo;re setting the diffuse reflection color of the floor and sphere to zero when we calculate which points lie in the shadow.</p>
<p>We can change the &ldquo;scaling factor&rdquo; to <code>0.2</code> instead:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">shadowRayLength</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">newRayOrigin</span><span class="p">))</span> <span class="n">dif</span> <span class="o">*=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// shadow</span></span></span></code></pre></div><p>Now the shadow looks a bit better, and you can see the diffuse color of the floor through the shadow.</p>
<p><a href="#R-image-fc59be1af1e0c9978235d53b4ba18c70" class="lightbox-link"><img src="./assets/shadertoy-117.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fc59be1af1e0c9978235d53b4ba18c70"><img src="./assets/shadertoy-117.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="soft-shadows">Soft Shadows</h4>
<p>In real life, shadows tend to have multiple parts, including an <a href="https://en.wikipedia.org/wiki/Umbra,_penumbra_and_antumbra" target="_blank">umbra, penumbra, and antumbra</a>. We can add a &ldquo;soft shadow&rdquo; that tries to copy shadows in real life by using algorithms found on <a href="https://www.iquilezles.org/www/articles/rmshadows/rmshadows.htm" target="_blank">Inigo Quilez&rsquo;s website</a>.</p>
<p>Below is an implementation of the &ldquo;soft shadow&rdquo; function found in the popular Shadertoy shader, <a href="https://www.shadertoy.com/view/ltyXD3" target="_blank">Raymarching Primitives Commented</a>. I have made adjustments to make it compatible with our code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">softShadow</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">mint</span><span class="p">,</span> <span class="k">float</span> <span class="n">tmax</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mint</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">t</span><span class="p">).</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">      <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">8.0</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="n">t</span> <span class="o">+=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="o">||</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">res</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>In our <code>mainImage</code> function, we can remove the &ldquo;hard shadow&rdquo; code and replace it with the &ldquo;soft shadow&rdquo; implementation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">softShadow</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">softShadow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">*</span> <span class="n">softShadow</span><span class="p">;</span></span></span></code></pre></div><p>We can clamp the shadow between <code>0.1</code> and <code>1.0</code> to lighten the shadow a bit, so it&rsquo;s not too dark.</p>
<p><a href="#R-image-c1f64e59aaefaa8cd14b1f7dedcdcceb" class="lightbox-link"><img src="./assets/shadertoy-118.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c1f64e59aaefaa8cd14b1f7dedcdcceb"><img src="./assets/shadertoy-118.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Notice the edges of the soft shadow. It&rsquo;s a smoother transition between the shadow and normal floor color.</p>
<h4 id="applying-fog">Applying Fog</h4>
<p>You may have noticed that the color of the sphere not facing the light appears too dark still. We can attempt to lighten it by adding <code>0.5</code> to the diffuse reflection, <code>dif</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection</span></span></span></code></pre></div><p>When you run the code, you&rsquo;ll see that the sphere appears a bit brighter, but the back of the floor in the distance looks kinda weird.</p>
<p><a href="#R-image-a9310d96a32bdcc32ac47dfdd5c26cb6" class="lightbox-link"><img src="./assets/shadertoy-119.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a9310d96a32bdcc32ac47dfdd5c26cb6"><img src="./assets/shadertoy-119.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You may commonly see people hide any irregularities of the background by applying <a href="https://www.iquilezles.org/www/articles/fog/fog.htm" target="_blank">fog</a>. Let&rsquo;s apply fog right before the gamma correction.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">backgroundColor</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0002</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">));</span> <span class="c1">// fog</span></span></span></code></pre></div><p>Now, the scene looks a bit more realistic!</p>
<p><a href="#R-image-992acdf662ae6dbbfa1ebba8b42ed238" class="lightbox-link"><img src="./assets/shadertoy-120.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-992acdf662ae6dbbfa1ebba8b42ed238"><img src="./assets/shadertoy-120.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code below:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="cm">/* The MIT License
</span></span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="cm">** Copyright Â© 2022 Nathan Vaughn
</span></span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="cm">** Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &#34;Software&#34;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</span></span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="cm">** 
</span></span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="cm">** Example on how to create a shadow, apply gamma correction, and apply fog.
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="cm">** Visit my tutorial to learn more: https://inspirnathan.com/posts/63-shadertoy-tutorial-part-16/
</span></span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="cm">** 
</span></span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="cm">** Resources/Credit:
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="cm">** Primitive SDFs: https://iquilezles.org/articles/distfunctions
</span></span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="cm">** Soft Shadows: https://iquilezles.org/articles/rmshadows/
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">
</span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// color</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">col</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">obj2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">obj1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">obj2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">  <span class="k">return</span> <span class="n">obj1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">  <span class="k">vec3</span> <span class="n">floorColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.7</span><span class="o">*</span><span class="n">mod</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">floorColor</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">
</span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="k">float</span> <span class="n">softShadow</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">float</span> <span class="n">mint</span><span class="p">,</span> <span class="k">float</span> <span class="n">tmax</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="k">float</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">mint</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">    <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">t</span><span class="p">).</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">      <span class="n">res</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">8.0</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">      <span class="n">t</span> <span class="o">+=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="o">||</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="k">return</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">res</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">
</span></span><span class="line"><span class="ln"> 86</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">vec3</span> <span class="n">backgroundColor</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.835</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">backgroundColor</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">
</span></span><span class="line"><span class="ln">106</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl">    <span class="k">float</span> <span class="n">softShadow</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">softShadow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">
</span></span><span class="line"><span class="ln">110</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">*</span> <span class="n">softShadow</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">backgroundColor</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0002</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">));</span> <span class="c1">// fog</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.2</span><span class="p">));</span> <span class="c1">// Gamma correction</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-12">Conclusion</h4>
<p>In this tutorial, you learned how to apply &ldquo;hard shadows,&rdquo; &ldquo;soft shadows,&rdquo; gamma correction, and fog. As we&rsquo;ve seen, adding shadows can be a bit tricky. In this tutorial, I discussed how to add shadows to a scene with only diffuse reflection, but the same principles apply to scenes with other types of reflections as well. You need to make sure you understand how your scene is lit and anticipate how shadows will impact the colors in your scene. What I&rsquo;ve mentioned in this article is just one way of adding shadows to your scene. As you dive into the code of various shaders on Shadertoy, you&rsquo;ll find completely different ways lighting is set up in the scene.</p>
<h4 id="resources-11">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/mdjGzd" target="_blank">Sphere with Shadow and Fog</a></li>
<li><a href="https://www.youtube.com/watch?v=PGtv-dBi2wE" target="_blank">YouTube: Ray Marching For Dummies</a></li>
<li><a href="https://en.wikipedia.org/wiki/Gamma_correction" target="_blank">Wikipedia: Gamma Correction</a></li>
<li><a href="https://www.shadertoy.com/view/Xds3zN" target="_blank">Shadertoy: Raymarching Primitives</a></li>
<li><a href="https://www.shadertoy.com/view/ltyXD3" target="_blank">Shadertoy: Raymarching Primitives Commented</a></li>
<li><a href="https://www.iquilezles.org/www/articles/fog/fog.htm" target="_blank">Fog</a></li>
<li><a href="https://www.iquilezles.org/www/articles/outdoorslighting/outdoorslighting.htm" target="_blank">Outdoors Lighting</a></li>
</ul>
<h3 id="tutorial-part-14---sdf-operations">Tutorial Part 14 - SDF Operations</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/60-shadertoy-tutorial-part-14</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 14 of my Shadertoy tutorial series! Have you ever wondered how people draw complex shapes and scenes in Shadertoy? We learned how to make spheres and cubes, but what about more complicated objects? In this tutorial, we&rsquo;ll learn how to use SDF operations popularized by the talented <a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a>, one of the co-creators of Shadertoy!</p>
<h4 id="initial-setup-5">Initial Setup</h4>
<p>Below, I have created a ray marching template that may prove useful for you if you plan on developing 3D models using Shadertoy and ray marching. We will start with this code for this tutorial.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">	
</span></span><span class="line"><span class="ln">54</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">  
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl">
</span></span><span class="line"><span class="ln">72</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl">
</span></span><span class="line"><span class="ln">74</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// signed distance value to closest object</span>
</span></span><span class="line"><span class="ln">75</span><span class="cl">
</span></span><span class="line"><span class="ln">76</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">77</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">COLOR_BACKGROUND</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">78</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">79</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">80</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">81</span><span class="cl">
</span></span><span class="line"><span class="ln">82</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">83</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.65</span><span class="p">;</span> <span class="c1">// The 0.65 is used to decrease the light intensity a bit</span>
</span></span><span class="line"><span class="ln">84</span><span class="cl">
</span></span><span class="line"><span class="ln">85</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection mapped to values between 0.5 and 1.0</span>
</span></span><span class="line"><span class="ln">86</span><span class="cl">
</span></span><span class="line"><span class="ln">87</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span>    
</span></span><span class="line"><span class="ln">88</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">89</span><span class="cl">
</span></span><span class="line"><span class="ln">90</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">91</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run this code, you should see a sphere appear in the center of the screen.</p>
<p><a href="#R-image-8820b27e499148a11b4092bbdefdb4dc" class="lightbox-link"><img src="./assets/shadertoy-121.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8820b27e499148a11b4092bbdefdb4dc"><img src="./assets/shadertoy-121.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s analyze the code to make sure we understand how this ray marching template works. At the beginning of the code, we are defining constants we learned about in <a href="https://inspirnathan.com/posts/52-shadertoy-tutorial-part-6" target="_blank">Part 6</a> of this tutorial series.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span></span></span></code></pre></div><p>We are defining the background color and ambient light color using variables, so we can quickly change how the 3D object will look under different colors.</p>
<p>Next, we are defining the <code>rotate2d</code> function for rotating an object along a 2D plane. This was discussed in <a href="https://inspirnathan.com/posts/56-shadertoy-tutorial-part-10" target="_blank">Part 10</a>. We&rsquo;ll use it to move the camera around our 3D model with our mouse.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The following functions are basic utility functions for creating a 3D scene. We learned about these in <a href="https://inspirnathan.com/posts/52-shadertoy-tutorial-part-6" target="_blank">Part 6</a> when we first learned about ray marching. The <code>sdSphere</code> function is an SDF used to create a sphere. The <code>scene</code> function is used to render all the objects in our scene. You may often see this called the <code>map</code> function as you read other peoples&rsquo; code on Shadertoy.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Next, we have the <code>camera</code> function that is used to define our camera model with a lookat point. This was discussed in <a href="https://inspirnathan.com/posts/56-shadertoy-tutorial-part-10" target="_blank">Part 10</a>. The lookat point camera model lets us point the camera at a target.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, let&rsquo;s analyze the <code>mainImage</code> function. We are setting up the UV coordinates so that the pixel coordinates will be between <code>-0.5</code> and <code>0.5</code>. We also account for the aspect ratio, which means the x-axis will have values that will go between different values, but still go between a negative value and positive value.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span></span></span></code></pre></div><p>Since we&rsquo;re using the mouse to rotate around the 3D object, we need to setup <code>mouseUV</code> coordinates. We&rsquo;ll setup such that the coordinates go between zero and one when we click on the canvas.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span></span></span></code></pre></div><p>There&rsquo;s an issue though. When we publish our shader on Shadertoy, and a user loads our shader for the first time, the coordinates will start at (0, 0) for the <code>mouseUV</code> coordinates. We can &ldquo;trick&rdquo; the shader by assigning it a new value when this happens.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span></span></span></code></pre></div><p>Next, we declare a color variable, <code>col</code>, with an arbitrary starting value. Then, we setup the lookat point, <code>lp</code>, and the ray origin, <code>ro</code>. This was also discussed in <a href="https://inspirnathan.com/posts/56-shadertoy-tutorial-part-10" target="_blank">Part 10</a>. Our sphere currently has no offset in the <code>scene</code> function, so it&rsquo;s located at (0, 0, 0). We should make the lookat point have the same value, but we can adjust it as needed.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span></span></span></code></pre></div><p>We can use the mouse to rotate around the camera, but we have to be conscious of how far away the camera is from the 3D object. As we learned at the end of <a href="https://inspirnathan.com/posts/56-shadertoy-tutorial-part-10" target="_blank">Part 10</a>, we can use the <code>rotate2d</code> function to move the camera around and use <code>cameraRadius</code> to control how far away the camera is.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span></span></span></code></pre></div><p>I hope that makes sense! There are alternative ways to implement cameras out there on Shadertoy. Each person sets it up slightly different. Choose whichever approach works best for you.</p>
<h4 id="combination-3d-sdf-operations">Combination 3D SDF Operations</h4>
<p>Now that we understand the ray marching template I have provided, let&rsquo;s learn about 3D SDF Operations! I covered 2D SDF operations in <a href="https://inspirnathan.com/posts/51-shadertoy-tutorial-part-5" target="_blank">Part 5</a> of this tutorial series. 3D SDF operations are a bit similar. We will use utility functions to combine shapes together or subtract shapes from one another. These functions can be found on <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s 3D SDFs page</a>.</p>
<p>Define the utility functions near the top of your code and then use it inside the <code>scene</code> function.</p>
<p>Union: combine two shapes together or show multiple shapes on the screen. We should be familiar with a union operation by now. We&rsquo;ve been using the <code>min</code> function to draw multiple shapes.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-68a5bb50d6611ec42db10c9d5f79906c" class="lightbox-link"><img src="./assets/shadertoy-122.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-68a5bb50d6611ec42db10c9d5f79906c"><img src="./assets/shadertoy-122.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Smooth Union: combine two shapes together and blend them at the edges using the parameter, <code>k</code>. A value of <code>k</code> equal to zero will result in a normal union operation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-af2964e595fb21e32117c411b70e9745" class="lightbox-link"><img src="./assets/shadertoy-123.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af2964e595fb21e32117c411b70e9745"><img src="./assets/shadertoy-123.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Intersection: take only the part where the two shapes intersect.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opIntersection</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opIntersection</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-355993ab0296a8a1f46823bd1376ce7c" class="lightbox-link"><img src="./assets/shadertoy-124.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-355993ab0296a8a1f46823bd1376ce7c"><img src="./assets/shadertoy-124.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Smooth Intersection: combine two shapes together and blend them at the edges using the parameter, <code>k</code>. A value of <code>k</code> equal to zero will result in a normal intersection operation.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothIntersection</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothIntersection</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-2165202113ae22d926a20c76a5469ebc" class="lightbox-link"><img src="./assets/shadertoy-125.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2165202113ae22d926a20c76a5469ebc"><img src="./assets/shadertoy-125.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Subtraction: subtract d1 from d2.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opSubtraction</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opSubtraction</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-bd2c9b935e45dfb853283d7b59395e7b" class="lightbox-link"><img src="./assets/shadertoy-126.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bd2c9b935e45dfb853283d7b59395e7b"><img src="./assets/shadertoy-126.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Smooth Subtraction: subtract d1 from d2 smoothly around the edges using <code>k</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothSubtraction</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="o">-</span><span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothSubtraction</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-09783b20e737b01e39acf37326ad74ab" class="lightbox-link"><img src="./assets/shadertoy-127.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-09783b20e737b01e39acf37326ad74ab"><img src="./assets/shadertoy-127.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Subtraction 2: subtract d2 from d1.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opSubtraction2</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opSubtraction2</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-e18e04c1a9da7b17259e2811ce807238" class="lightbox-link"><img src="./assets/shadertoy-128.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e18e04c1a9da7b17259e2811ce807238"><img src="./assets/shadertoy-128.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Smooth Subtraction 2: subtract d2 from d1 smoothly around the edges using <code>k</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothSubtraction2</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothSubtraction2</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-f68237565e0433c11626425744f42c9d" class="lightbox-link"><img src="./assets/shadertoy-129.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f68237565e0433c11626425744f42c9d"><img src="./assets/shadertoy-129.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="positional-3d-sdf-operations">Positional 3D SDF Operations</h4>
<p><a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s 3D SDFs page</a> describes a set of positional 3D SDF operations we can use to help save us some work when drawing 3D objects. Some of these operations help save on performance as well, since we don&rsquo;t have to run the ray marching loop extra times.</p>
<p>We&rsquo;ve learned in previous tutorials how to rotate shapes with a transformation matrix and translate 3D shapes with an offset. If you need to scale a shape, you can simply change the dimensions of the SDF.</p>
<p>If you&rsquo;re drawing a symmetrical scene, then it may be useful to use the <code>opSymX</code> operation. This operation will create a duplicate 3D object along the x-axis using the SDF you provide. If we draw the sphere at an offset of <code>vec3(1, 0, 0)</code>, then an equivalent sphere will be drawn at <code>vec3(-1, 0, 0)</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opSymX</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opSymX</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-b1f329cec029a8e76b6d1fc0afdee1e6" class="lightbox-link"><img src="./assets/shadertoy-130.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b1f329cec029a8e76b6d1fc0afdee1e6"><img src="./assets/shadertoy-130.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you want to use symmetry along the y-axis or z-axis, you can replace <code>p.x</code> with <code>p.y</code> or <code>p.z</code>, respectively. Don&rsquo;t forget to adjust the sphere offset as well.</p>
<p>If you want to draw spheres along two axes instead of just one, then you can use the <code>opSymXZ</code> operation. This will create a duplicate along the XZ plane, resulting in four spheres. If we draw a sphere with an offset of <code>vec3(1, 0, 1)</code>, then a sphere will be drawn at <code>vec3(1, 0, 1)</code>, <code>vec3(-1, 0, 1)</code>, <code>vec3(1, 0, -1)</code>, and <code>vec3(-1, 0, -1)</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opSymXZ</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opSymXZ</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-7492fd3da957d8063911434db6b56966" class="lightbox-link"><img src="./assets/shadertoy-131.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7492fd3da957d8063911434db6b56966"><img src="./assets/shadertoy-131.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Sometimes, you want to create an infinite number of 3D objects across one or more axes. You can use the <code>opRep</code> operation to repeat spheres along the axes of your choice. The parameter, <code>c</code>, is a vector used to control the spacing between the 3D objects along each axis.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opRep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-01ed10acd9e445f13f214384f8d537d7" class="lightbox-link"><img src="./assets/shadertoy-132.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-01ed10acd9e445f13f214384f8d537d7"><img src="./assets/shadertoy-132.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you want to repeat the 3D objects only a certain number of times instead of an infinite amount, you can use the <code>opRepLim</code> operation. The parameter, <code>c</code>, is now a float value and still controls the spacing between each repeated 3D object. The parameter, <code>l</code>, is a vector that lets you control how many times the shape should be repeated along a given axis. For example, a value of <code>vec3(1, 0, 1)</code> would draw an extra sphere along the positive and negative x-axis and z-axis.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opRepLim</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">,</span> <span class="k">float</span> <span class="n">c</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">l</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">clamp</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opRepLim</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">),</span> <span class="mf">2.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-242386f56a57064dd0049a36821aec25" class="lightbox-link"><img src="./assets/shadertoy-133.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-242386f56a57064dd0049a36821aec25"><img src="./assets/shadertoy-133.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can also perform deformations or distortions to an SDF by manipulating the value of <code>p</code> and adding it to the value returned from an SDF. Inside the <code>opDisplace</code> operation, you can create any type of mathematical operation you want to displace the value of <code>p</code> and then add that result to the original value you get back from an SDF.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">opDisplace</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">return</span> <span class="n">opDisplace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-858330fd8a7e86e8bf4b4b8919b8811b" class="lightbox-link"><img src="./assets/shadertoy-21.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-858330fd8a7e86e8bf4b4b8919b8811b"><img src="./assets/shadertoy-21.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can find the finished code, including an example of each 3D SDF operation, below.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="k">float</span> <span class="n">opIntersection</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">
</span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothIntersection</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">
</span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="k">float</span> <span class="n">opSubtraction</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothSubtraction</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="o">-</span><span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">
</span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="k">float</span> <span class="n">opSubtraction2</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothSubtraction2</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">+</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d1</span><span class="p">,</span> <span class="o">-</span><span class="n">d2</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="k">float</span> <span class="n">opSymX</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="k">float</span> <span class="n">opSymXZ</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="k">float</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">
</span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="k">float</span> <span class="n">opRepLim</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">,</span> <span class="k">float</span> <span class="n">c</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">l</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">clamp</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">c</span><span class="p">),</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">
</span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="k">float</span> <span class="n">opDisplace</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">o</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  <span class="k">float</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">float</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  <span class="c1">//return d1;</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="c1">//return d2;</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="c1">//return opUnion(d1, d2);</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="c1">//return opSmoothUnion(d1, d2, 0.2);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="c1">//return opIntersection(d1, d2);</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="c1">//return opSmoothIntersection(d1, d2, 0.2);</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="c1">//return opSubtraction(d1, d2);</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  <span class="c1">//return opSmoothSubtraction(d1, d2, 0.2);</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="c1">//return opSubtraction2(d1, d2);</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="c1">//return opSmoothSubtraction2(d1, d2, 0.2);</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="c1">//return opSymX(p, 1., vec3(1, 0, 0));</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="c1">//return opSymXZ(p, 1., vec3(1, 0, 1));</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">  <span class="c1">//return opRep(p, 1., vec3(0), vec3(8));</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="c1">//return opRepLim(p, 0.5, vec3(0), 2., vec3(1, 0, 1));</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="k">return</span> <span class="n">opDisplace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">
</span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  
</span></span><span class="line"><span class="ln">118</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">  
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">
</span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">
</span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">	
</span></span><span class="line"><span class="ln">137</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">
</span></span><span class="line"><span class="ln">140</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">  
</span></span><span class="line"><span class="ln">145</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">  
</span></span><span class="line"><span class="ln">151</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">
</span></span><span class="line"><span class="ln">155</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">
</span></span><span class="line"><span class="ln">157</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// signed distance value to closest object</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">
</span></span><span class="line"><span class="ln">159</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">COLOR_BACKGROUND</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">
</span></span><span class="line"><span class="ln">165</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.65</span><span class="p">;</span> <span class="c1">// The 0.65 is used to decrease the light intensity a bit</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">
</span></span><span class="line"><span class="ln">168</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection mapped to values between 0.5 and 1.0</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">
</span></span><span class="line"><span class="ln">170</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span>    
</span></span><span class="line"><span class="ln">171</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">
</span></span><span class="line"><span class="ln">173</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="conclusion-13">Conclusion</h4>
<p>In this tutorial, we learned how to use &ldquo;combination&rdquo; SDF operations such as unions, intersections, and subtractions. We also learned how to use &ldquo;positional&rdquo; SDF operations to help draw duplicate objects to the scene along different axes. In the resources, I have included a link to the <a href="https://www.shadertoy.com/view/7d2SW1" target="_blank">ray marching template</a> I created at the beginning of this tutorial and a link to my shader that includes examples of each <a href="https://www.shadertoy.com/view/NsjSR3" target="_blank">3D SDF operation</a>.</p>
<p>There are many other 3D SDF operations that I didn&rsquo;t discuss in this article. Please check out the other resources below to see examples created by <a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a> on how to use them.</p>
<h4 id="resources-12">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/7d2SW1" target="_blank">Ray Marching Template</a></li>
<li><a href="https://www.shadertoy.com/view/NsjSR3" target="_blank">3D SDF Operations</a></li>
<li><a href="https://www.shadertoy.com/view/lt3BW2" target="_blank">Combination</a></li>
<li><a href="https://www.shadertoy.com/view/Ml3fWj" target="_blank">Elongation</a></li>
<li><a href="https://www.shadertoy.com/view/Mt3BDj" target="_blank">Rounding</a></li>
<li><a href="https://www.shadertoy.com/view/MlcBDj" target="_blank">Onion</a></li>
<li><a href="https://www.shadertoy.com/view/ltcfDj" target="_blank">Metric</a></li>
<li><a href="https://www.shadertoy.com/view/3syGzz" target="_blank">Repetition</a></li>
<li><a href="https://www.shadertoy.com/view/4lyfzw" target="_blank">Extrusion2D</a></li>
<li><a href="https://www.shadertoy.com/view/4lyfzw" target="_blank">Revolution2D</a></li>
<li><a href="https://www.shadertoy.com/view/Xds3zN" target="_blank">Ray Marching Primitives</a></li>
<li><a href="https://www.shadertoy.com/view/ltyXD3" target="_blank">Ray Marching Primitives Commented</a></li>
</ul>
<h3 id="tutorial-part-15---channels-textures-and-buffers">Tutorial Part 15 - Channels, Textures, and Buffers</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/62-shadertoy-tutorial-part-15</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 15 of my Shadertoy tutorial series! In this tutorial, I&rsquo;ll discuss how to use channels and buffers in Shadertoy, so we can use textures and create multi-pass shaders.</p>
<h4 id="channels">Channels</h4>
<p>Shadertoy uses a concept known as channels to access different types of data. At the bottom of the Shadertoy user interface, you will see four black boxes: iChannel0, iChannel1, iChannel2, and iChannel3.</p>
<p><a href="#R-image-7936b11460b7b811b56ad8cf149a7c0f" class="lightbox-link"><img src="./assets/shadertoy-134.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7936b11460b7b811b56ad8cf149a7c0f"><img src="./assets/shadertoy-134.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you click any of the channels, a popup will appear. You can select from a variety of interactive elements, textures, cubemaps, volumes, videos, and music.</p>
<p><a href="#R-image-a62b6f5ad2fab05ae457211cd289a9b7" class="lightbox-link"><img src="./assets/shadertoy-135.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a62b6f5ad2fab05ae457211cd289a9b7"><img src="./assets/shadertoy-135.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>In the &ldquo;Misc&rdquo; tab, you can select from interactive elements such as a keyboard, a webcam, a microphone, or even play music from SoundCloud. The buffers, Buffer A, Buffer B, Buffer C, and Buffer D, let you create &ldquo;multi-pass&rdquo; shaders. Think of them as an extra shader you can add to your shader pipeline. The &ldquo;Cubemap A&rdquo; input is a special type of shader program that lets you create your own cubemap. You can then pass that cubemap to a buffer or to your main &ldquo;Image&rdquo; program. We&rsquo;ll talk about cubemaps in the next tutorial.</p>
<p>The next tab is the &ldquo;Textures&rdquo; tab. You will find three pages worth of 2D textures to choose from. Think of 2D textures as images we can pull pixel values from. As of the time of this writing, you can only use textures Shadertoy provides for you and can&rsquo;t import images from outside of Shadertoy. However, there are ways to circumvent this locally using details found in this <a href="https://www.shadertoy.com/view/lsGGDd" target="_blank">shader</a>.</p>
<p><a href="#R-image-3a84c573de4f8b49609142bf878bc067" class="lightbox-link"><img src="./assets/shadertoy-136.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3a84c573de4f8b49609142bf878bc067"><img src="./assets/shadertoy-136.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-1ed756bd40e730e9ba5e6a3c00d8536f" class="lightbox-link"><img src="./assets/shadertoy-137.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1ed756bd40e730e9ba5e6a3c00d8536f"><img src="./assets/shadertoy-137.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p><a href="#R-image-3e302538942b5317cf443002a16279a7" class="lightbox-link"><img src="./assets/shadertoy-138.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3e302538942b5317cf443002a16279a7"><img src="./assets/shadertoy-138.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The &ldquo;Cubemaps&rdquo; tab contains a selection of cubemaps you can choose from. We will talk about them more in the next tutorial. Cubemaps are commonly used in game engines such as <a href="https://unity.com/" target="_blank">Unity</a> for rendering a 3D world around you.</p>
<p><a href="#R-image-a7021b0c0388ef9d68aff8b7a5f814ef" class="lightbox-link"><img src="./assets/shadertoy-139.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a7021b0c0388ef9d68aff8b7a5f814ef"><img src="./assets/shadertoy-139.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The &ldquo;Volumes&rdquo; tab contains 3D textures. Typical 2D textures use UV coordinates to access data along the x-axis (U value) and y-axis (V value). In 3D textures, you use UVW coordinates where the W value is for the z-axis. You can think of 3D textures as a cube where each pixel on the cube represents data we can pull from. It&rsquo;s like pulling data from a three-dimensional array.</p>
<p><a href="#R-image-f21d0e13fa9ff3c3313661948a921174" class="lightbox-link"><img src="./assets/shadertoy-140.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f21d0e13fa9ff3c3313661948a921174"><img src="./assets/shadertoy-140.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The &ldquo;Videos&rdquo; tab contains 2D textures (or images) that change with time. That is, they play videos in the Shadertoy canvas. People use videos on Shadertoy to experiment with postprocessing effects or image effects that rely on data from the previous frame. The &ldquo;Britney Spears&rdquo; and &ldquo;Claude Van Damme&rdquo; videos are great for testing out green screen effects (aka <a href="https://en.wikipedia.org/wiki/Chroma_key" target="_blank">Chroma key compositing</a>).</p>
<p><a href="#R-image-0aa8eaa38327d6ed2e92d9e75b149508" class="lightbox-link"><img src="./assets/shadertoy-141.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0aa8eaa38327d6ed2e92d9e75b149508"><img src="./assets/shadertoy-141.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Finally, the &ldquo;Music&rdquo; tab lets you play from a range of songs that Shadertoy provides for you. The music will play automatically when a user visits your Shader if you have chosen a song from this tab in one of your channels.</p>
<p><a href="#R-image-769603757dc85b6b0e7f12e8d81e1ae4" class="lightbox-link"><img src="./assets/shadertoy-142.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-769603757dc85b6b0e7f12e8d81e1ae4"><img src="./assets/shadertoy-142.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="using-textures">Using Textures</h4>
<p>Using textures is very simple in Shadertoy. Open a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and replace the code with the following contents:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, click on the iChannel0 box. When the popup appears, go to the &ldquo;Textures&rdquo; tab. We will be choosing the &ldquo;Abstract 1&rdquo; texture, but let&rsquo;s inspect some details displayed in the popup menu.</p>
<p><a href="#R-image-c69b41e676e5e7f0173bb04027d6361e" class="lightbox-link"><img src="./assets/shadertoy-143.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c69b41e676e5e7f0173bb04027d6361e"><img src="./assets/shadertoy-143.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>It says this texture has a resolution of 1024x1024 pixels, which implies this image is best viewed in a square-like or proportional canvas. It also has 3 channels (red, green, blue) which are each of type <code>uint8</code>, an unsigned integer of 8 bits.</p>
<p>Go ahead and click on &ldquo;Abstract 1&rdquo; to load this texture into iChannel0. Then, run your shader program. You should see the texture appear in the Shadertoy canvas.</p>
<p><a href="#R-image-e9710c560e43faf7a286de95c4741885" class="lightbox-link"><img src="./assets/shadertoy-144.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e9710c560e43faf7a286de95c4741885"><img src="./assets/shadertoy-144.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s analyze the code in our shader program.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The UV coordinates go between zero and one across the x-axis and y-axis. Remember, the point (0, 0) starts at the bottom-left corner of the canvas. The <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/texture.xhtml" target="_blank">texture</a> function retrieves what are known as &ldquo;texels&rdquo; from a texture using iChannel0 and the <code>uv</code> coordinates.</p>
<p>A texel is value at a particular coordinate on the texture. For 2D textures such as images, a texel is a pixel value. We sample 2D textures assuming the UV coordinates go between zero and one on the image. We can then &ldquo;UV map&rdquo; the texture onto our entire Shadertoy canvas.</p>
<p><a href="#R-image-61e747cca5d9eb841e95414cd47c7082" class="lightbox-link"><img src="./assets/shadertoy-145.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-61e747cca5d9eb841e95414cd47c7082"><img src="./assets/shadertoy-145.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>For 3D textures, you can think of a texel as a pixel value at a 3D coordinate. You typically won&rsquo;t see 3D textures used that often unless you&rsquo;re dealing with noise generation or volumetric ray marching.</p>
<p>You may be curious on what kind of type <code>iChannel0</code> is when we pass it as a parameter to the <code>texture</code> function. Shadertoy takes care of setting up a sampler for you. A sampler is a way to bind texture units to a shader. The type of sampler will change depending on what kind of resource you load into one of the four channels (iChannel0, iChannel1, iChannel2, iChannel3).</p>
<p>In our case, we&rsquo;re loading a 2D texture into iChannel0. Therefore, <code>iChannel0</code> will have the type, <code>sampler2D</code>. You can see what other sampler types are available on the <a href="https://www.khronos.org/opengl/wiki/Sampler_%28GLSL%29" target="_blank">OpenGL wiki page</a>.</p>
<p>Suppose you wanted to make a function that let you pass in one of the channels. You can do this through the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">get2DTexture</span><span class="p">(</span> <span class="k">sampler2D</span> <span class="n">sam</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">uv</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">return</span> <span class="n">texture</span><span class="p">(</span><span class="n">sam</span><span class="p">,</span> <span class="n">uv</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">get2DTexture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">get2DTexture</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>If you click on the iChannel1 box, select the &ldquo;Abstract 3&rdquo; texture, and run your code, you should see two images blended together.</p>
<p><a href="#R-image-16d7f384d0613b1fb242a765ffd05c11" class="lightbox-link"><img src="./assets/shadertoy-146.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-16d7f384d0613b1fb242a765ffd05c11"><img src="./assets/shadertoy-146.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The <code>get2DTexture</code> function we created accepts a <code>sampler2D</code> type as its first parameter. When you use a 2D texture in a channel, Shadertoy automatically returns a <code>sampler2D</code> type of data for you.</p>
<p>If you want to play a video in the Shadertoy canvas, you can follow the same steps as for the 2D texture. Just choose a video inside iChannel0, and you should see the video start to play automatically.</p>
<h4 id="channel-settings">Channel Settings</h4>
<p>Alright, let&rsquo;s now look into some channel settings we can change. First, paste the following code into your shader:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we&rsquo;re going to use a new texture. Click on the iChannel0 box, go to the &ldquo;Textures&rdquo; tab, go to page 2, and you should see a &ldquo;Nyancat&rdquo; texture.</p>
<p><a href="#R-image-5799de65500f159b2e603e217f178f7a" class="lightbox-link"><img src="./assets/shadertoy-147.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5799de65500f159b2e603e217f178f7a"><img src="./assets/shadertoy-147.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The &ldquo;Nyancat&rdquo; texture is a 256x32 image with 4 channels (red, green, blue, and alpha). Click on this texture, so it shows up in iChannel0.</p>
<p><a href="#R-image-f9be8c0c19b96dc39fcb6bbc2799485a" class="lightbox-link"><img src="./assets/shadertoy-148.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f9be8c0c19b96dc39fcb6bbc2799485a"><img src="./assets/shadertoy-148.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When you run the code, you should see Nyan Cats appear, but they appear blurry.</p>
<p><a href="#R-image-37f1085de28c2d74839929881d79b273" class="lightbox-link"><img src="./assets/shadertoy-149.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-37f1085de28c2d74839929881d79b273"><img src="./assets/shadertoy-149.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>To fix this, we need to adjust the channel settings by clicking the little gear icon on the bottom right corner of the channel box.</p>
<p><a href="#R-image-b05803405047d04f4350b75b1bed5cee" class="lightbox-link"><img src="./assets/shadertoy-150.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b05803405047d04f4350b75b1bed5cee"><img src="./assets/shadertoy-150.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>This will open up a menu with three settings: Filter, Wrap, and VFlip.</p>
<p><a href="#R-image-87b56591cb6db2c05edb61ad6d75c6e7" class="lightbox-link"><img src="./assets/shadertoy-151.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-87b56591cb6db2c05edb61ad6d75c6e7"><img src="./assets/shadertoy-151.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The Filter option lets you change the type of algorithm used to <a href="https://en.wikipedia.org/wiki/Texture_filtering" target="_blank">filter the texture</a>. The dimensions of the texture and the Shadertoy canvas won&rsquo;t always match, so a filter is used to sample the texture. By default, the Filter option is set to &ldquo;mipmap.&rdquo; Click on the dropdown menu and choose &ldquo;nearest&rdquo; to use &ldquo;nearest-neighbor interpolation.&rdquo; This type of filter is useful for when you have textures or images that are pixelated, and you want to keep that pixelated look.</p>
<p><a href="#R-image-8caa22aff62b390f60598746b30c4a72" class="lightbox-link"><img src="./assets/shadertoy-152.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8caa22aff62b390f60598746b30c4a72"><img src="./assets/shadertoy-152.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When you change the filter to &ldquo;nearest,&rdquo; you should see the Nyan Cats look super clear and crisp.</p>
<p><a href="#R-image-0b1537b9f46d469efa8963edfd469545" class="lightbox-link"><img src="./assets/shadertoy-153.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0b1537b9f46d469efa8963edfd469545"><img src="./assets/shadertoy-153.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The Nyan Cats look a bit squished though. Let&rsquo;s fix that by scaling the x-axis by <code>0.25</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="mf">0.25</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, the Nyan Cats won&rsquo;t look squished anymore.</p>
<p><a href="#R-image-1089cbba1f115965006b6cfe1d4c52cd" class="lightbox-link"><img src="./assets/shadertoy-154.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1089cbba1f115965006b6cfe1d4c52cd"><img src="./assets/shadertoy-154.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can use the VFlip option to flip the texture upside down or vertically. Uncheck the checkbox next to VFlip in the channel settings to see the Nyan Cats flip upside down.</p>
<p><a href="#R-image-2842785b2343a3fbf818202ea46aad72" class="lightbox-link"><img src="./assets/shadertoy-155.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2842785b2343a3fbf818202ea46aad72"><img src="./assets/shadertoy-155.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Go back and check the VFlip option to return the Nyan Cats to normal. You can make the Nyan Cats move by subtracting an offset from <code>uv.x</code> and using <code>iTime</code> to animate the scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="mf">0.25</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">iTime</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-fa9fe260d10723bfb2a83a441d9d7784" class="lightbox-link"><img src="./assets/shadertoy-22.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-fa9fe260d10723bfb2a83a441d9d7784"><img src="./assets/shadertoy-22.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>By default, the Wrap mode is set to &ldquo;repeat.&rdquo; This means that when the UV coordinates are outside the boundary of zero and one, it&rsquo;ll start sampling from the texture and repeat between zero and one. Since we&rsquo;re making <code>uv.x</code> smaller and smaller, we definitely go outside the boundary of zero, but the sampler is smart enough to figure out how to adapt.</p>
<p>If you don&rsquo;t want this repeating behavior, you can set the Wrap mode to &ldquo;clamp&rdquo; instead.</p>
<p><a href="#R-image-886a7ec6308f0d39e186b729187c6ee6" class="lightbox-link"><img src="./assets/shadertoy-156.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-886a7ec6308f0d39e186b729187c6ee6"><img src="./assets/shadertoy-156.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you reset the time back to zero, then you&rsquo;ll see that after the UV coordinates go outside the boundary of zero or one, we don&rsquo;t see the Nyan Cats anymore.</p>
<p><a href="#R-image-cac4142edb61698a59a441d5e7855e37" class="lightbox-link"><img src="./assets/shadertoy-23.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cac4142edb61698a59a441d5e7855e37"><img src="./assets/shadertoy-23.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Since the &ldquo;Nyancat&rdquo; texture provides four channels and therefore an alpha channel, we can easily swap out the background. Make sure the timer is set back to zero and run the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// Normalized pixel coordinates (from 0 to 1)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec4</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="mf">0.75</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="mf">0.25</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">iTime</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec4</span> <span class="n">texCol</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">texCol</span><span class="p">,</span> <span class="n">texCol</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">);</span> <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The &ldquo;Nyancat&rdquo; texture has an alpha value of zero everwhere except for where the Nyan Cats are. This lets us set a background color behind them.</p>
<p><a href="#R-image-7eabc6dcb7e190b286ccb38cc0fa677f" class="lightbox-link"><img src="./assets/shadertoy-157.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7eabc6dcb7e190b286ccb38cc0fa677f"><img src="./assets/shadertoy-157.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Keep in mind that most textures are only three channels. Some textures only have one channel such as the &ldquo;Bayer&rdquo; texture. This means that the red channel will contain data, but the other three channels will not, which is why you will likely see red when you use it. Some textures are used for creating noise or displacing shapes a particular way. You can even use textures as height maps to shape the height of terrains based on the color values stored inside the texture. Textures serve a variety of purposes.</p>
<h4 id="buffers">Buffers</h4>
<p>Shadertoy provides the support of buffers. You can run completely different shaders in each buffer. Each shader will have its own final <code>fragColor</code> that can be passed to another buffer or the main &ldquo;Image&rdquo; shader we&rsquo;ve been working in.</p>
<p>There are four buffers: Buffer A, Buffer B, Buffer C, and Buffer D. Each buffer can hold its own four channels. To access a buffer, we use one of the four channels. Let&rsquo;s practice with buffers to see how to use them.</p>
<p>Above your code, near the top of the Shadertoy user interface, you should see a tab labelled &ldquo;Image.&rdquo; The &ldquo;Image&rdquo; tab represents the main shader we&rsquo;ve been using in the previous tutorials. To add a buffer, simply click on the plus sign (+) to the left of the Image tab.</p>
<p><a href="#R-image-2eff3db115633e4d09bd0fac72d3c709" class="lightbox-link"><img src="./assets/shadertoy-158.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2eff3db115633e4d09bd0fac72d3c709"><img src="./assets/shadertoy-158.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>From there, you&rsquo;ll see a dropdown of items to choose from: Common, Sound, Buffer A, Buffer B, Buffer C, Buffer D, Cubemap A.</p>
<p><a href="#R-image-66e57fe90a6fb974aa670a2eabb1e198" class="lightbox-link"><img src="./assets/shadertoy-159.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-66e57fe90a6fb974aa670a2eabb1e198"><img src="./assets/shadertoy-159.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The Common option is used to share code between the &ldquo;Image&rdquo; shader, all buffers, and other shaders including Sound and Cubemap A. The Sound options lets you create a shader that generates <a href="https://www.shadertoy.com/view/Xds3Rr" target="_blank">sound</a>. The Cubemap A option lets you generate your own <a href="https://www.shadertoy.com/view/4ttyzn" target="_blank">cubemap</a>. For this tutorial, I&rsquo;ll go over the buffers, which are normal shaders that return a color of type <code>vec4</code> (red, green, blue, alpha).</p>
<p>Go ahead and select Buffer A. You should see default code provided for you.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Looks like this code simply returns the color, blue, for each pixel. Next, let&rsquo;s go back to the &ldquo;Image&rdquo; tab. Click on iChannel0, go to the &ldquo;Misc&rdquo; tab, and select Buffer A. You should now be using Buffer A for iChannel0. Inside the &ldquo;Image&rdquo; shader, paste the following code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">uv</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see the entire canvas turn purple. This is because we&rsquo;re taking the color values from Buffer A, passing it into the Image shader, adding red to the blue color we got from Buffer A, and outputting the result to the screen.</p>
<p>Essentially, buffers give you more space to work with. You can create an entire shader in Buffer A, pass the result to another buffer to do more processing on it, and then pass the result to the Image shader to output the final result. Think of it as a pipeline where you keep passing the output of one shader to the next. This is why shaders that leverage buffers or additional shaders are often called multi-pass shaders.</p>
<h4 id="using-the-keyboard">Using the Keyboard</h4>
<p>You may have seen shaders on Shadertoy that let users control the scene with a keyboard. I have written a <a href="https://www.shadertoy.com/view/sdf3RS" target="_blank">shader</a> that demonstrates how to move objects using a keyboard and uses a buffer to store the results of each key press. If you go to this shader, you should see a multi-pass shader with a buffer, Buffer A, and the main &ldquo;Image&rdquo; shader.</p>
<p>Inside Buffer A, you should see the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Numbers are based on JavaScript key codes: https://keycode.info/</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">KEY_LEFT</span>  <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">KEY_UP</span>    <span class="o">=</span> <span class="mi">38</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">KEY_RIGHT</span> <span class="o">=</span> <span class="mi">39</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">KEY_DOWN</span>  <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">vec2</span> <span class="n">handleKeyboard</span><span class="p">(</span><span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">float</span> <span class="n">velocity</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">;</span> <span class="c1">// This will cause offset to change by 0.01 each time an arrow key is pressed</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">// texelFetch(iChannel1, ivec2(KEY, 0), 0).x will return a value of one if key is pressed, zero if not pressed</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">vec2</span> <span class="n">left</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="n">KEY_LEFT</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mo">0</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">vec2</span> <span class="n">up</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="n">KEY_UP</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="mo">0</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">vec2</span> <span class="n">right</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="n">KEY_RIGHT</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mo">0</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">vec2</span> <span class="n">down</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="n">KEY_DOWN</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mo">0</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">up</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">down</span><span class="p">)</span> <span class="o">*</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">return</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="c1">// Return the offset value from the last frame (zero if it&#39;s first frame)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span> <span class="n">iChannel0</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="mo">0</span><span class="p">).</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="c1">// Pass in the offset of the last frame and return a new offset based on keyboard input</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">handleKeyboard</span><span class="p">(</span><span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="c1">// Store offset in the XY values of every pixel value and pass this data to the &#34;Image&#34; shader and the next frame of Buffer A</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Inside the &ldquo;Image&rdquo; shader, you should see the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">return</span> <span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">vec3</span> <span class="n">drawScene</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">// Fetch the offset from the XY part of the pixel values returned by Buffer A</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">vec2</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">texelFetch</span><span class="p">(</span> <span class="n">iChannel0</span><span class="p">,</span> <span class="k">ivec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">),</span> <span class="mo">0</span> <span class="p">).</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">float</span> <span class="n">blueCircle</span> <span class="o">=</span> <span class="n">sdfCircle</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">blueCircle</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// &lt;-0.5,0.5&gt;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// fix aspect ratio</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">drawScene</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="c1">// Output to screen</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>My multi-pass shader draws a circle to the canvas and lets you move it around using the keyboard. What&rsquo;s actually happening is that we&rsquo;re getting a value of one or zero from a key press and using that value to control the circle&rsquo;s offset value.</p>
<p><a href="#R-image-01006b439c412c57b0d637a8f30a8c31" class="lightbox-link"><img src="./assets/shadertoy-160.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-01006b439c412c57b0d637a8f30a8c31"><img src="./assets/shadertoy-160.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>If you look inside Buffer A, you&rsquo;ll notice that I&rsquo;m using Buffer A in iChannel0 from within Buffer A. How is that possible? When you use Buffer A within the Buffer A shader, you will get access to the <code>fragColor</code> value from the last frame that was run.</p>
<p>There&rsquo;s no recursion going on. You can&rsquo;t use recursion in GLSL as far as I&rsquo;m aware of. Therefore, everything must be coded in an iterative approach. However, that doesn&rsquo;t stop us from using buffers on a frame by frame basis.</p>
<p>The <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/texelFetch.xhtml" target="_blank">texelFetch</a> function performs a lookup of a single texel value within a texture. A keyboard isn&rsquo;t a texture though, so how does that work? Shadertoy essentially glued things together in a way that lets us access the browser&rsquo;s keyboard events from within a shader as if it were a texture. We can access key presses by using <code>texelFetch</code> to check if a key was pressed.</p>
<p>We get back a zero or one depending on whether a key isn&rsquo;t pressed or is pressed, respectively. We can then multiply this value by a <code>velocity</code> to adjust the circle&rsquo;s offset. The offset value will be passed to the next frame of Buffer A. Then, it&rsquo;ll get passed to the &ldquo;Image&rdquo; shader.</p>
<p>If the scene is running at 60 frames per second (fps), then that means one frame is drawn every 1/60 of a second. During one pass of our multi-pass shader, we&rsquo;ll pull from the last frame&rsquo;s Buffer A value, pass that into the current frame&rsquo;s Buffer A shader, pass that result to the &ldquo;Image&rdquo; shader, and then draw the pixel to the canvas. This cycle will repeat every frame or 60 times a second.</p>
<p>Other interactive elements such as our computer&rsquo;s microphone can be accessed like textures as well. Please read the resources below to see examples created by <a href="https://www.iquilezles.org/" target="_blank">Inigo Quilez</a> on how to use various interactive elements in Shadertoy.</p>
<h4 id="conclusion-14">Conclusion</h4>
<p>Textures are a very important concept in computer graphics and game development. GLSL and other shader languages provide functions for accessing texture data. Shadertoy takes care of a lot of the hard work for you, so you can quickly access textures or interactive elements via channels. You can use textures to store color values but then use those colors to represent different types of data such as height, displacement, depth, or whatever else you can think of.</p>
<p>Please see the resources below to learn how to use various interactive elements in Shadertoy.</p>
<h4 id="resources-13">Resources</h4>
<ul>
<li><a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29" target="_blank">Khronos: Data Type (GLSL)</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/texture.xhtml" target="_blank">Khronos: texture</a></li>
<li><a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/texelFetch.xhtml" target="_blank">Khronos: texelFetch</a></li>
<li><a href="https://www.khronos.org/opengl/wiki/Sampler_%28GLSL%29" target="_blank">Khronos: Sampler (GLSL)</a></li>
<li><a href="https://www.shadertoy.com/view/sdf3RS" target="_blank">2D Movement with Keyboard</a></li>
<li><a href="https://www.shadertoy.com/view/lsXGzf" target="_blank">Input - Keyboard</a></li>
<li><a href="https://www.shadertoy.com/view/llSGDh" target="_blank">Input - Microphone</a></li>
<li><a href="https://www.shadertoy.com/view/Mss3zH" target="_blank">Input - Mouse</a></li>
<li><a href="https://www.shadertoy.com/view/Xds3Rr" target="_blank">Input - Sound</a></li>
<li><a href="https://www.shadertoy.com/view/MsdGzn" target="_blank">Input - SoundCloud</a></li>
<li><a href="https://www.shadertoy.com/view/lsXGz8" target="_blank">Input - Time</a></li>
<li><a href="https://www.shadertoy.com/view/lsKGWV" target="_blank">Input - TimeDelta</a></li>
<li><a href="https://www.shadertoy.com/view/4llcR4" target="_blank">Input - 3D Texture</a></li>
<li><a href="https://www.shadertoy.com/view/4ttyzn" target="_blank">Example - mainCubemap</a></li>
<li><a href="https://www.shadertoy.com/view/ltl3D8" target="_blank">Cheap Cubemap</a></li>
</ul>
<h3 id="tutorial-part-16---cubemaps-and-reflections">Tutorial Part 16 - Cubemaps and Reflections</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/63-shadertoy-tutorial-part-16</p>
</blockquote>
<p>Greetings, friends! Welcome to Part 16 of my Shadertoy tutorial series! In this tutorial, I&rsquo;ll discuss how to use cubemaps in Shadertoy, so we can use draw 3D backgrounds and make more realistic reflections on any 3D object!</p>
<h4 id="cubemaps">Cubemaps</h4>
<p>Cubemaps are a special type of texture that can be thought of containing six individual 2D textures that each form a face of a cube. You may have used cubemaps in game engines such as <a href="https://docs.unity3d.com/Manual/class-Cubemap.html" target="_blank">Unity</a> and <a href="https://docs.unrealengine.com/en-US/RenderingAndGraphics/Textures/Cubemaps/index.html" target="_blank">Unreal Engine</a>. In Shadertoy, cubemaps let you create a dynamic 3D background that changes depending on where the camera is facing. Each pixel of the Shadertoy canvas will be determined by the ray direction.</p>
<p>The website, <a href="https://learnopengl.com/Advanced-OpenGL/Cubemaps" target="_blank">Learn OpenGL</a>, provides a great image to visualize how cubemaps work.</p>
<p><a href="#R-image-2e053536f99c1ac552ca91b69aaa139b" class="lightbox-link"><img src="./assets/shadertoy-161.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2e053536f99c1ac552ca91b69aaa139b"><img src="./assets/shadertoy-161.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Cubemap by <a href="https://learnopengl.com/Advanced-OpenGL/Cubemaps" target="_blank">Learn OpenGL</a></p>
<p>We pretend the camera is in the center of the cube and points toward one or more faces of the cube. In the image above, the ray direction determines which part of the cubemap to sample from.</p>
<p>Let&rsquo;s practice this in Shadertoy. Create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader and click on the iChannel0 box. Click on the &ldquo;Cubemaps&rdquo; tab and select the &ldquo;Uffizi Gallery&rdquo; cubemap.</p>
<p><a href="#R-image-0e3f08d4b48a6a1ddaa81ff5e6071783" class="lightbox-link"><img src="./assets/shadertoy-162.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0e3f08d4b48a6a1ddaa81ff5e6071783"><img src="./assets/shadertoy-162.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Then, replace all the code with the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">	
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">rd</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Does this code look familiar? I took part of the code we used at the beginning of <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> of my Shadertoy tutorial series for this tutorial. We use the lookat camera model to adjust the ray direction, <code>rd</code>.</p>
<p>The color of each pixel, <code>col</code>, will be equal to a color value sampled from the cubemap stored in <code>iChannel0</code>. We learned how to access textures in the <a href="https://inspirnathan.com/posts/62-shadertoy-tutorial-part-15" target="_blank">previous tutorial</a>. However, accessing values from a cubemap requires us to pass in the ray direction, <code>rd</code>, instead of <code>uv</code> coordinates like what we did for 2D textures.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">rd</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span></span></span></code></pre></div><p>You can use the mouse to look around the cubemap because we&rsquo;re using the <code>iMouse</code> global variable to control the ray origin, <code>ro</code>, which is the position of the camera. The <code>camera</code> function changes based on <code>ro</code> and <code>lp</code>, so the ray direction is changing as we move the mouse around. Looks like the background is a dynamic 3D scene now!</p>
<p><a href="#R-image-ce52ae0fc88fd81510bdadc56ecae2fd" class="lightbox-link"><img src="./assets/shadertoy-24.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ce52ae0fc88fd81510bdadc56ecae2fd"><img src="./assets/shadertoy-24.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="reflections-with-cubemap">Reflections with Cubemap</h4>
<p>Using cubemaps, we can make objects look reflective. Let&rsquo;s add a sphere to the scene using ray marching.</p>
<p>Replace your code with the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="k">float</span> <span class="n">sdScene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">    <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">  <span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">    <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">sdScene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">
</span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">	
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="k">vec3</span> <span class="n">phong</span><span class="p">(</span><span class="k">vec3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="k">float</span> <span class="n">lightIntensity</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">normal</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">  <span class="k">vec3</span> <span class="n">cubemapReflectionColor</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">reflect</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_a</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="n">cubemapReflectionColor</span><span class="p">;</span> <span class="c1">// Reflection</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_d</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_s</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  <span class="k">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">50.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">  <span class="k">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="k">float</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">alpha</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">return</span> <span class="n">lightIntensity</span> <span class="o">*</span> <span class="p">(</span><span class="n">K_a</span> <span class="o">+</span> <span class="n">K_d</span> <span class="o">*</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">K_s</span> <span class="o">*</span> <span class="n">specular</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="k">float</span> <span class="n">fresnel</span><span class="p">(</span><span class="k">vec3</span> <span class="n">n</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="mf">5.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">rd</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="k">vec3</span> <span class="n">lightPosition1</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="k">vec3</span> <span class="n">lightDirection1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition1</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="k">vec3</span> <span class="n">lightPosition2</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="k">vec3</span> <span class="n">lightDirection2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition2</span> <span class="o">-</span> <span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">float</span> <span class="n">lightIntensity1</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  <span class="k">float</span> <span class="n">lightIntensity2</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="k">vec3</span> <span class="n">sphereColor</span> <span class="o">=</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection1</span><span class="p">,</span> <span class="n">lightIntensity1</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="n">sphereColor</span> <span class="o">+=</span> <span class="n">phong</span><span class="p">(</span><span class="n">lightDirection2</span><span class="p">,</span> <span class="n">lightIntensity2</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="n">sphereColor</span> <span class="o">+=</span> <span class="n">fresnel</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">rd</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">  
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">sphereColor</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">MAX_DIST</span><span class="p">,</span> <span class="mf">0.</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see a metallic-looking sphere in the center of the scene.</p>
<p><a href="#R-image-f5af36539683c423bf71cd2e2104a275" class="lightbox-link"><img src="./assets/shadertoy-163.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f5af36539683c423bf71cd2e2104a275"><img src="./assets/shadertoy-163.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We are using the Phong reflection model we learned in <a href="https://inspirnathan.com/posts/57-shadertoy-tutorial-part-11" target="_blank">Part 11</a> and Fresnel reflection we learned in <a href="https://inspirnathan.com/posts/58-shadertoy-tutorial-part-12" target="_blank">Part 12</a>.</p>
<p>Inside the <code>phong</code> function, we are implementing the Phong reflection model.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec3</span> <span class="n">phong</span><span class="p">(</span><span class="k">vec3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="k">float</span> <span class="n">lightIntensity</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">normal</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">vec3</span> <span class="n">cubemapReflectionColor</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">reflect</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_a</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="n">cubemapReflectionColor</span><span class="p">;</span> <span class="c1">// Reflection</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_d</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">vec3</span> <span class="n">K_s</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">50.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">specular</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">reflect</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span> <span class="n">normal</span><span class="p">),</span> <span class="o">-</span><span class="n">rd</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">alpha</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">lightIntensity</span> <span class="o">*</span> <span class="p">(</span><span class="n">K_a</span> <span class="o">+</span> <span class="n">K_d</span> <span class="o">*</span> <span class="n">diffuse</span> <span class="o">+</span> <span class="n">K_s</span> <span class="o">*</span> <span class="n">specular</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The ambient color of the sphere will be the color of the cubemap. However, notice that instead of passing in the ray direction, <code>rd</code>, into the <code>texture</code> function, we are using the <code>reflect</code> function to find the reflected ray direction as if the ray bounced off the sphere. This creates the illusion of a spherical reflection, making the sphere look like a mirror.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">cubemapReflectionColor</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">reflect</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">K_a</span> <span class="o">=</span> <span class="n">cubemapReflectionColor</span><span class="p">;</span></span></span></code></pre></div><p>We can also have some fun and add a blue tint to the color of the sphere.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">cubemapReflectionColor</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">reflect</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">normal</span><span class="p">)).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">vec3</span> <span class="n">K_a</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="n">cubemapReflectionColor</span><span class="p">;</span></span></span></code></pre></div><p><a href="#R-image-bedaa5742221108ecd05162d5c333af8" class="lightbox-link"><img src="./assets/shadertoy-25.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bedaa5742221108ecd05162d5c333af8"><img src="./assets/shadertoy-25.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Beautiful!</p>
<h4 id="how-to-use-the-cube-a-shader">How to Use the Cube A Shader</h4>
<p>We can create custom cubemaps in Shadertoy by using the &ldquo;Cube A&rdquo; option. First, let&rsquo;s create a <a href="https://www.shadertoy.com/new" target="_blank">new</a> shader. In the <a href="https://inspirnathan.com/posts/62-shadertoy-tutorial-part-15" target="_blank">previous tutorial</a>, we learned that we can add buffers by clicking the plus sign next to the &ldquo;Image&rdquo; tab at the top of the Shadertoy user interface.</p>
<p><a href="#R-image-72e87d8e72a2454a5959fc428393f3d5" class="lightbox-link"><img src="./assets/shadertoy-164.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-72e87d8e72a2454a5959fc428393f3d5"><img src="./assets/shadertoy-164.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Upon clicking the plus sign, we should see a menu appear. Select the &ldquo;Cubemap A&rdquo; option.</p>
<p><a href="#R-image-0d1d97cd8272178a76efd3692642aec6" class="lightbox-link"><img src="./assets/shadertoy-165.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0d1d97cd8272178a76efd3692642aec6"><img src="./assets/shadertoy-165.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>When you select the &ldquo;Cubemap A&rdquo; option, you should see a new tab appear to the left of the &ldquo;Image&rdquo; tab. This tab will say &ldquo;Cube A.&rdquo; By default, Shadertoy will provide the following code for this &ldquo;Cube A&rdquo; shader.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">void</span> <span class="n">mainCubemap</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec3</span> <span class="n">rayOri</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec3</span> <span class="n">rayDir</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="c1">// Ray direction as color</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">rayDir</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="c1">// Output to cubemap</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Instead of defining a <code>mainImage</code> function, we are now defining a <code>mainCubemap</code> function. It automatically provides a ray direction, <code>rayDir</code>, for you. It also provides a ray origin, <code>rayOri</code> in case you need it for performing calculations based on it.</p>
<p>Suppose we want to generate a custom cubemap that is red on opposite faces, blue on opposite faces, and green on opposite faces. Essentially, we&rsquo;re going to build a dynamic background in the shape of a cube and move the camera around using our mouse. It will look like the following.</p>
<p><a href="#R-image-862aff0518f20e2849ca8212a3bd2360" class="lightbox-link"><img src="./assets/shadertoy-26.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-862aff0518f20e2849ca8212a3bd2360"><img src="./assets/shadertoy-26.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>We will replace the code in the &ldquo;Cube A&rdquo; shader with the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">max3</span><span class="p">(</span><span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">   <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">rd</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">rd</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">rd</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">void</span> <span class="n">mainCubemap</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec3</span> <span class="n">rayOri</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec3</span> <span class="n">rayDir</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">rayDir</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">max3</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">==</span> <span class="n">rd</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">max3</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">==</span> <span class="n">rd</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">max3</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span> <span class="o">==</span> <span class="n">rd</span><span class="p">.</span><span class="n">z</span><span class="p">)</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// Output cubemap</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let me explain what&rsquo;s happening here. The <code>max3</code> function is a function I created for getting the maximum value of each component of a three-dimensional vector, <code>vec3</code>. Inside the <code>mainCubemap</code> function, we&rsquo;re taking the absolute value of the ray direction, <code>rayDir</code>. Why? If we had a ray direction of <code>vec3(1, 0, 0)</code> and a ray direction of <code>vec3(-1, 0, 0)</code>, then we want the pixel color to be red. Thus, opposite faces of the cube will be red.</p>
<p>We&rsquo;re taking the maximum value of each component of the ray direction to determine which component across the X, Y, and Z axis is larger. This will let us create a &ldquo;square&rdquo; shape.</p>
<p>Imagine you&rsquo;re looking at a cube and calculating the surface normal on each face of the cube. You would end up with six unique surface normals: <code>vec3(1, 0, 0)</code>, <code>vec3(0, 1, 0)</code>, <code>vec3(0, 0, 1)</code>, <code>vec3(-1, 0, 0)</code>, <code>vec3(0, -1, 0)</code>, <code>vec3(0, 0, -1)</code>. By taking the max of the ray direction, we essentially create one of these six surface normals. Since we&rsquo;re taking the absolute value of the ray direction, we only have to check three different scenarios.</p>
<p>Now that we learned how this code works, let&rsquo;s go back to the &ldquo;Image&rdquo; shader. Click on the iChannel0 box, click the &ldquo;Misc&rdquo; tab in the popup menu that appears, and select the &ldquo;Cubemap A&rdquo; option.</p>
<p>Then, add the following code to the &ldquo;Image&rdquo; shader:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">	
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">));</span> <span class="c1">// Notice how we&#39;re using -0.5 as the zoom factor instead of -1</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">rd</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This code is similar to what we used earlier in this tutorial. Instead of using the &ldquo;Uffizi Gallery&rdquo; cubemap, we are using the custom cubemap we created in the &ldquo;Cube A&rdquo; tab. We also zoomed out a little bit by changing the zoom factor from <code>-1</code> to <code>-0.5</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">));</span></span></span></code></pre></div><p>When you run the shader, you should see a colorful background that makes it seem like we&rsquo;re inside a cube. Neat!</p>
<h4 id="conclusion-15">Conclusion</h4>
<p>In this tutorial, we learned how to use cubemaps Shadertoy provides and learned how to create our own cubemaps. We can use the <code>texture</code> function to access values stored in a cubemap by using the ray direction. If we want to create reflections, we can use the <code>reflect</code> function together with the ray direction and surface normal to create more realistic reflections. By using the &ldquo;Cube A&rdquo; shader, we can create custom cubemaps.</p>
<h4 id="resources-14">Resources</h4>
<ul>
<li><a href="https://learnopengl.com/Advanced-OpenGL/Cubemaps" target="_blank">Learn OpenGL: Cubemaps</a></li>
<li><a href="https://www.shadertoy.com/view/7s2XD3" target="_blank">Shadertoy: How to Use Cubemaps</a></li>
<li><a href="https://www.shadertoy.com/view/7d2XRt" target="_blank">Shadertoy: Sphere Reflections with Cubemap</a></li>
<li><a href="https://www.shadertoy.com/view/7d2XD3" target="_blank">Shadertoy: How to Use Cubemap A Shader</a></li>
</ul>
<h3 id="snowman-shader-in-shadertoy">Snowman Shader in Shadertoy</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/61-snowman-shader-in-shadertoy</p>
</blockquote>
<p><a href="#R-image-901ab98d46d1392bf1bb7a58bdff6ea4" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-27.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-901ab98d46d1392bf1bb7a58bdff6ea4"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-27.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Do you wanna build a snowmannnnnnnn â˜ƒï¸ ğŸ¶?</p>
<p>Come on, let&rsquo;s go and code.</p>
<p>Trust me, it won&rsquo;t be a bore.</p>
<p>Prepare your keyboard.</p>
<p>It&rsquo;s time to ray march awayyyyyyy!!!!</p>
<p>Greetings, friends! You have made it so far on your Shadertoy journey! I&rsquo;m so proud! Even if you haven&rsquo;t read any of my past articles and landed here from Google, I&rsquo;m still proud you visited my website ğŸ˜ƒ. If you&rsquo;re new to Shadertoy or even shaders in general, please visit <a href="https://inspirnathan.com/posts/47-shadertoy-tutorial-part-1" target="_blank">Part 1</a> of my Shadertoy tutorial series.</p>
<p>In this article, I will show you how to make a snowman shader using the lessons in my Shadertoy tutorial series. We&rsquo;ll create a simple snowman, add color using structs, and then add lots of details to our scene to create an amazing shader!!!</p>
<h4 id="initial-setup-6">Initial Setup</h4>
<p>We&rsquo;ll start with the ray marching template we used at the beginning of <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> of my Shadertoy tutorial series.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Do</span> <span class="n">you</span> <span class="n">wanna</span> <span class="n">build</span> <span class="n">a</span> <span class="n">snowmannnnnnnn</span> <span class="err">â˜ƒï¸</span> <span class="err">ğŸ¶</span><span class="o">?</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">Come</span> <span class="n">on</span><span class="p">,</span> <span class="n">let</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">go</span> <span class="n">and</span> <span class="n">code</span><span class="p">.</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">Trust</span> <span class="n">me</span><span class="p">,</span> <span class="n">it</span> <span class="n">won</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">be</span> <span class="n">a</span> <span class="n">bore</span><span class="p">.</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">Prepare</span> <span class="n">your</span> <span class="n">keyboard</span><span class="p">.</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">It</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">time</span> <span class="n">to</span> <span class="n">ray</span> <span class="n">march</span> <span class="n">awayyyyyyy</span><span class="o">!!!!</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">Greetings</span><span class="p">,</span> <span class="n">friends</span><span class="o">!</span> <span class="n">You</span> <span class="n">have</span> <span class="n">made</span> <span class="n">it</span> <span class="n">so</span> <span class="n">far</span> <span class="n">on</span> <span class="n">your</span> <span class="n">Shadertoy</span> <span class="n">journey</span><span class="o">!</span> <span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">so</span> <span class="n">proud</span><span class="o">!</span> <span class="n">Even</span> <span class="k">if</span> <span class="n">you</span> <span class="n">haven</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">read</span> <span class="n">any</span> <span class="n">of</span> <span class="n">my</span> <span class="n">past</span> <span class="n">articles</span> <span class="n">and</span> <span class="n">landed</span> <span class="n">here</span> <span class="n">from</span> <span class="n">Google</span><span class="p">,</span> <span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">still</span> <span class="n">proud</span> <span class="n">you</span> <span class="n">visited</span> <span class="n">my</span> <span class="n">website</span> <span class="err">ğŸ˜ƒ</span><span class="p">.</span> <span class="n">If</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">new</span> <span class="n">to</span> <span class="n">Shadertoy</span> <span class="n">or</span> <span class="n">even</span> <span class="n">shaders</span> <span class="k">in</span> <span class="n">general</span><span class="p">,</span> <span class="n">please</span> <span class="n">visit</span> <span class="n">Part</span> <span class="mi">1</span> <span class="n">of</span> <span class="n">my</span> <span class="n">Shadertoy</span> <span class="n">tutorial</span> <span class="n">series</span><span class="p">.</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">In</span> <span class="k">this</span> <span class="n">article</span><span class="p">,</span> <span class="n">I</span> <span class="n">will</span> <span class="n">show</span> <span class="n">you</span> <span class="n">how</span> <span class="n">to</span> <span class="n">make</span> <span class="n">a</span> <span class="n">snowman</span> <span class="n">shader</span> <span class="k">using</span> <span class="n">the</span> <span class="n">lessons</span> <span class="k">in</span> <span class="n">my</span> <span class="n">Shadertoy</span> <span class="n">tutorial</span> <span class="n">series</span><span class="p">.</span> <span class="n">We</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">create</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">snowman</span><span class="p">,</span> <span class="n">add</span> <span class="n">color</span> <span class="k">using</span> <span class="n">structs</span><span class="p">,</span> <span class="n">and</span> <span class="n">then</span> <span class="n">add</span> <span class="n">lots</span> <span class="n">of</span> <span class="n">details</span> <span class="n">to</span> <span class="n">our</span> <span class="n">scene</span> <span class="n">to</span> <span class="n">create</span> <span class="n">an</span> <span class="n">amazing</span> <span class="n">shader</span><span class="o">!!!</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">Initial</span> <span class="n">Setup</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">We</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">start</span> <span class="n">with</span> <span class="n">the</span> <span class="n">ray</span> <span class="n">marching</span> <span class="k">template</span> <span class="n">we</span> <span class="n">used</span> <span class="n">at</span> <span class="n">the</span> <span class="n">beginning</span> <span class="n">of</span> <span class="n">Part</span> <span class="mi">14</span> <span class="n">of</span> <span class="n">my</span> <span class="n">Shadertoy</span> <span class="n">tutorial</span> <span class="n">series</span><span class="p">.</span></span></span></code></pre></div><p>When you run this code, you should see a sphere appear in the center of the screen. It kinda looks like a snowball, doesn&rsquo;t it?</p>
<p><a href="#R-image-2cde7acd9033472b3ccd6ebe82588bb7" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-166.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2cde7acd9033472b3ccd6ebe82588bb7"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-166.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="building-a-snowman-model">Building a Snowman Model</h4>
<p>When building 3D models using ray marching, it&rsquo;s best to think about what <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">SDFs</a> we&rsquo;ll need to build a snowman. A snowman is typically made using two or three spheres. For our snowman, we&rsquo;ll keep it simple and build it using only two spheres.</p>
<p>Let&rsquo;s draw two spheres to the scene. We can use the <code>opUnion</code> function we learned in <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> to draw more than one shape to the scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ve been using this function already in the previous tutorials. It simply takes the minimum &ldquo;signed distance&rdquo; between two SDFs.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-0e4ea968bdfc87ce6c31064ac4fefcb3" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-167.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0e4ea968bdfc87ce6c31064ac4fefcb3"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-167.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Right away, you can our snowman starting to take shape, but it looks awkward at the intersection where the two spheres meet. As we learned in <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> of my Shadertoy tutorial series, we can blend two shapes smoothly together by using the <code>opSmoothUnion</code> function or <code>smin</code> function, if you want to use a shorter name.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, let&rsquo;s replace the <code>opUnion</code> function with <code>opSmoothUnion</code> in our scene. We&rsquo;ll use a value of <code>0.2</code> as the smoothing factor, <code>k</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-77913e851dfaf51f0289e08a9c20ee1c" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-168.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-77913e851dfaf51f0289e08a9c20ee1c"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-168.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>That looks much better! The snowman is missing some eyes though. People tend to give them eyes using buttons or some other round objects. We&rsquo;ll give our snowman spherical eyes. Let&rsquo;s start with the left eye.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-85fa2e5eb79ecd536af19b2e1993602f" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-169.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-85fa2e5eb79ecd536af19b2e1993602f"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-169.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The right eye will use the same offset value as the left eye except the x-axis will be mirrored.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-33dd8dda5b72990c094eb768f298ff7e" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-170.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-33dd8dda5b72990c094eb768f298ff7e"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-170.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Next, the snowman needs a nose. People tend to make noses for snowmen out of carrots. We can simulate a carrot nose by using a cone SDF from <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s list of 3D SDFs</a>. We&rsquo;ll choose the SDF called &ldquo;Cone - bound (not exact)&rdquo; which has the following function declaration:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCone</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)),</span><span class="o">-</span><span class="n">h</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>This is for a cone pointing straight up. We want the tip of the cone to face us, toward the positive z-axis. To switch this, we&rsquo;ll replace <code>p.xz</code> with <code>p.xy</code> and replace <code>p.y</code> with <code>p.z</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCone</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="o">-</span><span class="n">h</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We also need to add an <code>offset</code> parameter to this function, so we can move the cone around in 3D space. Therefore, we end up with the following function declaration for the cone SDF.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCone</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="o">-</span><span class="n">h</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>To use this SDF, we need to create an angle for the cone. This requires playing around with the value a bit. A value of 75 degrees seems to work fine. You can use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/radians.xhtml" target="_blank">radians</a> function that is built into the GLSL language to convert a number from degrees to radians. The parameters, <code>c</code> and <code>h</code>, are used to control the dimensions of the cone.</p>
<p>Let&rsquo;s add a nose to our snowman!</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-ab4b78b0ccb18053afd873e07ef81a71" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-171.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ab4b78b0ccb18053afd873e07ef81a71"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-171.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can use your mouse to move the camera around the snowman to make sure the cone looks fine.</p>
<p><a href="#R-image-504449b40607747622882b66e930ec79" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-172.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-504449b40607747622882b66e930ec79"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-172.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s add arms to the snowman. Typically, the arms are made of sticks. We can simulate sticks by using a 3D line or &ldquo;capsule.&rdquo; In <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s list of 3D SDFs</a>, there&rsquo;s an SDF called &ldquo;Capsule / Line - exact&rdquo; that we can leverage for building a snowman arm.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCapsule</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">a</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Add an offset parameter to this function, so we can move the capsule around in 3D space.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCapsule</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">a</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec3</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we&rsquo;ll add a capsule in our 3D scene to simulate the left arm of the snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">mainBranch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-093ecdb9629e1969d2982f7622adfc1b" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-173.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-093ecdb9629e1969d2982f7622adfc1b"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-173.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The arm looks a bit too small and kinda awkward. Let&rsquo;s add a couple small capsules that branch off the &ldquo;main branch&rdquo; arm, so that it looks like the arm is built out of a tree branch.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchBottom</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchTop</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">mainBranch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-232d9b376fe98780c709791ed0bff67f" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-174.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-232d9b376fe98780c709791ed0bff67f"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-174.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>For the right arm, we need to apply the same three capsule SDFs but flip the sign of the x-component to &ldquo;mirror&rdquo; the arm on the other side of the snowman. We could write another three lines for the right arm, one for each capsule SDF, or we can get clever. The snowman is currently centered in the middle of our screen. We can take advantage of symmetry to draw the right arm with the same offset as the left arm but with a positive x-component instead of negative.</p>
<p>Let&rsquo;s create a custom SDF that merges the three branches into one SDF called <code>sdArm</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdArm</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchBottom</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchTop</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">mainBranch</span><span class="p">,</span> <span class="n">smallBranchBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we can use this function inside our <code>scene</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Let&rsquo;s make a custom operation called <code>opFlipX</code> that will flip the sign of the x-component of the point passed into it.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">opFlipX</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we can use this function inside the <code>scene</code> function to draw the right arm.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-95152dd7ce71656d745fa054018e5386" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-175.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-95152dd7ce71656d745fa054018e5386"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-175.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>VoilÃ ! We used symmetry to draw the right arm of the snowman! If we decide to move the arm a bit, it&rsquo;ll automatically be reflected in the offset of the right arm.</p>
<p>We can use the new <code>opFlipX</code> operation for the right eye of the snowman as well. Let&rsquo;s create a custom SDF for an eye of the snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdEye</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Next, we can use it inside the <code>scene</code> function to draw both the left eye and right eye.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The snowman looks great so far, but it&rsquo;s missing some pizazz. It could be great if the snowman had a top hat. We can simulate a top hat by combining two cylinders together. For that, we&rsquo;ll need to grab the cylinder SDF titled &ldquo;Capped Cylinder - exact&rdquo; from <a href="https://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm" target="_blank">Inigo Quilez&rsquo;s list of 3D SDFs</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCappedCylinder</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">),</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Make sure to add an offset, so we can move the hat around in 3D space.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdCappedCylinder</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">),</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We can create a thin cylinder for the bottom part of the hat, and a tall cylinder for the top part of the hat.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">hatBottom</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">float</span> <span class="n">hatTop</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">hatBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">hatTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-1f7235f8482aa9487c0b311bd4bf3a5a" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-176.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1f7235f8482aa9487c0b311bd4bf3a5a"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-176.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Our snowman is looking dapper now! ğŸ˜ƒ</p>
<h4 id="organizing-code-with-custom-sdfs">Organizing Code with Custom SDFs</h4>
<p>When we color the snowman, we&rsquo;ll need to target the individual parts of the snowman that have unique colors. We can organize the code by creating custom SDFs for each part of the snowman that will have a unique color.</p>
<p>Let&rsquo;s create an SDF called <code>sdBody</code> for the body of the snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdBody</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We already created an SDF for the eyes called <code>sdEyes</code>, but we need to create an SDF for the nose. Create a new function called <code>sdNose</code> with the following contents.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdNose</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">return</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We already created a custom SDF for the arms, but let&rsquo;s create one for the hat called <code>sdHat</code> with the following code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">sdHat</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">hatBottom</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">hatTop</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">hatBottom</span><span class="p">,</span> <span class="n">hatTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, we can adjust our scene function to use all of our custom SDFs that already take account for the offset or position of each part of the snowman inside the function declaration.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">body</span> <span class="o">=</span> <span class="n">sdBody</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdNose</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">hat</span> <span class="o">=</span> <span class="n">sdHat</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">hat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Looks much cleaner now! There&rsquo;s one more thing we can do to make this code a bit more abstract. If we plan on drawing multiple snowmen to the scene, then we should create a custom SDF that draws an entire snowman. Let&rsquo;s create a new function called <code>sdSnowman</code> that does just that.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">body</span> <span class="o">=</span> <span class="n">sdBody</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdNose</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">float</span> <span class="n">hat</span> <span class="o">=</span> <span class="n">sdHat</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">hat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Finally, our scene function will simply return the value of snowman SDF.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Our snowman is now built and ready to be colored! You can find the finished code for this entire scene below.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl">
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">
</span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="k">float</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">  <span class="k">return</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="k">vec3</span> <span class="n">opFlipX</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="k">float</span> <span class="n">sdCone</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">  <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="o">-</span><span class="n">h</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="k">float</span> <span class="n">sdCapsule</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">a</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="k">vec3</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="k">float</span> <span class="n">sdCappedCylinder</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">),</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="k">float</span> <span class="n">sdBody</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">float</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  <span class="k">float</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="k">float</span> <span class="n">sdEye</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">return</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="k">float</span> <span class="n">sdNose</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  <span class="k">return</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">
</span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="k">float</span> <span class="n">sdArm</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchBottom</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchTop</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">mainBranch</span><span class="p">,</span> <span class="n">smallBranchBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="k">float</span> <span class="n">sdHat</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="k">float</span> <span class="n">hatBottom</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">float</span> <span class="n">hatTop</span> <span class="o">=</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">hatBottom</span><span class="p">,</span> <span class="n">hatTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">
</span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="k">float</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  <span class="k">float</span> <span class="n">body</span> <span class="o">=</span> <span class="n">sdBody</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">  <span class="k">float</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">  <span class="k">float</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">  <span class="k">float</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdNose</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="k">float</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="k">float</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">float</span> <span class="n">hat</span> <span class="o">=</span> <span class="n">sdHat</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">hat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="k">float</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl"> <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">
</span></span><span class="line"><span class="ln">112</span><span class="cl"><span class="k">float</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="k">float</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// distance ray has travelled</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">
</span></span><span class="line"><span class="ln">128</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">
</span></span><span class="line"><span class="ln">137</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">	
</span></span><span class="line"><span class="ln">142</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">
</span></span><span class="line"><span class="ln">145</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">  
</span></span><span class="line"><span class="ln">150</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">
</span></span><span class="line"><span class="ln">152</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">  
</span></span><span class="line"><span class="ln">156</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">
</span></span><span class="line"><span class="ln">160</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">
</span></span><span class="line"><span class="ln">162</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// signed distance value to closest object</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">
</span></span><span class="line"><span class="ln">164</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">COLOR_BACKGROUND</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">
</span></span><span class="line"><span class="ln">170</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.65</span><span class="p">;</span> <span class="c1">// The 0.65 is used to decrease the light intensity a bit</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">
</span></span><span class="line"><span class="ln">173</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection mapped to values between 0.5 and 1.0</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">
</span></span><span class="line"><span class="ln">175</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">
</span></span><span class="line"><span class="ln">178</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><h4 id="coloring-the-snowman">Coloring the Snowman</h4>
<p>Now that we have the model of snowman built, let&rsquo;s add some color! We can declare some constants at the top of our code. We already have constants declared for the background color and ambient color in our scene. Let&rsquo;s add colors for each part of the snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BODY</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_EYE</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_NOSE</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_ARM</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_HAT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span></span></span></code></pre></div><p>Take note that the final color of the snowman is currently determined by Lambertian diffuse reflection plus the ambient color. Therefore, the color we defined in our constants will be blended with the ambient color. If you prefer, you can remove the ambient color to see the true color of each part of the snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span> </span></span></code></pre></div><p>As we learned in <a href="https://inspirnathan.com/posts/53-shadertoy-tutorial-part-7" target="_blank">Part 7</a> of my Shadertoy tutorial series, we can use <a href="https://www.khronos.org/opengl/wiki/Data_Type_%28GLSL%29#Structs" target="_blank">structs</a> to hold multiple values. We&rsquo;ll create a new struct that will hold the &ldquo;signed distance&rdquo; from the camera to the surface of an object in our scene and the color of that surface.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// diffuse color</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">};</span></span></span></code></pre></div><p>We&rsquo;ll have to make changes to a few operations, so they return <code>Surface</code> structs instead of just <code>float</code> values.</p>
<p>For the <code>opUnion</code> operation, we will actually overload this function. We&rsquo;ll keep the original function intact, but create a new <code>opUnion</code> function that passes in <code>Surface</code> structs instead of floats.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">d1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="https://en.wikipedia.org/wiki/Function_overloading" target="_blank">Function overloading</a> is quite common across different programming languages. It lets us define the same function name, but we can pass in a different number of parameters or different types of parameters. Therefore, if we call <code>opUnion</code> with <code>float</code> values, then it&rsquo;ll call the first function definition. If we call <code>opUnion</code> with <code>Surface</code> structs, then it&rsquo;ll call the second definition.</p>
<p>For the <code>opSmoothUnion</code> function, we won&rsquo;t need to overload this function. We will change this function to accept <code>Surface</code> structs instead of <code>float</code> values. Therefore, we need to call <code>mix</code> on both the signed distance, <code>sd</code>, and the color, <code>col</code>. This lets us smoothly blend two shapes together and blend their colors together as well.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">opSmoothUnion</span><span class="p">(</span> <span class="n">Surface</span> <span class="n">d1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">Surface</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="p">.</span><span class="n">sd</span><span class="o">-</span><span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">s</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="n">s</span><span class="p">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">.</span><span class="n">col</span><span class="p">,</span> <span class="n">d1</span><span class="p">.</span><span class="n">col</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll leave the SDFs for the primitive shapes (sphere, cone, capsule, cylinder) alone. They will continue to return a <code>float</code> value. However, we&rsquo;ll need to adjust our custom SDFs that return a part of the snowman. We want to return a <code>Surface</code> struct that contains a color for each part of our snowman, so we can pass along the color value during our ray marching loop.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBody</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">Surface</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_BODY</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">Surface</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_BODY</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">Surface</span> <span class="n">sdEye</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_EYE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">Surface</span> <span class="n">sdNose</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_NOSE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">Surface</span> <span class="n">sdArm</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchBottom</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchTop</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">mainBranch</span><span class="p">,</span> <span class="n">smallBranchBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_ARM</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="n">Surface</span> <span class="n">sdHat</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">Surface</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_HAT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">Surface</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_HAT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">top</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">Surface</span> <span class="n">body</span> <span class="o">=</span> <span class="n">sdBody</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="n">Surface</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">Surface</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="n">Surface</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdNose</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="n">Surface</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="n">Surface</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="n">Surface</span> <span class="n">hat</span> <span class="o">=</span> <span class="n">sdHat</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">hat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Our ray marching loop will need adjusted, since we are now returning a <code>Surface</code> struct instead of a <code>float</code> value.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We also need to adjust the <code>calcNormal</code> function to use the signed distance value, <code>sd</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>In the <code>mainImage</code> function, the ray marching loop used to return a <code>float</code>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span></span></span></code></pre></div><p>We need to replace the above code with the following, since the ray marching loop now returns a <code>Surface</code> struct.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span></span></span></code></pre></div><p>Additionally, we need to check if <code>co.sd</code> is greater than <code>MAX_DIST</code> instead of <code>d</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span></span></span></code></pre></div><p>Likewise, we need to use <code>co</code> instead of <code>d</code> when defining <code>p</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span></span></span></code></pre></div><p>In the <code>mainImage</code> function, we were setting the color equal to the diffuse color plus the ambient color.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">dif</span><span class="p">)</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span></span></span></code></pre></div><p>Now, we need to replace the above line with the following, since the color is determined by the part of the snowman hit by the ray as well.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span></span></span></code></pre></div><p>Your finished code should look like the following:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">  1</span><span class="cl"><span class="k">const</span> <span class="k">int</span> <span class="n">MAX_MARCHING_STEPS</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MIN_DIST</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PRECISION</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0005</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BACKGROUND</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">.741</span><span class="p">,</span> <span class="mf">.675</span><span class="p">,</span> <span class="mf">.82</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BODY</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_EYE</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_NOSE</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_ARM</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_HAT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="k">struct</span> <span class="n">Surface</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">  <span class="k">float</span> <span class="n">sd</span><span class="p">;</span> <span class="c1">// signed distance</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span><span class="p">;</span> <span class="c1">// diffuse color</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">
</span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="k">mat2</span> <span class="n">rotate2d</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">
</span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="k">float</span> <span class="n">opUnion</span><span class="p">(</span><span class="k">float</span> <span class="n">d1</span><span class="p">,</span> <span class="k">float</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">
</span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="n">Surface</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">Surface</span> <span class="n">d1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">d2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">d2</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span> <span class="k">return</span> <span class="n">d2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">  <span class="k">return</span> <span class="n">d1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">
</span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="n">Surface</span> <span class="n">opSmoothUnion</span><span class="p">(</span> <span class="n">Surface</span> <span class="n">d1</span><span class="p">,</span> <span class="n">Surface</span> <span class="n">d2</span><span class="p">,</span> <span class="k">float</span> <span class="n">k</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">  <span class="n">Surface</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">d2</span><span class="p">.</span><span class="n">sd</span><span class="o">-</span><span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">)</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">  <span class="n">s</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">d1</span><span class="p">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">  <span class="n">s</span><span class="p">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span> <span class="n">d2</span><span class="p">.</span><span class="n">col</span><span class="p">,</span> <span class="n">d1</span><span class="p">.</span><span class="n">col</span><span class="p">,</span> <span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">
</span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="k">vec3</span> <span class="n">opFlipX</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">  <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="k">float</span> <span class="n">sdSphere</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="k">float</span> <span class="n">sdCone</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec2</span> <span class="n">c</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  <span class="k">float</span> <span class="n">q</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">)),</span><span class="o">-</span><span class="n">h</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">
</span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="k">float</span> <span class="n">sdCapsule</span><span class="p">(</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">a</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">b</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">  <span class="k">vec3</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">pa</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span> <span class="n">pa</span> <span class="o">-</span> <span class="n">ba</span><span class="o">*</span><span class="n">h</span> <span class="p">)</span> <span class="o">-</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="k">float</span> <span class="n">sdCappedCylinder</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">h</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  <span class="k">vec2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="k">vec2</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">),</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mf">0.0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">
</span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="n">Surface</span> <span class="n">sdBody</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">  <span class="n">Surface</span> <span class="n">bottomSnowball</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_BODY</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">  <span class="n">Surface</span> <span class="n">topSnowball</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_BODY</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">  <span class="k">return</span> <span class="n">opSmoothUnion</span><span class="p">(</span><span class="n">bottomSnowball</span><span class="p">,</span> <span class="n">topSnowball</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">
</span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="n">Surface</span> <span class="n">sdEye</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdSphere</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_EYE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="n">Surface</span> <span class="n">sdNose</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">  <span class="k">float</span> <span class="n">noseAngle</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">75.</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdCone</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec2</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">noseAngle</span><span class="p">)),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_NOSE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">
</span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="n">Surface</span> <span class="n">sdArm</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">  <span class="k">float</span> <span class="n">mainBranch</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchBottom</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  <span class="k">float</span> <span class="n">smallBranchTop</span> <span class="o">=</span> <span class="n">sdCapsule</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">));</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">mainBranch</span><span class="p">,</span> <span class="n">smallBranchBottom</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">  <span class="n">d</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">smallBranchTop</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">COLOR_ARM</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">
</span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="n">Surface</span> <span class="n">sdHat</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">  <span class="n">Surface</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_HAT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">  <span class="n">Surface</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">(</span><span class="n">sdCappedCylinder</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mo">0</span><span class="p">)),</span> <span class="n">COLOR_HAT</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">  
</span></span><span class="line"><span class="ln">107</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">bottom</span><span class="p">,</span> <span class="n">top</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">
</span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="n">Surface</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  <span class="n">Surface</span> <span class="n">body</span> <span class="o">=</span> <span class="n">sdBody</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  <span class="n">Surface</span> <span class="n">leftEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">  <span class="n">Surface</span> <span class="n">rightEye</span> <span class="o">=</span> <span class="n">sdEye</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">  <span class="n">Surface</span> <span class="n">nose</span> <span class="o">=</span> <span class="n">sdNose</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">  <span class="n">Surface</span> <span class="n">leftArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">  <span class="n">Surface</span> <span class="n">rightArm</span> <span class="o">=</span> <span class="n">sdArm</span><span class="p">(</span><span class="n">opFlipX</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">  <span class="n">Surface</span> <span class="n">hat</span> <span class="o">=</span> <span class="n">sdHat</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">
</span></span><span class="line"><span class="ln">119</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">leftEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">rightEye</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">nose</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">hat</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">leftArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">  <span class="n">co</span> <span class="o">=</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">co</span><span class="p">,</span> <span class="n">rightArm</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">  
</span></span><span class="line"><span class="ln">127</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">
</span></span><span class="line"><span class="ln">130</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">  <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">
</span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="n">Surface</span> <span class="n">rayMarch</span><span class="p">(</span><span class="k">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">  <span class="k">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">MIN_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span><span class="p">;</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">
</span></span><span class="line"><span class="ln">138</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mo">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MARCHING_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">rd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">    <span class="n">co</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="n">depth</span> <span class="o">+=</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&lt;</span> <span class="n">PRECISION</span> <span class="o">||</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">  
</span></span><span class="line"><span class="ln">145</span><span class="cl">  <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">  
</span></span><span class="line"><span class="ln">147</span><span class="cl">  <span class="k">return</span> <span class="n">co</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">
</span></span><span class="line"><span class="ln">150</span><span class="cl"><span class="k">vec3</span> <span class="n">calcNormal</span><span class="p">(</span><span class="k">in</span> <span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">    <span class="k">vec2</span> <span class="n">e</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">    <span class="k">return</span> <span class="n">normalize</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xyy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xyy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yyx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yyx</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">yxy</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">yxy</span><span class="p">).</span><span class="n">sd</span> <span class="o">+</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">      <span class="n">e</span><span class="p">.</span><span class="n">xxx</span> <span class="o">*</span> <span class="n">scene</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">xxx</span><span class="p">).</span><span class="n">sd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">
</span></span><span class="line"><span class="ln">159</span><span class="cl"><span class="n">mat3</span> <span class="n">camera</span><span class="p">(</span><span class="k">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">lookAtPoint</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">	<span class="k">vec3</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPoint</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">	<span class="k">vec3</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span> <span class="n">cd</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">	<span class="k">vec3</span> <span class="n">cu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">cr</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">	
</span></span><span class="line"><span class="ln">164</span><span class="cl">	<span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="o">-</span><span class="n">cr</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="o">-</span><span class="n">cd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">
</span></span><span class="line"><span class="ln">167</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">  <span class="k">vec2</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="n">iMouse</span><span class="p">.</span><span class="n">xy</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">  
</span></span><span class="line"><span class="ln">172</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// trick to center mouse on page load</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">
</span></span><span class="line"><span class="ln">174</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">  <span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">);</span> <span class="c1">// lookat point</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">  <span class="k">vec3</span> <span class="n">ro</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// ray origin that represents camera position</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">  
</span></span><span class="line"><span class="ln">178</span><span class="cl">  <span class="k">float</span> <span class="n">cameraRadius</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">yz</span> <span class="o">*</span> <span class="n">cameraRadius</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">PI</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">  <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">=</span> <span class="n">ro</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">rotate2d</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="n">PI</span><span class="p">,</span> <span class="n">PI</span><span class="p">,</span> <span class="n">mouseUV</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="k">vec2</span><span class="p">(</span><span class="n">lp</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">
</span></span><span class="line"><span class="ln">182</span><span class="cl">  <span class="k">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">lp</span><span class="p">)</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// ray direction</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">
</span></span><span class="line"><span class="ln">184</span><span class="cl">  <span class="n">Surface</span> <span class="n">co</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">ro</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span> <span class="c1">// closest object</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">
</span></span><span class="line"><span class="ln">186</span><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">COLOR_BACKGROUND</span><span class="p">;</span> <span class="c1">// ray didn&#39;t hit anything</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">    <span class="k">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">;</span> <span class="c1">// point discovered from ray marching</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">    <span class="k">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">calcNormal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="c1">// surface normal</span>
</span></span><span class="line"><span class="ln">191</span><span class="cl">
</span></span><span class="line"><span class="ln">192</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">193</span><span class="cl">    <span class="k">vec3</span> <span class="n">lightDirection</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lightPosition</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.65</span><span class="p">;</span> <span class="c1">// The 0.65 is used to decrease the light intensity a bit</span>
</span></span><span class="line"><span class="ln">194</span><span class="cl">
</span></span><span class="line"><span class="ln">195</span><span class="cl">    <span class="k">float</span> <span class="n">dif</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">lightDirection</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// diffuse reflection mapped to values between 0.5 and 1.0</span>
</span></span><span class="line"><span class="ln">196</span><span class="cl">
</span></span><span class="line"><span class="ln">197</span><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="n">COLOR_AMBIENT</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">198</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">199</span><span class="cl">
</span></span><span class="line"><span class="ln">200</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">201</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run this code, you should see the snowman in color!</p>
<p><a href="#R-image-ae14b2f8b6faceda1290583cbb946c08" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-177.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ae14b2f8b6faceda1290583cbb946c08"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-177.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="creating-multiple-snowmen">Creating Multiple Snowmen</h4>
<p>Now that we have added color to our snowman, let&rsquo;s create an awesome scene using our new snowman model!</p>
<p>The snowman model is currently floating in air. Let&rsquo;s add a floor of now beneath the snowman. We&rsquo;ll create a new custom SDF that returns a <code>Surface</code> struct.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">snowFloor</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">snowFloorCol</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">snowFloor</span><span class="p">,</span> <span class="n">snowFloorCol</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, we&rsquo;ll adjust our <code>scene</code> function to add the floor to our 3D scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sdSnowman</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-155d6eb58a7c4419617176d697eaf6f9" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-178.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-155d6eb58a7c4419617176d697eaf6f9"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-178.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The colors we have chosen makes it look like it&rsquo;s a sunny day outside. What if we wanted to make it look like it was nighttime instead? We can adjust the ambient light color to change the mood of the scene.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_AMBIENT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">;</span></span></span></code></pre></div><p>Now the scene instantly appears different.</p>
<p><a href="#R-image-2411e18eb9a733b718a0bdb3eb0c8005" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-179.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2411e18eb9a733b718a0bdb3eb0c8005"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-179.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The surface of the snow appears a bit flat. What if we wanted to add a bit of texture to it? We can use &ldquo;channels&rdquo; in Shadertoy to add a texture to our shader. Underneath the code section on Shadertoy, you should see four channels: iChannel0, iChannel1, iChannel2, and iChannel3.</p>
<p><a href="#R-image-c212350a466aa4161adbf435a134ae3a" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-180.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c212350a466aa4161adbf435a134ae3a"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-180.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can use channels to add interactivity to your shader such as a webcam, microphone input, or even sound from <a href="https://soundcloud.com/" target="_blank">SoundCloud</a>! In our case, we want to add a texture. Click on the box for iChannel0. You should see a modal pop up. Click on the &ldquo;Textures&rdquo; tab, and you should see a selection of textures to choose from.</p>
<p><a href="#R-image-f0997d916248e73cc4f43afda0f96d2a" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-181.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f0997d916248e73cc4f43afda0f96d2a"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-181.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Select the texture called &ldquo;Gray Noise Small.&rdquo; Once selected, it should appear in the iChannel0 box beneath your code.</p>
<p><a href="#R-image-887af441ff501a9e58090e9f2fd48898" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-182.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-887af441ff501a9e58090e9f2fd48898"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-182.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Noise lets us add a bit of fake randomness or &ldquo;pseudorandomness&rdquo; to our code. It&rsquo;s not truly random because the shader will look the same upon every run. This makes the shader deterministic, which is useful for making sure everyone sees the same shader. Noise will make it seem like the floor has a &ldquo;random&rdquo; pattern. We don&rsquo;t have access to anything like <code>Math.random</code> in GLSL code like we do in JavaScript. Therefore, shader authors typically have to rely on procedurally generating noise through an algorithm or by utilizing textures from images like what we&rsquo;re going to do.</p>
<p>Go back to the <code>sdFloor</code> function we defined earlier and replace it with the following code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">sdFloor</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">float</span> <span class="n">snowFloor</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">snowFloorCol</span> <span class="o">=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mf">1.5</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="o">/</span><span class="mf">100.</span><span class="p">).</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">Surface</span><span class="p">(</span><span class="n">snowFloor</span><span class="p">,</span> <span class="n">snowFloorCol</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The <code>texture</code> function lets us access the texture stored in iChannel0. Each texture has a set of UV coordinates much like the Shadertoy canvas. The first parameter of the <code>texture</code> function will be <code>iChannel0</code>. The second parameter is the point on the &ldquo;Gray Noise Small&rdquo; image we would like to select.</p>
<p>We can adjust the height of the floor by sampling values from the texture.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">float</span> <span class="n">snowFloor</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="p">).</span><span class="n">x</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">;</span></span></span></code></pre></div><p>We can also adjust the color of the floor by sampling values from the texture.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">snowFloorCol</span> <span class="o">=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">mix</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mf">1.5</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel0</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">xz</span><span class="o">/</span><span class="mf">100.</span><span class="p">).</span><span class="n">x</span><span class="p">);</span></span></span></code></pre></div><p>I played around with scaling factors and values in the <code>mix</code> function until I found a material that looked close enough to snow.</p>
<p><a href="#R-image-a9e935708cf2b063c6d9068b3f08a324" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-183.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a9e935708cf2b063c6d9068b3f08a324"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-183.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The snowman looks a bit lonely, so why not give him some friends! We can use the <code>opRep</code> operation I discussed in <a href="https://inspirnathan.com/posts/60-shadertoy-tutorial-part-14" target="_blank">Part 14</a> of my Shadertoy tutorial series to create lots of snowmen!</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>In the <code>scene</code> function, we can set the spacing between the snowmen and set the directions the snowmen should repeat.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">Surface</span> <span class="n">sdSnowmen</span> <span class="o">=</span> <span class="n">opRep</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sdSnowmen</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>The snowman is no longer alone! However, one snowman seems to be hogging all the attention in the scene.</p>
<p><a href="#R-image-9a1ad5e2d41cc7586eb94981b1104233" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-184.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9a1ad5e2d41cc7586eb94981b1104233"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-184.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s make a few adjustments. We&rsquo;ll change the default position of the mouse when the page loads, so it&rsquo;s slightly offset from the center of the screen.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">mouseUV</span> <span class="o">==</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span> <span class="n">mouseUV</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">);</span></span></span></code></pre></div><p>Next, we&rsquo;ll adjust the lookat point:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lp</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span></span></span></code></pre></div><p>Finally, we&rsquo;ll adjust the starting angle and position of the scene when the page loads:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mf">0.75</span><span class="p">;</span> <span class="c1">// move entire scene slightly to the left</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// start scene at an angle</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="n">Surface</span> <span class="n">sdSnowmen</span> <span class="o">=</span> <span class="n">opRep</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sdSnowmen</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Now, the scene is setup such that people visiting your shader for the first time will see a bunch of snowmen without one of the snowman getting in the way of the camera. You can still use your mouse to rotate the camera around the scene.</p>
<p><a href="#R-image-f0e6c501ab94116cff90ab6fc0d96a1e" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-185.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f0e6c501ab94116cff90ab6fc0d96a1e"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-185.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The scene is starting to look better, but as you look down the isle of snowmen, it looks too artificial. Let&rsquo;s add some fog to add a sense of depth to our scene. We learned about fog in <a href="https://inspirnathan.com/posts/59-shadertoy-tutorial-part-13" target="_blank">Part 13</a> of my Shadertoy series. Right before the final <code>fragColor</code> value is set, add the following line:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">COLOR_BACKGROUND</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.00005</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span> <span class="o">*</span> <span class="n">co</span><span class="p">.</span><span class="n">sd</span><span class="p">));</span> <span class="c1">// fog</span></span></span></code></pre></div><p><a href="#R-image-d126d74b6fb948ceb6cdfa56abf0da89" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-186.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d126d74b6fb948ceb6cdfa56abf0da89"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-186.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Much better! The snowmen seem to be facing away from the light. Let&rsquo;s change the light direction, so they appear brighter. Inside the <code>mainImage</code> function, we&rsquo;ll adjust the value of the light position.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">vec3</span> <span class="n">lightPosition</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span></span></span></code></pre></div><p>We&rsquo;ll also make the color of each snowman&rsquo;s body and hat a bit brighter.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_BODY</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">1.15</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">const</span> <span class="k">vec3</span> <span class="n">COLOR_HAT</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.4</span><span class="p">);</span></span></span></code></pre></div><p><a href="#R-image-ae84414276930de1d2cd5dc4657711eb" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-187.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-ae84414276930de1d2cd5dc4657711eb"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-187.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Their hats look more noticeable now! Next, let&rsquo;s make the snowmen a bit more lively. We&rsquo;ll wiggle them a bit and have them bounce up and down.</p>
<p>We can cause them to wiggle a bit by applying a transformation matrix to each snowman. Create a function called <code>wiggle</code> and use the <code>rotateZ</code> function I discussed in <a href="https://inspirnathan.com/posts/54-shadertoy-tutorial-part-8" target="_blank">Part 8</a>.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">mat3</span> <span class="n">rotateZ</span><span class="p">(</span><span class="k">float</span> <span class="n">theta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">float</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">vec3</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">vec3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mo">0</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">mat3</span> <span class="n">wiggle</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">return</span> <span class="n">rotateZ</span><span class="p">(</span><span class="n">mix</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">iTime</span> <span class="o">*</span> <span class="n">SPEED</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>We&rsquo;ll define a <code>SPEED</code> constant at the top of our code. Let&rsquo;s set it to a value of four.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">const</span> <span class="k">float</span> <span class="n">SPEED</span> <span class="o">=</span> <span class="mf">4.</span><span class="p">;</span></span></span></code></pre></div><p>Then, we&rsquo;ll apply the <code>wiggle</code> function inside the <code>opRep</code> function, so it&rsquo;s applied to each snowman.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">opRep</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">,</span> <span class="k">vec3</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="k">vec3</span> <span class="n">q</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="k">return</span> <span class="n">sdSnowman</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">wiggle</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Next, we want the snowmen to bounce up and down a bit. We can add the following line to our <code>scene</code> function.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">mix</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span> <span class="o">*</span> <span class="n">SPEED</span><span class="p">));</span></span></span></code></pre></div><p>This will deform the snowmen about the y-axis by a tiny amount. We use the <code>mix</code> function to remap the value of the <code>sin</code> function to values between <code>1.0</code> and <code>1.03</code>.</p>
<p>Your <code>scene</code> function should now look like the following.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">Surface</span> <span class="n">scene</span><span class="p">(</span><span class="k">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="mf">0.75</span><span class="p">;</span> <span class="c1">// move entire scene slightly to the left</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">*=</span> <span class="n">rotate2d</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// start scene at an angle</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">mix</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">iTime</span> <span class="o">*</span> <span class="n">SPEED</span><span class="p">));</span> <span class="c1">// bounce snowman up and down a bit</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="n">Surface</span> <span class="n">sdSnowmen</span> <span class="o">=</span> <span class="n">opRep</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mo">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="k">return</span> <span class="n">opUnion</span><span class="p">(</span><span class="n">sdSnowmen</span><span class="p">,</span> <span class="n">sdFloor</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see the snowmen start wiggling!</p>
<p><a href="#R-image-8fd0323a8e8332f38e4079d6a5df29cd" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-28.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8fd0323a8e8332f38e4079d6a5df29cd"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-28.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Finally, we can &ldquo;let it snow&rdquo; by overlaying falling snow on top of the scene. There are already plenty of great snow shaders out there on Shadertoy. We&rsquo;ll use <a href="https://www.shadertoy.com/view/3ld3zX" target="_blank">&ldquo;snow snow&rdquo;</a> by the Shadertoy author, <a href="https://www.shadertoy.com/user/changjiu" target="_blank">changjiu</a>. Always make sure you give credit to authors when using their shaders. If you&rsquo;re using an author&rsquo;s shader for commercial applications such as a game, make sure to ask their permission first!</p>
<p>Inside Shadertoy, we can use channels to add a buffer similar to how we added a texture earlier. Buffers let you create &ldquo;multi-pass&rdquo; shaders that let you pass the output or final color of each pixel of one shader to another shader. Think of it as a shader pipeline. We can pass the output of Buffer A to the main program running in the &ldquo;Image&rdquo; tab in your Shadertoy environment.</p>
<p>Click on the iChannel1 box in the section underneath your code. A popup should appear. Click on the &ldquo;Misc&rdquo; tab and select Buffer A.</p>
<p><a href="#R-image-f3952a2e81ce4782a2ba524a77dec055" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-188.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f3952a2e81ce4782a2ba524a77dec055"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-188.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Once you add Buffer A, you should see it appear in the iChannel1 box.</p>
<p><a href="#R-image-0dc58371fbc624fb564139fb315d4a9e" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-189.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-0dc58371fbc624fb564139fb315d4a9e"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-189.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Next, we need to create the Buffer A shader. Then, we&rsquo;ll add code inside of this shader pass. At the top of your screen, you should see a tab that says &ldquo;Image&rdquo; above your code. To the left of that, you will find a tab with a plus sign (+). Click on the plus sign, and choose &ldquo;Buffer A&rdquo; in the dropdown that appears.</p>
<p><a href="#R-image-c78a5597904b70054b977db6b8444377" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-190.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c78a5597904b70054b977db6b8444377"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-190.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Inside Buffer A, add the following code:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="cm">** Buffer A
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">** Credit: This buffer contains code forked from &#34;snow snow&#34; by changjiu: https://www.shadertoy.com/view/3ld3zX
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">float</span> <span class="n">SIZE_RATE</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">float</span> <span class="n">XSPEED</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">float</span> <span class="n">YSPEED</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">float</span> <span class="n">LAYERS</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">float</span> <span class="n">Hash11</span><span class="p">(</span><span class="k">float</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">vec3</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">p3</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">yzx</span> <span class="o">+</span> <span class="mf">19.19</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">return</span> <span class="n">fract</span><span class="p">((</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">p3</span><span class="p">.</span><span class="n">z</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">vec2</span> <span class="n">Hash22</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">vec3</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xyx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">p3</span> <span class="o">+=</span> <span class="n">dot</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">yzx</span><span class="o">+</span><span class="mf">19.19</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">return</span> <span class="n">fract</span><span class="p">((</span><span class="n">p3</span><span class="p">.</span><span class="n">xx</span><span class="o">+</span><span class="n">p3</span><span class="p">.</span><span class="n">yz</span><span class="p">)</span><span class="o">*</span><span class="n">p3</span><span class="p">.</span><span class="n">zy</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="k">vec2</span> <span class="n">Rand22</span><span class="p">(</span><span class="k">vec2</span> <span class="n">co</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">xy</span> <span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="mf">122.9898</span><span class="p">,</span><span class="mf">783.233</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">43758.5453</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">co</span><span class="p">.</span><span class="n">xy</span> <span class="p">,</span><span class="k">vec2</span><span class="p">(</span><span class="mf">457.6537</span><span class="p">,</span><span class="mf">537.2793</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">37573.5913</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="k">return</span> <span class="k">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">vec3</span> <span class="n">SnowSingleLayer</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span><span class="k">float</span> <span class="n">layer</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="k">vec3</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">uv</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">layer</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="k">float</span> <span class="n">xOffset</span> <span class="o">=</span> <span class="n">uv</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="p">(((</span><span class="n">Hash11</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span><span class="o">*</span><span class="mf">2.</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">*</span><span class="n">XSPEED</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="k">float</span> <span class="n">yOffset</span> <span class="o">=</span> <span class="n">YSPEED</span> <span class="o">*</span> <span class="n">iTime</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">uv</span> <span class="o">+=</span> <span class="k">vec2</span><span class="p">(</span><span class="n">xOffset</span><span class="p">,</span><span class="n">yOffset</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">vec2</span> <span class="n">rgrid</span> <span class="o">=</span> <span class="n">Hash22</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">31.1759</span><span class="o">*</span><span class="n">layer</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">uv</span> <span class="o">=</span> <span class="n">fract</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">rgrid</span><span class="o">*</span><span class="mf">2.</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.35</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">float</span> <span class="n">r</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">uv</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">float</span> <span class="n">circleSize</span> <span class="o">=</span> <span class="mf">0.04</span><span class="o">*</span><span class="p">(</span><span class="mf">1.5</span><span class="o">+</span><span class="mf">0.3</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">iTime</span><span class="o">*</span><span class="n">SIZE_RATE</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="k">float</span> <span class="n">val</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">circleSize</span><span class="p">,</span><span class="o">-</span><span class="n">circleSize</span><span class="p">,</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">val</span><span class="p">)</span><span class="o">*</span> <span class="n">rgrid</span><span class="p">.</span><span class="n">x</span> <span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">fragCoord</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="k">vec3</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">,</span><span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="k">float</span> <span class="n">i</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LAYERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="n">acc</span> <span class="o">+=</span> <span class="n">SnowSingleLayer</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span><span class="n">i</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">54</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>Then, go back to the &ldquo;Image&rdquo; tab where our main shader code lives. At the bottom of our code, we&rsquo;re going to use Buffer A to add falling snow to our scene in front of all the snowmen. Right after the fog and before the final <code>fragColor</code> is set, add the following line:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">col</span> <span class="o">+=</span> <span class="n">texture</span><span class="p">(</span><span class="n">iChannel1</span><span class="p">,</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span></span></span></code></pre></div><p>We use the <code>texture</code> function to access iChannel1 that holds the Buffer A texture. The second parameter of the <code>texture</code> function will be normal UV coordinates that go from zero to one. This will let us access each pixel of the shader in Buffer A as if it were an image.</p>
<p>Once you run the code, you should see an amazing winter scene with wiggling snowmen and falling snow! Congratulations! You did it! ğŸ‰ğŸ‰ğŸ‰</p>
<p><a href="#R-image-d51e6b347b8448d7db0efe4516bcc5ff" class="lightbox-link"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-29.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-d51e6b347b8448d7db0efe4516bcc5ff"><img src="D:/Gitee_repository/blog_hugo/content/computer_graphics/classic_tutorial/shader_tutorial/assets/shadertoy-29.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can see the finished code by visiting my shader on <a href="https://www.shadertoy.com/view/fsBSzW" target="_blank">Shadertoy</a>. Don&rsquo;t forget! You can use one of the channels to add music to your shader by selecting SoundCloud and pasting a URL in the input field.</p>
<h4 id="conclusion-16">Conclusion</h4>
<p>I hope you had fun building a snowman model, learning how to color it, and then drawing multiple snowmen to a beautiful scene with falling snow. You learned how to use ray marching to build a 3D model, add a textured floor to a 3D scene, add fog to give your scene a sense of depth, and use buffers to create a multi-pass shader!</p>
<p>If this helped you in any way or inspired you, please consider <a href="https://ko-fi.com/inspirnathan" target="_blank">donating</a>. Please check out the resources for the finished code for each part of this tutorial. Until next time, happy coding! Stay inspired!!!</p>
<h4 id="resources-15">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/sdsXWl" target="_blank">Ray Marching Snowman</a></li>
<li><a href="https://www.shadertoy.com/view/Ns2SR1" target="_blank">Ray Marching Snowman With Color</a></li>
<li><a href="https://www.shadertoy.com/view/fsBSzW" target="_blank">Ray Marching Multiple Snowmen</a></li>
</ul>
<h3 id="shader-resources">Shader Resources</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/64-shader-resources</p>
</blockquote>
<p>Greetings, friends! I hope you have learned a lot from my <a href="https://inspirnathan.com/posts/47-shadertoy-tutorial-part-1" target="_blank">Shadertoy series</a>. Today, I would like to discuss some additional resources you should check out for learning more about shader development.</p>
<h4 id="the-book-of-shaders">The Book of Shaders</h4>
<p>The <a href="https://thebookofshaders.com/" target="_blank">Book of Shaders</a> is an amazing free resource for learning how to run fragment shaders within the browser. It covers these important topics:</p>
<ul>
<li><a href="https://thebookofshaders.com/09/" target="_blank">Patterns</a></li>
<li><a href="https://thebookofshaders.com/10/" target="_blank">Randomness</a></li>
<li><a href="https://thebookofshaders.com/11/" target="_blank">Noise</a></li>
<li><a href="https://thebookofshaders.com/12/" target="_blank">Cellular noise (Voronoi and Perlin)</a></li>
</ul>
<p>In Shadertoy, you will commonly see functions named <code>hash</code> or <code>random</code>. These functions generate pseudorandom values in one or more dimensions (i.e. x-axis, y-axis, z-axis). Pseudorandom values are deterministic and aren&rsquo;t truly random. To the human eye, they look random, but each pixel color has a deterministic, calculated value. All users who visit a shader on Shadertoy will see the same pixel colors which is a good thing!</p>
<p>There&rsquo;s no <code>Math.random</code> function in GLSL or HLSL. Should one ever exist, you probably shouldn&rsquo;t use it anyways. Imagine if you were making a game in <a href="https://unity.com/" target="_blank">Unity</a> and developing shaders that needed to look random. If you had people testing each level of the game, each person might see slightly different visuals. We want the gameplay experience to be consistent for everyone.</p>
<h4 id="inigo-quilezs-website">Inigo Quilez&rsquo;s Website</h4>
<p><a href="https://www.iquilezles.org/www/index.htm" target="_blank">Inigo Quilez</a> is one of the co-creators of <a href="http://shadertoy.com/" target="_blank">Shadertoy</a>. His website contains an abundant wealth of knowledge about tons of topics in computer graphics. He has created plenty of examples in Shadertoy to help you learn how to use it and how to implement various algorithms in computer graphics. Check out his <a href="https://inspirnathan.com/posts/64-shader-resources/shadertoy.com/user/iq" target="_blank">Shadertoy profile</a> to see lots of amazing shaders! Here are some very helpful resources he&rsquo;s created for newcomers in the computer graphics world.</p>
<ul>
<li><a href="https://www.shadertoy.com/view/Xds3zN" target="_blank">Raymarching - Primitives</a></li>
<li><a href="https://www.youtube.com/watch?v=8--5LwHRhjk" target="_blank">Painting a Selfie Girl, with Maths</a></li>
<li><a href="https://www.shadertoy.com/view/Xd23Dh" target="_blank">Voronoise</a></li>
<li><a href="https://www.shadertoy.com/view/ldl3W8" target="_blank">Voronoise: Exact edges</a></li>
<li><a href="https://www.shadertoy.com/view/Xll3zX" target="_blank">Voronoise: Hierarchical</a></li>
<li><a href="https://www.shadertoy.com/view/ldB3zc" target="_blank">Voronoise: Smooth</a></li>
<li><a href="https://www.shadertoy.com/view/4dXBRH" target="_blank">Value Noise 2D, Derivatives</a></li>
<li><a href="https://www.shadertoy.com/view/XdXBRH" target="_blank">Gradient Noise 2D, Derivatives</a></li>
<li><a href="https://www.shadertoy.com/view/XsXfRH" target="_blank">Value Noise 3D, Derivatives</a></li>
<li><a href="https://www.shadertoy.com/view/4dffRH" target="_blank">Gradient Noise 3D, Derivatives</a></li>
<li><a href="https://www.shadertoy.com/view/lsf3WH" target="_blank">Value Noise 2D</a></li>
<li><a href="https://www.shadertoy.com/view/4sfGzS" target="_blank">Value Noise 3D</a></li>
<li><a href="https://www.shadertoy.com/view/XdXGW8" target="_blank">Gradient Noise 2D</a></li>
<li><a href="https://www.shadertoy.com/view/Xsl3Dl" target="_blank">Gradient Noise 3D</a></li>
<li><a href="https://www.shadertoy.com/view/Msf3WH" target="_blank">Simplex Noise 2D</a></li>
<li><a href="https://www.shadertoy.com/view/tldSRj" target="_blank">Wave Noise 2D</a></li>
</ul>
<h4 id="shadertoy">Shadertoy</h4>
<p>You can learn a lot from users across the <a href="http://shadertoy.com/" target="_blank">Shadertoy</a> community. If there&rsquo;s a topic in computer graphics you&rsquo;re struggling with, chances are that someone has already created a shader in Shadertoy that implements the algorithm you&rsquo;re looking for. Either use Google to search across Shadertoy using a search query such as &ldquo;site:shadertoy.com bubbles&rdquo; (without quotes) or use the search bar within Shadertoy using search queries such as &ldquo;tag=bubbles&rdquo; (without quotes).</p>
<h4 id="shadertoy-unofficial">Shadertoy Unofficial</h4>
<p>The <a href="https://inspirnathan.com/posts/64-shader-resources/shadertoyunofficial.wordpress.com" target="_blank">Shadertoy - Unofficial Blog</a> by <a href="https://www.shadertoy.com/user/FabriceNeyret2" target="_blank">FabriceNeyret2</a> is an excellent resource for learning more about Shadertoy and GLSL. The author of this blog has a list of amazing Shadertoy shaders that range from games, widgets, GUI toolkits, and more! Definitely check out this blog to learn more advanced skills and tricks in shader development!</p>
<h4 id="the-art-of-code">The Art of Code</h4>
<p>Martijn Steinrucken aka <a href="https://www.shadertoy.com/user/BigWIngs" target="_blank">BigWings</a> has an amazing YouTube channel called <a href="https://www.youtube.com/c/TheArtofCodeIsCool/videos" target="_blank">The Art of Code</a>. His channel helped me tremendously when I was learning shader development. In his videos, he creates really cool shaders to help teach everyone different concepts in the GLSL language and teach about algorithms in computer graphics. His shaders are incredible, so go check out his channel!</p>
<h4 id="learn-opengl">Learn OpenGL</h4>
<p><a href="https://learnopengl.com/Introduction" target="_blank">Learn OpenGL</a> is an incredible free resource for those who want to learn the OpenGL graphics API. With Shadertoy, we&rsquo;ve been stuck with only a fragment shader. By using the OpenGL API, you can create your own shaders outside of the browser and use both a vertex shader and fragment shader. You can also tap into other parts of the graphics pipeline.</p>
<p>Using the OpenGL API requires a lot more work than Shadertoy for creating shaders because Shadertoy takes care of handling a lot of boilerplate code for you. However, Shadertoy must run in the browser using WebGL which has its own set of limitations such as only being able to run shaders near 60 frames per second at a maximum.</p>
<p>The Learn OpenGL website is still a great resource for learning about shader concepts such as textures, cubemaps, lighting, physically based rendering (PBR), image based lighting (IBL), and more. Knowledge you learn on this website can be transferred over to Shadertoy or your preferred game engine or 3D modelling software.</p>
<h4 id="ray-tracing-in-one-weekend">Ray Tracing in One Weekend</h4>
<p>The <em>Ray Tracing in One Weekend</em> series is an amazing series of free books by <a href="https://www.petershirley.com/" target="_blank">Peter Shirley</a>, a brilliant computer scientist, who specializes in computer graphics. These books are filled with a plethora of information about ray tracing and path tracing.</p>
<h4 id="the-blog-at-the-bottom-of-the-sea">The Blog at the Bottom of the Sea</h4>
<p><a href="https://blog.demofox.org/" target="_blank">Demofox&rsquo;s Blog</a> is an amazing blog on computer graphics, game development, and other topics. The author has lots of amazing examples on <a href="https://www.shadertoy.com/user/demofox" target="_blank">Shadertoy</a> with really clean code. On his blog, you can learn a lot about <a href="https://blog.demofox.org/2018/01/30/what-the-heck-is-blue-noise/" target="_blank">Blue Noise</a>, <a href="https://blog.demofox.org/2020/05/25/casual-shadertoy-path-tracing-1-basic-camera-diffuse-emissive/" target="_blank">Path Tracing</a>, <a href="https://blog.demofox.org/2018/07/04/pathtraced-depth-of-field-bokeh/" target="_blank">Bokeh, and Depth of Field</a>.</p>
<h4 id="scratchapixel">Scratchapixel</h4>
<p><a href="https://www.scratchapixel.com/" target="_blank">Scratchapixel</a> has an awesome blog on computer graphics as well. The author has detailed articles on <a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-ray-tracing/how-does-it-work" target="_blank">Ray Tracing</a>, <a href="https://www.scratchapixel.com/lessons/3d-basic-rendering/global-illumination-path-tracing" target="_blank">Global Illumination, and Path Tracing</a>.</p>
<h4 id="alainxyz-blog">Alain.xyz Blog</h4>
<p><a href="https://alain.xyz/blog" target="_blank">Alain Galvan&rsquo;s Blog</a> has a plethora of resources and great content in regards to computer graphics, game development, 3D modelling, and more. There&rsquo;s so many good articles to read!</p>
<h4 id="reindernijhoffnet">reindernijhoff.net</h4>
<p><a href="https://reindernijhoff.net/" target="_blank">reindernijhoff.net</a> is a fantastic blog with so many amazing creations on Shadertoy. The author covers <a href="https://reindernijhoff.net/2018/09/raytracing-in-one-weekend/" target="_blank">Ray Tracing</a>, <a href="https://reindernijhoff.net/2018/08/old-watch-a-webgl-path-tracer/" target="_blank">Path Tracing</a>, <a href="https://reindernijhoff.net/2018/04/image-based-lighting/" target="_blank">Image Based Lighting</a>, and more. Go check it out! It&rsquo;s awesome!</p>
<h4 id="resources-for-volumetric-ray-marching">Resources for Volumetric Ray Marching</h4>
<p>Volumetric ray marching is a powerful technique used in game development and 3D modelling for creating clouds, fog, god rays (or godrays), and other types of objects with &ldquo;volumetric&rdquo; data. That is, the pixel value will be different depending on how far a ray enters a volume. Here are some really good resources to help you learn volumetric ray marching.</p>
<ul>
<li><a href="https://shaderbits.com/blog/creating-volumetric-ray-marcher" target="_blank">Shaderbits</a></li>
<li><a href="https://www.shadertoy.com/view/3sXSRX" target="_blank">Shadertoy: Volumetric Cloud Marching</a></li>
<li><a href="https://www.shadertoy.com/view/lstfR7" target="_blank">Shadertoy: Volumetric Point Light</a></li>
<li><a href="https://www.shadertoy.com/view/4ldGRf" target="_blank">Shadertoy: Volumetric Cloud</a></li>
<li><a href="https://www.udemy.com/course/unity-shaders/" target="_blank">Volumetric Rendering Section on Shader Udemy Course</a></li>
<li><a href="https://wallisc.github.io/rendering/2020/05/02/Volumetric-Rendering-Part-1.html" target="_blank">Volumetric Rendering Part 1</a></li>
<li><a href="https://wallisc.github.io/rendering/2020/05/02/Volumetric-Rendering-Part-2.html" target="_blank">Volumetric Rendering Part 2</a></li>
<li><a href="https://wallisc.github.io/rendering/2020/12/08/Making-Of-Moana-the-shadertoy.html" target="_blank">Making of Moana in Shadertoy</a></li>
</ul>
<h3 id="glow-shader-in-shadertoy">Glow Shader in Shadertoy</h3>
<blockquote>
<p>è½¬è‡ªï¼šhttps://inspirnathan.com/posts/65-glow-shader-in-shadertoy</p>
</blockquote>
<p>Greetings, friends! Today, we will learn how to make glow effects in shaders using Shadertoy!</p>
<p><a href="#R-image-e4e6dab585c6bf884e09c01789faef9c" class="lightbox-link"><img src="./assets/shadertoy-191.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e4e6dab585c6bf884e09c01789faef9c"><img src="./assets/shadertoy-191.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="what-is-glow">What is Glow?</h4>
<p>Before we make a glow effect, we need to think about what makes an object look like it&rsquo;s glowing. Lots of objects glow in real life: fireflies, light bulbs, jellyfish, and even the stars in the sky. These objects can generate luminescence or light to brighten up a dark room or area. The glow may be subtle and travel a small distance, or it could be as bright as a full moon, glowing far through the night sky.</p>
<p>In my opinion, there are two important factors for making an object look like its glowing:</p>
<ol>
<li>Good contrast between the object&rsquo;s color and the background</li>
<li>Color gradient that fades with distance from the object</li>
</ol>
<p>If we achieve these two goals, then we can create a glow effect. Let&rsquo;s begin!</p>
<h4 id="glowing-circle">Glowing Circle</h4>
<p>We can create a simple circle using a <a href="https://inspirnathan.com/posts/48-shadertoy-tutorial-part-2" target="_blank">circle SDF</a>:</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// signed distance value</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span> <span class="c1">// create white circle with black background</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// output color</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-5a89d5c9c5da891c2f44c79b847269ad" class="lightbox-link"><img src="./assets/shadertoy-192.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5a89d5c9c5da891c2f44c79b847269ad"><img src="./assets/shadertoy-192.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The circle SDF will give us a signed distance value equal to the distance from the center of the circle. Remember, a shader draws every pixel in parallel, and each pixel will be a certain distance away from the center of the circle.</p>
<p>Next, we can create a function that will add glow proportional to the distance away from the center of the circle. If you go to <a href="https://www.desmos.com/calculator" target="_blank">Desmos</a>, then you can enter <code>y = 1 / x</code> to visualize the function we will be using. Let&rsquo;s pretend that <code>x</code> represents the signed distance value for a circle. As it increases, the output, <code>y</code>, gets smaller or diminishes.</p>
<p><a href="#R-image-f50fa4f8ef3d6880630d54ec448d0b42" class="lightbox-link"><img src="./assets/shadertoy-193.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f50fa4f8ef3d6880630d54ec448d0b42"><img src="./assets/shadertoy-193.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>Let&rsquo;s use this function to create glow in our code.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// signed distance function</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span> <span class="c1">// create white circle with black background</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">glow</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="n">d</span><span class="p">;</span> <span class="c1">// create glow and diminish it with distance</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">glow</span><span class="p">;</span> <span class="c1">// add glow</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// output color</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run this code, you may see weird artifacts appear.</p>
<p><a href="#R-image-e19a8add1d4aaf5486cf8a8b71115db4" class="lightbox-link"><img src="./assets/shadertoy-194.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e19a8add1d4aaf5486cf8a8b71115db4"><img src="./assets/shadertoy-194.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>The <code>y = 1/x</code> function may result in unexpected values when <code>x</code> is less than or equal to zero. This can cause the compiler to perform weird calculations that cause unexpected colors. We can use the <a href="https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/clamp.xhtml" target="_blank">clamp</a> function to make sure the <code>glow</code> value stays between zero and one.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// signed distance function</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span> <span class="c1">// create white circle with black background</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">glow</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="n">d</span><span class="p">;</span> <span class="c1">// create glow and diminish it with distance</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">glow</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">glow</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// remove artifacts</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">glow</span><span class="p">;</span> <span class="c1">// add glow</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// output color</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see a glowing circle appear!</p>
<p><a href="#R-image-014b4cac0d5cd3f31c0b1be1438c6b23" class="lightbox-link"><img src="./assets/shadertoy-195.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-014b4cac0d5cd3f31c0b1be1438c6b23"><img src="./assets/shadertoy-195.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="increasing-glow-strength">Increasing Glow Strength</h4>
<p>You can multiply the glow by a value to make the circle appear even brighter and have the glow travel a larger distance.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">;</span> <span class="c1">// signed distance function</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span> <span class="c1">// create white circle with black background</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">glow</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">/</span><span class="n">d</span><span class="p">;</span> <span class="c1">// create glow and diminish it with distance</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">glow</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">glow</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span> <span class="c1">// remove artifacts</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">glow</span> <span class="o">*</span> <span class="mf">5.</span><span class="p">;</span> <span class="c1">// add glow</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span> <span class="c1">// output color</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-76e7445730530f10086de69b5ba001ff" class="lightbox-link"><img src="./assets/shadertoy-196.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-76e7445730530f10086de69b5ba001ff"><img src="./assets/shadertoy-196.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="glowing-star">Glowing Star</h4>
<p>We&rsquo;ve been using circles, but we can make other shapes glow too! Let&rsquo;s try using the <code>sdStar5</code> SDF from <a href="https://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm" target="_blank">Inigo Quilez&rsquo;s 2D distance functions</a>. You can learn more about how to use this SDF in <a href="https://inspirnathan.com/posts/51-shadertoy-tutorial-part-5" target="_blank">Part 5</a> of my Shadertoy tutorial series.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">float</span> <span class="n">rf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdStar5</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">);</span> <span class="c1">// signed distance function</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">clamp</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mf">0.001</span><span class="o">/</span><span class="n">d</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">12.</span><span class="p">;</span> <span class="c1">// add glow</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="n">col</span> <span class="o">*=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p>When you run the code, you should see a glowing star! ğŸŒŸ</p>
<p><a href="#R-image-aebb45cc2d389c28ef60bf36ffeb3617" class="lightbox-link"><img src="./assets/shadertoy-197.png" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-aebb45cc2d389c28ef60bf36ffeb3617"><img src="./assets/shadertoy-197.png" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<p>You can also add a <code>rotate</code> function, similar to what I discussed in <a href="https://inspirnathan.com/posts/49-shadertoy-tutorial-part-3" target="_blank">Part 3</a> of my Shadertoy tutorial series, to make the star spin.</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-glsl" data-lang="glsl"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">vec2</span> <span class="n">rotate</span><span class="p">(</span><span class="k">vec2</span> <span class="n">uv</span><span class="p">,</span> <span class="k">float</span> <span class="n">th</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">return</span> <span class="k">mat2</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">))</span> <span class="o">*</span> <span class="n">uv</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">float</span> <span class="n">sdStar5</span><span class="p">(</span><span class="k">vec2</span> <span class="n">p</span><span class="p">,</span> <span class="k">float</span> <span class="n">r</span><span class="p">,</span> <span class="k">float</span> <span class="n">rf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k1</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="mf">0.809016994375</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.587785252292</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">const</span> <span class="k">vec2</span> <span class="n">k2</span> <span class="o">=</span> <span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">p</span> <span class="o">-=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span><span class="o">*</span><span class="n">k2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">vec2</span> <span class="n">ba</span> <span class="o">=</span> <span class="n">rf</span><span class="o">*</span><span class="k">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">k1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">k1</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="k">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ba</span><span class="p">)</span><span class="o">/</span><span class="n">dot</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="n">ba</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">r</span> <span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">ba</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">sign</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="o">*</span><span class="n">ba</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">void</span> <span class="n">mainImage</span><span class="p">(</span> <span class="k">out</span> <span class="k">vec4</span> <span class="n">fragColor</span><span class="p">,</span> <span class="k">in</span> <span class="k">vec2</span> <span class="n">fragCoord</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">fragCoord</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span> <span class="c1">// x: &lt;0, 1&gt;, y: &lt;0, 1&gt;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="n">uv</span> <span class="o">-=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt;, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="n">uv</span><span class="p">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">iResolution</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">iResolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span> <span class="c1">// x: &lt;-0.5, 0.5&gt; * aspect ratio, y: &lt;-0.5, 0.5&gt;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="k">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sdStar5</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">iTime</span><span class="p">),</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">);</span> <span class="c1">// signed distance function</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">vec3</span> <span class="n">col</span> <span class="o">=</span> <span class="k">vec3</span><span class="p">(</span><span class="n">step</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">col</span> <span class="o">+=</span> <span class="n">clamp</span><span class="p">(</span><span class="k">vec3</span><span class="p">(</span><span class="mf">0.001</span><span class="o">/</span><span class="n">d</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">12.</span><span class="p">;</span> <span class="c1">// add glow</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">col</span> <span class="o">*=</span> <span class="k">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mo">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="n">fragColor</span> <span class="o">=</span> <span class="k">vec4</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">}</span></span></span></code></pre></div><p><a href="#R-image-35274d69ad74ad36badc5b0e5834548d" class="lightbox-link"><img src="./assets/shadertoy-30.gif" alt="" class="figure-image bg-white border lightbox noshadow" style="height: auto; width: auto;" loading="lazy"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-35274d69ad74ad36badc5b0e5834548d"><img src="./assets/shadertoy-30.gif" alt="" class="lightbox-image bg-white border lightbox noshadow" loading="lazy"></a></p>
<h4 id="conclusion-17">Conclusion</h4>
<p>In this tutorial, we learned how to make 2D shapes glow in a shader using signed distance functions (SDFs). We applied contrast between the color of the shape and background color. We also created a smooth gradient around the edges of the shape. These two criteria led to a simulated glow effect in our shaders. If you&rsquo;d like to learn more about Shadertoy, please check out my <a href="https://inspirnathan.com/posts/47-shadertoy-tutorial-part-1" target="_blank">Part 1</a> of my Shadertoy tutorial series.</p>
<h4 id="resources-16">Resources</h4>
<ul>
<li><a href="https://www.shadertoy.com/view/flSGDd" target="_blank">Glowing Star Shader</a></li>
</ul>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          
<span style="font-size:26px">æ™Ÿä¸–æ¸…é£</span>
        </div>
        <form action="../../../search.html" method="get"><div class="searchbox default-animation">
          <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
          <label class="a11y-only" for="R-search-by">Search</label>
          <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
          <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
        </div></form>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="../../../js/auto-complete.js?1708235103" defer></script>
        <script src="../../../js/lunr/lunr.min.js?1708235103" defer></script>
        <script src="../../../js/lunr/lunr.stemmer.support.min.js?1708235103" defer></script>
        <script src="../../../js/lunr/lunr.multi.min.js?1708235103" defer></script>
        <script src="../../../js/lunr/lunr.en.min.js?1708235103" defer></script>
        <script src="../../../js/search.js?1708235103" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="../../../index.html"><i class='fas fa-home'></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
          <li data-nav-id="/programming/index.html" class=""><input type="checkbox" id="R-section-d205f2b94e06f539e77f2bc392064cb6" aria-controls="R-subsections-d205f2b94e06f539e77f2bc392064cb6"><label for="R-section-d205f2b94e06f539e77f2bc392064cb6"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ç¨‹åºè®¾è®¡ä¸å¼€å‘</span></label><a class="padding" href="../../../programming/index.html">ç¨‹åºè®¾è®¡ä¸å¼€å‘</a><ul id="R-subsections-d205f2b94e06f539e77f2bc392064cb6" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/index.html" class="alwaysopen"><input type="checkbox" id="R-section-1a585580994f9dab2d4547c8eaf11987" aria-controls="R-subsections-1a585580994f9dab2d4547c8eaf11987" checked><label for="R-section-1a585580994f9dab2d4547c8eaf11987"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Java è¯­è¨€</span></label><a class="padding" href="../../../programming/java/index.html">Java è¯­è¨€</a><ul id="R-subsections-1a585580994f9dab2d4547c8eaf11987" class="morespace collapsible-menu">
          <li data-nav-id="/programming/java/java_basics/index.html" class=""><a class="padding" href="../../../programming/java/java_basics/index.html">Java åŸºç¡€çŸ¥è¯†</a></li>
          <li data-nav-id="/programming/java/java_collection_framework/index.html" class=""><a class="padding" href="../../../programming/java/java_collection_framework/index.html">Java é›†åˆæ¡†æ¶</a></li>
          <li data-nav-id="/programming/java/java_concurrency/index.html" class=""><a class="padding" href="../../../programming/java/java_concurrency/index.html">Java å¹¶å‘ç¼–ç¨‹</a></li>
          <li data-nav-id="/programming/java/java_memory_model/index.html" class=""><a class="padding" href="../../../programming/java/java_memory_model/index.html">Java å†…å­˜æ¨¡å‹</a></li>
          <li data-nav-id="/programming/java/java_annotation/index.html" class=""><a class="padding" href="../../../programming/java/java_annotation/index.html">Java æ³¨è§£ç›¸å…³</a></li></ul></li></ul></li>
          <li data-nav-id="/test/index.html" class=""><input type="checkbox" id="R-section-40aaf63da4d8c6f43df4cc726b56321f" aria-controls="R-subsections-40aaf63da4d8c6f43df4cc726b56321f"><label for="R-section-40aaf63da4d8c6f43df4cc726b56321f"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Test</span></label><a class="padding" href="../../../test/index.html">Test</a><ul id="R-subsections-40aaf63da4d8c6f43df4cc726b56321f" class="morespace collapsible-menu">
          <li data-nav-id="/test/demo/index.html" class=""><a class="padding" href="../../../test/demo/index.html">Test</a></li></ul></li>
          <li data-nav-id="/algorithms_and_data_structures/index.html" class=""><a class="padding" href="../../../algorithms_and_data_structures/index.html">æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li>
          <li data-nav-id="/computer_graphics/index.html" class="parent "><input type="checkbox" id="R-section-17dabdd0438dc68716ce11b90ee5aa30" aria-controls="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" checked><label for="R-section-17dabdd0438dc68716ce11b90ee5aa30"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu è®¡ç®—æœºå›¾å½¢å­¦</span></label><a class="padding" href="../../../computer_graphics/index.html">è®¡ç®—æœºå›¾å½¢å­¦</a><ul id="R-subsections-17dabdd0438dc68716ce11b90ee5aa30" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/index.html" class="parent "><input type="checkbox" id="R-section-0e0951862a264269c87df7fac4f297fb" aria-controls="R-subsections-0e0951862a264269c87df7fac4f297fb" checked><label for="R-section-0e0951862a264269c87df7fac4f297fb"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu ç»å…¸æ•™ç¨‹</span></label><a class="padding" href="../../../computer_graphics/classic_tutorial/index.html">ç»å…¸æ•™ç¨‹</a><ul id="R-subsections-0e0951862a264269c87df7fac4f297fb" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/basics_tutorial/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/basics_tutorial/index.html">åŸºç¡€æ•™ç¨‹</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/shader_tutorial/index.html" class="active"><a class="padding" href="../../../computer_graphics/classic_tutorial/shader_tutorial/index.html">ç€è‰²æ•™ç¨‹</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/index.html" class=""><input type="checkbox" id="R-section-06ac295778bd74c824886a3ab22c212c" aria-controls="R-subsections-06ac295778bd74c824886a3ab22c212c"><label for="R-section-06ac295778bd74c824886a3ab22c212c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu å…‰çº¿è¿½è¸ª</span></label><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/index.html">å…‰çº¿è¿½è¸ª</a><ul id="R-subsections-06ac295778bd74c824886a3ab22c212c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_in_one_weekend/index.html">Ray Tracing in One Weekend</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_next_week/index.html">Ray Tracing The Next Week</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/ray_tracing_the_rest_of_your_life/index.html">Ray Tracing The Rest of Your Life</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html" class=""><input type="checkbox" id="R-section-c33da7e0886830ccf91b260ac3fff456" aria-controls="R-subsections-c33da7e0886830ccf91b260ac3fff456"><label for="R-section-c33da7e0886830ccf91b260ac3fff456"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu Scratchapixe ç³»åˆ—çŸ­æ–‡</span></label><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/index.html">Scratchapixe ç³»åˆ—çŸ­æ–‡</a><ul id="R-subsections-c33da7e0886830ccf91b260ac3fff456" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-1/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-2/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-3/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-4/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-5/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/raytracing_tutorial/scratchapixel/scratchapixel-chapter-6/index.html">Chapter - 6</a></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/index.html" class=""><input type="checkbox" id="R-section-23d956a7f1e516a9e3d46517dfb799dd" aria-controls="R-subsections-23d956a7f1e516a9e3d46517dfb799dd"><label for="R-section-23d956a7f1e516a9e3d46517dfb799dd"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OpenGLæ•™ç¨‹</span></label><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/index.html">OpenGLæ•™ç¨‹</a><ul id="R-subsections-23d956a7f1e516a9e3d46517dfb799dd" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/learn_opengl/index.html">Learn OpenGL</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html" class=""><input type="checkbox" id="R-section-ae6b71edd18a266dbd92162060f7614e" aria-controls="R-subsections-ae6b71edd18a266dbd92162060f7614e"><label for="R-section-ae6b71edd18a266dbd92162060f7614e"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu OGL dev æ•™ç¨‹</span></label><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/index.html">OGL dev æ•™ç¨‹</a><ul id="R-subsections-ae6b71edd18a266dbd92162060f7614e" class="morespace collapsible-menu">
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_1_open_a_window/index.html">Chapter - 1</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_2_hello_dot/index.html">Chapter - 2</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_3_first_triangle/index.html">Chapter - 3</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_4_shaders/index.html">Chapter - 4</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_5_uniform_variables/index.html">Chapter - 5</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_6_translation_transformation/index.html">Chapter - 6</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_7_rotation_transformation/index.html">Chapter - 7</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_8_scaling_transformation/index.html">Chapter - 8</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_9_interpolation/index.html">Chapter - 9</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_10_indexed_draws/index.html">Chapter - 10</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_11_concatenating_transformations/index.html">Chapter - 11</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_12_perspective_projection/index.html">Chapter - 12</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_13_camera_space/index.html">Chapter - 13</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_14_camera_control_-_part_1/index.html">Chapter - 14</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_15_camera_control_-_part_2/index.html">Chapter - 15</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_16_basic_texture_mapping/index.html">Chapter - 16</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_17_ambient_lighting/index.html">Chapter - 17</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_18_diffuse_lighting/index.html">Chapter - 18</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_19_specular_lighting/index.html">Chapter - 19</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_20_point_light/index.html">Chapter - 20</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_21_spot_light/index.html">Chapter - 21</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_22_loading_models_using_the_open_asset_import_library/index.html">Chapter - 22</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_23_shadow_mapping_-_part_1/index.html">Chapter - 23</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_24_shadow_mapping_-_part_2/index.html">Chapter - 24</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_25_skybox/index.html">Chapter - 25</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_26_normal_mapping/index.html">Chapter - 26</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_27_billboarding_and_the_geometry_shader/index.html">Chapter - 27</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_28_particle_system_using_transform_feedback/index.html">Chapter - 28</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_29_3d_picking/index.html">Chapter - 29</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_30_basic_tessellation/index.html">Chapter - 30</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_31_pn_triangles_tessellation/index.html">Chapter - 31</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_32_vertex_array_objects/index.html">Chapter - 32</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_33_instanced_rendering/index.html">Chapter - 33</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_34_glfx_-_an_opengl_effect_library/index.html">Chapter - 34</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_35_deferred_shading_-_part_1/index.html">Chapter - 35</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_36_deferred_shading_-_part_2/index.html">Chapter - 36</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_37_deferred_shading_-_part_3/index.html">Chapter - 37</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_38_skeletal_animation_with_assimp/index.html">Chapter - 38</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_39_silhouette_detection/index.html">Chapter - 39</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_40_stencil_shadow_volume/index.html">Chapter - 40</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_41_object_motion_blur/index.html">Chapter - 41</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_42_percentage_closer_filtering/index.html">Chapter - 42</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_43_multipass_shadow_mapping_with_point_lights/index.html">Chapter - 43</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_44_glfw/index.html">Chapter - 44</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_45_screen_space_ambient_occlusion/index.html">Chapter - 45</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_46_ssao_with_depth_reconstruction/index.html">Chapter - 46</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_47_shadow_mapping_with_directional_lights/index.html">Chapter - 47</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_48_user_interface_with_ant_tweak_bar/index.html">Chapter - 48</a></li>
          <li data-nav-id="/computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html" class=""><a class="padding" href="../../../computer_graphics/classic_tutorial/opengl_tutorial/ogl_dev_modern_opengl_tutorial/tutorial_49_cascaded_shadow_mapping/index.html">Chapter - 49</a></li></ul></li></ul></li></ul></li>
          <li data-nav-id="/computer_graphics/book_recommend/index.html" class=""><a class="padding" href="../../../computer_graphics/book_recommend/index.html">ä¹¦ç±æ¨è</a></li>
          <li data-nav-id="/computer_graphics/blog_article/index.html" class=""><a class="padding" href="../../../computer_graphics/blog_article/index.html">åšå®¢æ–‡ç« </a></li>
          <li data-nav-id="/computer_graphics/reference/index.html" class=""><a class="padding" href="../../../computer_graphics/reference/index.html">å‚è€ƒèµ„æ–™</a></li></ul></li>
          <li data-nav-id="/computer_science/index.html" class=""><input type="checkbox" id="R-section-7d71eaebfb32275fa70e6b3397a5fe7c" aria-controls="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c"><label for="R-section-7d71eaebfb32275fa70e6b3397a5fe7c"><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class="a11y-only">Submenu è®¡ç®—æœºç§‘å­¦</span></label><a class="padding" href="../../../computer_science/index.html">è®¡ç®—æœºç§‘å­¦</a><ul id="R-subsections-7d71eaebfb32275fa70e6b3397a5fe7c" class="morespace collapsible-menu">
          <li data-nav-id="/computer_science/blog_article/index.html" class=""><a class="padding" href="../../../computer_science/blog_article/index.html">åšå®¢æ–‡ç« </a></li>
          <li data-nav-id="/computer_science/operating_system/index.html" class=""><a class="padding" href="../../../computer_science/operating_system/index.html">æ“ä½œç³»ç»Ÿ</a></li></ul></li>
          <li data-nav-id="/computer_networks/index.html" class=""><a class="padding" href="../../../computer_networks/index.html">è®¡ç®—æœºç½‘ç»œ</a></li>
          <li data-nav-id="/game_programming/index.html" class=""><a class="padding" href="../../../game_programming/index.html">æ¸¸æˆç¼–ç¨‹</a></li>
          <li data-nav-id="/database/index.html" class=""><a class="padding" href="../../../database/index.html">æ•°æ®åº“</a></li>
          </ul>
        </div>
        <div id="R-shortcuts">
          <div class="nav-title padding">More</div>
          <ul class="space">
            <li><a class="padding" href="https://github.com/McShelby/hugo-theme-relearn"><i class='fab fa-fw fa-github'></i> GitHub repo</a></li>
            <li><a class="padding" href="../../../tags/index.html"><i class='fas fa-fw fa-tags'></i> Tags</a></li>
            <li><a class="padding" href="../../../categories/index.html"><i class='fas fa-fw fa-layer-group'></i> Categories</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVariantSwitch">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-language fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = baseUri + this.value;">
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch showVariantSwitch">
                <div class="padding menu-control">
                  <i class="fas fa-paint-brush fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-auto" value="auto" selected>Auto</option>
                      <option id="R-relearn-light" value="relearn-light">Relearn Light</option>
                      <option id="R-relearn-dark" value="relearn-dark">Relearn Dark</option>
                      <option id="R-zen-light" value="zen-light">Zen Light</option>
                      <option id="R-zen-dark" value="zen-dark">Zen Dark</option>
                      <option id="R-neon" value="neon">Neon</option>
                      <option id="R-learn" value="learn">Learn</option>
                      <option id="R-blue" value="blue">Blue</option>
                      <option id="R-green" value="green">Green</option>
                      <option id="R-red" value="red">Red</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fas fa-history fa-fw"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
          <span class="github-buttons"></span>
          <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
          <script>
            function githubButtonsScheme(){
              var scheme = 'light';
              var colorPropertyValue = window.getComputedStyle( document.querySelector( '#R-sidebar' ) ).getPropertyValue( 'background-color' );
              var colorValues = colorPropertyValue.match( /\d+/g ).map( function( e ){ return parseInt(e,10); });
              if( colorValues.length === 3 && ((0.2126 * colorValues[0]) + (0.7152 * colorValues[1]) + (0.0722 * colorValues[2]) < 165) ){
                
                scheme = 'dark';
              }
              return scheme;
            }
            function githubButtonsInit(){
              if( !window.githubButtons ){
                
                setTimeout( githubButtonsInit, 50 );
                return;
              }
              var scheme = githubButtonsScheme();
              var githubButtonsHTML = `
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/archive/main.zip" data-color-scheme="${scheme}" data-icon="octicon-cloud-download" aria-label="Download McShelby/hugo-theme-relearn on GitHub">Download</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn" data-color-scheme="${scheme}" data-icon="octicon-star" data-show-count="true" aria-label="Star McShelby/hugo-theme-relearn on GitHub">Star</a>
                <a class="github-button" href="https://github.com/McShelby/hugo-theme-relearn/fork" data-color-scheme="${scheme}" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork McShelby/hugo-theme-relearn on GitHub">Fork</a>
               `;
              document.querySelector( '.github-buttons' ).innerHTML = githubButtonsHTML;
              document.querySelectorAll( '.github-button' ).forEach( function( anchor ){
                anchor.dataset.colorScheme = scheme;
                window.githubButtons.render( anchor, function( el ){
                  anchor.parentNode.replaceChild( el, anchor );
                });
              });
            }
            document.addEventListener( 'themeVariantLoaded', function( e ){
              
              setTimeout( githubButtonsInit, 400 );
            });
          </script>
          <script async src="../../../js/github-buttons.js?1708235103"></script>
          </div>
        </div>
      </div>
    </aside>
    <script src="../../../js/clipboard.min.js?1708235103" defer></script>
    <script src="../../../js/perfect-scrollbar.min.js?1708235103" defer></script>
    <script src="../../../js/theme.js?1708235103" defer></script>
  </body>
</html>
